.2025-11-10 19:43:37,606 - main - INFO - 
2025-11-10 19:43:37,607 - main - INFO - ================================================================================
2025-11-10 19:43:37,608 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-10 19:43:37,609 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-10 19:43:37,610 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-10 19:43:37,611 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-10 19:43:37,611 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-10 19:43:37,612 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-10 19:43:37,613 - main - INFO -   âœ… User Documents Service connection closed
2025-11-10 19:43:37,613 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-10 19:43:37,614 - main - INFO -   âœ… Application stopped successfully
2025-11-10 19:43:37,614 - main - INFO - ================================================================================
2025-11-10 19:43:37,614 - main - INFO - 
2025-11-11 15:28:24,152 - main - INFO - 
2025-11-11 15:28:24,152 - main - INFO - ================================================================================
2025-11-11 15:28:24,152 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-11 15:28:24,153 - main - INFO -   Production-Ready Complete Integration
2025-11-11 15:28:24,153 - main - INFO - ================================================================================
2025-11-11 15:28:24,153 - main - INFO -   AI Model: gpt-4o-mini
2025-11-11 15:28:24,153 - main - INFO -   Upload Directory: uploads
2025-11-11 15:28:24,153 - main - INFO -   Max File Size: 20MB
2025-11-11 15:28:24,154 - main - INFO - ================================================================================
2025-11-11 15:28:24,154 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-11 15:28:24,154 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-11 15:28:24,155 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-11 15:28:24,437 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-11 15:28:24,451 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-11 15:28:24,452 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-11 15:28:24,453 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-11 15:28:24,453 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-11 15:28:24,454 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-11 15:28:24,454 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-11 15:28:24,455 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-11 15:28:24,493 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-11 15:28:24,494 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-11 15:28:24,495 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-11 15:28:24,497 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-11 15:28:24,498 - main - INFO -   âœ… User Subscription Service connected
2025-11-11 15:28:24,498 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-11 15:28:24,498 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-11 15:28:24,499 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-11 15:28:24,529 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-11 15:28:24,529 - main - INFO -   âœ… User Documents Service connected
2025-11-11 15:28:24,530 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-11 15:28:24,531 - main - INFO - 
2025-11-11 15:28:24,531 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-11 15:28:24,532 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-11 15:28:24,532 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-11 15:28:24,533 - main - INFO -        - Separates warranties from extensions
2025-11-11 15:28:24,533 - main - INFO -        - Extracts subjectivities & operational details
2025-11-11 15:28:24,534 - main - INFO -        - Correct deductible tier detection
2025-11-11 15:28:24,534 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-11 15:28:24,534 - main - INFO - 
2025-11-11 15:28:24,535 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-11 15:28:24,535 - main - INFO -        - Generates ALL sections comprehensively
2025-11-11 15:28:24,535 - main - INFO -        - Identifies unique items per provider
2025-11-11 15:28:24,536 - main - INFO -        - Transparent scoring methodology
2025-11-11 15:28:24,536 - main - INFO -        - Uses full _extended_data from parser
2025-11-11 15:28:24,536 - main - INFO - 
2025-11-11 15:28:24,536 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-11 15:28:24,537 - main - INFO -        - Single endpoint auto-populates everything
2025-11-11 15:28:24,537 - main - INFO -        - No manual section generation
2025-11-11 15:28:24,537 - main - INFO -        - Complete MongoDB integration
2025-11-11 15:28:24,537 - main - INFO - 
2025-11-11 15:28:24,538 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-11 15:28:24,538 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-11 15:28:24,539 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-11 15:28:24,539 - main - INFO -      âœ… Subjectivities: Now included
2025-11-11 15:28:24,539 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-11 15:28:24,540 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-11 15:28:24,540 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-11 15:28:24,540 - main - INFO - 
2025-11-11 15:28:24,541 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-11 15:28:24,541 - main - INFO -      Main:
2025-11-11 15:28:24,541 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-11 15:28:24,541 - main - INFO - 
2025-11-11 15:28:24,542 - main - INFO -      Retrieval:
2025-11-11 15:28:24,542 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-11 15:28:24,542 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-11 15:28:24,542 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-11 15:28:24,542 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-11 15:28:24,543 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-11 15:28:24,543 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-11 15:28:24,543 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-11 15:28:24,543 - main - INFO - 
2025-11-11 15:28:24,544 - main - INFO -      Management:
2025-11-11 15:28:24,544 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-11 15:28:24,544 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-11 15:28:24,544 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-11 15:28:24,545 - main - INFO - 
2025-11-11 15:28:24,545 - main - INFO -      Documents (MongoDB):
2025-11-11 15:28:24,545 - main - INFO -        GET  /api/documents                All documents
2025-11-11 15:28:24,545 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-11 15:28:24,545 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-11 15:28:24,546 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-11 15:28:24,546 - main - INFO - 
2025-11-11 15:28:24,546 - main - INFO -      Diagnostics & Health:
2025-11-11 15:28:24,546 - main - INFO -        GET  /api/health                   System health
2025-11-11 15:28:24,546 - main - INFO -        GET  /api/status                   Detailed status
2025-11-11 15:28:24,546 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-11 15:28:24,547 - main - INFO - 
2025-11-11 15:28:24,547 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-11 15:28:24,547 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-11 15:28:24,547 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-11 15:28:24,548 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-11 15:28:24,548 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-11 15:28:24,548 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-11 15:28:24,548 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-11 15:28:24,548 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-11 15:28:24,549 - main - INFO - 
2025-11-11 15:28:24,549 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-11 15:28:24,549 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-11 15:28:24,549 - main - INFO -      2. Receive comparison_id + complete data
2025-11-11 15:28:24,549 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-11 15:28:24,550 - main - INFO -      4. No re-upload needed!
2025-11-11 15:28:24,550 - main - INFO - 
2025-11-11 15:28:24,550 - main - INFO - ================================================================================
2025-11-11 15:28:24,550 - main - INFO -   âœ… Application started successfully!
2025-11-11 15:28:24,550 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-11 15:28:24,550 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-11 15:28:24,551 - main - INFO - ================================================================================
2025-11-11 15:28:24,551 - main - INFO - 
2025-11-11 15:28:24,551 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-11 15:28:24,801 - main - INFO - ðŸ“¥ GET /
2025-11-11 15:28:24,802 - main - INFO - ðŸ“¤ GET / - 200 - 0.00s
2025-11-11 15:28:24,843 - main - INFO - ðŸ“¥ GET /favicon.ico
2025-11-11 15:28:24,844 - main - INFO - ðŸ“¤ GET /favicon.ico - 404 - 0.00s
2025-11-11 15:28:34,446 - main - INFO - ðŸ“¥ GET /docs
2025-11-11 15:28:34,447 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-11 15:28:35,430 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-11 15:28:35,439 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-11 15:30:31,181 - main - INFO - ðŸ“¥ GET /api/health
2025-11-11 15:30:31,182 - main - INFO - ðŸ“¤ GET /api/health - 200 - 0.00s
2025-11-11 15:31:09,308 - main - INFO - ðŸ“¥ GET /api/
2025-11-11 15:31:09,309 - main - INFO - ðŸ“¤ GET /api/ - 200 - 0.00s
2025-11-11 15:41:49,796 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-11 15:41:49,815 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-11 15:41:49,816 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-11 15:41:49,817 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-11 15:41:49,817 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-11 15:41:49,824 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-11 15:41:49,825 - app.api.routes - WARNING - âŒ Comparison not allowed for user 690b5e52447df54e13f39f1e: Maximum 3 quotes per case allowed for your plan. You uploaded 4 files.
2025-11-11 15:41:49,826 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.03s
2025-11-11 15:41:55,626 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-11 15:41:55,631 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-11 15:41:55,631 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-11 15:41:55,631 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-11 15:41:55,632 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-11 15:41:55,634 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-11 15:41:55,636 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-11 15:41:55,636 - app.api.routes - INFO -    - Remaining comparisons: 241
2025-11-11 15:41:55,637 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-11 15:41:55,637 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-11 15:41:55,638 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1762875715_8918ec9e2cd2
2025-11-11 15:41:55,639 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_10a49b775b49 (3 files)
2025-11-11 15:41:55,639 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_10a49b775b49
2025-11-11 15:41:55,640 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:41:55,640 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:41:55,640 - app.api.routes - INFO - ======================================================================
2025-11-11 15:41:55,642 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 7c92e6f7f0c24baf8bcc3ad7a0d2574b.pdf (331157 bytes)
2025-11-11 15:41:55,643 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:41:55,645 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\7c92e6f7f0c24baf8bcc3ad7a0d2574b.pdf
2025-11-11 15:41:55,645 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:41:55,737 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:41:55,740 - app.api.routes - INFO - ======================================================================
2025-11-11 15:41:55,741 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ de90e02182114009bb019936a2491a0d.pdf (464206 bytes)
2025-11-11 15:41:55,766 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:41:55,774 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-11 15:41:55,775 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\de90e02182114009bb019936a2491a0d.pdf
2025-11-11 15:41:55,775 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:41:55,775 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:41:55,807 - app.api.routes - INFO - ======================================================================
2025-11-11 15:41:55,838 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-11 15:41:55,838 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ a955850ce2a745f1a9e08a1106636ce9.pdf (175401 bytes)
2025-11-11 15:41:55,839 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:41:55,839 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a955850ce2a745f1a9e08a1106636ce9.pdf
2025-11-11 15:41:55,840 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:41:55,840 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:41:55,864 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-11 15:41:55,889 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-11 15:41:55,890 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-11 15:41:55,890 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-11 15:41:55,890 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-11 15:41:55,891 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-11 15:41:56,009 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-11 15:41:56,010 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-11 15:41:56,650 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:41:56,650 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:41:56,651 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-11 15:41:56,651 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-11 15:41:56,651 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-11 15:41:56,652 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-11 15:41:56,652 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-11 15:41:56,811 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-11 15:41:56,811 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-11 15:41:56,812 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:41:56,812 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:41:56,813 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-11 15:41:56,813 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-11 15:41:56,814 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-11 15:41:56,814 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-11 15:41:56,815 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-11 15:41:56,894 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-11 15:41:56,895 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-11 15:42:27,511 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:42:27,822 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-11 15:42:27,822 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-11 15:42:27,926 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:27,927 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:36,891 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:42:37,149 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-11 15:42:37,149 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-11 15:42:37,150 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-11 15:42:37,151 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-11 15:42:37,151 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: N/A
2025-11-11 15:42:37,151 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-11 15:42:37,151 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-11 15:42:44,115 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:42:44,117 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 70.0
2025-11-11 15:42:44,118 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-11 15:42:44,118 - app.services.ai_parser - INFO - 
2025-11-11 15:42:44,118 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:42:44,119 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:42:44,119 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:42:44,119 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-11 15:42:44,119 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-11 15:42:44,120 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-11 15:42:44,120 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-11 15:42:44,120 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 70.0/100
2025-11-11 15:42:44,120 - app.services.ai_parser - INFO - ðŸ“ Quality: 92.3/100
2025-11-11 15:42:44,121 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: N/A
2025-11-11 15:42:44,121 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-11 15:42:44,121 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-11 15:42:44,121 - app.services.ai_parser - INFO - 
2025-11-11 15:42:44,122 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-11 15:42:44,122 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-11 15:42:44,122 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-11 15:42:44,122 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-11 15:42:44,122 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-11 15:42:44,123 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-11 15:42:44,123 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:42:44,134 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: de90e02182114009bb019936a2491a0d.pdf â†’ 69135974b895600e98fa8a9b
2025-11-11 15:42:44,135 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69135974b895600e98fa8a9b
2025-11-11 15:42:44,142 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69135974b895600e98fa8a9c (464206 bytes)
2025-11-11 15:42:44,142 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69135974b895600e98fa8a9c
2025-11-11 15:42:44,142 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:42:44,950 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:44,951 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:46,247 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:46,249 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:46,781 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:46,782 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:47,379 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:47,380 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:47,587 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:47,588 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:47,763 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:47,765 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:47,957 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:47,958 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:48,120 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:48,121 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:48,272 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:48,273 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:48,428 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:48,430 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:48,571 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:48,572 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:48,751 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:48,752 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:49,038 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:49,038 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:49,250 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:49,251 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:49,439 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:49,440 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:49,644 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:49,644 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:49,857 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:49,858 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:50,140 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:50,140 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:50,335 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:50,336 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:50,532 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:50,533 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:50,714 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:50,715 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:50,881 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:50,882 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:51,046 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:51,048 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:51,234 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:51,235 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:51,417 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:51,417 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:51,603 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:51,604 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:51,785 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:51,786 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:51,965 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:51,966 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:52,109 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:52,109 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:52,284 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:52,285 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:52,466 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:52,466 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:52,624 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:52,625 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:52,812 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:52,813 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:52,976 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:52,977 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:53,156 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:53,156 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:53,322 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:53,323 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:53,488 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:53,488 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:53,664 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:53,665 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:53,843 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:53,844 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:54,010 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:54,011 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:54,196 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:54,198 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:54,381 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:54,382 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:54,561 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:54,562 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:54,752 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:54,753 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:54,939 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:54,940 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:55,127 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:55,128 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:55,292 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:55,292 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:55,475 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:55,476 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:55,648 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:55,649 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:55,838 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:55,839 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:56,028 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:56,029 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:56,223 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:56,224 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:56,416 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:56,416 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:56,602 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:56,603 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:56,779 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:56,780 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:56,945 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:56,946 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:57,122 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:57,123 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:57,311 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:57,312 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:57,504 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:57,505 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:57,700 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:57,701 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:57,893 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:57,894 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:58,072 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:58,073 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:58,281 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:58,282 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:58,481 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:58,482 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:58,706 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:58,706 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:58,918 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:58,919 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:59,137 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:59,138 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:59,364 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:59,365 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:59,562 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:59,563 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:59,744 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:59,745 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:42:59,973 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:42:59,974 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:00,213 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:00,214 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:00,481 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:00,482 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:00,711 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:00,712 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:01,469 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:01,470 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:01,674 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:01,674 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:02,778 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:02,779 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:03,342 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:03,343 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:03,550 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:03,551 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:03,770 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:03,771 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:04,123 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:04,124 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:04,336 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:04,337 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:04,808 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:04,809 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:05,193 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:05,194 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:05,432 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:05,433 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:05,772 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:05,773 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:06,014 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:06,015 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:06,239 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:06,240 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:06,472 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:06,473 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:06,804 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:06,805 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:07,033 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:07,034 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:07,225 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:07,226 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:07,403 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:07,404 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:07,679 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:07,680 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:07,864 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:07,865 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:08,039 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:08,040 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:08,232 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:08,233 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:08,410 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:08,411 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:08,580 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:08,581 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:08,761 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:08,762 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:08,928 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:08,929 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:09,125 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:09,126 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:09,301 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:09,302 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:09,473 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:09,475 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:09,650 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:09,651 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:09,841 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:09,842 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:10,015 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:10,016 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:10,203 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:10,204 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:10,391 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:10,391 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:10,572 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:10,572 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:11,451 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:11,452 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:12,183 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:12,184 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:12,774 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:12,774 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:13,017 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:13,019 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-11 15:43:13,019 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-11 15:43:13,308 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:13,309 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:14,445 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:14,446 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:15,702 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:16,200 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-11 15:43:16,201 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-11 15:43:17,027 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:17,028 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:17,193 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:17,194 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:17,404 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:17,405 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:17,558 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:17,558 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:17,734 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:17,735 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:18,482 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:18,483 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:18,656 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:18,657 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:18,821 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:18,822 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:19,014 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:19,015 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:19,225 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:19,226 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:19,405 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:19,406 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:19,627 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:19,628 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:19,818 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:19,819 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:20,004 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:20,005 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:20,221 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:20,222 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:20,413 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:20,414 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:20,604 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:20,605 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:20,797 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:20,801 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-11 15:43:20,802 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-11 15:43:20,803 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-11 15:43:20,803 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-11 15:43:20,804 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:43:20,805 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:43:20,806 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:43:20,806 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-11 15:43:20,807 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-11 15:43:20,808 - app.services.ai_parser - INFO - ðŸ“Š Counts: 52 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-11 15:43:21,543 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:21,544 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:23,025 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:23,026 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:23,346 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:23,347 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:23,613 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:23,614 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:23,877 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:23,878 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:24,482 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:24,505 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:24,505 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:24,789 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:24,790 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:25,076 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:25,077 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:25,200 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-11 15:43:25,200 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-11 15:43:25,200 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-11 15:43:25,201 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-11 15:43:25,201 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:43:25,201 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:43:25,201 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:43:25,202 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-11 15:43:25,202 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-11 15:43:25,202 - app.services.ai_parser - INFO - ðŸ“Š Counts: 37 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-11 15:43:25,398 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:25,398 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:25,700 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:25,701 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:27,050 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:27,051 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:27,282 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:27,283 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:27,589 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:27,590 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:27,874 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:27,875 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:28,193 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:28,194 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:28,466 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:28,467 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:28,770 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:28,771 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:28,795 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:29,047 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-11 15:43:29,047 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-11 15:43:29,047 - app.services.ai_parser - INFO - 
2025-11-11 15:43:29,048 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:43:29,048 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:43:29,048 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:43:29,048 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-11 15:43:29,048 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-11 15:43:29,048 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-11 15:43:29,049 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-11 15:43:29,049 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-11 15:43:29,049 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-11 15:43:29,049 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-11 15:43:29,049 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-11 15:43:29,050 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-11 15:43:29,050 - app.services.ai_parser - INFO - 
2025-11-11 15:43:29,050 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-11 15:43:29,050 - app.services.ai_parser - INFO -    âœ“ Benefits: 52
2025-11-11 15:43:29,050 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-11 15:43:29,050 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-11 15:43:29,051 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-11 15:43:29,051 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-11 15:43:29,051 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:43:29,053 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 7c92e6f7f0c24baf8bcc3ad7a0d2574b.pdf â†’ 691359a1b895600e98fa8a9d
2025-11-11 15:43:29,053 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691359a1b895600e98fa8a9d
2025-11-11 15:43:29,056 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691359a1b895600e98fa8a9e (331157 bytes)
2025-11-11 15:43:29,056 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691359a1b895600e98fa8a9e
2025-11-11 15:43:29,056 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:43:29,085 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:29,086 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:29,464 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:29,465 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:29,774 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:29,774 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:30,452 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:30,453 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:30,995 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:30,996 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:31,219 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:31,220 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:31,443 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:31,444 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:31,674 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:31,675 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:31,884 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:31,884 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:32,075 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:32,095 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:32,096 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:32,314 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:32,315 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:32,334 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-11 15:43:32,335 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-11 15:43:32,335 - app.services.ai_parser - INFO - 
2025-11-11 15:43:32,335 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:43:32,336 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:43:32,336 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:43:32,336 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-11 15:43:32,336 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-11 15:43:32,337 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-11 15:43:32,337 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-11 15:43:32,337 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-11 15:43:32,338 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-11 15:43:32,338 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-11 15:43:32,338 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-11 15:43:32,338 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-11 15:43:32,339 - app.services.ai_parser - INFO - 
2025-11-11 15:43:32,339 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-11 15:43:32,339 - app.services.ai_parser - INFO -    âœ“ Benefits: 37
2025-11-11 15:43:32,339 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-11 15:43:32,339 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-11 15:43:32,339 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-11 15:43:32,340 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-11 15:43:32,340 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:43:32,341 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a955850ce2a745f1a9e08a1106636ce9.pdf â†’ 691359a4b895600e98fa8a9f
2025-11-11 15:43:32,341 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691359a4b895600e98fa8a9f
2025-11-11 15:43:32,343 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691359a4b895600e98fa8aa0 (175401 bytes)
2025-11-11 15:43:32,344 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691359a4b895600e98fa8aa0
2025-11-11 15:43:32,344 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:43:32,344 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-11 15:43:32,344 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:43:32,345 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-11 15:43:32,345 - app.api.routes - INFO - ======================================================================
2025-11-11 15:43:32,345 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-11 15:43:32,345 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-11 15:43:32,346 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-11 15:43:32,346 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=74.72
2025-11-11 15:43:32,346 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-11 15:43:32,347 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.12
2025-11-11 15:43:32,347 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-11 15:43:32,347 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-11 15:43:32,543 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:32,544 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:32,783 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:32,784 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:33,002 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:33,003 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:33,316 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:33,317 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:33,543 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:33,543 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:33,777 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:33,778 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:34,044 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:34,045 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:34,310 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:34,311 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:34,520 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:34,521 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:34,733 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:34,734 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:34,954 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:34,955 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:35,187 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:35,188 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:35,429 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:35,430 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:35,644 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:35,646 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:35,889 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:35,890 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:36,081 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:36,082 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:37,026 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:37,027 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:46,936 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:46,937 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:47,570 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:47,571 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:48,093 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:48,094 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:43:48,126 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:43:48,128 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-11 15:43:48,128 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-11 15:43:48,128 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-11 15:43:48,129 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-11 15:43:48,129 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-11 15:43:48,129 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1762875715_8918ec9e2cd2
2025-11-11 15:43:48,130 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-11 15:43:48,130 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-11 15:43:48,130 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-11 15:43:48,131 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-11 15:43:48,131 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-11 15:43:48,131 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-11 15:43:48,132 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-11 15:43:48,132 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-11 15:43:48,132 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-11 15:43:48,133 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-11 15:43:48,133 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-11 15:43:48,133 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-11 15:43:48,133 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-11 15:43:48,134 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-11 15:43:48,134 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-11 15:43:48,134 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-11 15:43:48,135 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-11 15:43:48,137 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-11 15:43:48,137 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,102 bytes
2025-11-11 15:43:48,138 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 27,455 bytes
2025-11-11 15:43:48,138 - app.services.mongodb_service_enhanced - INFO -    Data table: 11,552 bytes
2025-11-11 15:43:48,138 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,744 bytes
2025-11-11 15:43:48,138 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 48,222 bytes
2025-11-11 15:43:48,139 - app.services.mongodb_service_enhanced - INFO -    Total document: 193,475 bytes
2025-11-11 15:43:48,139 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-11 15:43:48,139 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-11 15:43:48,139 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-11 15:43:48,140 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-11 15:43:48,140 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-11 15:43:48,140 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-11 15:43:48,140 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-11 15:43:48,141 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-11 15:43:48,141 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-11 15:43:48,141 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-11 15:43:48,141 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-11 15:43:48,141 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-11 15:43:48,142 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-11 15:43:48,142 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-11 15:43:48,142 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-11 15:43:48,142 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-11 15:43:48,142 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-11 15:43:48,142 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-11 15:43:48,143 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-11 15:43:48,143 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-11 15:43:48,165 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1762875715_8918ec9e2cd2
2025-11-11 15:43:48,166 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691359b4d8b5ddffe68e95b7
2025-11-11 15:43:48,169 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-11 15:43:48,170 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-11 15:43:48,170 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-11 15:43:48,170 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-11 15:43:48,171 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-11 15:43:48,171 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-11 15:43:48,171 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-11 15:43:48,171 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-11 15:43:48,172 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-11 15:43:48,172 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-11 15:43:48,172 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-11 15:43:48,173 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-11 15:43:48,173 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-11 15:43:48,173 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-11 15:43:48,174 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-11 15:43:48,174 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-11 15:43:48,174 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-11 15:43:48,174 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-11 15:43:48,174 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-11 15:43:48,175 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691359b4d8b5ddffe68e95b7
2025-11-11 15:43:48,175 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-11 15:43:48,175 - app.api.routes - INFO -    Collection: comparisons
2025-11-11 15:43:48,175 - app.api.routes - INFO -    Comparison ID: cmp_1762875715_8918ec9e2cd2
2025-11-11 15:43:48,183 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-11 15:43:48,184 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-11 15:43:48,184 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:43:48,184 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-11 15:43:48,185 - app.api.routes - INFO - ======================================================================
2025-11-11 15:43:48,185 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1762875715_8918ec9e2cd2
2025-11-11 15:43:48,185 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-11 15:43:48,186 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-11 15:43:48,186 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-11 15:43:48,186 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-11 15:43:48,187 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-11 15:43:48,187 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-11 15:43:48,188 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-11 15:43:48,190 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 240
2025-11-11 15:43:48,191 - app.api.routes - INFO - ======================================================================

2025-11-11 15:43:48,191 - app.services.progress_tracker - INFO - âœ… Job completed: job_10a49b775b49 â†’ comparison_id: cmp_1762875715_8918ec9e2cd2
2025-11-11 15:43:48,192 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 112.57s
2025-11-11 15:43:48,827 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:43:48,828 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:44:07,761 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-11 15:44:07,766 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-11 15:44:07,766 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-11 15:44:07,766 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-11 15:44:07,766 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-11 15:44:07,768 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-11 15:44:07,769 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-11 15:44:07,770 - app.api.routes - INFO -    - Remaining comparisons: 240
2025-11-11 15:44:07,770 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-11 15:44:07,771 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-11 15:44:07,771 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1762875847_647aecc38469
2025-11-11 15:44:07,772 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_2b9e62ae175f (3 files)
2025-11-11 15:44:07,772 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_2b9e62ae175f
2025-11-11 15:44:07,773 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:44:07,773 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:44:07,774 - app.api.routes - INFO - ======================================================================
2025-11-11 15:44:07,775 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ bf6f3e06f44e4885ba77821095a3de64.pdf (331157 bytes)
2025-11-11 15:44:07,776 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:44:07,776 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:44:07,776 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\bf6f3e06f44e4885ba77821095a3de64.pdf
2025-11-11 15:44:07,777 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:44:07,777 - app.api.routes - INFO - ======================================================================
2025-11-11 15:44:07,835 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-11 15:44:07,835 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ f160b6c197c04990a1b3cc448ad2659c.pdf (464206 bytes)
2025-11-11 15:44:07,836 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:44:07,836 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:44:07,836 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:44:07,836 - app.api.routes - INFO - ======================================================================
2025-11-11 15:44:07,836 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\f160b6c197c04990a1b3cc448ad2659c.pdf
2025-11-11 15:44:07,895 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-11 15:44:07,895 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ f7c011be16094042a460fb89392da8b2.pdf (175401 bytes)
2025-11-11 15:44:07,895 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:44:07,896 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\f7c011be16094042a460fb89392da8b2.pdf
2025-11-11 15:44:07,896 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:44:07,909 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:44:07,923 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-11 15:44:07,941 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-11 15:44:07,942 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-11 15:44:07,942 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-11 15:44:07,942 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-11 15:44:07,942 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-11 15:44:08,044 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-11 15:44:08,044 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-11 15:44:08,046 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:44:08,046 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:44:08,047 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-11 15:44:08,047 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-11 15:44:08,048 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-11 15:44:08,048 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-11 15:44:08,049 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-11 15:44:08,206 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-11 15:44:08,207 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-11 15:44:08,209 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:44:08,209 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:44:08,209 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-11 15:44:08,209 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-11 15:44:08,210 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-11 15:44:08,210 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-11 15:44:08,210 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-11 15:44:08,287 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-11 15:44:08,288 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-11 15:44:10,681 - main - INFO - ðŸ“¥ GET /api/progress/job_10a49b775b49
2025-11-11 15:44:10,682 - main - INFO - ðŸ“¤ GET /api/progress/job_10a49b775b49 - 200 - 0.00s
2025-11-11 15:44:35,530 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:44:35,531 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:44:37,183 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:44:37,665 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-11 15:44:37,666 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-11 15:44:49,311 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:44:49,895 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-11 15:44:49,896 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-11 15:44:50,157 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:44:50,423 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-11 15:44:50,424 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-11 15:44:50,424 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-11 15:44:50,425 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-11 15:44:50,426 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: N/A
2025-11-11 15:44:50,427 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-11 15:44:50,427 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-11 15:44:58,962 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:44:58,964 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 70.0
2025-11-11 15:44:58,964 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-11 15:44:58,965 - app.services.ai_parser - INFO - 
2025-11-11 15:44:58,965 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:44:58,966 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:44:58,966 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:44:58,966 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-11 15:44:58,966 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-11 15:44:58,967 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-11 15:44:58,967 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-11 15:44:58,967 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 70.0/100
2025-11-11 15:44:58,968 - app.services.ai_parser - INFO - ðŸ“ Quality: 92.3/100
2025-11-11 15:44:58,968 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: N/A
2025-11-11 15:44:58,968 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-11 15:44:58,968 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-11 15:44:58,969 - app.services.ai_parser - INFO - 
2025-11-11 15:44:58,969 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-11 15:44:58,969 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-11 15:44:58,969 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-11 15:44:58,969 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-11 15:44:58,970 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-11 15:44:58,970 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-11 15:44:58,970 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:44:58,971 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: f160b6c197c04990a1b3cc448ad2659c.pdf â†’ 691359fab895600e98fa8aa1
2025-11-11 15:44:58,972 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691359fab895600e98fa8aa1
2025-11-11 15:44:58,975 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691359fab895600e98fa8aa2 (464206 bytes)
2025-11-11 15:44:58,976 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691359fab895600e98fa8aa2
2025-11-11 15:44:58,976 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-11 15:44:59,919 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:45:00,659 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-11 15:45:00,659 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-11 15:45:00,660 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-11 15:45:00,660 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-11 15:45:00,660 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:45:00,661 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:45:00,661 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:45:00,661 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-11 15:45:00,661 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-11 15:45:00,661 - app.services.ai_parser - INFO - ðŸ“Š Counts: 6 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-11 15:45:06,516 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:45:06,520 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-11 15:45:06,520 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-11 15:45:06,520 - app.services.ai_parser - INFO - 
2025-11-11 15:45:06,521 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:45:06,521 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:45:06,521 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:45:06,521 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-11 15:45:06,522 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-11 15:45:06,522 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-11 15:45:06,522 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-11 15:45:06,522 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-11 15:45:06,522 - app.services.ai_parser - INFO - ðŸ“ Quality: 94.7/100
2025-11-11 15:45:06,523 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-11 15:45:06,523 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-11 15:45:06,523 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-11 15:45:06,523 - app.services.ai_parser - INFO - 
2025-11-11 15:45:06,523 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-11 15:45:06,523 - app.services.ai_parser - INFO -    âœ“ Benefits: 6
2025-11-11 15:45:06,524 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-11 15:45:06,524 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-11 15:45:06,524 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-11 15:45:06,524 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-11 15:45:06,524 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:45:06,526 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: f7c011be16094042a460fb89392da8b2.pdf â†’ 69135a02b895600e98fa8aa3
2025-11-11 15:45:06,526 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69135a02b895600e98fa8aa3
2025-11-11 15:45:06,528 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69135a02b895600e98fa8aa4 (175401 bytes)
2025-11-11 15:45:06,529 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69135a02b895600e98fa8aa4
2025-11-11 15:45:06,529 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-11 15:45:26,550 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:45:27,603 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-11 15:45:27,603 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-11 15:45:35,809 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:35,809 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:36,100 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:45:36,106 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-11 15:45:36,107 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-11 15:45:36,107 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-11 15:45:36,107 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-11 15:45:36,108 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:45:36,108 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:45:36,108 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-11 15:45:36,108 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-11 15:45:36,108 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-11 15:45:36,108 - app.services.ai_parser - INFO - ðŸ“Š Counts: 52 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-11 15:45:38,457 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:38,458 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:42,779 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:45:42,783 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-11 15:45:42,783 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-11 15:45:42,784 - app.services.ai_parser - INFO - 
2025-11-11 15:45:42,785 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:45:42,785 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:45:42,786 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:45:42,787 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-11 15:45:42,788 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-11 15:45:42,788 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-11 15:45:42,789 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-11 15:45:42,789 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-11 15:45:42,790 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-11 15:45:42,791 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-11 15:45:42,792 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-11 15:45:42,792 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-11 15:45:42,792 - app.services.ai_parser - INFO - 
2025-11-11 15:45:42,793 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-11 15:45:42,793 - app.services.ai_parser - INFO -    âœ“ Benefits: 52
2025-11-11 15:45:42,793 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-11 15:45:42,794 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-11 15:45:42,794 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-11 15:45:42,794 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-11 15:45:42,794 - app.services.ai_parser - INFO - ======================================================================
2025-11-11 15:45:42,796 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: bf6f3e06f44e4885ba77821095a3de64.pdf â†’ 69135a26b895600e98fa8aa5
2025-11-11 15:45:42,797 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69135a26b895600e98fa8aa5
2025-11-11 15:45:42,800 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69135a26b895600e98fa8aa6 (331157 bytes)
2025-11-11 15:45:42,801 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69135a26b895600e98fa8aa6
2025-11-11 15:45:42,801 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-11 15:45:42,802 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-11 15:45:42,802 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:45:42,803 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-11 15:45:42,803 - app.api.routes - INFO - ======================================================================
2025-11-11 15:45:42,803 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-11 15:45:42,804 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-11 15:45:42,804 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-11 15:45:42,804 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=74.72
2025-11-11 15:45:42,805 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=78.43
2025-11-11 15:45:42,805 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-11 15:45:42,805 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-11 15:45:42,805 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-11 15:45:46,618 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:46,619 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:48,946 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:48,947 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:49,570 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:49,571 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:49,890 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:49,891 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:50,236 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:50,237 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:50,619 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:50,620 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:51,440 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:51,441 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:51,728 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:51,729 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:52,050 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:45:52,051 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:45:52,225 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-11 15:45:52,226 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-11 15:45:52,227 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-11 15:45:52,227 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-11 15:45:52,228 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-11 15:45:52,228 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-11 15:45:52,228 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1762875847_647aecc38469
2025-11-11 15:45:52,229 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-11 15:45:52,229 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-11 15:45:52,229 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-11 15:45:52,230 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-11 15:45:52,230 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-11 15:45:52,231 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-11 15:45:52,231 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-11 15:45:52,231 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-11 15:45:52,232 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-11 15:45:52,232 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-11 15:45:52,232 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-11 15:45:52,233 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-11 15:45:52,233 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-11 15:45:52,233 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-11 15:45:52,233 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-11 15:45:52,234 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-11 15:45:52,234 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-11 15:45:52,236 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-11 15:45:52,237 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,075 bytes
2025-11-11 15:45:52,237 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 26,846 bytes
2025-11-11 15:45:52,237 - app.services.mongodb_service_enhanced - INFO -    Data table: 11,315 bytes
2025-11-11 15:45:52,237 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,744 bytes
2025-11-11 15:45:52,238 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 43,139 bytes
2025-11-11 15:45:52,238 - app.services.mongodb_service_enhanced - INFO -    Total document: 181,501 bytes
2025-11-11 15:45:52,238 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-11 15:45:52,238 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-11 15:45:52,239 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-11 15:45:52,239 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-11 15:45:52,239 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-11 15:45:52,239 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-11 15:45:52,239 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-11 15:45:52,239 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-11 15:45:52,240 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-11 15:45:52,240 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-11 15:45:52,240 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-11 15:45:52,240 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-11 15:45:52,240 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-11 15:45:52,240 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-11 15:45:52,241 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-11 15:45:52,241 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-11 15:45:52,241 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-11 15:45:52,241 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-11 15:45:52,241 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-11 15:45:52,242 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-11 15:45:52,245 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1762875847_647aecc38469
2025-11-11 15:45:52,245 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69135a30d8b5ddffe68e95b8
2025-11-11 15:45:52,248 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-11 15:45:52,249 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-11 15:45:52,249 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-11 15:45:52,249 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-11 15:45:52,250 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-11 15:45:52,250 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-11 15:45:52,250 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-11 15:45:52,250 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-11 15:45:52,250 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-11 15:45:52,251 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-11 15:45:52,251 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-11 15:45:52,251 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-11 15:45:52,252 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-11 15:45:52,252 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-11 15:45:52,252 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-11 15:45:52,252 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-11 15:45:52,253 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-11 15:45:52,253 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-11 15:45:52,253 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-11 15:45:52,253 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69135a30d8b5ddffe68e95b8
2025-11-11 15:45:52,254 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-11 15:45:52,254 - app.api.routes - INFO -    Collection: comparisons
2025-11-11 15:45:52,254 - app.api.routes - INFO -    Comparison ID: cmp_1762875847_647aecc38469
2025-11-11 15:45:52,256 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-11 15:45:52,257 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-11 15:45:52,257 - app.api.routes - INFO - 
======================================================================
2025-11-11 15:45:52,257 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-11 15:45:52,258 - app.api.routes - INFO - ======================================================================
2025-11-11 15:45:52,258 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1762875847_647aecc38469
2025-11-11 15:45:52,258 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-11 15:45:52,258 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-11 15:45:52,258 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-11 15:45:52,259 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-11 15:45:52,259 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-11 15:45:52,259 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-11 15:45:52,260 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-11 15:45:52,261 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 239
2025-11-11 15:45:52,261 - app.api.routes - INFO - ======================================================================

2025-11-11 15:45:52,262 - app.services.progress_tracker - INFO - âœ… Job completed: job_2b9e62ae175f â†’ comparison_id: cmp_1762875847_647aecc38469
2025-11-11 15:45:52,263 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 104.50s
2025-11-11 15:47:44,232 - main - INFO - ðŸ“¥ GET /api/progress/job_2b9e62ae175f
2025-11-11 15:47:44,233 - main - INFO - ðŸ“¤ GET /api/progress/job_2b9e62ae175f - 200 - 0.00s
2025-11-11 15:53:24,581 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 2 old progress entries
2025-11-11 15:53:24,582 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 2 old entries
2025-11-11 19:25:17,367 - main - INFO - 
2025-11-11 19:25:17,375 - main - INFO - ================================================================================
2025-11-11 19:25:17,377 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-11 19:25:17,415 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-11 19:25:17,423 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-11 19:25:17,432 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-11 19:25:17,432 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-11 19:25:17,447 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-11 19:25:17,448 - main - INFO -   âœ… User Documents Service connection closed
2025-11-11 19:25:17,460 - main - INFO -   âœ… Cleaned up 6 temporary files
2025-11-11 19:25:17,461 - main - INFO -   âœ… Application stopped successfully
2025-11-11 19:25:17,463 - main - INFO - ================================================================================
2025-11-11 19:25:17,464 - main - INFO - 
2025-11-11 19:25:21,815 - main - INFO - 
2025-11-11 19:25:21,815 - main - INFO - ================================================================================
2025-11-11 19:25:21,816 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-11 19:25:21,816 - main - INFO -   Production-Ready Complete Integration
2025-11-11 19:25:21,816 - main - INFO - ================================================================================
2025-11-11 19:25:21,816 - main - INFO -   AI Model: gpt-4o-mini
2025-11-11 19:25:21,816 - main - INFO -   Upload Directory: uploads
2025-11-11 19:25:21,817 - main - INFO -   Max File Size: 20MB
2025-11-11 19:25:21,817 - main - INFO - ================================================================================
2025-11-11 19:25:21,817 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-11 19:25:21,818 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-11 19:25:21,819 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-11 19:25:22,104 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-11 19:25:22,110 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-11 19:25:22,111 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-11 19:25:22,111 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-11 19:25:22,111 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-11 19:25:22,112 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-11 19:25:22,112 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-11 19:25:22,112 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-11 19:25:22,133 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-11 19:25:22,135 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-11 19:25:22,138 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-11 19:25:22,141 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-11 19:25:22,141 - main - INFO -   âœ… User Subscription Service connected
2025-11-11 19:25:22,142 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-11 19:25:22,142 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-11 19:25:22,142 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-11 19:25:22,167 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-11 19:25:22,167 - main - INFO -   âœ… User Documents Service connected
2025-11-11 19:25:22,167 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-11 19:25:22,168 - main - INFO - 
2025-11-11 19:25:22,168 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-11 19:25:22,168 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-11 19:25:22,168 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-11 19:25:22,168 - main - INFO -        - Separates warranties from extensions
2025-11-11 19:25:22,169 - main - INFO -        - Extracts subjectivities & operational details
2025-11-11 19:25:22,169 - main - INFO -        - Correct deductible tier detection
2025-11-11 19:25:22,169 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-11 19:25:22,169 - main - INFO - 
2025-11-11 19:25:22,170 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-11 19:25:22,170 - main - INFO -        - Generates ALL sections comprehensively
2025-11-11 19:25:22,170 - main - INFO -        - Identifies unique items per provider
2025-11-11 19:25:22,170 - main - INFO -        - Transparent scoring methodology
2025-11-11 19:25:22,170 - main - INFO -        - Uses full _extended_data from parser
2025-11-11 19:25:22,170 - main - INFO - 
2025-11-11 19:25:22,171 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-11 19:25:22,171 - main - INFO -        - Single endpoint auto-populates everything
2025-11-11 19:25:22,171 - main - INFO -        - No manual section generation
2025-11-11 19:25:22,171 - main - INFO -        - Complete MongoDB integration
2025-11-11 19:25:22,171 - main - INFO - 
2025-11-11 19:25:22,171 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-11 19:25:22,172 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-11 19:25:22,172 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-11 19:25:22,172 - main - INFO -      âœ… Subjectivities: Now included
2025-11-11 19:25:22,172 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-11 19:25:22,172 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-11 19:25:22,173 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-11 19:25:22,173 - main - INFO - 
2025-11-11 19:25:22,173 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-11 19:25:22,173 - main - INFO -      Main:
2025-11-11 19:25:22,173 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-11 19:25:22,174 - main - INFO - 
2025-11-11 19:25:22,174 - main - INFO -      Retrieval:
2025-11-11 19:25:22,174 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-11 19:25:22,174 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-11 19:25:22,174 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-11 19:25:22,174 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-11 19:25:22,175 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-11 19:25:22,175 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-11 19:25:22,175 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-11 19:25:22,175 - main - INFO - 
2025-11-11 19:25:22,175 - main - INFO -      Management:
2025-11-11 19:25:22,176 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-11 19:25:22,176 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-11 19:25:22,176 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-11 19:25:22,176 - main - INFO - 
2025-11-11 19:25:22,177 - main - INFO -      Documents (MongoDB):
2025-11-11 19:25:22,177 - main - INFO -        GET  /api/documents                All documents
2025-11-11 19:25:22,177 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-11 19:25:22,177 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-11 19:25:22,178 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-11 19:25:22,178 - main - INFO - 
2025-11-11 19:25:22,178 - main - INFO -      Diagnostics & Health:
2025-11-11 19:25:22,178 - main - INFO -        GET  /api/health                   System health
2025-11-11 19:25:22,178 - main - INFO -        GET  /api/status                   Detailed status
2025-11-11 19:25:22,178 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-11 19:25:22,179 - main - INFO - 
2025-11-11 19:25:22,179 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-11 19:25:22,179 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-11 19:25:22,179 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-11 19:25:22,179 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-11 19:25:22,180 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-11 19:25:22,180 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-11 19:25:22,180 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-11 19:25:22,180 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-11 19:25:22,180 - main - INFO - 
2025-11-11 19:25:22,180 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-11 19:25:22,181 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-11 19:25:22,181 - main - INFO -      2. Receive comparison_id + complete data
2025-11-11 19:25:22,181 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-11 19:25:22,181 - main - INFO -      4. No re-upload needed!
2025-11-11 19:25:22,181 - main - INFO - 
2025-11-11 19:25:22,181 - main - INFO - ================================================================================
2025-11-11 19:25:22,182 - main - INFO -   âœ… Application started successfully!
2025-11-11 19:25:22,182 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-11 19:25:22,182 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-11 19:25:22,182 - main - INFO - ================================================================================
2025-11-11 19:25:22,182 - main - INFO - 
2025-11-11 19:25:22,183 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 17:51:02,962 - main - INFO - 
2025-11-13 17:51:02,963 - main - INFO - ================================================================================
2025-11-13 17:51:02,963 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 17:51:02,963 - main - INFO -   Production-Ready Complete Integration
2025-11-13 17:51:02,963 - main - INFO - ================================================================================
2025-11-13 17:51:02,964 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 17:51:02,964 - main - INFO -   Upload Directory: uploads
2025-11-13 17:51:02,964 - main - INFO -   Max File Size: 20MB
2025-11-13 17:51:02,964 - main - INFO - ================================================================================
2025-11-13 17:51:02,965 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 17:51:02,965 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 17:51:02,965 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 17:51:03,343 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 17:51:03,368 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 17:51:03,368 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 17:51:03,369 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 17:51:03,369 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 17:51:03,369 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 17:51:03,370 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 17:51:03,370 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 17:51:03,381 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 17:51:03,389 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 17:51:03,395 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 17:51:03,550 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 17:51:03,550 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 17:51:03,551 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 17:51:03,551 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 17:51:03,551 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 17:51:03,581 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 17:51:03,582 - main - INFO -   âœ… User Documents Service connected
2025-11-13 17:51:03,582 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 17:51:03,582 - main - INFO - 
2025-11-13 17:51:03,582 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 17:51:03,583 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 17:51:03,583 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 17:51:03,583 - main - INFO -        - Separates warranties from extensions
2025-11-13 17:51:03,583 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 17:51:03,584 - main - INFO -        - Correct deductible tier detection
2025-11-13 17:51:03,584 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 17:51:03,584 - main - INFO - 
2025-11-13 17:51:03,584 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 17:51:03,585 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 17:51:03,585 - main - INFO -        - Identifies unique items per provider
2025-11-13 17:51:03,585 - main - INFO -        - Transparent scoring methodology
2025-11-13 17:51:03,585 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 17:51:03,586 - main - INFO - 
2025-11-13 17:51:03,586 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 17:51:03,586 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 17:51:03,586 - main - INFO -        - No manual section generation
2025-11-13 17:51:03,586 - main - INFO -        - Complete MongoDB integration
2025-11-13 17:51:03,587 - main - INFO - 
2025-11-13 17:51:03,587 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 17:51:03,587 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 17:51:03,587 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 17:51:03,588 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 17:51:03,589 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 17:51:03,590 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 17:51:03,591 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 17:51:03,591 - main - INFO - 
2025-11-13 17:51:03,591 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 17:51:03,592 - main - INFO -      Main:
2025-11-13 17:51:03,592 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 17:51:03,592 - main - INFO - 
2025-11-13 17:51:03,592 - main - INFO -      Retrieval:
2025-11-13 17:51:03,592 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 17:51:03,593 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 17:51:03,593 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 17:51:03,593 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 17:51:03,593 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 17:51:03,593 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 17:51:03,594 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 17:51:03,594 - main - INFO - 
2025-11-13 17:51:03,594 - main - INFO -      Management:
2025-11-13 17:51:03,594 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 17:51:03,594 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 17:51:03,595 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 17:51:03,595 - main - INFO - 
2025-11-13 17:51:03,595 - main - INFO -      Documents (MongoDB):
2025-11-13 17:51:03,595 - main - INFO -        GET  /api/documents                All documents
2025-11-13 17:51:03,595 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 17:51:03,596 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 17:51:03,596 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 17:51:03,596 - main - INFO - 
2025-11-13 17:51:03,596 - main - INFO -      Diagnostics & Health:
2025-11-13 17:51:03,596 - main - INFO -        GET  /api/health                   System health
2025-11-13 17:51:03,596 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 17:51:03,597 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 17:51:03,597 - main - INFO - 
2025-11-13 17:51:03,597 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 17:51:03,597 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 17:51:03,598 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 17:51:03,598 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 17:51:03,598 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 17:51:03,599 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 17:51:03,599 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 17:51:03,599 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 17:51:03,599 - main - INFO - 
2025-11-13 17:51:03,600 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 17:51:03,600 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 17:51:03,600 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 17:51:03,600 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 17:51:03,600 - main - INFO -      4. No re-upload needed!
2025-11-13 17:51:03,601 - main - INFO - 
2025-11-13 17:51:03,601 - main - INFO - ================================================================================
2025-11-13 17:51:03,601 - main - INFO -   âœ… Application started successfully!
2025-11-13 17:51:03,601 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 17:51:03,602 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 17:51:03,602 - main - INFO - ================================================================================
2025-11-13 17:51:03,602 - main - INFO - 
2025-11-13 17:51:03,603 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 17:51:06,268 - main - INFO - ðŸ“¥ GET /docs
2025-11-13 17:51:06,269 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-13 17:51:09,091 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-13 17:51:09,104 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-13 17:52:03,175 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-13 17:52:03,186 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-13 17:52:03,187 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 17:52:03,187 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 17:52:03,188 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 17:52:03,198 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 17:52:03,200 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-13 17:52:03,201 - app.api.routes - INFO -    - Remaining comparisons: 239
2025-11-13 17:52:03,201 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-13 17:52:03,203 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-13 17:52:03,204 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763056323_9ef4ae04d6f0
2025-11-13 17:52:03,205 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_8f23c00439a8 (3 files)
2025-11-13 17:52:03,205 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_8f23c00439a8
2025-11-13 17:52:03,206 - app.api.routes - INFO - 
======================================================================
2025-11-13 17:52:03,206 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 17:52:03,206 - app.api.routes - INFO - ======================================================================
2025-11-13 17:52:03,208 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ c84c205b5bad47b595fd991d3c2deeb6.pdf (464206 bytes)
2025-11-13 17:52:03,209 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 17:52:03,209 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\c84c205b5bad47b595fd991d3c2deeb6.pdf
2025-11-13 17:52:03,210 - app.api.routes - INFO - 
======================================================================
2025-11-13 17:52:03,213 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 17:52:03,267 - app.api.routes - INFO - ======================================================================
2025-11-13 17:52:03,326 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ d6cb35c6d2b847a0a68e0384fe012be9.pdf (175401 bytes)
2025-11-13 17:52:03,327 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 17:52:03,329 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\d6cb35c6d2b847a0a68e0384fe012be9.pdf
2025-11-13 17:52:03,329 - app.api.routes - INFO - 
======================================================================
2025-11-13 17:52:03,362 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-13 17:52:03,387 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 17:52:03,401 - app.api.routes - INFO - ======================================================================
2025-11-13 17:52:03,420 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-13 17:52:03,421 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 4a0a5691d62e4b4d8458958db3e27b01.pdf (331157 bytes)
2025-11-13 17:52:03,421 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 17:52:03,422 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\4a0a5691d62e4b4d8458958db3e27b01.pdf
2025-11-13 17:52:03,422 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 17:52:03,439 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 17:52:03,485 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-13 17:52:03,486 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-13 17:52:03,487 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-13 17:52:03,487 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 17:52:03,487 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 17:52:03,488 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-13 17:52:03,647 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-13 17:52:03,648 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 17:52:04,227 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 17:52:04,227 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 17:52:04,227 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-13 17:52:04,228 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-13 17:52:04,228 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 17:52:04,228 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 17:52:04,229 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-13 17:52:04,319 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-13 17:52:04,319 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 17:52:04,321 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 17:52:04,321 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-13 17:52:04,321 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-13 17:52:04,321 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-13 17:52:04,322 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-13 17:52:04,322 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 17:52:04,322 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-13 17:52:04,422 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-13 17:52:04,422 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 17:52:28,025 - main - INFO - ðŸ“¥ GET /api/progress/job_8f23c00439a8
2025-11-13 17:52:28,026 - main - INFO - ðŸ“¤ GET /api/progress/job_8f23c00439a8 - 200 - 0.00s
2025-11-13 17:52:39,980 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:52:40,010 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 17:52:40,011 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 17:52:47,421 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:52:47,432 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 17:52:47,433 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 17:52:47,433 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-13 17:52:47,434 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-13 17:52:47,434 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: N/A
2025-11-13 17:52:47,434 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 17:52:47,434 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-13 17:52:54,121 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:52:54,127 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 70.0
2025-11-13 17:52:54,128 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 17:52:54,128 - app.services.ai_parser - INFO - 
2025-11-13 17:52:54,129 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:52:54,130 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 17:52:54,130 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:52:54,131 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-13 17:52:54,132 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 17:52:54,132 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-13 17:52:54,133 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-13 17:52:54,134 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 70.0/100
2025-11-13 17:52:54,134 - app.services.ai_parser - INFO - ðŸ“ Quality: 92.3/100
2025-11-13 17:52:54,135 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: N/A
2025-11-13 17:52:54,135 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 17:52:54,136 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 17:52:54,136 - app.services.ai_parser - INFO - 
2025-11-13 17:52:54,137 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 17:52:54,137 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-13 17:52:54,138 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-13 17:52:54,139 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-13 17:52:54,139 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 17:52:54,140 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 17:52:54,140 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:52:54,251 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: c84c205b5bad47b595fd991d3c2deeb6.pdf â†’ 69161af61fa7f61fa9e09ae3
2025-11-13 17:52:54,252 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69161af61fa7f61fa9e09ae3
2025-11-13 17:52:54,255 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69161af61fa7f61fa9e09ae4 (464206 bytes)
2025-11-13 17:52:54,256 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69161af61fa7f61fa9e09ae4
2025-11-13 17:52:54,256 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 17:53:20,923 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:21,177 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 17:53:21,178 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 17:53:26,147 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:26,416 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 17:53:26,416 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 17:53:27,779 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:27,789 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 17:53:27,789 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 17:53:27,790 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-13 17:53:27,791 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-13 17:53:27,792 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 17:53:27,793 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 17:53:27,794 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 17:53:27,795 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 17:53:27,795 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 17:53:27,795 - app.services.ai_parser - INFO - ðŸ“Š Counts: 52 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-13 17:53:31,907 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:31,923 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 17:53:31,924 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 17:53:31,924 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-13 17:53:31,924 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-13 17:53:31,925 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 17:53:31,925 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 17:53:31,925 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 17:53:31,925 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-13 17:53:31,926 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 17:53:31,926 - app.services.ai_parser - INFO - ðŸ“Š Counts: 38 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-13 17:53:34,499 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:34,502 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-13 17:53:34,503 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 17:53:34,504 - app.services.ai_parser - INFO - 
2025-11-13 17:53:34,505 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:53:34,505 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-13 17:53:34,506 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:53:34,507 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-13 17:53:34,508 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-13 17:53:34,509 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-13 17:53:34,510 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-13 17:53:34,510 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-13 17:53:34,511 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-13 17:53:34,511 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 17:53:34,511 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-13 17:53:34,512 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-13 17:53:34,512 - app.services.ai_parser - INFO - 
2025-11-13 17:53:34,512 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 17:53:34,512 - app.services.ai_parser - INFO -    âœ“ Benefits: 52
2025-11-13 17:53:34,513 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-13 17:53:34,513 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-13 17:53:34,513 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 17:53:34,514 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 17:53:34,514 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:53:34,516 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 4a0a5691d62e4b4d8458958db3e27b01.pdf â†’ 69161b1e1fa7f61fa9e09ae5
2025-11-13 17:53:34,517 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69161b1e1fa7f61fa9e09ae5
2025-11-13 17:53:34,521 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69161b1e1fa7f61fa9e09ae6 (331157 bytes)
2025-11-13 17:53:34,522 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69161b1e1fa7f61fa9e09ae6
2025-11-13 17:53:34,522 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 17:53:39,400 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:39,404 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-13 17:53:39,405 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 17:53:39,406 - app.services.ai_parser - INFO - 
2025-11-13 17:53:39,406 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:53:39,407 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 17:53:39,408 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:53:39,409 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-13 17:53:39,410 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 17:53:39,411 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-13 17:53:39,411 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-13 17:53:39,412 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-13 17:53:39,413 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-13 17:53:39,413 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-13 17:53:39,413 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 17:53:39,413 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 17:53:39,414 - app.services.ai_parser - INFO - 
2025-11-13 17:53:39,414 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 17:53:39,414 - app.services.ai_parser - INFO -    âœ“ Benefits: 38
2025-11-13 17:53:39,414 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-13 17:53:39,415 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-13 17:53:39,415 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 17:53:39,415 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 17:53:39,415 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 17:53:39,417 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: d6cb35c6d2b847a0a68e0384fe012be9.pdf â†’ 69161b231fa7f61fa9e09ae7
2025-11-13 17:53:39,417 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69161b231fa7f61fa9e09ae7
2025-11-13 17:53:39,418 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69161b231fa7f61fa9e09ae8 (175401 bytes)
2025-11-13 17:53:39,419 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69161b231fa7f61fa9e09ae8
2025-11-13 17:53:39,419 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 17:53:39,419 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-13 17:53:39,420 - app.api.routes - INFO - 
======================================================================
2025-11-13 17:53:39,420 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-13 17:53:39,420 - app.api.routes - INFO - ======================================================================
2025-11-13 17:53:39,420 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-13 17:53:39,421 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-13 17:53:39,421 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-13 17:53:39,421 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=74.72
2025-11-13 17:53:39,422 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-13 17:53:39,422 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.12
2025-11-13 17:53:39,422 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-13 17:53:39,422 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-13 17:53:50,772 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 17:53:50,779 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-13 17:53:50,780 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-13 17:53:50,780 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-13 17:53:50,783 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-13 17:53:50,784 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-13 17:53:50,784 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763056323_9ef4ae04d6f0
2025-11-13 17:53:50,785 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-13 17:53:50,785 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-13 17:53:50,786 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-13 17:53:50,787 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-13 17:53:50,787 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 17:53:50,787 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 17:53:50,787 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 17:53:50,788 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 17:53:50,788 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 17:53:50,788 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 17:53:50,788 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-13 17:53:50,788 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 17:53:50,789 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 17:53:50,789 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 17:53:50,789 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 17:53:50,789 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 17:53:50,790 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 17:53:50,793 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-13 17:53:50,794 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,088 bytes
2025-11-13 17:53:50,794 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 27,316 bytes
2025-11-13 17:53:50,794 - app.services.mongodb_service_enhanced - INFO -    Data table: 11,515 bytes
2025-11-13 17:53:50,795 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,744 bytes
2025-11-13 17:53:50,795 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 48,062 bytes
2025-11-13 17:53:50,795 - app.services.mongodb_service_enhanced - INFO -    Total document: 192,747 bytes
2025-11-13 17:53:50,795 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-13 17:53:50,796 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-13 17:53:50,796 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-13 17:53:50,796 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-13 17:53:50,796 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-13 17:53:50,796 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-13 17:53:50,797 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-13 17:53:50,797 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-13 17:53:50,797 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-13 17:53:50,797 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-13 17:53:50,798 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-13 17:53:50,798 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-13 17:53:50,798 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-13 17:53:50,799 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-13 17:53:50,799 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-13 17:53:50,799 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-13 17:53:50,799 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-13 17:53:50,800 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 17:53:50,800 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 17:53:50,801 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-13 17:53:50,865 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763056323_9ef4ae04d6f0
2025-11-13 17:53:50,865 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69161b2ee07bc3665c3df803
2025-11-13 17:53:50,867 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-13 17:53:50,868 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-13 17:53:50,868 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-13 17:53:50,868 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-13 17:53:50,868 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-13 17:53:50,868 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-13 17:53:50,869 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-13 17:53:50,869 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-13 17:53:50,869 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-13 17:53:50,869 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-13 17:53:50,869 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-13 17:53:50,870 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-13 17:53:50,870 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 17:53:50,870 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-13 17:53:50,871 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-13 17:53:50,871 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-13 17:53:50,871 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-13 17:53:50,871 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-13 17:53:50,871 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 17:53:50,872 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69161b2ee07bc3665c3df803
2025-11-13 17:53:50,872 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-13 17:53:50,872 - app.api.routes - INFO -    Collection: comparisons
2025-11-13 17:53:50,872 - app.api.routes - INFO -    Comparison ID: cmp_1763056323_9ef4ae04d6f0
2025-11-13 17:53:50,876 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 17:53:50,877 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 17:53:50,877 - app.api.routes - INFO - 
======================================================================
2025-11-13 17:53:50,877 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-13 17:53:50,877 - app.api.routes - INFO - ======================================================================
2025-11-13 17:53:50,878 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763056323_9ef4ae04d6f0
2025-11-13 17:53:50,878 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-13 17:53:50,878 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-13 17:53:50,878 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-13 17:53:50,878 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 17:53:50,879 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 17:53:50,879 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 17:53:50,880 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 17:53:50,882 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 238
2025-11-13 17:53:50,883 - app.api.routes - INFO - ======================================================================

2025-11-13 17:53:50,883 - app.services.progress_tracker - INFO - âœ… Job completed: job_8f23c00439a8 â†’ comparison_id: cmp_1763056323_9ef4ae04d6f0
2025-11-13 17:53:50,886 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 107.71s
2025-11-13 18:01:03,628 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-13 18:01:03,628 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-13 18:21:58,852 - main - INFO - 
2025-11-13 18:21:58,853 - main - INFO - ================================================================================
2025-11-13 18:21:58,854 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:21:58,858 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:21:58,859 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:21:58,862 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:21:58,863 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:21:58,865 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:21:58,866 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:21:58,871 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-13 18:21:58,872 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:21:58,873 - main - INFO - ================================================================================
2025-11-13 18:21:58,873 - main - INFO - 
2025-11-13 18:22:05,176 - main - INFO - 
2025-11-13 18:22:05,176 - main - INFO - ================================================================================
2025-11-13 18:22:05,177 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:22:05,177 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:22:05,177 - main - INFO - ================================================================================
2025-11-13 18:22:05,177 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:22:05,178 - main - INFO -   Upload Directory: uploads
2025-11-13 18:22:05,178 - main - INFO -   Max File Size: 20MB
2025-11-13 18:22:05,178 - main - INFO - ================================================================================
2025-11-13 18:22:05,179 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:22:05,179 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:22:05,179 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:22:05,198 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:22:05,205 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:22:05,206 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:22:05,206 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:22:05,206 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:22:05,206 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:22:05,207 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:22:05,207 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:22:05,254 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:22:05,256 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:22:05,258 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:22:05,262 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:22:05,262 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:22:05,263 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:22:05,264 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:22:05,264 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:22:05,300 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:22:05,300 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:22:05,301 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:22:05,301 - main - INFO - 
2025-11-13 18:22:05,302 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:22:05,302 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:22:05,302 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:22:05,303 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:22:05,303 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:22:05,303 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:22:05,304 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:22:05,304 - main - INFO - 
2025-11-13 18:22:05,304 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:22:05,305 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:22:05,305 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:22:05,305 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:22:05,305 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:22:05,305 - main - INFO - 
2025-11-13 18:22:05,306 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:22:05,306 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:22:05,306 - main - INFO -        - No manual section generation
2025-11-13 18:22:05,306 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:22:05,306 - main - INFO - 
2025-11-13 18:22:05,307 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:22:05,307 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:22:05,307 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:22:05,307 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:22:05,308 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:22:05,308 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:22:05,308 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:22:05,308 - main - INFO - 
2025-11-13 18:22:05,308 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:22:05,309 - main - INFO -      Main:
2025-11-13 18:22:05,309 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:22:05,309 - main - INFO - 
2025-11-13 18:22:05,309 - main - INFO -      Retrieval:
2025-11-13 18:22:05,309 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:22:05,309 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:22:05,310 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:22:05,310 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:22:05,310 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:22:05,310 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:22:05,310 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:22:05,311 - main - INFO - 
2025-11-13 18:22:05,311 - main - INFO -      Management:
2025-11-13 18:22:05,311 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:22:05,311 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:22:05,312 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:22:05,312 - main - INFO - 
2025-11-13 18:22:05,312 - main - INFO -      Documents (MongoDB):
2025-11-13 18:22:05,313 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:22:05,313 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:22:05,314 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:22:05,314 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:22:05,315 - main - INFO - 
2025-11-13 18:22:05,315 - main - INFO -      Diagnostics & Health:
2025-11-13 18:22:05,315 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:22:05,316 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:22:05,316 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:22:05,316 - main - INFO - 
2025-11-13 18:22:05,316 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:22:05,316 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:22:05,317 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:22:05,317 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:22:05,317 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:22:05,317 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:22:05,317 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:22:05,318 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:22:05,318 - main - INFO - 
2025-11-13 18:22:05,318 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:22:05,318 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:22:05,318 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:22:05,318 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:22:05,319 - main - INFO -      4. No re-upload needed!
2025-11-13 18:22:05,319 - main - INFO - 
2025-11-13 18:22:05,319 - main - INFO - ================================================================================
2025-11-13 18:22:05,319 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:22:05,319 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:22:05,320 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:22:05,320 - main - INFO - ================================================================================
2025-11-13 18:22:05,320 - main - INFO - 
2025-11-13 18:22:05,320 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:22:14,882 - main - INFO - ðŸ“¥ GET /docs
2025-11-13 18:22:14,882 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-13 18:22:15,056 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-13 18:22:15,068 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-13 18:22:43,747 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-13 18:22:43,753 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-13 18:22:43,753 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 18:22:43,754 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 18:22:43,754 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 18:22:43,756 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 18:22:43,758 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-13 18:22:43,759 - app.api.routes - INFO -    - Remaining comparisons: 238
2025-11-13 18:22:43,759 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-13 18:22:43,760 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-13 18:22:43,760 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763058163_53066731fc55
2025-11-13 18:22:43,760 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_e8154473b77c (3 files)
2025-11-13 18:22:43,760 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_e8154473b77c
2025-11-13 18:22:43,762 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:22:43,763 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:22:43,764 - app.api.routes - INFO - ======================================================================
2025-11-13 18:22:43,766 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ b0d7188914834c25945cbd81b74918eb.pdf (464206 bytes)
2025-11-13 18:22:43,768 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:22:43,770 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\b0d7188914834c25945cbd81b74918eb.pdf
2025-11-13 18:22:43,771 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:22:43,807 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:22:43,808 - app.api.routes - INFO - ======================================================================
2025-11-13 18:22:43,843 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-13 18:22:43,843 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ e343700796d440c09957a7b4e402fe9c.pdf (175401 bytes)
2025-11-13 18:22:43,845 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:22:43,845 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:22:43,845 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e343700796d440c09957a7b4e402fe9c.pdf
2025-11-13 18:22:43,846 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:22:43,846 - app.api.routes - INFO - ======================================================================
2025-11-13 18:22:43,897 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-13 18:22:43,899 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 4ab01bfeb9884fd3a67856258018b4bc.pdf (331157 bytes)
2025-11-13 18:22:43,900 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:22:43,900 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\4ab01bfeb9884fd3a67856258018b4bc.pdf
2025-11-13 18:22:43,900 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:22:43,901 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:22:43,902 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-13 18:22:43,937 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-13 18:22:43,952 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 18:22:43,953 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-13 18:22:43,953 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 18:22:43,954 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-13 18:22:44,111 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-13 18:22:44,112 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 18:22:44,494 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:22:44,495 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:22:44,495 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-13 18:22:44,495 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-13 18:22:44,496 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 18:22:44,496 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 18:22:44,496 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-13 18:22:44,577 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-13 18:22:44,578 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 18:22:44,579 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:22:44,579 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:22:44,579 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-13 18:22:44,580 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-13 18:22:44,580 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-13 18:22:44,580 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 18:22:44,581 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-13 18:22:44,696 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-13 18:22:44,697 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 18:23:14,831 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:14,843 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 18:23:14,843 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 18:23:21,281 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:21,285 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 18:23:21,285 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 18:23:21,287 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-13 18:23:21,288 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-13 18:23:21,289 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: N/A
2025-11-13 18:23:21,290 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 18:23:21,290 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-13 18:23:28,010 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:28,018 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 70.0
2025-11-13 18:23:28,019 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 18:23:28,019 - app.services.ai_parser - INFO - 
2025-11-13 18:23:28,020 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:28,020 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:23:28,021 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:28,021 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-13 18:23:28,022 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 18:23:28,022 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-13 18:23:28,022 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-13 18:23:28,023 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 70.0/100
2025-11-13 18:23:28,023 - app.services.ai_parser - INFO - ðŸ“ Quality: 92.3/100
2025-11-13 18:23:28,024 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: N/A
2025-11-13 18:23:28,024 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 18:23:28,024 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 18:23:28,025 - app.services.ai_parser - INFO - 
2025-11-13 18:23:28,025 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 18:23:28,025 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-13 18:23:28,025 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-13 18:23:28,026 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-13 18:23:28,026 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 18:23:28,026 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 18:23:28,026 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:28,028 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: b0d7188914834c25945cbd81b74918eb.pdf â†’ 691622209bc8396315131136
2025-11-13 18:23:28,028 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691622209bc8396315131136
2025-11-13 18:23:28,033 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691622209bc8396315131137 (464206 bytes)
2025-11-13 18:23:28,033 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691622209bc8396315131137
2025-11-13 18:23:28,034 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:23:29,214 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:29,217 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 18:23:29,217 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 18:23:35,943 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:36,045 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 18:23:36,046 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 18:23:37,132 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:37,137 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 18:23:37,138 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 18:23:37,138 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-13 18:23:37,139 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-13 18:23:37,140 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:23:37,141 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:23:37,142 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:23:37,143 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-13 18:23:37,143 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 18:23:37,144 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-13 18:23:41,233 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:41,236 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 18:23:41,237 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 18:23:41,237 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-13 18:23:41,238 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-13 18:23:41,239 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:23:41,240 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:23:41,241 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:23:41,241 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-13 18:23:41,242 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 18:23:41,243 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-13 18:23:42,857 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:42,860 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-13 18:23:42,861 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 18:23:42,862 - app.services.ai_parser - INFO - 
2025-11-13 18:23:42,862 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:42,863 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:23:42,864 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:42,865 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-13 18:23:42,865 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 18:23:42,866 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 500,000.00
2025-11-13 18:23:42,867 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-13 18:23:42,867 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-13 18:23:42,868 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-13 18:23:42,869 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-13 18:23:42,870 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 18:23:42,870 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 18:23:42,871 - app.services.ai_parser - INFO - 
2025-11-13 18:23:42,872 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 18:23:42,873 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-13 18:23:42,873 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-13 18:23:42,875 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-13 18:23:42,876 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 18:23:42,876 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 18:23:42,876 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:42,878 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e343700796d440c09957a7b4e402fe9c.pdf â†’ 6916222e9bc8396315131138
2025-11-13 18:23:42,878 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6916222e9bc8396315131138
2025-11-13 18:23:42,880 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 6916222e9bc8396315131139 (175401 bytes)
2025-11-13 18:23:42,880 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 6916222e9bc8396315131139
2025-11-13 18:23:42,881 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:23:47,567 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:47,574 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 76.0
2025-11-13 18:23:47,575 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 18:23:47,575 - app.services.ai_parser - INFO - 
2025-11-13 18:23:47,576 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:47,576 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:23:47,577 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:47,578 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-13 18:23:47,578 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-13 18:23:47,579 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-13 18:23:47,579 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-13 18:23:47,580 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 76.0/100
2025-11-13 18:23:47,581 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-13 18:23:47,582 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-13 18:23:47,582 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-13 18:23:47,583 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-13 18:23:47,584 - app.services.ai_parser - INFO - 
2025-11-13 18:23:47,584 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 18:23:47,585 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-13 18:23:47,585 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-13 18:23:47,587 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-13 18:23:47,588 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 18:23:47,588 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 18:23:47,589 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:23:47,592 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 4ab01bfeb9884fd3a67856258018b4bc.pdf â†’ 691622339bc839631513113a
2025-11-13 18:23:47,593 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691622339bc839631513113a
2025-11-13 18:23:47,598 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691622339bc839631513113b (331157 bytes)
2025-11-13 18:23:47,599 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691622339bc839631513113b
2025-11-13 18:23:47,600 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:23:47,601 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-13 18:23:47,602 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:23:47,603 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-13 18:23:47,603 - app.api.routes - INFO - ======================================================================
2025-11-13 18:23:47,604 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-13 18:23:47,604 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-13 18:23:47,605 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-13 18:23:47,605 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=73.17
2025-11-13 18:23:47,606 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.43
2025-11-13 18:23:47,606 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=79.61
2025-11-13 18:23:47,607 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-13 18:23:47,607 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-13 18:23:56,287 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:23:56,291 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-13 18:23:56,292 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-13 18:23:56,292 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-13 18:23:56,295 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-13 18:23:56,296 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-13 18:23:56,296 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763058163_53066731fc55
2025-11-13 18:23:56,297 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-13 18:23:56,298 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-13 18:23:56,299 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-13 18:23:56,300 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-13 18:23:56,300 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 18:23:56,300 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 18:23:56,301 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 18:23:56,301 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 18:23:56,301 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 18:23:56,301 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 18:23:56,302 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-13 18:23:56,302 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 18:23:56,302 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 18:23:56,302 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 18:23:56,302 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 18:23:56,303 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 18:23:56,303 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 18:23:56,307 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-13 18:23:56,307 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,243 bytes
2025-11-13 18:23:56,307 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 26,566 bytes
2025-11-13 18:23:56,307 - app.services.mongodb_service_enhanced - INFO -    Data table: 11,082 bytes
2025-11-13 18:23:56,308 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,740 bytes
2025-11-13 18:23:56,308 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 38,589 bytes
2025-11-13 18:23:56,308 - app.services.mongodb_service_enhanced - INFO -    Total document: 171,769 bytes
2025-11-13 18:23:56,309 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-13 18:23:56,309 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-13 18:23:56,309 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-13 18:23:56,310 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-13 18:23:56,310 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-13 18:23:56,310 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-13 18:23:56,310 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-13 18:23:56,310 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-13 18:23:56,311 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-13 18:23:56,311 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-13 18:23:56,311 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-13 18:23:56,311 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-13 18:23:56,312 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-13 18:23:56,312 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-13 18:23:56,312 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-13 18:23:56,312 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-13 18:23:56,312 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-13 18:23:56,313 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 18:23:56,313 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 18:23:56,313 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-13 18:23:56,318 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763058163_53066731fc55
2025-11-13 18:23:56,319 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6916223ce07bc3665c3df804
2025-11-13 18:23:56,320 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-13 18:23:56,320 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-13 18:23:56,321 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-13 18:23:56,321 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-13 18:23:56,321 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-13 18:23:56,321 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-13 18:23:56,322 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-13 18:23:56,322 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-13 18:23:56,322 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-13 18:23:56,322 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-13 18:23:56,323 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-13 18:23:56,323 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-13 18:23:56,323 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 18:23:56,323 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-13 18:23:56,324 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-13 18:23:56,324 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-13 18:23:56,324 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-13 18:23:56,324 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-13 18:23:56,324 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 18:23:56,325 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6916223ce07bc3665c3df804
2025-11-13 18:23:56,325 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-13 18:23:56,325 - app.api.routes - INFO -    Collection: comparisons
2025-11-13 18:23:56,326 - app.api.routes - INFO -    Comparison ID: cmp_1763058163_53066731fc55
2025-11-13 18:23:56,328 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 18:23:56,329 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 18:23:56,329 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:23:56,329 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-13 18:23:56,329 - app.api.routes - INFO - ======================================================================
2025-11-13 18:23:56,330 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763058163_53066731fc55
2025-11-13 18:23:56,330 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-13 18:23:56,330 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-13 18:23:56,330 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-13 18:23:56,331 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 18:23:56,331 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 18:23:56,331 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 18:23:56,334 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 18:23:56,335 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 237
2025-11-13 18:23:56,336 - app.api.routes - INFO - ======================================================================

2025-11-13 18:23:56,336 - app.services.progress_tracker - INFO - âœ… Job completed: job_e8154473b77c â†’ comparison_id: cmp_1763058163_53066731fc55
2025-11-13 18:23:56,337 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 72.59s
2025-11-13 18:25:32,526 - main - INFO - 
2025-11-13 18:25:32,526 - main - INFO - ================================================================================
2025-11-13 18:25:32,527 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:25:32,528 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:25:32,528 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:25:32,529 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:25:32,529 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:25:32,530 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:25:32,530 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:25:32,532 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-13 18:25:32,532 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:25:32,533 - main - INFO - ================================================================================
2025-11-13 18:25:32,533 - main - INFO - 
2025-11-13 18:25:35,272 - main - INFO - 
2025-11-13 18:25:35,272 - main - INFO - ================================================================================
2025-11-13 18:25:35,272 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:25:35,273 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:25:35,273 - main - INFO - ================================================================================
2025-11-13 18:25:35,273 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:25:35,273 - main - INFO -   Upload Directory: uploads
2025-11-13 18:25:35,274 - main - INFO -   Max File Size: 20MB
2025-11-13 18:25:35,274 - main - INFO - ================================================================================
2025-11-13 18:25:35,274 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:25:35,274 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:25:35,275 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:25:35,307 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:25:35,316 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:25:35,316 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:25:35,317 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:25:35,317 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:25:35,317 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:25:35,317 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:25:35,318 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:25:35,338 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:25:35,339 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:25:35,340 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:25:35,344 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:25:35,345 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:25:35,347 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:25:35,348 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:25:35,348 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:25:35,383 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:25:35,383 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:25:35,383 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:25:35,383 - main - INFO - 
2025-11-13 18:25:35,384 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:25:35,384 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:25:35,384 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:25:35,384 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:25:35,384 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:25:35,385 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:25:35,385 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:25:35,385 - main - INFO - 
2025-11-13 18:25:35,385 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:25:35,385 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:25:35,385 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:25:35,386 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:25:35,386 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:25:35,386 - main - INFO - 
2025-11-13 18:25:35,386 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:25:35,386 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:25:35,386 - main - INFO -        - No manual section generation
2025-11-13 18:25:35,387 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:25:35,387 - main - INFO - 
2025-11-13 18:25:35,387 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:25:35,387 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:25:35,387 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:25:35,387 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:25:35,388 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:25:35,388 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:25:35,388 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:25:35,388 - main - INFO - 
2025-11-13 18:25:35,388 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:25:35,388 - main - INFO -      Main:
2025-11-13 18:25:35,389 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:25:35,389 - main - INFO - 
2025-11-13 18:25:35,389 - main - INFO -      Retrieval:
2025-11-13 18:25:35,389 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:25:35,389 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:25:35,390 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:25:35,390 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:25:35,390 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:25:35,390 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:25:35,390 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:25:35,390 - main - INFO - 
2025-11-13 18:25:35,390 - main - INFO -      Management:
2025-11-13 18:25:35,391 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:25:35,391 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:25:35,391 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:25:35,391 - main - INFO - 
2025-11-13 18:25:35,391 - main - INFO -      Documents (MongoDB):
2025-11-13 18:25:35,392 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:25:35,392 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:25:35,392 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:25:35,392 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:25:35,392 - main - INFO - 
2025-11-13 18:25:35,392 - main - INFO -      Diagnostics & Health:
2025-11-13 18:25:35,393 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:25:35,393 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:25:35,393 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:25:35,393 - main - INFO - 
2025-11-13 18:25:35,394 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:25:35,395 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:25:35,395 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:25:35,395 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:25:35,395 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:25:35,396 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:25:35,396 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:25:35,396 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:25:35,396 - main - INFO - 
2025-11-13 18:25:35,396 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:25:35,397 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:25:35,397 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:25:35,397 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:25:35,397 - main - INFO -      4. No re-upload needed!
2025-11-13 18:25:35,397 - main - INFO - 
2025-11-13 18:25:35,398 - main - INFO - ================================================================================
2025-11-13 18:25:35,398 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:25:35,398 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:25:35,398 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:25:35,398 - main - INFO - ================================================================================
2025-11-13 18:25:35,399 - main - INFO - 
2025-11-13 18:25:35,399 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:25:37,799 - main - INFO - ðŸ“¥ GET /docs
2025-11-13 18:25:37,799 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-13 18:25:37,879 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-13 18:25:37,890 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-13 18:26:03,481 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-13 18:26:03,487 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-13 18:26:03,487 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 18:26:03,488 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 18:26:03,488 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 18:26:03,490 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 18:26:03,494 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-13 18:26:03,494 - app.api.routes - INFO -    - Remaining comparisons: 237
2025-11-13 18:26:03,494 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-13 18:26:03,495 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-13 18:26:03,495 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763058363_38894ab342f8
2025-11-13 18:26:03,495 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_ea7e4741c347 (3 files)
2025-11-13 18:26:03,495 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_ea7e4741c347
2025-11-13 18:26:03,497 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:26:03,498 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:26:03,499 - app.api.routes - INFO - ======================================================================
2025-11-13 18:26:03,501 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ bee8c06de9e74954a394fb572902ae01.pdf (464206 bytes)
2025-11-13 18:26:03,501 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:26:03,502 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\bee8c06de9e74954a394fb572902ae01.pdf
2025-11-13 18:26:03,502 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:26:03,537 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:26:03,537 - app.api.routes - INFO - ======================================================================
2025-11-13 18:26:03,565 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-13 18:26:03,565 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 57b3f7ae20094b5e812b3670bad937f1.pdf (175401 bytes)
2025-11-13 18:26:03,565 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:26:03,566 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:26:03,566 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\57b3f7ae20094b5e812b3670bad937f1.pdf
2025-11-13 18:26:03,566 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:26:03,567 - app.api.routes - INFO - ======================================================================
2025-11-13 18:26:03,611 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-13 18:26:03,612 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ c848037164c8434eb9e01f166ea807ca.pdf (331157 bytes)
2025-11-13 18:26:03,612 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:26:03,613 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:26:03,613 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\c848037164c8434eb9e01f166ea807ca.pdf
2025-11-13 18:26:03,614 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:26:03,615 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-13 18:26:03,631 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-13 18:26:03,643 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 18:26:03,668 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-13 18:26:03,668 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 18:26:03,669 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-13 18:26:03,828 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-13 18:26:03,828 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 18:26:04,193 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:26:04,193 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:26:04,194 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-13 18:26:04,194 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-13 18:26:04,195 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 18:26:04,195 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 18:26:04,195 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-13 18:26:04,275 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-13 18:26:04,275 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 18:26:04,276 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:26:04,277 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:26:04,277 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-13 18:26:04,277 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-13 18:26:04,278 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-13 18:26:04,278 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 18:26:04,278 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-13 18:26:04,375 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-13 18:26:04,375 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 18:26:34,912 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:34,923 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 18:26:34,924 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-13 18:26:34,924 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits extracted - using fallback
2025-11-13 18:26:34,930 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-13 18:26:34,930 - app.services.ai_parser - INFO - âœ… Benefits after fallback: 45 (was: 0)
2025-11-13 18:26:34,930 - app.services.ai_parser - INFO - âœ… Exclusions extraction complete: 24
2025-11-13 18:26:34,931 - app.services.ai_parser - INFO - âœ… Warranties extraction complete: 13
2025-11-13 18:26:34,931 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 18:26:40,289 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:40,291 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 18:26:40,291 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 18:26:40,292 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-13 18:26:40,292 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-13 18:26:40,292 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: N/A
2025-11-13 18:26:40,292 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 18:26:40,293 - app.services.ai_parser - INFO - ðŸ“Š Counts: 45 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-13 18:26:43,437 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:43,442 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 18:26:43,442 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-13 18:26:43,443 - app.services.ai_parser - INFO - âœ… Benefits extraction complete: 15
2025-11-13 18:26:43,444 - app.services.ai_parser - INFO - âœ… Exclusions extraction complete: 29
2025-11-13 18:26:43,444 - app.services.ai_parser - INFO - âœ… Warranties extraction complete: 9
2025-11-13 18:26:43,445 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 18:26:45,466 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:45,503 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-13 18:26:45,503 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 18:26:45,504 - app.services.ai_parser - INFO - 
2025-11-13 18:26:45,505 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:26:45,506 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:26:45,506 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:26:45,507 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-13 18:26:45,508 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 18:26:45,509 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-13 18:26:45,510 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-13 18:26:45,510 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-13 18:26:45,511 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-13 18:26:45,512 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: N/A
2025-11-13 18:26:45,512 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 18:26:45,513 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 18:26:45,513 - app.services.ai_parser - INFO - 
2025-11-13 18:26:45,513 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 18:26:45,514 - app.services.ai_parser - INFO -    âœ“ Benefits: 45
2025-11-13 18:26:45,514 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-13 18:26:45,514 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-13 18:26:45,514 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 18:26:45,514 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 18:26:45,515 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:26:45,517 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: bee8c06de9e74954a394fb572902ae01.pdf â†’ 691622e59e2e5556877df784
2025-11-13 18:26:45,518 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691622e59e2e5556877df784
2025-11-13 18:26:45,521 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691622e59e2e5556877df785 (464206 bytes)
2025-11-13 18:26:45,522 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691622e59e2e5556877df785
2025-11-13 18:26:45,522 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 18:26:48,956 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:48,962 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 18:26:48,962 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 18:26:48,963 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-13 18:26:48,963 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-13 18:26:48,964 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:26:48,964 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:26:48,964 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:26:48,965 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-13 18:26:48,965 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 18:26:48,965 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-13 18:26:54,957 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:54,964 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 18:26:54,965 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-13 18:26:54,965 - app.services.ai_parser - INFO - âœ… Benefits extraction complete: 11
2025-11-13 18:26:54,966 - app.services.ai_parser - INFO - âœ… Exclusions extraction complete: 26
2025-11-13 18:26:54,967 - app.services.ai_parser - INFO - âœ… Warranties extraction complete: 12
2025-11-13 18:26:54,968 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 18:26:55,537 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:26:55,541 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-13 18:26:55,541 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 18:26:55,542 - app.services.ai_parser - INFO - 
2025-11-13 18:26:55,543 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:26:55,544 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:26:55,545 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:26:55,545 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-13 18:26:55,546 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 18:26:55,547 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 500,000.00
2025-11-13 18:26:55,547 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-13 18:26:55,548 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-13 18:26:55,549 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-13 18:26:55,549 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-13 18:26:55,549 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 18:26:55,549 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 18:26:55,550 - app.services.ai_parser - INFO - 
2025-11-13 18:26:55,550 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 18:26:55,550 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-13 18:26:55,550 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-13 18:26:55,551 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-13 18:26:55,551 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 18:26:55,551 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 18:26:55,551 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:26:55,555 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 57b3f7ae20094b5e812b3670bad937f1.pdf â†’ 691622ef9e2e5556877df786
2025-11-13 18:26:55,555 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691622ef9e2e5556877df786
2025-11-13 18:26:55,556 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691622ef9e2e5556877df787 (175401 bytes)
2025-11-13 18:26:55,557 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691622ef9e2e5556877df787
2025-11-13 18:26:55,557 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 18:27:01,789 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:27:01,792 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 18:27:01,793 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 18:27:01,793 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-13 18:27:01,793 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-13 18:27:01,793 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:27:01,793 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:27:01,794 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 18:27:01,794 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 18:27:01,794 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 18:27:01,794 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-13 18:27:06,793 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:27:06,805 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-13 18:27:06,806 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 18:27:06,807 - app.services.ai_parser - INFO - 
2025-11-13 18:27:06,808 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:27:06,808 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:27:06,809 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:27:06,810 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-13 18:27:06,810 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-13 18:27:06,811 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-13 18:27:06,811 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-13 18:27:06,811 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-13 18:27:06,811 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-13 18:27:06,811 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 18:27:06,812 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-13 18:27:06,812 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-13 18:27:06,812 - app.services.ai_parser - INFO - 
2025-11-13 18:27:06,812 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 18:27:06,813 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-13 18:27:06,813 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-13 18:27:06,814 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-13 18:27:06,814 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 18:27:06,815 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 18:27:06,815 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 18:27:06,816 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: c848037164c8434eb9e01f166ea807ca.pdf â†’ 691622fa9e2e5556877df788
2025-11-13 18:27:06,817 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691622fa9e2e5556877df788
2025-11-13 18:27:06,819 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691622fa9e2e5556877df789 (331157 bytes)
2025-11-13 18:27:06,819 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691622fa9e2e5556877df789
2025-11-13 18:27:06,819 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 18:27:06,820 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-13 18:27:06,820 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:27:06,820 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-13 18:27:06,820 - app.api.routes - INFO - ======================================================================
2025-11-13 18:27:06,821 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-13 18:27:06,821 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-13 18:27:06,821 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-13 18:27:06,821 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=83.17
2025-11-13 18:27:06,822 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.43
2025-11-13 18:27:06,822 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=79.61
2025-11-13 18:27:06,822 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-13 18:27:06,823 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-13 18:27:12,569 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 18:27:12,571 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-13 18:27:12,571 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-13 18:27:12,572 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-13 18:27:12,572 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-13 18:27:12,573 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-13 18:27:12,573 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763058363_38894ab342f8
2025-11-13 18:27:12,573 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-13 18:27:12,573 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-13 18:27:12,573 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-13 18:27:12,574 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-13 18:27:12,574 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 18:27:12,574 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 18:27:12,574 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 18:27:12,574 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 18:27:12,575 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 18:27:12,575 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 18:27:12,575 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-13 18:27:12,575 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 18:27:12,575 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 18:27:12,576 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 18:27:12,576 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 18:27:12,576 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 18:27:12,576 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 18:27:12,579 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-13 18:27:12,579 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,309 bytes
2025-11-13 18:27:12,579 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 27,533 bytes
2025-11-13 18:27:12,579 - app.services.mongodb_service_enhanced - INFO -    Data table: 11,473 bytes
2025-11-13 18:27:12,580 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,737 bytes
2025-11-13 18:27:12,580 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 41,639 bytes
2025-11-13 18:27:12,580 - app.services.mongodb_service_enhanced - INFO -    Total document: 180,680 bytes
2025-11-13 18:27:12,580 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-13 18:27:12,581 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-13 18:27:12,581 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-13 18:27:12,581 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-13 18:27:12,581 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-13 18:27:12,582 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-13 18:27:12,582 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-13 18:27:12,582 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-13 18:27:12,582 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-13 18:27:12,582 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-13 18:27:12,583 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-13 18:27:12,583 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-13 18:27:12,583 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-13 18:27:12,583 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-13 18:27:12,583 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-13 18:27:12,584 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-13 18:27:12,584 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-13 18:27:12,584 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 18:27:12,584 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 18:27:12,585 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-13 18:27:12,590 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763058363_38894ab342f8
2025-11-13 18:27:12,590 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69162300e07bc3665c3df805
2025-11-13 18:27:12,593 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-13 18:27:12,593 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-13 18:27:12,593 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-13 18:27:12,594 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-13 18:27:12,594 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-13 18:27:12,594 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-13 18:27:12,594 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-13 18:27:12,594 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-13 18:27:12,595 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-13 18:27:12,595 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-13 18:27:12,595 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-13 18:27:12,595 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-13 18:27:12,596 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 18:27:12,596 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-13 18:27:12,596 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-13 18:27:12,597 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-13 18:27:12,597 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-13 18:27:12,597 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-13 18:27:12,597 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 18:27:12,598 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69162300e07bc3665c3df805
2025-11-13 18:27:12,598 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-13 18:27:12,598 - app.api.routes - INFO -    Collection: comparisons
2025-11-13 18:27:12,598 - app.api.routes - INFO -    Comparison ID: cmp_1763058363_38894ab342f8
2025-11-13 18:27:12,602 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 18:27:12,603 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 18:27:12,603 - app.api.routes - INFO - 
======================================================================
2025-11-13 18:27:12,603 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-13 18:27:12,603 - app.api.routes - INFO - ======================================================================
2025-11-13 18:27:12,604 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763058363_38894ab342f8
2025-11-13 18:27:12,604 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-13 18:27:12,604 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-13 18:27:12,604 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-13 18:27:12,604 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 18:27:12,605 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 18:27:12,605 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 18:27:12,606 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 18:27:12,607 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 236
2025-11-13 18:27:12,607 - app.api.routes - INFO - ======================================================================

2025-11-13 18:27:12,607 - app.services.progress_tracker - INFO - âœ… Job completed: job_ea7e4741c347 â†’ comparison_id: cmp_1763058363_38894ab342f8
2025-11-13 18:27:12,609 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 69.13s
2025-11-13 18:35:35,417 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-13 18:35:35,418 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-13 18:51:35,998 - main - INFO - 
2025-11-13 18:51:35,999 - main - INFO - ================================================================================
2025-11-13 18:51:36,000 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:51:36,006 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:51:36,022 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:51:36,023 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:51:36,024 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:51:36,026 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:51:36,031 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:51:36,037 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-13 18:51:36,038 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:51:36,039 - main - INFO - ================================================================================
2025-11-13 18:51:36,040 - main - INFO - 
2025-11-13 18:51:40,537 - main - INFO - 
2025-11-13 18:51:40,537 - main - INFO - ================================================================================
2025-11-13 18:51:40,537 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:51:40,537 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:51:40,537 - main - INFO - ================================================================================
2025-11-13 18:51:40,538 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:51:40,538 - main - INFO -   Upload Directory: uploads
2025-11-13 18:51:40,538 - main - INFO -   Max File Size: 20MB
2025-11-13 18:51:40,538 - main - INFO - ================================================================================
2025-11-13 18:51:40,539 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:51:40,539 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:51:40,540 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:51:40,562 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:51:40,568 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:51:40,569 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:51:40,569 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:51:40,569 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:51:40,570 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:51:40,570 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:51:40,570 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:51:40,580 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:51:40,582 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:51:40,583 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:51:40,585 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:51:40,585 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:51:40,585 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:51:40,586 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:51:40,586 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:51:40,596 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:51:40,596 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:51:40,596 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:51:40,597 - main - INFO - 
2025-11-13 18:51:40,597 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:51:40,597 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:51:40,597 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:51:40,598 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:51:40,598 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:51:40,598 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:51:40,598 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:51:40,599 - main - INFO - 
2025-11-13 18:51:40,599 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:51:40,599 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:51:40,599 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:51:40,599 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:51:40,600 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:51:40,600 - main - INFO - 
2025-11-13 18:51:40,600 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:51:40,600 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:51:40,600 - main - INFO -        - No manual section generation
2025-11-13 18:51:40,600 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:51:40,601 - main - INFO - 
2025-11-13 18:51:40,601 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:51:40,601 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:51:40,601 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:51:40,601 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:51:40,601 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:51:40,601 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:51:40,602 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:51:40,602 - main - INFO - 
2025-11-13 18:51:40,602 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:51:40,602 - main - INFO -      Main:
2025-11-13 18:51:40,602 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:51:40,602 - main - INFO - 
2025-11-13 18:51:40,603 - main - INFO -      Retrieval:
2025-11-13 18:51:40,603 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:51:40,603 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:51:40,603 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:51:40,603 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:51:40,603 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:51:40,603 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:51:40,604 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:51:40,604 - main - INFO - 
2025-11-13 18:51:40,604 - main - INFO -      Management:
2025-11-13 18:51:40,604 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:51:40,604 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:51:40,604 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:51:40,604 - main - INFO - 
2025-11-13 18:51:40,605 - main - INFO -      Documents (MongoDB):
2025-11-13 18:51:40,605 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:51:40,605 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:51:40,605 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:51:40,605 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:51:40,605 - main - INFO - 
2025-11-13 18:51:40,605 - main - INFO -      Diagnostics & Health:
2025-11-13 18:51:40,606 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:51:40,606 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:51:40,606 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:51:40,606 - main - INFO - 
2025-11-13 18:51:40,607 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:51:40,607 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:51:40,608 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:51:40,608 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:51:40,608 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:51:40,609 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:51:40,609 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:51:40,609 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:51:40,609 - main - INFO - 
2025-11-13 18:51:40,609 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:51:40,609 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:51:40,609 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:51:40,610 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:51:40,610 - main - INFO -      4. No re-upload needed!
2025-11-13 18:51:40,610 - main - INFO - 
2025-11-13 18:51:40,610 - main - INFO - ================================================================================
2025-11-13 18:51:40,610 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:51:40,611 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:51:40,611 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:51:40,611 - main - INFO - ================================================================================
2025-11-13 18:51:40,611 - main - INFO - 
2025-11-13 18:51:40,611 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:52:24,631 - main - INFO - 
2025-11-13 18:52:24,632 - main - INFO - ================================================================================
2025-11-13 18:52:24,632 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:52:24,633 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:52:24,635 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:52:24,636 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:52:24,637 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:52:24,638 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:52:24,638 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:52:24,639 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-13 18:52:24,639 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:52:24,640 - main - INFO - ================================================================================
2025-11-13 18:52:24,640 - main - INFO - 
2025-11-13 18:52:28,406 - main - INFO - 
2025-11-13 18:52:28,407 - main - INFO - ================================================================================
2025-11-13 18:52:28,408 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:52:28,408 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:52:28,409 - main - INFO - ================================================================================
2025-11-13 18:52:28,409 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:52:28,409 - main - INFO -   Upload Directory: uploads
2025-11-13 18:52:28,409 - main - INFO -   Max File Size: 20MB
2025-11-13 18:52:28,410 - main - INFO - ================================================================================
2025-11-13 18:52:28,410 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:52:28,411 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:52:28,411 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:52:28,448 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:52:28,452 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:52:28,453 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:52:28,453 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:52:28,453 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:52:28,453 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:52:28,453 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:52:28,454 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:52:28,482 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:52:28,484 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:52:28,486 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:52:28,489 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:52:28,489 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:52:28,491 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:52:28,491 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:52:28,492 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:52:28,523 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:52:28,524 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:52:28,524 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:52:28,524 - main - INFO - 
2025-11-13 18:52:28,524 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:52:28,524 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:52:28,524 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:52:28,525 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:52:28,525 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:52:28,525 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:52:28,525 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:52:28,526 - main - INFO - 
2025-11-13 18:52:28,526 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:52:28,526 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:52:28,526 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:52:28,526 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:52:28,526 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:52:28,527 - main - INFO - 
2025-11-13 18:52:28,527 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:52:28,527 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:52:28,527 - main - INFO -        - No manual section generation
2025-11-13 18:52:28,527 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:52:28,527 - main - INFO - 
2025-11-13 18:52:28,528 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:52:28,528 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:52:28,528 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:52:28,528 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:52:28,528 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:52:28,528 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:52:28,529 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:52:28,529 - main - INFO - 
2025-11-13 18:52:28,529 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:52:28,529 - main - INFO -      Main:
2025-11-13 18:52:28,529 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:52:28,529 - main - INFO - 
2025-11-13 18:52:28,530 - main - INFO -      Retrieval:
2025-11-13 18:52:28,530 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:52:28,530 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:52:28,530 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:52:28,530 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:52:28,530 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:52:28,530 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:52:28,531 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:52:28,531 - main - INFO - 
2025-11-13 18:52:28,531 - main - INFO -      Management:
2025-11-13 18:52:28,531 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:52:28,531 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:52:28,531 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:52:28,531 - main - INFO - 
2025-11-13 18:52:28,532 - main - INFO -      Documents (MongoDB):
2025-11-13 18:52:28,532 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:52:28,532 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:52:28,532 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:52:28,532 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:52:28,532 - main - INFO - 
2025-11-13 18:52:28,532 - main - INFO -      Diagnostics & Health:
2025-11-13 18:52:28,533 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:52:28,533 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:52:28,533 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:52:28,533 - main - INFO - 
2025-11-13 18:52:28,533 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:52:28,533 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:52:28,533 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:52:28,534 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:52:28,534 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:52:28,534 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:52:28,534 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:52:28,534 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:52:28,534 - main - INFO - 
2025-11-13 18:52:28,534 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:52:28,535 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:52:28,535 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:52:28,535 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:52:28,535 - main - INFO -      4. No re-upload needed!
2025-11-13 18:52:28,535 - main - INFO - 
2025-11-13 18:52:28,535 - main - INFO - ================================================================================
2025-11-13 18:52:28,535 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:52:28,536 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:52:28,536 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:52:28,536 - main - INFO - ================================================================================
2025-11-13 18:52:28,536 - main - INFO - 
2025-11-13 18:52:28,536 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:53:34,248 - main - INFO - 
2025-11-13 18:53:34,249 - main - INFO - ================================================================================
2025-11-13 18:53:34,249 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:53:34,250 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:53:34,251 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:53:34,252 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:53:34,252 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:53:34,253 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:53:34,254 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:53:34,255 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-13 18:53:34,256 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:53:34,256 - main - INFO - ================================================================================
2025-11-13 18:53:34,256 - main - INFO - 
2025-11-13 18:53:38,347 - main - INFO - 
2025-11-13 18:53:38,347 - main - INFO - ================================================================================
2025-11-13 18:53:38,347 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:53:38,348 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:53:38,348 - main - INFO - ================================================================================
2025-11-13 18:53:38,348 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:53:38,348 - main - INFO -   Upload Directory: uploads
2025-11-13 18:53:38,348 - main - INFO -   Max File Size: 20MB
2025-11-13 18:53:38,349 - main - INFO - ================================================================================
2025-11-13 18:53:38,349 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:53:38,349 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:53:38,349 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:53:38,395 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:53:38,400 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:53:38,400 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:53:38,400 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:53:38,401 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:53:38,401 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:53:38,401 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:53:38,401 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:53:38,409 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:53:38,410 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:53:38,411 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:53:38,413 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:53:38,413 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:53:38,414 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:53:38,414 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:53:38,414 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:53:38,422 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:53:38,422 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:53:38,423 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:53:38,423 - main - INFO - 
2025-11-13 18:53:38,423 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:53:38,423 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:53:38,423 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:53:38,424 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:53:38,424 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:53:38,424 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:53:38,424 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:53:38,424 - main - INFO - 
2025-11-13 18:53:38,424 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:53:38,425 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:53:38,425 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:53:38,425 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:53:38,425 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:53:38,425 - main - INFO - 
2025-11-13 18:53:38,425 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:53:38,426 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:53:38,426 - main - INFO -        - No manual section generation
2025-11-13 18:53:38,426 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:53:38,426 - main - INFO - 
2025-11-13 18:53:38,426 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:53:38,427 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:53:38,427 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:53:38,427 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:53:38,427 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:53:38,427 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:53:38,428 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:53:38,428 - main - INFO - 
2025-11-13 18:53:38,428 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:53:38,428 - main - INFO -      Main:
2025-11-13 18:53:38,429 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:53:38,429 - main - INFO - 
2025-11-13 18:53:38,429 - main - INFO -      Retrieval:
2025-11-13 18:53:38,429 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:53:38,430 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:53:38,430 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:53:38,430 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:53:38,431 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:53:38,431 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:53:38,431 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:53:38,431 - main - INFO - 
2025-11-13 18:53:38,431 - main - INFO -      Management:
2025-11-13 18:53:38,432 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:53:38,432 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:53:38,432 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:53:38,432 - main - INFO - 
2025-11-13 18:53:38,433 - main - INFO -      Documents (MongoDB):
2025-11-13 18:53:38,433 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:53:38,433 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:53:38,433 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:53:38,434 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:53:38,434 - main - INFO - 
2025-11-13 18:53:38,434 - main - INFO -      Diagnostics & Health:
2025-11-13 18:53:38,435 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:53:38,435 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:53:38,436 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:53:38,436 - main - INFO - 
2025-11-13 18:53:38,436 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:53:38,437 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:53:38,437 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:53:38,437 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:53:38,438 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:53:38,439 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:53:38,440 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:53:38,440 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:53:38,441 - main - INFO - 
2025-11-13 18:53:38,441 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:53:38,441 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:53:38,442 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:53:38,442 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:53:38,442 - main - INFO -      4. No re-upload needed!
2025-11-13 18:53:38,442 - main - INFO - 
2025-11-13 18:53:38,442 - main - INFO - ================================================================================
2025-11-13 18:53:38,443 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:53:38,443 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:53:38,444 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:53:38,445 - main - INFO - ================================================================================
2025-11-13 18:53:38,445 - main - INFO - 
2025-11-13 18:53:38,445 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:53:56,845 - main - INFO - 
2025-11-13 18:53:56,846 - main - INFO - ================================================================================
2025-11-13 18:53:56,846 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:53:56,848 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:53:56,848 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:53:56,850 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:53:56,850 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:53:56,853 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:53:56,853 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:53:56,854 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-13 18:53:56,858 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:53:56,862 - main - INFO - ================================================================================
2025-11-13 18:53:56,863 - main - INFO - 
2025-11-13 18:54:00,576 - main - INFO - 
2025-11-13 18:54:00,577 - main - INFO - ================================================================================
2025-11-13 18:54:00,577 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:54:00,577 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:54:00,578 - main - INFO - ================================================================================
2025-11-13 18:54:00,578 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:54:00,578 - main - INFO -   Upload Directory: uploads
2025-11-13 18:54:00,578 - main - INFO -   Max File Size: 20MB
2025-11-13 18:54:00,578 - main - INFO - ================================================================================
2025-11-13 18:54:00,579 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:54:00,579 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:54:00,579 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:54:00,622 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:54:00,633 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:54:00,633 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:54:00,634 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:54:00,634 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:54:00,634 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:54:00,635 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:54:00,635 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:54:00,667 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:54:00,668 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:54:00,671 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:54:00,676 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:54:00,677 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:54:00,677 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:54:00,677 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:54:00,678 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:54:00,699 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:54:00,699 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:54:00,700 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:54:00,700 - main - INFO - 
2025-11-13 18:54:00,700 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:54:00,701 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:54:00,701 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:54:00,701 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:54:00,702 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:54:00,702 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:54:00,702 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:54:00,702 - main - INFO - 
2025-11-13 18:54:00,703 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:54:00,703 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:54:00,703 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:54:00,703 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:54:00,704 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:54:00,704 - main - INFO - 
2025-11-13 18:54:00,704 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:54:00,704 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:54:00,704 - main - INFO -        - No manual section generation
2025-11-13 18:54:00,705 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:54:00,705 - main - INFO - 
2025-11-13 18:54:00,705 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:54:00,705 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:54:00,705 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:54:00,705 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:54:00,706 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:54:00,706 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:54:00,707 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:54:00,708 - main - INFO - 
2025-11-13 18:54:00,708 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:54:00,709 - main - INFO -      Main:
2025-11-13 18:54:00,709 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:54:00,710 - main - INFO - 
2025-11-13 18:54:00,710 - main - INFO -      Retrieval:
2025-11-13 18:54:00,710 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:54:00,711 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:54:00,711 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:54:00,712 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:54:00,712 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:54:00,713 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:54:00,713 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:54:00,713 - main - INFO - 
2025-11-13 18:54:00,714 - main - INFO -      Management:
2025-11-13 18:54:00,714 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:54:00,714 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:54:00,714 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:54:00,715 - main - INFO - 
2025-11-13 18:54:00,715 - main - INFO -      Documents (MongoDB):
2025-11-13 18:54:00,715 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:54:00,715 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:54:00,716 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:54:00,716 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:54:00,716 - main - INFO - 
2025-11-13 18:54:00,716 - main - INFO -      Diagnostics & Health:
2025-11-13 18:54:00,716 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:54:00,717 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:54:00,717 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:54:00,717 - main - INFO - 
2025-11-13 18:54:00,717 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:54:00,717 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:54:00,718 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:54:00,718 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:54:00,718 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:54:00,718 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:54:00,718 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:54:00,718 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:54:00,719 - main - INFO - 
2025-11-13 18:54:00,719 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:54:00,719 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:54:00,719 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:54:00,719 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:54:00,720 - main - INFO -      4. No re-upload needed!
2025-11-13 18:54:00,720 - main - INFO - 
2025-11-13 18:54:00,720 - main - INFO - ================================================================================
2025-11-13 18:54:00,720 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:54:00,720 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:54:00,721 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:54:00,721 - main - INFO - ================================================================================
2025-11-13 18:54:00,721 - main - INFO - 
2025-11-13 18:54:00,721 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:54:53,280 - main - INFO - 
2025-11-13 18:54:53,280 - main - INFO - ================================================================================
2025-11-13 18:54:53,281 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:54:53,282 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:54:53,283 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:54:53,284 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:54:53,286 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:54:53,288 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:54:53,291 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:54:53,294 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-13 18:54:53,295 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:54:53,295 - main - INFO - ================================================================================
2025-11-13 18:54:53,296 - main - INFO - 
2025-11-13 18:54:57,480 - main - INFO - 
2025-11-13 18:54:57,480 - main - INFO - ================================================================================
2025-11-13 18:54:57,480 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:54:57,481 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:54:57,481 - main - INFO - ================================================================================
2025-11-13 18:54:57,481 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:54:57,481 - main - INFO -   Upload Directory: uploads
2025-11-13 18:54:57,481 - main - INFO -   Max File Size: 20MB
2025-11-13 18:54:57,481 - main - INFO - ================================================================================
2025-11-13 18:54:57,482 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:54:57,482 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:54:57,482 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:54:57,514 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:54:57,519 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:54:57,519 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:54:57,519 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:54:57,519 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:54:57,520 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:54:57,520 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:54:57,520 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:54:57,543 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:54:57,545 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:54:57,546 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:54:57,548 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:54:57,548 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:54:57,549 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:54:57,549 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:54:57,549 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:54:57,581 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:54:57,582 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:54:57,582 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:54:57,583 - main - INFO - 
2025-11-13 18:54:57,583 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:54:57,583 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:54:57,584 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:54:57,584 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:54:57,585 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:54:57,586 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:54:57,586 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:54:57,586 - main - INFO - 
2025-11-13 18:54:57,587 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:54:57,588 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:54:57,588 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:54:57,589 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:54:57,589 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:54:57,591 - main - INFO - 
2025-11-13 18:54:57,592 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:54:57,593 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:54:57,594 - main - INFO -        - No manual section generation
2025-11-13 18:54:57,594 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:54:57,595 - main - INFO - 
2025-11-13 18:54:57,596 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:54:57,597 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:54:57,598 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:54:57,598 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:54:57,599 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:54:57,599 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:54:57,600 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:54:57,600 - main - INFO - 
2025-11-13 18:54:57,601 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:54:57,601 - main - INFO -      Main:
2025-11-13 18:54:57,602 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:54:57,602 - main - INFO - 
2025-11-13 18:54:57,603 - main - INFO -      Retrieval:
2025-11-13 18:54:57,603 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:54:57,604 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:54:57,605 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:54:57,605 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:54:57,606 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:54:57,608 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:54:57,609 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:54:57,610 - main - INFO - 
2025-11-13 18:54:57,611 - main - INFO -      Management:
2025-11-13 18:54:57,611 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:54:57,612 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:54:57,613 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:54:57,613 - main - INFO - 
2025-11-13 18:54:57,614 - main - INFO -      Documents (MongoDB):
2025-11-13 18:54:57,615 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:54:57,615 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:54:57,616 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:54:57,616 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:54:57,617 - main - INFO - 
2025-11-13 18:54:57,618 - main - INFO -      Diagnostics & Health:
2025-11-13 18:54:57,618 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:54:57,619 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:54:57,619 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:54:57,619 - main - INFO - 
2025-11-13 18:54:57,620 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:54:57,620 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:54:57,621 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:54:57,621 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:54:57,621 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:54:57,622 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:54:57,622 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:54:57,623 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:54:57,625 - main - INFO - 
2025-11-13 18:54:57,626 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:54:57,626 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:54:57,626 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:54:57,627 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:54:57,627 - main - INFO -      4. No re-upload needed!
2025-11-13 18:54:57,628 - main - INFO - 
2025-11-13 18:54:57,628 - main - INFO - ================================================================================
2025-11-13 18:54:57,628 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:54:57,629 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:54:57,629 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:54:57,630 - main - INFO - ================================================================================
2025-11-13 18:54:57,630 - main - INFO - 
2025-11-13 18:54:57,630 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 18:58:41,992 - main - INFO - 
2025-11-13 18:58:41,993 - main - INFO - ================================================================================
2025-11-13 18:58:41,993 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-13 18:58:41,994 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:58:41,994 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-13 18:58:41,995 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-13 18:58:41,996 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-13 18:58:41,996 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-13 18:58:41,997 - main - INFO -   âœ… User Documents Service connection closed
2025-11-13 18:58:41,997 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-13 18:58:41,997 - main - INFO -   âœ… Application stopped successfully
2025-11-13 18:58:41,998 - main - INFO - ================================================================================
2025-11-13 18:58:41,998 - main - INFO - 
2025-11-13 18:58:44,445 - main - INFO - 
2025-11-13 18:58:44,446 - main - INFO - ================================================================================
2025-11-13 18:58:44,446 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-13 18:58:44,446 - main - INFO -   Production-Ready Complete Integration
2025-11-13 18:58:44,446 - main - INFO - ================================================================================
2025-11-13 18:58:44,447 - main - INFO -   AI Model: gpt-4o-mini
2025-11-13 18:58:44,447 - main - INFO -   Upload Directory: uploads
2025-11-13 18:58:44,447 - main - INFO -   Max File Size: 20MB
2025-11-13 18:58:44,447 - main - INFO - ================================================================================
2025-11-13 18:58:44,448 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-13 18:58:44,448 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-13 18:58:44,448 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-13 18:58:44,491 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-13 18:58:44,502 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-13 18:58:44,503 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-13 18:58:44,503 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-13 18:58:44,503 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-13 18:58:44,504 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-13 18:58:44,504 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:58:44,504 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:58:44,549 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-13 18:58:44,551 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-13 18:58:44,553 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-13 18:58:44,556 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-13 18:58:44,556 - main - INFO -   âœ… User Subscription Service connected
2025-11-13 18:58:44,557 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-13 18:58:44,557 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-13 18:58:44,558 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-13 18:58:44,594 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-13 18:58:44,595 - main - INFO -   âœ… User Documents Service connected
2025-11-13 18:58:44,595 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-13 18:58:44,595 - main - INFO - 
2025-11-13 18:58:44,595 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-13 18:58:44,596 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-13 18:58:44,596 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-13 18:58:44,596 - main - INFO -        - Separates warranties from extensions
2025-11-13 18:58:44,597 - main - INFO -        - Extracts subjectivities & operational details
2025-11-13 18:58:44,597 - main - INFO -        - Correct deductible tier detection
2025-11-13 18:58:44,597 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-13 18:58:44,598 - main - INFO - 
2025-11-13 18:58:44,598 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-13 18:58:44,598 - main - INFO -        - Generates ALL sections comprehensively
2025-11-13 18:58:44,598 - main - INFO -        - Identifies unique items per provider
2025-11-13 18:58:44,598 - main - INFO -        - Transparent scoring methodology
2025-11-13 18:58:44,599 - main - INFO -        - Uses full _extended_data from parser
2025-11-13 18:58:44,599 - main - INFO - 
2025-11-13 18:58:44,599 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-13 18:58:44,599 - main - INFO -        - Single endpoint auto-populates everything
2025-11-13 18:58:44,599 - main - INFO -        - No manual section generation
2025-11-13 18:58:44,599 - main - INFO -        - Complete MongoDB integration
2025-11-13 18:58:44,600 - main - INFO - 
2025-11-13 18:58:44,600 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-13 18:58:44,600 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-13 18:58:44,600 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-13 18:58:44,600 - main - INFO -      âœ… Subjectivities: Now included
2025-11-13 18:58:44,600 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-13 18:58:44,600 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-13 18:58:44,601 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-13 18:58:44,601 - main - INFO - 
2025-11-13 18:58:44,601 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-13 18:58:44,601 - main - INFO -      Main:
2025-11-13 18:58:44,601 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-13 18:58:44,601 - main - INFO - 
2025-11-13 18:58:44,601 - main - INFO -      Retrieval:
2025-11-13 18:58:44,602 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-13 18:58:44,602 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-13 18:58:44,602 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-13 18:58:44,602 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-13 18:58:44,602 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-13 18:58:44,602 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-13 18:58:44,602 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-13 18:58:44,603 - main - INFO - 
2025-11-13 18:58:44,603 - main - INFO -      Management:
2025-11-13 18:58:44,603 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-13 18:58:44,603 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-13 18:58:44,603 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-13 18:58:44,603 - main - INFO - 
2025-11-13 18:58:44,603 - main - INFO -      Documents (MongoDB):
2025-11-13 18:58:44,604 - main - INFO -        GET  /api/documents                All documents
2025-11-13 18:58:44,604 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-13 18:58:44,604 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-13 18:58:44,604 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-13 18:58:44,604 - main - INFO - 
2025-11-13 18:58:44,604 - main - INFO -      Diagnostics & Health:
2025-11-13 18:58:44,604 - main - INFO -        GET  /api/health                   System health
2025-11-13 18:58:44,605 - main - INFO -        GET  /api/status                   Detailed status
2025-11-13 18:58:44,605 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-13 18:58:44,605 - main - INFO - 
2025-11-13 18:58:44,605 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-13 18:58:44,605 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-13 18:58:44,606 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-13 18:58:44,606 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-13 18:58:44,606 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-13 18:58:44,606 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-13 18:58:44,606 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-13 18:58:44,606 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-13 18:58:44,606 - main - INFO - 
2025-11-13 18:58:44,607 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-13 18:58:44,607 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-13 18:58:44,607 - main - INFO -      2. Receive comparison_id + complete data
2025-11-13 18:58:44,607 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-13 18:58:44,607 - main - INFO -      4. No re-upload needed!
2025-11-13 18:58:44,607 - main - INFO - 
2025-11-13 18:58:44,608 - main - INFO - ================================================================================
2025-11-13 18:58:44,608 - main - INFO -   âœ… Application started successfully!
2025-11-13 18:58:44,608 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-13 18:58:44,608 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-13 18:58:44,608 - main - INFO - ================================================================================
2025-11-13 18:58:44,608 - main - INFO - 
2025-11-13 18:58:44,609 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-13 19:01:04,149 - main - INFO - ðŸ“¥ GET /docs
2025-11-13 19:01:04,150 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-13 19:01:04,230 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-13 19:01:04,241 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-13 19:01:39,250 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-13 19:01:39,256 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-13 19:01:39,257 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 19:01:39,257 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 19:01:39,258 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 19:01:39,260 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 19:01:39,262 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-13 19:01:39,263 - app.api.routes - INFO -    - Remaining comparisons: 236
2025-11-13 19:01:39,264 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-13 19:01:39,264 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-13 19:01:39,265 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763060499_03f554e4207c
2025-11-13 19:01:39,265 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_7f02566d07de (3 files)
2025-11-13 19:01:39,265 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_7f02566d07de
2025-11-13 19:01:39,266 - app.api.routes - INFO - 
======================================================================
2025-11-13 19:01:39,267 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 19:01:39,267 - app.api.routes - INFO - ======================================================================
2025-11-13 19:01:39,269 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 6f433530d36144eb8dccfe3e217ad6ce.pdf (464206 bytes)
2025-11-13 19:01:39,271 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 19:01:39,272 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6f433530d36144eb8dccfe3e217ad6ce.pdf
2025-11-13 19:01:39,272 - app.api.routes - INFO - 
======================================================================
2025-11-13 19:01:39,293 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 19:01:39,311 - app.api.routes - INFO - ======================================================================
2025-11-13 19:01:39,315 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ a3becbc4368d4b9a95e9aabeb5030a00.pdf (175401 bytes)
2025-11-13 19:01:39,344 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 19:01:39,347 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-13 19:01:39,348 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a3becbc4368d4b9a95e9aabeb5030a00.pdf
2025-11-13 19:01:39,348 - app.api.routes - INFO - 
======================================================================
2025-11-13 19:01:39,370 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 19:01:39,386 - app.api.routes - INFO - ======================================================================
2025-11-13 19:01:39,395 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-13 19:01:39,396 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ d599e0e281f34aaabdc83c88345af0a7.pdf (331157 bytes)
2025-11-13 19:01:39,397 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 19:01:39,397 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\d599e0e281f34aaabdc83c88345af0a7.pdf
2025-11-13 19:01:39,397 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 19:01:39,427 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 19:01:39,449 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-13 19:01:39,452 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-13 19:01:39,452 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-13 19:01:39,453 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 19:01:39,453 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 19:01:39,454 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-13 19:01:39,612 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-13 19:01:39,613 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 19:01:39,990 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 19:01:39,990 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 19:01:39,991 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-13 19:01:39,991 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-13 19:01:39,991 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 19:01:39,992 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 19:01:39,992 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-13 19:01:40,165 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-13 19:01:40,178 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 19:01:40,180 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 19:01:40,181 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-13 19:01:40,181 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-13 19:01:40,182 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-13 19:01:40,182 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-13 19:01:40,182 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-13 19:01:40,182 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-13 19:01:40,313 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-13 19:01:40,314 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-13 19:02:11,192 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:11,223 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 19:02:11,224 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-13 19:02:11,226 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-13 19:02:11,227 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-13 19:02:11,227 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 19:02:11,228 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-13 19:02:11,234 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-13 19:02:11,235 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-13 19:02:11,235 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 19:02:17,653 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:17,658 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 19:02:17,658 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 19:02:17,658 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-13 19:02:17,659 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-13 19:02:17,659 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 19:02:17,659 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 19:02:17,659 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-13 19:02:18,305 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:18,308 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 19:02:18,309 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-13 19:02:18,310 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-13 19:02:18,310 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 19:02:25,481 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:25,488 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 19:02:25,488 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 19:02:25,489 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-13 19:02:25,489 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-13 19:02:25,490 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 19:02:25,490 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 19:02:25,490 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 19:02:25,491 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 19:02:25,491 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 19:02:25,492 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 3 extensions
2025-11-13 19:02:25,742 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:25,743 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-13 19:02:25,744 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 19:02:25,744 - app.services.ai_parser - INFO - 
2025-11-13 19:02:25,745 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:02:25,745 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 19:02:25,745 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:02:25,746 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-13 19:02:25,746 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-13 19:02:25,746 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-13 19:02:25,747 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-13 19:02:25,747 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-13 19:02:25,747 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-13 19:02:25,747 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 19:02:25,748 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 19:02:25,748 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 19:02:25,748 - app.services.ai_parser - INFO - 
2025-11-13 19:02:25,748 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 19:02:25,749 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-13 19:02:25,749 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-13 19:02:25,749 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-13 19:02:25,749 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 19:02:25,749 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 19:02:25,750 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:02:25,751 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6f433530d36144eb8dccfe3e217ad6ce.pdf â†’ 69162b4119e2c9939a2b9a72
2025-11-13 19:02:25,751 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69162b4119e2c9939a2b9a72
2025-11-13 19:02:25,757 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69162b4119e2c9939a2b9a73 (464206 bytes)
2025-11-13 19:02:25,758 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69162b4119e2c9939a2b9a73
2025-11-13 19:02:25,758 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-13 19:02:35,165 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:35,169 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-13 19:02:35,170 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 19:02:35,170 - app.services.ai_parser - INFO - 
2025-11-13 19:02:35,171 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:02:35,171 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-13 19:02:35,171 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:02:35,172 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-13 19:02:35,172 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-13 19:02:35,173 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-13 19:02:35,173 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-13 19:02:35,173 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-13 19:02:35,174 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-13 19:02:35,174 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-13 19:02:35,175 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-13 19:02:35,175 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-13 19:02:35,175 - app.services.ai_parser - INFO - 
2025-11-13 19:02:35,176 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 19:02:35,176 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-13 19:02:35,176 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-13 19:02:35,176 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-13 19:02:35,177 - app.services.ai_parser - INFO -    âœ“ Extensions: 3
2025-11-13 19:02:35,177 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 19:02:35,177 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:02:35,178 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: d599e0e281f34aaabdc83c88345af0a7.pdf â†’ 69162b4b19e2c9939a2b9a74
2025-11-13 19:02:35,179 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69162b4b19e2c9939a2b9a74
2025-11-13 19:02:35,181 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69162b4b19e2c9939a2b9a75 (331157 bytes)
2025-11-13 19:02:35,181 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69162b4b19e2c9939a2b9a75
2025-11-13 19:02:35,181 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-13 19:02:50,082 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:50,087 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-13 19:02:50,087 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-13 19:02:50,088 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-13 19:02:50,089 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-13 19:02:57,610 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:02:57,640 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-13 19:02:57,641 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-13 19:02:57,642 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-13 19:02:57,643 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-13 19:02:57,644 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 19:02:57,645 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 19:02:57,645 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-13 19:02:57,646 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-13 19:02:57,647 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-13 19:02:57,647 - app.services.ai_parser - INFO - ðŸ“Š Counts: 37 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-13 19:03:04,128 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:03:04,138 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-13 19:03:04,139 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-13 19:03:04,140 - app.services.ai_parser - INFO - 
2025-11-13 19:03:04,141 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:03:04,142 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 19:03:04,142 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:03:04,143 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-13 19:03:04,143 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-13 19:03:04,144 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-13 19:03:04,145 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-13 19:03:04,145 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-13 19:03:04,145 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-13 19:03:04,145 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-13 19:03:04,146 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-13 19:03:04,146 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-13 19:03:04,146 - app.services.ai_parser - INFO - 
2025-11-13 19:03:04,147 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-13 19:03:04,147 - app.services.ai_parser - INFO -    âœ“ Benefits: 37
2025-11-13 19:03:04,147 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-13 19:03:04,147 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-13 19:03:04,147 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-13 19:03:04,148 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-13 19:03:04,148 - app.services.ai_parser - INFO - ======================================================================
2025-11-13 19:03:04,150 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a3becbc4368d4b9a95e9aabeb5030a00.pdf â†’ 69162b6819e2c9939a2b9a76
2025-11-13 19:03:04,151 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69162b6819e2c9939a2b9a76
2025-11-13 19:03:04,154 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69162b6819e2c9939a2b9a77 (175401 bytes)
2025-11-13 19:03:04,154 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69162b6819e2c9939a2b9a77
2025-11-13 19:03:04,154 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-13 19:03:04,155 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-13 19:03:04,155 - app.api.routes - INFO - 
======================================================================
2025-11-13 19:03:04,155 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-13 19:03:04,155 - app.api.routes - INFO - ======================================================================
2025-11-13 19:03:04,156 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-13 19:03:04,156 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-13 19:03:04,157 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-13 19:03:04,157 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-13 19:03:04,158 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-13 19:03:04,158 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.12
2025-11-13 19:03:04,158 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-13 19:03:04,159 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-13 19:03:18,896 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-13 19:03:18,898 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-13 19:03:18,898 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-13 19:03:18,898 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-13 19:03:18,899 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-13 19:03:18,899 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-13 19:03:18,899 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763060499_03f554e4207c
2025-11-13 19:03:18,899 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-13 19:03:18,900 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-13 19:03:18,900 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-13 19:03:18,900 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-13 19:03:18,900 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 19:03:18,900 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 19:03:18,901 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 19:03:18,901 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 19:03:18,901 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 19:03:18,901 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 19:03:18,901 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-13 19:03:18,902 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-13 19:03:18,902 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-13 19:03:18,902 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-13 19:03:18,902 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-13 19:03:18,902 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-13 19:03:18,903 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-13 19:03:18,905 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-13 19:03:18,905 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,485 bytes
2025-11-13 19:03:18,905 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 29,480 bytes
2025-11-13 19:03:18,906 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,419 bytes
2025-11-13 19:03:18,906 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,728 bytes
2025-11-13 19:03:18,906 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 47,531 bytes
2025-11-13 19:03:18,906 - app.services.mongodb_service_enhanced - INFO -    Total document: 198,754 bytes
2025-11-13 19:03:18,906 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-13 19:03:18,907 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-13 19:03:18,907 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-13 19:03:18,908 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-13 19:03:18,908 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-13 19:03:18,909 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-13 19:03:18,909 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-13 19:03:18,909 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-13 19:03:18,909 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-13 19:03:18,910 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-13 19:03:18,910 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-13 19:03:18,910 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-13 19:03:18,910 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-13 19:03:18,910 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-13 19:03:18,910 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-13 19:03:18,911 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-13 19:03:18,911 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-13 19:03:18,911 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 19:03:18,911 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 19:03:18,912 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-13 19:03:18,915 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763060499_03f554e4207c
2025-11-13 19:03:18,915 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69162b76e07bc3665c3df806
2025-11-13 19:03:18,917 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-13 19:03:18,917 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-13 19:03:18,917 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-13 19:03:18,917 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-13 19:03:18,918 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-13 19:03:18,918 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-13 19:03:18,918 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-13 19:03:18,918 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-13 19:03:18,919 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-13 19:03:18,919 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-13 19:03:18,919 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-13 19:03:18,919 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-13 19:03:18,920 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-13 19:03:18,920 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-13 19:03:18,920 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-13 19:03:18,920 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-13 19:03:18,921 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-13 19:03:18,921 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-13 19:03:18,921 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-13 19:03:18,921 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69162b76e07bc3665c3df806
2025-11-13 19:03:18,921 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-13 19:03:18,922 - app.api.routes - INFO -    Collection: comparisons
2025-11-13 19:03:18,922 - app.api.routes - INFO -    Comparison ID: cmp_1763060499_03f554e4207c
2025-11-13 19:03:18,925 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 19:03:18,926 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-13 19:03:18,926 - app.api.routes - INFO - 
======================================================================
2025-11-13 19:03:18,926 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-13 19:03:18,926 - app.api.routes - INFO - ======================================================================
2025-11-13 19:03:18,927 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763060499_03f554e4207c
2025-11-13 19:03:18,927 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-13 19:03:18,927 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-13 19:03:18,927 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-13 19:03:18,928 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-13 19:03:18,928 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-13 19:03:18,928 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-13 19:03:18,931 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-13 19:03:18,932 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 235
2025-11-13 19:03:18,932 - app.api.routes - INFO - ======================================================================

2025-11-13 19:03:18,932 - app.services.progress_tracker - INFO - âœ… Job completed: job_7f02566d07de â†’ comparison_id: cmp_1763060499_03f554e4207c
2025-11-13 19:03:18,934 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 99.68s
2025-11-13 19:08:44,618 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-13 19:08:44,619 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-14 17:53:14,931 - main - INFO - 
2025-11-14 17:53:14,932 - main - INFO - ================================================================================
2025-11-14 17:53:14,932 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-14 17:53:14,932 - main - INFO -   Production-Ready Complete Integration
2025-11-14 17:53:14,932 - main - INFO - ================================================================================
2025-11-14 17:53:14,932 - main - INFO -   AI Model: gpt-4o-mini
2025-11-14 17:53:14,932 - main - INFO -   Upload Directory: uploads
2025-11-14 17:53:14,932 - main - INFO -   Max File Size: 20MB
2025-11-14 17:53:14,933 - main - INFO - ================================================================================
2025-11-14 17:53:14,933 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-14 17:53:14,933 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-14 17:53:14,934 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-14 17:53:15,291 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-14 17:53:15,300 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-14 17:53:15,301 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-14 17:53:15,301 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-14 17:53:15,302 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-14 17:53:15,302 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-14 17:53:15,303 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-14 17:53:15,303 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-14 17:53:15,312 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-14 17:53:15,313 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-14 17:53:15,315 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-14 17:53:15,318 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-14 17:53:15,318 - main - INFO -   âœ… User Subscription Service connected
2025-11-14 17:53:15,318 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-14 17:53:15,319 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-14 17:53:15,319 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-14 17:53:15,355 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-14 17:53:15,355 - main - INFO -   âœ… User Documents Service connected
2025-11-14 17:53:15,355 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-14 17:53:15,356 - main - INFO - 
2025-11-14 17:53:15,356 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-14 17:53:15,357 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-14 17:53:15,358 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-14 17:53:15,359 - main - INFO -        - Separates warranties from extensions
2025-11-14 17:53:15,359 - main - INFO -        - Extracts subjectivities & operational details
2025-11-14 17:53:15,360 - main - INFO -        - Correct deductible tier detection
2025-11-14 17:53:15,360 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-14 17:53:15,360 - main - INFO - 
2025-11-14 17:53:15,361 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-14 17:53:15,361 - main - INFO -        - Generates ALL sections comprehensively
2025-11-14 17:53:15,361 - main - INFO -        - Identifies unique items per provider
2025-11-14 17:53:15,361 - main - INFO -        - Transparent scoring methodology
2025-11-14 17:53:15,362 - main - INFO -        - Uses full _extended_data from parser
2025-11-14 17:53:15,362 - main - INFO - 
2025-11-14 17:53:15,362 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-14 17:53:15,362 - main - INFO -        - Single endpoint auto-populates everything
2025-11-14 17:53:15,363 - main - INFO -        - No manual section generation
2025-11-14 17:53:15,363 - main - INFO -        - Complete MongoDB integration
2025-11-14 17:53:15,363 - main - INFO - 
2025-11-14 17:53:15,363 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-14 17:53:15,364 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-14 17:53:15,364 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-14 17:53:15,364 - main - INFO -      âœ… Subjectivities: Now included
2025-11-14 17:53:15,364 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-14 17:53:15,365 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-14 17:53:15,365 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-14 17:53:15,365 - main - INFO - 
2025-11-14 17:53:15,365 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-14 17:53:15,365 - main - INFO -      Main:
2025-11-14 17:53:15,365 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-14 17:53:15,366 - main - INFO - 
2025-11-14 17:53:15,366 - main - INFO -      Retrieval:
2025-11-14 17:53:15,366 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-14 17:53:15,366 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-14 17:53:15,366 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-14 17:53:15,367 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-14 17:53:15,367 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-14 17:53:15,367 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-14 17:53:15,367 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-14 17:53:15,367 - main - INFO - 
2025-11-14 17:53:15,368 - main - INFO -      Management:
2025-11-14 17:53:15,368 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-14 17:53:15,368 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-14 17:53:15,368 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-14 17:53:15,368 - main - INFO - 
2025-11-14 17:53:15,368 - main - INFO -      Documents (MongoDB):
2025-11-14 17:53:15,369 - main - INFO -        GET  /api/documents                All documents
2025-11-14 17:53:15,369 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-14 17:53:15,369 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-14 17:53:15,369 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-14 17:53:15,369 - main - INFO - 
2025-11-14 17:53:15,369 - main - INFO -      Diagnostics & Health:
2025-11-14 17:53:15,370 - main - INFO -        GET  /api/health                   System health
2025-11-14 17:53:15,370 - main - INFO -        GET  /api/status                   Detailed status
2025-11-14 17:53:15,370 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-14 17:53:15,370 - main - INFO - 
2025-11-14 17:53:15,370 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-14 17:53:15,371 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-14 17:53:15,371 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-14 17:53:15,371 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-14 17:53:15,371 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-14 17:53:15,371 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-14 17:53:15,371 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-14 17:53:15,372 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-14 17:53:15,372 - main - INFO - 
2025-11-14 17:53:15,372 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-14 17:53:15,372 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-14 17:53:15,372 - main - INFO -      2. Receive comparison_id + complete data
2025-11-14 17:53:15,372 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-14 17:53:15,373 - main - INFO -      4. No re-upload needed!
2025-11-14 17:53:15,373 - main - INFO - 
2025-11-14 17:53:15,373 - main - INFO - ================================================================================
2025-11-14 17:53:15,373 - main - INFO -   âœ… Application started successfully!
2025-11-14 17:53:15,373 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-14 17:53:15,373 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-14 17:53:15,374 - main - INFO - ================================================================================
2025-11-14 17:53:15,374 - main - INFO - 
2025-11-14 17:53:15,374 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-14 17:53:19,976 - main - INFO - ðŸ“¥ GET /docs
2025-11-14 17:53:19,977 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-14 17:53:20,080 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-14 17:53:20,090 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-14 18:39:00,147 - main - INFO - 
2025-11-14 18:39:00,150 - main - INFO - ================================================================================
2025-11-14 18:39:00,150 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-14 18:39:00,152 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-14 18:39:00,153 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-14 18:39:00,156 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-14 18:39:00,158 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-14 18:39:00,161 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-14 18:39:00,162 - main - INFO -   âœ… User Documents Service connection closed
2025-11-14 18:39:00,164 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-14 18:39:00,168 - main - INFO -   âœ… Application stopped successfully
2025-11-14 18:39:00,169 - main - INFO - ================================================================================
2025-11-14 18:39:00,169 - main - INFO - 
2025-11-14 18:39:04,812 - main - INFO - 
2025-11-14 18:39:04,812 - main - INFO - ================================================================================
2025-11-14 18:39:04,813 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-14 18:39:04,813 - main - INFO -   Production-Ready Complete Integration
2025-11-14 18:39:04,813 - main - INFO - ================================================================================
2025-11-14 18:39:04,813 - main - INFO -   AI Model: gpt-4o-mini
2025-11-14 18:39:04,814 - main - INFO -   Upload Directory: uploads
2025-11-14 18:39:04,814 - main - INFO -   Max File Size: 20MB
2025-11-14 18:39:04,814 - main - INFO - ================================================================================
2025-11-14 18:39:04,814 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-14 18:39:04,815 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-14 18:39:04,815 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-14 18:39:04,849 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-14 18:39:04,861 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-14 18:39:04,862 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-14 18:39:04,862 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-14 18:39:04,863 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-14 18:39:04,863 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-14 18:39:04,864 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-14 18:39:04,864 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-14 18:39:04,880 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-14 18:39:04,882 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-14 18:39:04,883 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-14 18:39:04,886 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-14 18:39:04,887 - main - INFO -   âœ… User Subscription Service connected
2025-11-14 18:39:04,888 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-14 18:39:04,890 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-14 18:39:04,891 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-14 18:39:04,902 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-14 18:39:04,903 - main - INFO -   âœ… User Documents Service connected
2025-11-14 18:39:04,903 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-14 18:39:04,903 - main - INFO - 
2025-11-14 18:39:04,904 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-14 18:39:04,907 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-14 18:39:04,908 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-14 18:39:04,909 - main - INFO -        - Separates warranties from extensions
2025-11-14 18:39:04,909 - main - INFO -        - Extracts subjectivities & operational details
2025-11-14 18:39:04,911 - main - INFO -        - Correct deductible tier detection
2025-11-14 18:39:04,911 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-14 18:39:04,911 - main - INFO - 
2025-11-14 18:39:04,912 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-14 18:39:04,912 - main - INFO -        - Generates ALL sections comprehensively
2025-11-14 18:39:04,913 - main - INFO -        - Identifies unique items per provider
2025-11-14 18:39:04,913 - main - INFO -        - Transparent scoring methodology
2025-11-14 18:39:04,914 - main - INFO -        - Uses full _extended_data from parser
2025-11-14 18:39:04,914 - main - INFO - 
2025-11-14 18:39:04,914 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-14 18:39:04,915 - main - INFO -        - Single endpoint auto-populates everything
2025-11-14 18:39:04,915 - main - INFO -        - No manual section generation
2025-11-14 18:39:04,915 - main - INFO -        - Complete MongoDB integration
2025-11-14 18:39:04,916 - main - INFO - 
2025-11-14 18:39:04,916 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-14 18:39:04,916 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-14 18:39:04,917 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-14 18:39:04,917 - main - INFO -      âœ… Subjectivities: Now included
2025-11-14 18:39:04,917 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-14 18:39:04,918 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-14 18:39:04,918 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-14 18:39:04,918 - main - INFO - 
2025-11-14 18:39:04,919 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-14 18:39:04,919 - main - INFO -      Main:
2025-11-14 18:39:04,920 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-14 18:39:04,920 - main - INFO - 
2025-11-14 18:39:04,922 - main - INFO -      Retrieval:
2025-11-14 18:39:04,924 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-14 18:39:04,924 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-14 18:39:04,925 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-14 18:39:04,926 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-14 18:39:04,927 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-14 18:39:04,927 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-14 18:39:04,928 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-14 18:39:04,928 - main - INFO - 
2025-11-14 18:39:04,928 - main - INFO -      Management:
2025-11-14 18:39:04,929 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-14 18:39:04,929 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-14 18:39:04,929 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-14 18:39:04,930 - main - INFO - 
2025-11-14 18:39:04,930 - main - INFO -      Documents (MongoDB):
2025-11-14 18:39:04,930 - main - INFO -        GET  /api/documents                All documents
2025-11-14 18:39:04,931 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-14 18:39:04,931 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-14 18:39:04,931 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-14 18:39:04,932 - main - INFO - 
2025-11-14 18:39:04,932 - main - INFO -      Diagnostics & Health:
2025-11-14 18:39:04,932 - main - INFO -        GET  /api/health                   System health
2025-11-14 18:39:04,932 - main - INFO -        GET  /api/status                   Detailed status
2025-11-14 18:39:04,933 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-14 18:39:04,933 - main - INFO - 
2025-11-14 18:39:04,933 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-14 18:39:04,933 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-14 18:39:04,934 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-14 18:39:04,934 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-14 18:39:04,934 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-14 18:39:04,935 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-14 18:39:04,935 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-14 18:39:04,935 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-14 18:39:04,935 - main - INFO - 
2025-11-14 18:39:04,936 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-14 18:39:04,936 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-14 18:39:04,939 - main - INFO -      2. Receive comparison_id + complete data
2025-11-14 18:39:04,940 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-14 18:39:04,941 - main - INFO -      4. No re-upload needed!
2025-11-14 18:39:04,942 - main - INFO - 
2025-11-14 18:39:04,943 - main - INFO - ================================================================================
2025-11-14 18:39:04,944 - main - INFO -   âœ… Application started successfully!
2025-11-14 18:39:04,944 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-14 18:39:04,944 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-14 18:39:04,945 - main - INFO - ================================================================================
2025-11-14 18:39:04,945 - main - INFO - 
2025-11-14 18:39:04,945 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-14 18:48:44,619 - main - INFO - ðŸ“¥ GET /health
2025-11-14 18:48:44,623 - main - INFO - ðŸ“¤ GET /health - 200 - 0.00s
2025-11-14 18:48:56,021 - main - INFO - ðŸ“¥ GET /api
2025-11-14 18:48:56,022 - main - INFO - ðŸ“¤ GET /api - 200 - 0.00s
2025-11-17 15:10:58,515 - main - INFO - 
2025-11-17 15:10:58,516 - main - INFO - ================================================================================
2025-11-17 15:10:58,516 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-17 15:10:58,516 - main - INFO -   Production-Ready Complete Integration
2025-11-17 15:10:58,516 - main - INFO - ================================================================================
2025-11-17 15:10:58,516 - main - INFO -   AI Model: gpt-4o-mini
2025-11-17 15:10:58,516 - main - INFO -   Upload Directory: uploads
2025-11-17 15:10:58,517 - main - INFO -   Max File Size: 20MB
2025-11-17 15:10:58,517 - main - INFO - ================================================================================
2025-11-17 15:10:58,517 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-17 15:10:58,518 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-17 15:10:58,518 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-17 15:10:58,920 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-17 15:10:58,928 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-17 15:10:58,929 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-17 15:10:58,929 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-17 15:10:58,930 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-17 15:10:58,930 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-17 15:10:58,931 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:10:58,931 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:10:58,941 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-17 15:10:58,942 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-17 15:10:58,944 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-17 15:10:58,946 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 5 documents
2025-11-17 15:10:58,947 - main - INFO -   âœ… User Subscription Service connected
2025-11-17 15:10:58,947 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-17 15:10:58,947 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:10:58,948 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:10:58,957 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-17 15:10:58,958 - main - INFO -   âœ… User Documents Service connected
2025-11-17 15:10:58,958 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-17 15:10:58,958 - main - INFO - 
2025-11-17 15:10:58,959 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-17 15:10:58,959 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-17 15:10:58,959 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-17 15:10:58,959 - main - INFO -        - Separates warranties from extensions
2025-11-17 15:10:58,960 - main - INFO -        - Extracts subjectivities & operational details
2025-11-17 15:10:58,960 - main - INFO -        - Correct deductible tier detection
2025-11-17 15:10:58,960 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-17 15:10:58,960 - main - INFO - 
2025-11-17 15:10:58,961 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-17 15:10:58,961 - main - INFO -        - Generates ALL sections comprehensively
2025-11-17 15:10:58,961 - main - INFO -        - Identifies unique items per provider
2025-11-17 15:10:58,961 - main - INFO -        - Transparent scoring methodology
2025-11-17 15:10:58,962 - main - INFO -        - Uses full _extended_data from parser
2025-11-17 15:10:58,962 - main - INFO - 
2025-11-17 15:10:58,962 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-17 15:10:58,962 - main - INFO -        - Single endpoint auto-populates everything
2025-11-17 15:10:58,962 - main - INFO -        - No manual section generation
2025-11-17 15:10:58,963 - main - INFO -        - Complete MongoDB integration
2025-11-17 15:10:58,963 - main - INFO - 
2025-11-17 15:10:58,963 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-17 15:10:58,963 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-17 15:10:58,964 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-17 15:10:58,964 - main - INFO -      âœ… Subjectivities: Now included
2025-11-17 15:10:58,964 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-17 15:10:58,964 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-17 15:10:58,964 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-17 15:10:58,965 - main - INFO - 
2025-11-17 15:10:58,965 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-17 15:10:58,965 - main - INFO -      Main:
2025-11-17 15:10:58,965 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-17 15:10:58,965 - main - INFO - 
2025-11-17 15:10:58,966 - main - INFO -      Retrieval:
2025-11-17 15:10:58,966 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-17 15:10:58,966 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-17 15:10:58,966 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-17 15:10:58,966 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-17 15:10:58,967 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-17 15:10:58,967 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-17 15:10:58,967 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-17 15:10:58,967 - main - INFO - 
2025-11-17 15:10:58,968 - main - INFO -      Management:
2025-11-17 15:10:58,968 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-17 15:10:58,968 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-17 15:10:58,968 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-17 15:10:58,969 - main - INFO - 
2025-11-17 15:10:58,969 - main - INFO -      Documents (MongoDB):
2025-11-17 15:10:58,970 - main - INFO -        GET  /api/documents                All documents
2025-11-17 15:10:58,970 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-17 15:10:58,970 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-17 15:10:58,971 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-17 15:10:58,972 - main - INFO - 
2025-11-17 15:10:58,972 - main - INFO -      Diagnostics & Health:
2025-11-17 15:10:58,973 - main - INFO -        GET  /api/health                   System health
2025-11-17 15:10:58,973 - main - INFO -        GET  /api/status                   Detailed status
2025-11-17 15:10:58,974 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-17 15:10:58,974 - main - INFO - 
2025-11-17 15:10:58,975 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-17 15:10:58,975 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-17 15:10:58,976 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-17 15:10:58,976 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-17 15:10:58,976 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-17 15:10:58,976 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-17 15:10:58,977 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-17 15:10:58,977 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-17 15:10:58,977 - main - INFO - 
2025-11-17 15:10:58,977 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-17 15:10:58,981 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-17 15:10:58,985 - main - INFO -      2. Receive comparison_id + complete data
2025-11-17 15:10:58,987 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-17 15:10:58,989 - main - INFO -      4. No re-upload needed!
2025-11-17 15:10:58,992 - main - INFO - 
2025-11-17 15:10:58,995 - main - INFO - ================================================================================
2025-11-17 15:10:58,996 - main - INFO -   âœ… Application started successfully!
2025-11-17 15:10:58,997 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-17 15:10:58,999 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-17 15:10:58,999 - main - INFO - ================================================================================
2025-11-17 15:10:59,000 - main - INFO - 
2025-11-17 15:10:59,002 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-17 15:11:02,994 - main - INFO - ðŸ“¥ GET /docs
2025-11-17 15:11:02,994 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-17 15:11:03,206 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-17 15:11:03,219 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-17 15:11:12,500 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf
2025-11-17 15:11:12,501 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:11:12,506 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:11:12,507 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-17 15:11:12,507 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-17 15:11:12,509 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-17 15:11:12,509 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-17 15:11:12,511 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-17 15:11:12,511 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-17 15:11:12,513 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-17 15:11:12,513 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-17 15:11:12,514 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-17 15:11:12,515 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-17 15:11:12,516 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-17 15:11:12,516 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-17 15:11:12,523 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-17 15:11:12,775 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:11:12,776 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1762456905_1ad7dd03cae3_20251117_151112.pdf (131973 bytes)
2025-11-17 15:11:12,777 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf - 200 - 0.28s
2025-11-17 15:11:44,088 - main - INFO - 
2025-11-17 15:11:44,091 - main - INFO - ================================================================================
2025-11-17 15:11:44,093 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-17 15:11:44,096 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-17 15:11:44,096 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-17 15:11:44,098 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-17 15:11:44,099 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-17 15:11:44,100 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-17 15:11:44,113 - main - INFO -   âœ… User Documents Service connection closed
2025-11-17 15:11:44,115 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-17 15:11:44,131 - main - INFO -   âœ… Application stopped successfully
2025-11-17 15:11:44,142 - main - INFO - ================================================================================
2025-11-17 15:11:44,144 - main - INFO - 
2025-11-17 15:11:49,328 - main - INFO - 
2025-11-17 15:11:49,328 - main - INFO - ================================================================================
2025-11-17 15:11:49,328 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-17 15:11:49,329 - main - INFO -   Production-Ready Complete Integration
2025-11-17 15:11:49,329 - main - INFO - ================================================================================
2025-11-17 15:11:49,329 - main - INFO -   AI Model: gpt-4o-mini
2025-11-17 15:11:49,329 - main - INFO -   Upload Directory: uploads
2025-11-17 15:11:49,330 - main - INFO -   Max File Size: 20MB
2025-11-17 15:11:49,330 - main - INFO - ================================================================================
2025-11-17 15:11:49,330 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-17 15:11:49,331 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-17 15:11:49,331 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-17 15:11:49,349 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-17 15:11:49,356 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-17 15:11:49,357 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-17 15:11:49,357 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-17 15:11:49,357 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-17 15:11:49,358 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-17 15:11:49,358 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:11:49,358 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:11:49,381 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-17 15:11:49,382 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-17 15:11:49,383 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-17 15:11:49,386 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 5 documents
2025-11-17 15:11:49,386 - main - INFO -   âœ… User Subscription Service connected
2025-11-17 15:11:49,386 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-17 15:11:49,387 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:11:49,388 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:11:49,399 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-17 15:11:49,399 - main - INFO -   âœ… User Documents Service connected
2025-11-17 15:11:49,399 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-17 15:11:49,399 - main - INFO - 
2025-11-17 15:11:49,400 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-17 15:11:49,400 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-17 15:11:49,400 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-17 15:11:49,400 - main - INFO -        - Separates warranties from extensions
2025-11-17 15:11:49,401 - main - INFO -        - Extracts subjectivities & operational details
2025-11-17 15:11:49,402 - main - INFO -        - Correct deductible tier detection
2025-11-17 15:11:49,402 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-17 15:11:49,402 - main - INFO - 
2025-11-17 15:11:49,403 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-17 15:11:49,403 - main - INFO -        - Generates ALL sections comprehensively
2025-11-17 15:11:49,403 - main - INFO -        - Identifies unique items per provider
2025-11-17 15:11:49,403 - main - INFO -        - Transparent scoring methodology
2025-11-17 15:11:49,403 - main - INFO -        - Uses full _extended_data from parser
2025-11-17 15:11:49,404 - main - INFO - 
2025-11-17 15:11:49,404 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-17 15:11:49,405 - main - INFO -        - Single endpoint auto-populates everything
2025-11-17 15:11:49,406 - main - INFO -        - No manual section generation
2025-11-17 15:11:49,407 - main - INFO -        - Complete MongoDB integration
2025-11-17 15:11:49,409 - main - INFO - 
2025-11-17 15:11:49,410 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-17 15:11:49,411 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-17 15:11:49,411 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-17 15:11:49,411 - main - INFO -      âœ… Subjectivities: Now included
2025-11-17 15:11:49,411 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-17 15:11:49,412 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-17 15:11:49,412 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-17 15:11:49,412 - main - INFO - 
2025-11-17 15:11:49,412 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-17 15:11:49,413 - main - INFO -      Main:
2025-11-17 15:11:49,413 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-17 15:11:49,413 - main - INFO - 
2025-11-17 15:11:49,413 - main - INFO -      Retrieval:
2025-11-17 15:11:49,413 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-17 15:11:49,414 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-17 15:11:49,414 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-17 15:11:49,414 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-17 15:11:49,414 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-17 15:11:49,414 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-17 15:11:49,415 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-17 15:11:49,415 - main - INFO - 
2025-11-17 15:11:49,415 - main - INFO -      Management:
2025-11-17 15:11:49,415 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-17 15:11:49,415 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-17 15:11:49,416 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-17 15:11:49,416 - main - INFO - 
2025-11-17 15:11:49,416 - main - INFO -      Documents (MongoDB):
2025-11-17 15:11:49,416 - main - INFO -        GET  /api/documents                All documents
2025-11-17 15:11:49,416 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-17 15:11:49,417 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-17 15:11:49,417 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-17 15:11:49,418 - main - INFO - 
2025-11-17 15:11:49,418 - main - INFO -      Diagnostics & Health:
2025-11-17 15:11:49,418 - main - INFO -        GET  /api/health                   System health
2025-11-17 15:11:49,418 - main - INFO -        GET  /api/status                   Detailed status
2025-11-17 15:11:49,419 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-17 15:11:49,419 - main - INFO - 
2025-11-17 15:11:49,419 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-17 15:11:49,420 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-17 15:11:49,420 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-17 15:11:49,420 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-17 15:11:49,421 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-17 15:11:49,423 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-17 15:11:49,426 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-17 15:11:49,427 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-17 15:11:49,428 - main - INFO - 
2025-11-17 15:11:49,429 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-17 15:11:49,429 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-17 15:11:49,430 - main - INFO -      2. Receive comparison_id + complete data
2025-11-17 15:11:49,431 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-17 15:11:49,431 - main - INFO -      4. No re-upload needed!
2025-11-17 15:11:49,431 - main - INFO - 
2025-11-17 15:11:49,432 - main - INFO - ================================================================================
2025-11-17 15:11:49,432 - main - INFO -   âœ… Application started successfully!
2025-11-17 15:11:49,432 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-17 15:11:49,433 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-17 15:11:49,433 - main - INFO - ================================================================================
2025-11-17 15:11:49,434 - main - INFO - 
2025-11-17 15:11:49,434 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-17 15:11:49,503 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf
2025-11-17 15:11:49,504 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:11:49,506 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:11:49,506 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-17 15:11:49,507 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-17 15:11:49,507 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-17 15:11:49,507 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-17 15:11:49,508 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-17 15:11:49,508 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-17 15:11:49,509 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-17 15:11:49,509 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-17 15:11:49,510 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-17 15:11:49,510 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-17 15:11:49,511 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-17 15:11:49,511 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-17 15:11:49,512 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-17 15:11:49,637 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:11:49,637 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1762456905_1ad7dd03cae3_20251117_151149.pdf (131976 bytes)
2025-11-17 15:11:49,638 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf - 200 - 0.14s
2025-11-17 15:12:40,644 - main - INFO - 
2025-11-17 15:12:40,644 - main - INFO - ================================================================================
2025-11-17 15:12:40,644 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-17 15:12:40,645 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-17 15:12:40,646 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-17 15:12:40,646 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-17 15:12:40,647 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-17 15:12:40,647 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-17 15:12:40,648 - main - INFO -   âœ… User Documents Service connection closed
2025-11-17 15:12:40,648 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-17 15:12:40,648 - main - INFO -   âœ… Application stopped successfully
2025-11-17 15:12:40,648 - main - INFO - ================================================================================
2025-11-17 15:12:40,649 - main - INFO - 
2025-11-17 15:12:43,666 - main - INFO - 
2025-11-17 15:12:43,667 - main - INFO - ================================================================================
2025-11-17 15:12:43,667 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-17 15:12:43,667 - main - INFO -   Production-Ready Complete Integration
2025-11-17 15:12:43,668 - main - INFO - ================================================================================
2025-11-17 15:12:43,668 - main - INFO -   AI Model: gpt-4o-mini
2025-11-17 15:12:43,668 - main - INFO -   Upload Directory: uploads
2025-11-17 15:12:43,669 - main - INFO -   Max File Size: 20MB
2025-11-17 15:12:43,669 - main - INFO - ================================================================================
2025-11-17 15:12:43,669 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-17 15:12:43,670 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-17 15:12:43,670 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-17 15:12:43,706 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-17 15:12:43,716 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-17 15:12:43,716 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-17 15:12:43,716 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-17 15:12:43,717 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-17 15:12:43,717 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-17 15:12:43,717 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:12:43,718 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:12:43,728 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-17 15:12:43,730 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-17 15:12:43,731 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-17 15:12:43,732 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 5 documents
2025-11-17 15:12:43,732 - main - INFO -   âœ… User Subscription Service connected
2025-11-17 15:12:43,733 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-17 15:12:43,733 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:12:43,733 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:12:43,753 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-17 15:12:43,753 - main - INFO -   âœ… User Documents Service connected
2025-11-17 15:12:43,754 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-17 15:12:43,754 - main - INFO - 
2025-11-17 15:12:43,755 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-17 15:12:43,755 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-17 15:12:43,756 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-17 15:12:43,756 - main - INFO -        - Separates warranties from extensions
2025-11-17 15:12:43,756 - main - INFO -        - Extracts subjectivities & operational details
2025-11-17 15:12:43,757 - main - INFO -        - Correct deductible tier detection
2025-11-17 15:12:43,757 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-17 15:12:43,758 - main - INFO - 
2025-11-17 15:12:43,758 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-17 15:12:43,758 - main - INFO -        - Generates ALL sections comprehensively
2025-11-17 15:12:43,759 - main - INFO -        - Identifies unique items per provider
2025-11-17 15:12:43,759 - main - INFO -        - Transparent scoring methodology
2025-11-17 15:12:43,760 - main - INFO -        - Uses full _extended_data from parser
2025-11-17 15:12:43,760 - main - INFO - 
2025-11-17 15:12:43,761 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-17 15:12:43,762 - main - INFO -        - Single endpoint auto-populates everything
2025-11-17 15:12:43,763 - main - INFO -        - No manual section generation
2025-11-17 15:12:43,763 - main - INFO -        - Complete MongoDB integration
2025-11-17 15:12:43,764 - main - INFO - 
2025-11-17 15:12:43,764 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-17 15:12:43,764 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-17 15:12:43,765 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-17 15:12:43,765 - main - INFO -      âœ… Subjectivities: Now included
2025-11-17 15:12:43,765 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-17 15:12:43,766 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-17 15:12:43,766 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-17 15:12:43,766 - main - INFO - 
2025-11-17 15:12:43,767 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-17 15:12:43,767 - main - INFO -      Main:
2025-11-17 15:12:43,767 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-17 15:12:43,767 - main - INFO - 
2025-11-17 15:12:43,768 - main - INFO -      Retrieval:
2025-11-17 15:12:43,768 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-17 15:12:43,769 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-17 15:12:43,769 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-17 15:12:43,769 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-17 15:12:43,769 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-17 15:12:43,770 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-17 15:12:43,770 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-17 15:12:43,770 - main - INFO - 
2025-11-17 15:12:43,770 - main - INFO -      Management:
2025-11-17 15:12:43,771 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-17 15:12:43,771 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-17 15:12:43,771 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-17 15:12:43,772 - main - INFO - 
2025-11-17 15:12:43,772 - main - INFO -      Documents (MongoDB):
2025-11-17 15:12:43,772 - main - INFO -        GET  /api/documents                All documents
2025-11-17 15:12:43,772 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-17 15:12:43,773 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-17 15:12:43,773 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-17 15:12:43,773 - main - INFO - 
2025-11-17 15:12:43,773 - main - INFO -      Diagnostics & Health:
2025-11-17 15:12:43,774 - main - INFO -        GET  /api/health                   System health
2025-11-17 15:12:43,774 - main - INFO -        GET  /api/status                   Detailed status
2025-11-17 15:12:43,774 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-17 15:12:43,774 - main - INFO - 
2025-11-17 15:12:43,775 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-17 15:12:43,775 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-17 15:12:43,776 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-17 15:12:43,776 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-17 15:12:43,777 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-17 15:12:43,777 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-17 15:12:43,778 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-17 15:12:43,778 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-17 15:12:43,778 - main - INFO - 
2025-11-17 15:12:43,779 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-17 15:12:43,779 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-17 15:12:43,779 - main - INFO -      2. Receive comparison_id + complete data
2025-11-17 15:12:43,779 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-17 15:12:43,779 - main - INFO -      4. No re-upload needed!
2025-11-17 15:12:43,780 - main - INFO - 
2025-11-17 15:12:43,780 - main - INFO - ================================================================================
2025-11-17 15:12:43,780 - main - INFO -   âœ… Application started successfully!
2025-11-17 15:12:43,780 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-17 15:12:43,780 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-17 15:12:43,780 - main - INFO - ================================================================================
2025-11-17 15:12:43,781 - main - INFO - 
2025-11-17 15:12:43,781 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-17 15:12:44,865 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf
2025-11-17 15:12:44,866 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:12:44,867 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:12:44,868 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-17 15:12:44,868 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-17 15:12:44,869 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-17 15:12:44,869 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-17 15:12:44,870 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-17 15:12:44,870 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-17 15:12:44,871 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-17 15:12:44,871 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-17 15:12:44,872 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-17 15:12:44,873 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-17 15:12:44,873 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-17 15:12:44,874 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-17 15:12:44,874 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-17 15:12:45,050 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:12:45,051 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1762456905_1ad7dd03cae3_20251117_151245.pdf (131976 bytes)
2025-11-17 15:12:45,051 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf - 200 - 0.19s
2025-11-17 15:13:35,410 - main - INFO - 
2025-11-17 15:13:35,411 - main - INFO - ================================================================================
2025-11-17 15:13:35,412 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-17 15:13:35,414 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-17 15:13:35,414 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-17 15:13:35,416 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-17 15:13:35,416 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-17 15:13:35,419 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-17 15:13:35,422 - main - INFO -   âœ… User Documents Service connection closed
2025-11-17 15:13:35,425 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-17 15:13:35,427 - main - INFO -   âœ… Application stopped successfully
2025-11-17 15:13:35,432 - main - INFO - ================================================================================
2025-11-17 15:13:35,433 - main - INFO - 
2025-11-17 15:13:38,542 - main - INFO - 
2025-11-17 15:13:38,543 - main - INFO - ================================================================================
2025-11-17 15:13:38,543 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-17 15:13:38,543 - main - INFO -   Production-Ready Complete Integration
2025-11-17 15:13:38,544 - main - INFO - ================================================================================
2025-11-17 15:13:38,544 - main - INFO -   AI Model: gpt-4o-mini
2025-11-17 15:13:38,544 - main - INFO -   Upload Directory: uploads
2025-11-17 15:13:38,544 - main - INFO -   Max File Size: 20MB
2025-11-17 15:13:38,544 - main - INFO - ================================================================================
2025-11-17 15:13:38,545 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-17 15:13:38,545 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-17 15:13:38,545 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-17 15:13:38,562 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-17 15:13:38,574 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-17 15:13:38,574 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-17 15:13:38,574 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-17 15:13:38,575 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-17 15:13:38,575 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-17 15:13:38,575 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:13:38,575 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:13:38,587 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-17 15:13:38,588 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-17 15:13:38,590 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-17 15:13:38,594 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 5 documents
2025-11-17 15:13:38,595 - main - INFO -   âœ… User Subscription Service connected
2025-11-17 15:13:38,595 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-17 15:13:38,595 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-17 15:13:38,595 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-17 15:13:38,623 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-17 15:13:38,623 - main - INFO -   âœ… User Documents Service connected
2025-11-17 15:13:38,623 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-17 15:13:38,624 - main - INFO - 
2025-11-17 15:13:38,624 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-17 15:13:38,624 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-17 15:13:38,624 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-17 15:13:38,624 - main - INFO -        - Separates warranties from extensions
2025-11-17 15:13:38,625 - main - INFO -        - Extracts subjectivities & operational details
2025-11-17 15:13:38,625 - main - INFO -        - Correct deductible tier detection
2025-11-17 15:13:38,625 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-17 15:13:38,625 - main - INFO - 
2025-11-17 15:13:38,625 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-17 15:13:38,625 - main - INFO -        - Generates ALL sections comprehensively
2025-11-17 15:13:38,626 - main - INFO -        - Identifies unique items per provider
2025-11-17 15:13:38,626 - main - INFO -        - Transparent scoring methodology
2025-11-17 15:13:38,626 - main - INFO -        - Uses full _extended_data from parser
2025-11-17 15:13:38,626 - main - INFO - 
2025-11-17 15:13:38,626 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-17 15:13:38,626 - main - INFO -        - Single endpoint auto-populates everything
2025-11-17 15:13:38,627 - main - INFO -        - No manual section generation
2025-11-17 15:13:38,627 - main - INFO -        - Complete MongoDB integration
2025-11-17 15:13:38,627 - main - INFO - 
2025-11-17 15:13:38,627 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-17 15:13:38,627 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-17 15:13:38,627 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-17 15:13:38,627 - main - INFO -      âœ… Subjectivities: Now included
2025-11-17 15:13:38,628 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-17 15:13:38,628 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-17 15:13:38,628 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-17 15:13:38,628 - main - INFO - 
2025-11-17 15:13:38,628 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-17 15:13:38,629 - main - INFO -      Main:
2025-11-17 15:13:38,629 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-17 15:13:38,629 - main - INFO - 
2025-11-17 15:13:38,629 - main - INFO -      Retrieval:
2025-11-17 15:13:38,629 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-17 15:13:38,629 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-17 15:13:38,629 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-17 15:13:38,630 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-17 15:13:38,630 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-17 15:13:38,630 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-17 15:13:38,630 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-17 15:13:38,630 - main - INFO - 
2025-11-17 15:13:38,631 - main - INFO -      Management:
2025-11-17 15:13:38,631 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-17 15:13:38,631 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-17 15:13:38,631 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-17 15:13:38,631 - main - INFO - 
2025-11-17 15:13:38,632 - main - INFO -      Documents (MongoDB):
2025-11-17 15:13:38,632 - main - INFO -        GET  /api/documents                All documents
2025-11-17 15:13:38,632 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-17 15:13:38,632 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-17 15:13:38,633 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-17 15:13:38,633 - main - INFO - 
2025-11-17 15:13:38,634 - main - INFO -      Diagnostics & Health:
2025-11-17 15:13:38,636 - main - INFO -        GET  /api/health                   System health
2025-11-17 15:13:38,637 - main - INFO -        GET  /api/status                   Detailed status
2025-11-17 15:13:38,638 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-17 15:13:38,639 - main - INFO - 
2025-11-17 15:13:38,639 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-17 15:13:38,640 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-17 15:13:38,640 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-17 15:13:38,641 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-17 15:13:38,641 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-17 15:13:38,641 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-17 15:13:38,642 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-17 15:13:38,642 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-17 15:13:38,642 - main - INFO - 
2025-11-17 15:13:38,642 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-17 15:13:38,643 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-17 15:13:38,643 - main - INFO -      2. Receive comparison_id + complete data
2025-11-17 15:13:38,644 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-17 15:13:38,645 - main - INFO -      4. No re-upload needed!
2025-11-17 15:13:38,645 - main - INFO - 
2025-11-17 15:13:38,646 - main - INFO - ================================================================================
2025-11-17 15:13:38,647 - main - INFO -   âœ… Application started successfully!
2025-11-17 15:13:38,647 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-17 15:13:38,648 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-17 15:13:38,648 - main - INFO - ================================================================================
2025-11-17 15:13:38,648 - main - INFO - 
2025-11-17 15:13:38,649 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-17 15:13:42,204 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf
2025-11-17 15:13:42,206 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:13:42,209 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:13:42,209 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-17 15:13:42,210 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-17 15:13:42,211 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-17 15:13:42,211 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-17 15:13:42,212 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-17 15:13:42,213 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-17 15:13:42,214 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-17 15:13:42,214 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-17 15:13:42,215 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-17 15:13:42,215 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-17 15:13:42,216 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-17 15:13:42,216 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-17 15:13:42,218 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-17 15:13:42,345 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1762456905_1ad7dd03cae3
2025-11-17 15:13:42,346 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1762456905_1ad7dd03cae3_20251117_151342.pdf (131977 bytes)
2025-11-17 15:13:42,346 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1762456905_1ad7dd03cae3/pdf - 200 - 0.14s
2025-11-18 20:26:19,834 - main - INFO - 
2025-11-18 20:26:19,834 - main - INFO - ================================================================================
2025-11-18 20:26:19,834 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-18 20:26:19,834 - main - INFO -   Production-Ready Complete Integration
2025-11-18 20:26:19,834 - main - INFO - ================================================================================
2025-11-18 20:26:19,834 - main - INFO -   AI Model: gpt-4o-mini
2025-11-18 20:26:19,835 - main - INFO -   Upload Directory: uploads
2025-11-18 20:26:19,835 - main - INFO -   Max File Size: 20MB
2025-11-18 20:26:19,835 - main - INFO - ================================================================================
2025-11-18 20:26:19,836 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-18 20:26:19,838 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-18 20:26:19,841 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-18 20:26:20,335 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-18 20:26:20,349 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-18 20:26:20,349 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-18 20:26:20,350 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-18 20:26:20,350 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-18 20:26:20,350 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-18 20:26:20,351 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-18 20:26:20,351 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-18 20:26:20,361 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-18 20:26:20,365 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-18 20:26:20,370 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-18 20:26:20,500 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-18 20:26:20,501 - main - INFO -   âœ… User Subscription Service connected
2025-11-18 20:26:20,502 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-18 20:26:20,502 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-18 20:26:20,503 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-18 20:26:20,535 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-18 20:26:20,536 - main - INFO -   âœ… User Documents Service connected
2025-11-18 20:26:20,537 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-18 20:26:20,537 - main - INFO - 
2025-11-18 20:26:20,538 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-18 20:26:20,539 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-18 20:26:20,539 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-18 20:26:20,540 - main - INFO -        - Separates warranties from extensions
2025-11-18 20:26:20,540 - main - INFO -        - Extracts subjectivities & operational details
2025-11-18 20:26:20,540 - main - INFO -        - Correct deductible tier detection
2025-11-18 20:26:20,542 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-18 20:26:20,542 - main - INFO - 
2025-11-18 20:26:20,542 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-18 20:26:20,543 - main - INFO -        - Generates ALL sections comprehensively
2025-11-18 20:26:20,543 - main - INFO -        - Identifies unique items per provider
2025-11-18 20:26:20,543 - main - INFO -        - Transparent scoring methodology
2025-11-18 20:26:20,544 - main - INFO -        - Uses full _extended_data from parser
2025-11-18 20:26:20,544 - main - INFO - 
2025-11-18 20:26:20,544 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-18 20:26:20,545 - main - INFO -        - Single endpoint auto-populates everything
2025-11-18 20:26:20,545 - main - INFO -        - No manual section generation
2025-11-18 20:26:20,545 - main - INFO -        - Complete MongoDB integration
2025-11-18 20:26:20,546 - main - INFO - 
2025-11-18 20:26:20,546 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-18 20:26:20,546 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-18 20:26:20,546 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-18 20:26:20,547 - main - INFO -      âœ… Subjectivities: Now included
2025-11-18 20:26:20,547 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-18 20:26:20,547 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-18 20:26:20,548 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-18 20:26:20,548 - main - INFO - 
2025-11-18 20:26:20,548 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-18 20:26:20,549 - main - INFO -      Main:
2025-11-18 20:26:20,549 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-18 20:26:20,549 - main - INFO - 
2025-11-18 20:26:20,549 - main - INFO -      Retrieval:
2025-11-18 20:26:20,549 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-18 20:26:20,550 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-18 20:26:20,551 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-18 20:26:20,552 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-18 20:26:20,553 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-18 20:26:20,553 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-18 20:26:20,554 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-18 20:26:20,554 - main - INFO - 
2025-11-18 20:26:20,555 - main - INFO -      Management:
2025-11-18 20:26:20,555 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-18 20:26:20,555 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-18 20:26:20,556 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-18 20:26:20,556 - main - INFO - 
2025-11-18 20:26:20,556 - main - INFO -      Documents (MongoDB):
2025-11-18 20:26:20,557 - main - INFO -        GET  /api/documents                All documents
2025-11-18 20:26:20,557 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-18 20:26:20,558 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-18 20:26:20,558 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-18 20:26:20,558 - main - INFO - 
2025-11-18 20:26:20,558 - main - INFO -      Diagnostics & Health:
2025-11-18 20:26:20,558 - main - INFO -        GET  /api/health                   System health
2025-11-18 20:26:20,559 - main - INFO -        GET  /api/status                   Detailed status
2025-11-18 20:26:20,559 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-18 20:26:20,559 - main - INFO - 
2025-11-18 20:26:20,559 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-18 20:26:20,560 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-18 20:26:20,560 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-18 20:26:20,560 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-18 20:26:20,561 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-18 20:26:20,561 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-18 20:26:20,561 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-18 20:26:20,561 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-18 20:26:20,562 - main - INFO - 
2025-11-18 20:26:20,562 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-18 20:26:20,562 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-18 20:26:20,562 - main - INFO -      2. Receive comparison_id + complete data
2025-11-18 20:26:20,562 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-18 20:26:20,563 - main - INFO -      4. No re-upload needed!
2025-11-18 20:26:20,563 - main - INFO - 
2025-11-18 20:26:20,563 - main - INFO - ================================================================================
2025-11-18 20:26:20,563 - main - INFO -   âœ… Application started successfully!
2025-11-18 20:26:20,564 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-18 20:26:20,564 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-18 20:26:20,564 - main - INFO - ================================================================================
2025-11-18 20:26:20,564 - main - INFO - 
2025-11-18 20:26:20,565 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-18 20:28:28,852 - main - INFO - ðŸ“¥ GET /docs
2025-11-18 20:28:28,852 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-18 20:28:29,076 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-18 20:28:29,088 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-18 20:29:02,895 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-18 20:29:02,906 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-18 20:29:02,907 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-18 20:29:02,908 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-18 20:29:02,908 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-18 20:29:02,917 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-18 20:29:02,919 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-18 20:29:02,919 - app.api.routes - INFO -    - Remaining comparisons: 235
2025-11-18 20:29:02,919 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-18 20:29:02,919 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-18 20:29:02,920 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763497742_166960ac4d2c
2025-11-18 20:29:02,920 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_8551869dd246 (3 files)
2025-11-18 20:29:02,920 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_8551869dd246
2025-11-18 20:29:02,921 - app.api.routes - INFO - 
======================================================================
2025-11-18 20:29:02,921 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-18 20:29:02,922 - app.api.routes - INFO - ======================================================================
2025-11-18 20:29:02,924 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ de6746a85dbb4f1ea0c78a794aca7555.pdf (464206 bytes)
2025-11-18 20:29:02,925 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-18 20:29:02,926 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\de6746a85dbb4f1ea0c78a794aca7555.pdf
2025-11-18 20:29:02,926 - app.api.routes - INFO - 
======================================================================
2025-11-18 20:29:02,929 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-18 20:29:02,967 - app.api.routes - INFO - ======================================================================
2025-11-18 20:29:03,031 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ f5faff6157bb4c67be37a6b8b33b562c.pdf (175401 bytes)
2025-11-18 20:29:03,032 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-18 20:29:03,033 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\f5faff6157bb4c67be37a6b8b33b562c.pdf
2025-11-18 20:29:03,033 - app.api.routes - INFO - 
======================================================================
2025-11-18 20:29:03,055 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-18 20:29:03,101 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-18 20:29:03,105 - app.api.routes - INFO - ======================================================================
2025-11-18 20:29:03,115 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-18 20:29:03,117 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 6ad799daa49d438d8bfed1b47121ed41.pdf (331157 bytes)
2025-11-18 20:29:03,117 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-18 20:29:03,118 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6ad799daa49d438d8bfed1b47121ed41.pdf
2025-11-18 20:29:03,118 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-18 20:29:03,167 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-18 20:29:03,170 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-18 20:29:03,171 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-18 20:29:03,172 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-18 20:29:03,172 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-18 20:29:03,173 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-18 20:29:03,173 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-18 20:29:03,326 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-18 20:29:03,326 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-18 20:29:03,932 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-18 20:29:03,932 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-18 20:29:03,933 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-18 20:29:03,933 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-18 20:29:03,933 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-18 20:29:03,934 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-18 20:29:03,934 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-18 20:29:04,017 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-18 20:29:04,018 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-18 20:29:04,019 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-18 20:29:04,019 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-18 20:29:04,020 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-18 20:29:04,020 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-18 20:29:04,020 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-18 20:29:04,021 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-18 20:29:04,021 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-18 20:29:04,121 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-18 20:29:04,121 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-18 20:29:27,321 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:29:27,332 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-18 20:29:27,332 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-18 20:29:27,333 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-18 20:29:27,333 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-18 20:29:27,333 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-18 20:29:27,333 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-18 20:29:27,344 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-18 20:29:27,344 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-18 20:29:27,344 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-18 20:29:33,415 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:29:33,418 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-18 20:29:33,418 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-18 20:29:33,419 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-18 20:29:33,420 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-18 20:29:33,420 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-18 20:29:33,420 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-18 20:29:33,420 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-18 20:29:40,103 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:29:40,185 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-18 20:29:40,187 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-18 20:29:40,188 - app.services.ai_parser - INFO - 
2025-11-18 20:29:40,189 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:29:40,190 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-18 20:29:40,191 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:29:40,192 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-18 20:29:40,193 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-18 20:29:40,195 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-18 20:29:40,197 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-18 20:29:40,198 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-18 20:29:40,198 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-18 20:29:40,199 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-18 20:29:40,199 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-18 20:29:40,200 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-18 20:29:40,200 - app.services.ai_parser - INFO - 
2025-11-18 20:29:40,201 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-18 20:29:40,201 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-18 20:29:40,202 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-18 20:29:40,202 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-18 20:29:40,203 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-18 20:29:40,204 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-18 20:29:40,204 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:29:40,279 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: de6746a85dbb4f1ea0c78a794aca7555.pdf â†’ 691cd734be4cb3dd9c8891f4
2025-11-18 20:29:40,280 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691cd734be4cb3dd9c8891f4
2025-11-18 20:29:40,283 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691cd734be4cb3dd9c8891f5 (464206 bytes)
2025-11-18 20:29:40,283 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691cd734be4cb3dd9c8891f5
2025-11-18 20:29:40,284 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-18 20:29:41,991 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:29:41,995 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-18 20:29:41,996 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-18 20:29:41,996 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-18 20:29:41,997 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-18 20:29:46,939 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:29:46,942 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-18 20:29:46,943 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-18 20:29:46,943 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-18 20:29:46,944 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-18 20:29:46,944 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-18 20:29:46,945 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-18 20:29:46,945 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-18 20:29:46,946 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-18 20:29:46,947 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-18 20:29:46,947 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-18 20:29:54,047 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:29:54,048 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-18 20:29:54,049 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-18 20:29:54,049 - app.services.ai_parser - INFO - 
2025-11-18 20:29:54,049 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:29:54,050 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-18 20:29:54,050 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:29:54,050 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-18 20:29:54,050 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-18 20:29:54,051 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-18 20:29:54,051 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-18 20:29:54,051 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-18 20:29:54,051 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-18 20:29:54,051 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-18 20:29:54,052 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-18 20:29:54,052 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-18 20:29:54,052 - app.services.ai_parser - INFO - 
2025-11-18 20:29:54,052 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-18 20:29:54,052 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-18 20:29:54,053 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-18 20:29:54,053 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-18 20:29:54,053 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-18 20:29:54,053 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-18 20:29:54,053 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:29:54,055 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6ad799daa49d438d8bfed1b47121ed41.pdf â†’ 691cd742be4cb3dd9c8891f6
2025-11-18 20:29:54,055 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691cd742be4cb3dd9c8891f6
2025-11-18 20:29:54,058 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691cd742be4cb3dd9c8891f7 (331157 bytes)
2025-11-18 20:29:54,058 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691cd742be4cb3dd9c8891f7
2025-11-18 20:29:54,059 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-18 20:30:08,590 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:30:08,865 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-18 20:30:08,866 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-18 20:30:08,867 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-18 20:30:08,867 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-18 20:30:14,596 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:30:14,601 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-18 20:30:14,602 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-18 20:30:14,603 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-18 20:30:14,604 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-18 20:30:14,605 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-18 20:30:14,605 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-18 20:30:14,605 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-18 20:30:14,606 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-18 20:30:14,606 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-18 20:30:14,606 - app.services.ai_parser - INFO - ðŸ“Š Counts: 47 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-18 20:30:20,943 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:30:20,948 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-18 20:30:20,949 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-18 20:30:20,949 - app.services.ai_parser - INFO - 
2025-11-18 20:30:20,950 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:30:20,951 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-18 20:30:20,951 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:30:20,951 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-18 20:30:20,951 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-18 20:30:20,952 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-18 20:30:20,952 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-18 20:30:20,953 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-18 20:30:20,953 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-18 20:30:20,953 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-18 20:30:20,954 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-18 20:30:20,954 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-18 20:30:20,955 - app.services.ai_parser - INFO - 
2025-11-18 20:30:20,955 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-18 20:30:20,955 - app.services.ai_parser - INFO -    âœ“ Benefits: 47
2025-11-18 20:30:20,956 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-18 20:30:20,956 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-18 20:30:20,957 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-18 20:30:20,958 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-18 20:30:20,958 - app.services.ai_parser - INFO - ======================================================================
2025-11-18 20:30:20,965 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: f5faff6157bb4c67be37a6b8b33b562c.pdf â†’ 691cd75cbe4cb3dd9c8891f8
2025-11-18 20:30:20,965 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691cd75cbe4cb3dd9c8891f8
2025-11-18 20:30:20,968 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691cd75cbe4cb3dd9c8891f9 (175401 bytes)
2025-11-18 20:30:20,968 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691cd75cbe4cb3dd9c8891f9
2025-11-18 20:30:20,968 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-18 20:30:20,969 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-18 20:30:20,969 - app.api.routes - INFO - 
======================================================================
2025-11-18 20:30:20,972 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-18 20:30:20,975 - app.api.routes - INFO - ======================================================================
2025-11-18 20:30:20,976 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-18 20:30:20,977 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-18 20:30:20,977 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-18 20:30:20,978 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-18 20:30:20,978 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-18 20:30:20,979 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.12
2025-11-18 20:30:20,979 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-18 20:30:20,980 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-18 20:30:29,744 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-18 20:30:29,746 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-18 20:30:29,746 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-18 20:30:29,746 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-18 20:30:29,747 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-18 20:30:29,748 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-18 20:30:29,748 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763497742_166960ac4d2c
2025-11-18 20:30:29,748 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-18 20:30:29,748 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-18 20:30:29,749 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-18 20:30:29,749 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-18 20:30:29,749 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-18 20:30:29,750 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-18 20:30:29,750 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-18 20:30:29,750 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-18 20:30:29,750 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-18 20:30:29,751 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-18 20:30:29,751 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-18 20:30:29,751 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-18 20:30:29,751 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-18 20:30:29,751 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-18 20:30:29,752 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-18 20:30:29,752 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-18 20:30:29,752 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-18 20:30:29,756 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-18 20:30:29,757 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,096 bytes
2025-11-18 20:30:29,757 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 29,836 bytes
2025-11-18 20:30:29,757 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,662 bytes
2025-11-18 20:30:29,757 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,728 bytes
2025-11-18 20:30:29,758 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 51,834 bytes
2025-11-18 20:30:29,758 - app.services.mongodb_service_enhanced - INFO -    Total document: 207,708 bytes
2025-11-18 20:30:29,758 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-18 20:30:29,759 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-18 20:30:29,759 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-18 20:30:29,759 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-18 20:30:29,759 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-18 20:30:29,759 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-18 20:30:29,760 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-18 20:30:29,760 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-18 20:30:29,760 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-18 20:30:29,761 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-18 20:30:29,762 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-18 20:30:29,763 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-18 20:30:29,763 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-18 20:30:29,764 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-18 20:30:29,764 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-18 20:30:29,764 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-18 20:30:29,764 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-18 20:30:29,765 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-18 20:30:29,765 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-18 20:30:29,765 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-18 20:30:29,829 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763497742_166960ac4d2c
2025-11-18 20:30:29,829 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691cd765b8ed226b2b31fea5
2025-11-18 20:30:29,831 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-18 20:30:29,831 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-18 20:30:29,831 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-18 20:30:29,832 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-18 20:30:29,832 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-18 20:30:29,832 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-18 20:30:29,832 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-18 20:30:29,833 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-18 20:30:29,833 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-18 20:30:29,833 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-18 20:30:29,834 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-18 20:30:29,834 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-18 20:30:29,834 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-18 20:30:29,835 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-18 20:30:29,835 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-18 20:30:29,835 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-18 20:30:29,835 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-18 20:30:29,836 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-18 20:30:29,836 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-18 20:30:29,836 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691cd765b8ed226b2b31fea5
2025-11-18 20:30:29,837 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-18 20:30:29,837 - app.api.routes - INFO -    Collection: comparisons
2025-11-18 20:30:29,837 - app.api.routes - INFO -    Comparison ID: cmp_1763497742_166960ac4d2c
2025-11-18 20:30:29,844 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-18 20:30:29,845 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-18 20:30:29,845 - app.api.routes - INFO - 
======================================================================
2025-11-18 20:30:29,845 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-18 20:30:29,846 - app.api.routes - INFO - ======================================================================
2025-11-18 20:30:29,846 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763497742_166960ac4d2c
2025-11-18 20:30:29,846 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-18 20:30:29,846 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-18 20:30:29,846 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-18 20:30:29,847 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-18 20:30:29,847 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-18 20:30:29,847 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-18 20:30:29,848 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-18 20:30:29,849 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 234
2025-11-18 20:30:29,849 - app.api.routes - INFO - ======================================================================

2025-11-18 20:30:29,850 - app.services.progress_tracker - INFO - âœ… Job completed: job_8551869dd246 â†’ comparison_id: cmp_1763497742_166960ac4d2c
2025-11-18 20:30:29,851 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 86.96s
2025-11-18 20:36:20,584 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-18 20:36:20,584 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-19 13:27:10,151 - main - INFO - 
2025-11-19 13:27:10,151 - main - INFO - ================================================================================
2025-11-19 13:27:10,151 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 13:27:10,151 - main - INFO -   Production-Ready Complete Integration
2025-11-19 13:27:10,151 - main - INFO - ================================================================================
2025-11-19 13:27:10,151 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 13:27:10,152 - main - INFO -   Upload Directory: uploads
2025-11-19 13:27:10,152 - main - INFO -   Max File Size: 20MB
2025-11-19 13:27:10,152 - main - INFO - ================================================================================
2025-11-19 13:27:10,153 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 13:27:10,153 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 13:27:10,153 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 13:27:10,581 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 13:27:10,586 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 13:27:10,586 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 13:27:10,586 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 13:27:10,586 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 13:27:10,587 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 13:27:10,587 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 13:27:10,587 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 13:27:10,598 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 13:27:10,599 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 13:27:10,601 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 13:27:10,606 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 13:27:10,606 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 13:27:10,606 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 13:27:10,607 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 13:27:10,607 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 13:27:10,614 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 13:27:10,615 - main - INFO -   âœ… User Documents Service connected
2025-11-19 13:27:10,615 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 13:27:10,615 - main - INFO - 
2025-11-19 13:27:10,616 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 13:27:10,616 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 13:27:10,617 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 13:27:10,617 - main - INFO -        - Separates warranties from extensions
2025-11-19 13:27:10,617 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 13:27:10,617 - main - INFO -        - Correct deductible tier detection
2025-11-19 13:27:10,618 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 13:27:10,618 - main - INFO - 
2025-11-19 13:27:10,618 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 13:27:10,618 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 13:27:10,619 - main - INFO -        - Identifies unique items per provider
2025-11-19 13:27:10,619 - main - INFO -        - Transparent scoring methodology
2025-11-19 13:27:10,619 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 13:27:10,619 - main - INFO - 
2025-11-19 13:27:10,620 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 13:27:10,620 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 13:27:10,620 - main - INFO -        - No manual section generation
2025-11-19 13:27:10,621 - main - INFO -        - Complete MongoDB integration
2025-11-19 13:27:10,621 - main - INFO - 
2025-11-19 13:27:10,621 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 13:27:10,621 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 13:27:10,622 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 13:27:10,622 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 13:27:10,622 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 13:27:10,622 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 13:27:10,623 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 13:27:10,623 - main - INFO - 
2025-11-19 13:27:10,623 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 13:27:10,623 - main - INFO -      Main:
2025-11-19 13:27:10,624 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 13:27:10,624 - main - INFO - 
2025-11-19 13:27:10,624 - main - INFO -      Retrieval:
2025-11-19 13:27:10,624 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 13:27:10,625 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 13:27:10,625 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 13:27:10,626 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 13:27:10,627 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 13:27:10,630 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 13:27:10,631 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 13:27:10,631 - main - INFO - 
2025-11-19 13:27:10,631 - main - INFO -      Management:
2025-11-19 13:27:10,631 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 13:27:10,632 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 13:27:10,632 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 13:27:10,632 - main - INFO - 
2025-11-19 13:27:10,632 - main - INFO -      Documents (MongoDB):
2025-11-19 13:27:10,633 - main - INFO -        GET  /api/documents                All documents
2025-11-19 13:27:10,633 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 13:27:10,633 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 13:27:10,633 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 13:27:10,633 - main - INFO - 
2025-11-19 13:27:10,634 - main - INFO -      Diagnostics & Health:
2025-11-19 13:27:10,634 - main - INFO -        GET  /api/health                   System health
2025-11-19 13:27:10,634 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 13:27:10,634 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 13:27:10,635 - main - INFO - 
2025-11-19 13:27:10,635 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 13:27:10,635 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 13:27:10,635 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 13:27:10,636 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 13:27:10,636 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 13:27:10,636 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 13:27:10,636 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 13:27:10,637 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 13:27:10,637 - main - INFO - 
2025-11-19 13:27:10,637 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 13:27:10,637 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 13:27:10,637 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 13:27:10,638 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 13:27:10,638 - main - INFO -      4. No re-upload needed!
2025-11-19 13:27:10,638 - main - INFO - 
2025-11-19 13:27:10,638 - main - INFO - ================================================================================
2025-11-19 13:27:10,639 - main - INFO -   âœ… Application started successfully!
2025-11-19 13:27:10,639 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 13:27:10,639 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 13:27:10,639 - main - INFO - ================================================================================
2025-11-19 13:27:10,640 - main - INFO - 
2025-11-19 13:27:10,640 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 13:56:35,112 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 13:56:35,115 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 13:56:35,215 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 13:56:35,242 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.03s
2025-11-19 13:57:05,958 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 13:57:05,970 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 13:57:05,970 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 13:57:05,970 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 13:57:05,971 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 13:57:05,972 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 13:57:05,974 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 13:57:05,974 - app.api.routes - INFO -    - Remaining comparisons: 234
2025-11-19 13:57:05,974 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 13:57:05,974 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 13:57:05,975 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763560625_30a35f453bde
2025-11-19 13:57:05,975 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_b68043613e22 (3 files)
2025-11-19 13:57:05,975 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_b68043613e22
2025-11-19 13:57:05,976 - app.api.routes - INFO - 
======================================================================
2025-11-19 13:57:05,977 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 13:57:05,979 - app.api.routes - INFO - ======================================================================
2025-11-19 13:57:05,983 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 37f976f7e7b041b49d1f85f8dd038c4c.pdf (464206 bytes)
2025-11-19 13:57:05,984 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 13:57:05,986 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\37f976f7e7b041b49d1f85f8dd038c4c.pdf
2025-11-19 13:57:05,987 - app.api.routes - INFO - 
======================================================================
2025-11-19 13:57:06,038 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 13:57:06,103 - app.api.routes - INFO - ======================================================================
2025-11-19 13:57:06,107 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ f5e5a2f5c3b04e2ca44168fc180850b9.pdf (175401 bytes)
2025-11-19 13:57:06,108 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 13:57:06,139 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 13:57:06,139 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\f5e5a2f5c3b04e2ca44168fc180850b9.pdf
2025-11-19 13:57:06,139 - app.api.routes - INFO - 
======================================================================
2025-11-19 13:57:06,163 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 13:57:06,179 - app.api.routes - INFO - ======================================================================
2025-11-19 13:57:06,190 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 13:57:06,192 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 2b81f862bf7a40ab8f8d7c86bd248289.pdf (331157 bytes)
2025-11-19 13:57:06,192 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 13:57:06,192 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\2b81f862bf7a40ab8f8d7c86bd248289.pdf
2025-11-19 13:57:06,192 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 13:57:06,209 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 13:57:06,240 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 13:57:06,248 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 13:57:06,249 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 13:57:06,249 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 13:57:06,251 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 13:57:06,252 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 13:57:06,413 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 13:57:06,413 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 13:57:07,087 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 13:57:07,087 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 13:57:07,088 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 13:57:07,088 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 13:57:07,088 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 13:57:07,088 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 13:57:07,089 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 13:57:07,169 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 13:57:07,170 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 13:57:07,171 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 13:57:07,172 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 13:57:07,172 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 13:57:07,172 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 13:57:07,173 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 13:57:07,173 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 13:57:07,173 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 13:57:07,277 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 13:57:07,278 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 13:57:36,206 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:57:36,220 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 13:57:36,220 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 13:57:36,221 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 13:57:36,222 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 13:57:36,222 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 13:57:36,223 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 13:57:36,233 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 13:57:36,233 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 13:57:36,234 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 13:57:45,057 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:57:45,079 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 13:57:45,080 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 13:57:45,081 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 13:57:45,082 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 13:57:45,082 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 13:57:45,083 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 13:57:45,084 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 13:57:51,689 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:57:51,691 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 13:57:51,692 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 13:57:51,692 - app.services.ai_parser - INFO - 
2025-11-19 13:57:51,693 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:57:51,693 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 13:57:51,694 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:57:51,695 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 13:57:51,695 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 13:57:51,696 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 13:57:51,696 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 13:57:51,697 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 13:57:51,698 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 13:57:51,698 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 13:57:51,699 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 13:57:51,699 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 13:57:51,700 - app.services.ai_parser - INFO - 
2025-11-19 13:57:51,700 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 13:57:51,701 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 13:57:51,701 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 13:57:51,701 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 13:57:51,701 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 13:57:51,702 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 13:57:51,702 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:57:51,703 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 37f976f7e7b041b49d1f85f8dd038c4c.pdf â†’ 691dccdfedeab5c761d41f27
2025-11-19 13:57:51,704 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691dccdfedeab5c761d41f27
2025-11-19 13:57:51,707 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691dccdfedeab5c761d41f28 (464206 bytes)
2025-11-19 13:57:51,708 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691dccdfedeab5c761d41f28
2025-11-19 13:57:51,708 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 13:57:58,626 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:57:58,631 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 13:57:58,632 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 13:57:58,632 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 13:57:58,633 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 13:58:05,342 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:58:05,352 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 13:58:05,353 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 13:58:05,353 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 13:58:05,354 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 13:58:05,354 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 13:58:05,354 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 13:58:05,355 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 13:58:05,355 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 for Material Damage other than Natural Catastrophe Risks. | BI: Minimum 21 days for Business Interruption / Contingent Business Interruption / Loss of Rent (Receivable / Payable) | Nat Cat: 5% of claim amount, minimum SR 1,500,000 for Natural Catastrophe Risks including Flood and Earthquake.
2025-11-19 13:58:05,356 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 13:58:05,356 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 13:58:11,671 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:58:11,678 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 13:58:11,678 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 13:58:11,679 - app.services.ai_parser - INFO - 
2025-11-19 13:58:11,680 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:58:11,681 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 13:58:11,681 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:58:11,682 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 13:58:11,683 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 13:58:11,683 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 13:58:11,684 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 13:58:11,685 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 13:58:11,685 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 13:58:11,686 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 for Material Damage other than Natural Catastrophe Risks. | BI: Minimum 21 days for Business Interruption / Contingent Business Interruption / Loss of Rent (Receivable / Payable) | Nat Cat: 5% of claim amount, minimum SR 1,500,000 for Natural Catastrophe Risks including Flood and Earthquake.
2025-11-19 13:58:11,687 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 13:58:11,688 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 13:58:11,689 - app.services.ai_parser - INFO - 
2025-11-19 13:58:11,689 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 13:58:11,690 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-19 13:58:11,691 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 13:58:11,691 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 13:58:11,692 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 13:58:11,693 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 13:58:11,693 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:58:11,696 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 2b81f862bf7a40ab8f8d7c86bd248289.pdf â†’ 691dccf3edeab5c761d41f29
2025-11-19 13:58:11,697 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691dccf3edeab5c761d41f29
2025-11-19 13:58:11,701 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691dccf3edeab5c761d41f2a (331157 bytes)
2025-11-19 13:58:11,702 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691dccf3edeab5c761d41f2a
2025-11-19 13:58:11,702 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 13:58:28,804 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:58:29,062 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 13:58:29,062 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 13:58:29,063 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 13:58:29,064 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 13:58:36,792 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:58:36,795 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 13:58:36,796 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 13:58:36,797 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 13:58:36,797 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 13:58:36,798 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 13:58:36,799 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 13:58:36,800 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 13:58:36,800 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-19 13:58:36,801 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 13:58:36,801 - app.services.ai_parser - INFO - ðŸ“Š Counts: 38 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-19 13:58:44,747 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:58:44,749 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 13:58:44,749 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 13:58:44,749 - app.services.ai_parser - INFO - 
2025-11-19 13:58:44,749 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:58:44,750 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 13:58:44,750 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:58:44,750 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 13:58:44,750 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 13:58:44,750 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-19 13:58:44,751 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 13:58:44,751 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 13:58:44,751 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-19 13:58:44,751 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-19 13:58:44,752 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 13:58:44,752 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 13:58:44,752 - app.services.ai_parser - INFO - 
2025-11-19 13:58:44,752 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 13:58:44,752 - app.services.ai_parser - INFO -    âœ“ Benefits: 38
2025-11-19 13:58:44,753 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 13:58:44,753 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-19 13:58:44,753 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 13:58:44,753 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 13:58:44,753 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 13:58:44,755 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: f5e5a2f5c3b04e2ca44168fc180850b9.pdf â†’ 691dcd14edeab5c761d41f2b
2025-11-19 13:58:44,755 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691dcd14edeab5c761d41f2b
2025-11-19 13:58:44,756 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691dcd14edeab5c761d41f2c (175401 bytes)
2025-11-19 13:58:44,757 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691dcd14edeab5c761d41f2c
2025-11-19 13:58:44,757 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 13:58:44,757 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 13:58:44,757 - app.api.routes - INFO - 
======================================================================
2025-11-19 13:58:44,758 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 13:58:44,758 - app.api.routes - INFO - ======================================================================
2025-11-19 13:58:44,758 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 13:58:44,758 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 13:58:44,758 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 13:58:44,759 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-19 13:58:44,759 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-19 13:58:44,760 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.12
2025-11-19 13:58:44,760 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 13:58:44,760 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 13:58:54,946 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 13:58:54,956 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 13:58:54,957 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 13:58:54,958 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 13:58:54,960 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 13:58:54,961 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 13:58:54,962 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763560625_30a35f453bde
2025-11-19 13:58:54,962 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 13:58:54,963 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 13:58:54,964 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 13:58:54,965 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 13:58:54,965 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 13:58:54,966 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 13:58:54,967 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 13:58:54,968 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 13:58:54,968 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 13:58:54,969 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 13:58:54,970 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-19 13:58:54,971 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 13:58:54,971 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 13:58:54,972 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 13:58:54,972 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 13:58:54,973 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 13:58:54,973 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 13:58:54,979 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 13:58:54,980 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,319 bytes
2025-11-19 13:58:54,980 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 29,636 bytes
2025-11-19 13:58:54,980 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,604 bytes
2025-11-19 13:58:54,981 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,741 bytes
2025-11-19 13:58:54,981 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 49,018 bytes
2025-11-19 13:58:54,981 - app.services.mongodb_service_enhanced - INFO -    Total document: 202,016 bytes
2025-11-19 13:58:54,982 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 13:58:54,982 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 13:58:54,982 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 13:58:54,983 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 13:58:54,983 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 13:58:54,983 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 13:58:54,984 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 13:58:54,984 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 13:58:54,984 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 13:58:54,985 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 13:58:54,985 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 13:58:54,985 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 13:58:54,986 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 13:58:54,986 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 13:58:54,986 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 13:58:54,986 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 13:58:54,987 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 13:58:54,987 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 13:58:54,987 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 13:58:54,988 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 13:58:54,993 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763560625_30a35f453bde
2025-11-19 13:58:54,993 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691dcd1eb8ed226b2b31fea6
2025-11-19 13:58:54,996 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 13:58:54,996 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 13:58:54,996 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 13:58:54,996 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 13:58:54,997 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 13:58:54,997 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 13:58:54,997 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 13:58:54,997 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 13:58:54,998 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 13:58:54,998 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 13:58:54,998 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 13:58:54,999 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 13:58:54,999 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 13:58:54,999 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 13:58:54,999 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 13:58:55,000 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 13:58:55,000 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 13:58:55,000 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 13:58:55,000 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 13:58:55,001 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691dcd1eb8ed226b2b31fea6
2025-11-19 13:58:55,001 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 13:58:55,001 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 13:58:55,001 - app.api.routes - INFO -    Comparison ID: cmp_1763560625_30a35f453bde
2025-11-19 13:58:55,003 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 13:58:55,004 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 13:58:55,004 - app.api.routes - INFO - 
======================================================================
2025-11-19 13:58:55,004 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 13:58:55,004 - app.api.routes - INFO - ======================================================================
2025-11-19 13:58:55,005 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763560625_30a35f453bde
2025-11-19 13:58:55,005 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 13:58:55,005 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 13:58:55,005 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 13:58:55,005 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 13:58:55,006 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 13:58:55,006 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 13:58:55,007 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 13:58:55,008 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 233
2025-11-19 13:58:55,008 - app.api.routes - INFO - ======================================================================

2025-11-19 13:58:55,009 - app.services.progress_tracker - INFO - âœ… Job completed: job_b68043613e22 â†’ comparison_id: cmp_1763560625_30a35f453bde
2025-11-19 13:58:55,010 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 109.05s
2025-11-19 14:07:10,715 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-19 14:07:10,716 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-19 14:56:39,772 - main - INFO - 
2025-11-19 14:56:39,773 - main - INFO - ================================================================================
2025-11-19 14:56:39,774 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 14:56:39,780 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 14:56:39,781 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 14:56:39,784 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 14:56:39,785 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 14:56:39,788 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 14:56:39,789 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 14:56:39,798 - main - INFO -   âœ… Cleaned up 6 temporary files
2025-11-19 14:56:39,799 - main - INFO -   âœ… Application stopped successfully
2025-11-19 14:56:39,799 - main - INFO - ================================================================================
2025-11-19 14:56:39,800 - main - INFO - 
2025-11-19 14:56:42,599 - main - INFO - 
2025-11-19 14:56:42,600 - main - INFO - ================================================================================
2025-11-19 14:56:42,600 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 14:56:42,600 - main - INFO -   Production-Ready Complete Integration
2025-11-19 14:56:42,600 - main - INFO - ================================================================================
2025-11-19 14:56:42,601 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 14:56:42,601 - main - INFO -   Upload Directory: uploads
2025-11-19 14:56:42,601 - main - INFO -   Max File Size: 20MB
2025-11-19 14:56:42,601 - main - INFO - ================================================================================
2025-11-19 14:56:42,602 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 14:56:42,602 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 14:56:42,602 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 14:56:42,625 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 14:56:42,631 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 14:56:42,632 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 14:56:42,633 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 14:56:42,634 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 14:56:42,635 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 14:56:42,635 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 14:56:42,635 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 14:56:42,655 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 14:56:42,656 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 14:56:42,656 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 14:56:42,658 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 14:56:42,658 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 14:56:42,658 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 14:56:42,659 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 14:56:42,659 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 14:56:42,685 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 14:56:42,686 - main - INFO -   âœ… User Documents Service connected
2025-11-19 14:56:42,686 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 14:56:42,687 - main - INFO - 
2025-11-19 14:56:42,687 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 14:56:42,687 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 14:56:42,688 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 14:56:42,688 - main - INFO -        - Separates warranties from extensions
2025-11-19 14:56:42,688 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 14:56:42,688 - main - INFO -        - Correct deductible tier detection
2025-11-19 14:56:42,688 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 14:56:42,689 - main - INFO - 
2025-11-19 14:56:42,689 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 14:56:42,689 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 14:56:42,689 - main - INFO -        - Identifies unique items per provider
2025-11-19 14:56:42,689 - main - INFO -        - Transparent scoring methodology
2025-11-19 14:56:42,690 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 14:56:42,690 - main - INFO - 
2025-11-19 14:56:42,690 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 14:56:42,690 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 14:56:42,690 - main - INFO -        - No manual section generation
2025-11-19 14:56:42,690 - main - INFO -        - Complete MongoDB integration
2025-11-19 14:56:42,690 - main - INFO - 
2025-11-19 14:56:42,691 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 14:56:42,691 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 14:56:42,691 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 14:56:42,691 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 14:56:42,691 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 14:56:42,691 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 14:56:42,692 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 14:56:42,692 - main - INFO - 
2025-11-19 14:56:42,692 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 14:56:42,692 - main - INFO -      Main:
2025-11-19 14:56:42,692 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 14:56:42,693 - main - INFO - 
2025-11-19 14:56:42,693 - main - INFO -      Retrieval:
2025-11-19 14:56:42,693 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 14:56:42,693 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 14:56:42,693 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 14:56:42,693 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 14:56:42,693 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 14:56:42,694 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 14:56:42,694 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 14:56:42,694 - main - INFO - 
2025-11-19 14:56:42,694 - main - INFO -      Management:
2025-11-19 14:56:42,694 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 14:56:42,694 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 14:56:42,695 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 14:56:42,695 - main - INFO - 
2025-11-19 14:56:42,695 - main - INFO -      Documents (MongoDB):
2025-11-19 14:56:42,695 - main - INFO -        GET  /api/documents                All documents
2025-11-19 14:56:42,695 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 14:56:42,695 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 14:56:42,695 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 14:56:42,696 - main - INFO - 
2025-11-19 14:56:42,696 - main - INFO -      Diagnostics & Health:
2025-11-19 14:56:42,696 - main - INFO -        GET  /api/health                   System health
2025-11-19 14:56:42,696 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 14:56:42,696 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 14:56:42,696 - main - INFO - 
2025-11-19 14:56:42,697 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 14:56:42,697 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 14:56:42,697 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 14:56:42,697 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 14:56:42,697 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 14:56:42,698 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 14:56:42,698 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 14:56:42,698 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 14:56:42,698 - main - INFO - 
2025-11-19 14:56:42,698 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 14:56:42,699 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 14:56:42,699 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 14:56:42,699 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 14:56:42,699 - main - INFO -      4. No re-upload needed!
2025-11-19 14:56:42,700 - main - INFO - 
2025-11-19 14:56:42,700 - main - INFO - ================================================================================
2025-11-19 14:56:42,700 - main - INFO -   âœ… Application started successfully!
2025-11-19 14:56:42,700 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 14:56:42,701 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 14:56:42,701 - main - INFO - ================================================================================
2025-11-19 14:56:42,701 - main - INFO - 
2025-11-19 14:56:42,701 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 14:56:49,092 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 14:56:49,093 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 14:56:49,297 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 14:56:49,313 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.02s
2025-11-19 14:56:52,007 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 14:56:52,010 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 14:56:52,151 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 14:56:52,152 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.00s
2025-11-19 14:57:25,879 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 14:57:25,887 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 14:57:25,887 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 14:57:25,887 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 14:57:25,888 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 14:57:25,890 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 14:57:25,893 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 14:57:25,894 - app.api.routes - INFO -    - Remaining comparisons: 233
2025-11-19 14:57:25,894 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 14:57:25,895 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 14:57:25,896 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763564245_96e45675da38
2025-11-19 14:57:25,896 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_e6ff06c741bf (3 files)
2025-11-19 14:57:25,897 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_e6ff06c741bf
2025-11-19 14:57:25,898 - app.api.routes - INFO - 
======================================================================
2025-11-19 14:57:25,899 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 14:57:25,900 - app.api.routes - INFO - ======================================================================
2025-11-19 14:57:25,902 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 1d14c5c398804923ac3960ea216a6f01.pdf (464206 bytes)
2025-11-19 14:57:25,903 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 14:57:25,905 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\1d14c5c398804923ac3960ea216a6f01.pdf
2025-11-19 14:57:25,905 - app.api.routes - INFO - 
======================================================================
2025-11-19 14:57:25,905 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 14:57:25,905 - app.api.routes - INFO - ======================================================================
2025-11-19 14:57:25,953 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ a51daf6ae99c47868a40e77e584092b5.pdf (175401 bytes)
2025-11-19 14:57:25,954 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 14:57:25,987 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 14:57:25,987 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a51daf6ae99c47868a40e77e584092b5.pdf
2025-11-19 14:57:25,987 - app.api.routes - INFO - 
======================================================================
2025-11-19 14:57:25,988 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 14:57:26,016 - app.api.routes - INFO - ======================================================================
2025-11-19 14:57:26,042 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 14:57:26,042 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 1bd39963be1546508c010275863b5afb.pdf (331157 bytes)
2025-11-19 14:57:26,043 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 14:57:26,043 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\1bd39963be1546508c010275863b5afb.pdf
2025-11-19 14:57:26,043 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 14:57:26,071 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 14:57:26,095 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 14:57:26,096 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 14:57:26,097 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 14:57:26,098 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 14:57:26,098 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 14:57:26,098 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 14:57:26,257 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 14:57:26,257 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 14:57:26,692 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 14:57:26,693 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 14:57:26,693 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 14:57:26,694 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 14:57:26,694 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 14:57:26,694 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 14:57:26,695 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 14:57:26,798 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 14:57:26,798 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 14:57:26,799 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 14:57:26,800 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 14:57:26,800 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 14:57:26,800 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 14:57:26,800 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 14:57:26,801 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 14:57:26,801 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 14:57:26,895 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 14:57:26,896 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 14:58:01,794 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:58:01,804 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 14:58:01,805 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 14:58:01,805 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 14:58:01,806 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 14:58:01,806 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 14:58:01,806 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 14:58:01,811 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 14:58:01,811 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 14:58:01,812 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 14:58:08,970 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:58:08,978 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 14:58:08,979 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 14:58:08,979 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 14:58:08,979 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 14:58:08,980 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 14:58:08,980 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 14:58:08,980 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 14:58:15,816 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:58:15,820 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 14:58:15,820 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 14:58:15,820 - app.services.ai_parser - INFO - 
2025-11-19 14:58:15,820 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:58:15,821 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 14:58:15,821 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:58:15,821 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 14:58:15,821 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 14:58:15,821 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 14:58:15,822 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 14:58:15,822 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 14:58:15,822 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 14:58:15,822 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 14:58:15,823 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 14:58:15,823 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 14:58:15,823 - app.services.ai_parser - INFO - 
2025-11-19 14:58:15,823 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 14:58:15,823 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 14:58:15,824 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 14:58:15,824 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 14:58:15,824 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 14:58:15,824 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 14:58:15,825 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:58:15,827 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 1d14c5c398804923ac3960ea216a6f01.pdf â†’ 691ddb07e04f81bf5b31ec43
2025-11-19 14:58:15,827 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddb07e04f81bf5b31ec43
2025-11-19 14:58:15,836 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddb07e04f81bf5b31ec44 (464206 bytes)
2025-11-19 14:58:15,836 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddb07e04f81bf5b31ec44
2025-11-19 14:58:15,837 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 14:58:35,921 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:58:36,184 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 14:58:36,185 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 14:58:36,186 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 14:58:36,186 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 14:58:43,172 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:58:43,176 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 14:58:43,176 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 14:58:43,177 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 14:58:43,177 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 14:58:43,177 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 14:58:43,178 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 14:58:43,178 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 14:58:43,178 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 14:58:43,179 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 14:58:43,179 - app.services.ai_parser - INFO - ðŸ“Š Counts: 17 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 14:58:53,802 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:58:53,836 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 14:58:53,836 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 14:58:53,836 - app.services.ai_parser - INFO - 
2025-11-19 14:58:53,836 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:58:53,837 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 14:58:53,837 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:58:53,837 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 14:58:53,837 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 14:58:53,837 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 14:58:53,837 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 14:58:53,838 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 14:58:53,838 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 14:58:53,838 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 14:58:53,838 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 14:58:53,838 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 14:58:53,838 - app.services.ai_parser - INFO - 
2025-11-19 14:58:53,839 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 14:58:53,839 - app.services.ai_parser - INFO -    âœ“ Benefits: 17
2025-11-19 14:58:53,839 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 14:58:53,839 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 14:58:53,839 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 14:58:53,839 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 14:58:53,840 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:58:53,841 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 1bd39963be1546508c010275863b5afb.pdf â†’ 691ddb2de04f81bf5b31ec45
2025-11-19 14:58:53,841 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddb2de04f81bf5b31ec45
2025-11-19 14:58:53,843 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691ddb2de04f81bf5b31ec46 (331157 bytes)
2025-11-19 14:58:53,844 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691ddb2de04f81bf5b31ec46
2025-11-19 14:58:53,844 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 14:59:03,221 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:59:03,327 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 14:59:03,328 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 14:59:03,328 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 14:59:03,328 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 14:59:11,718 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:59:11,720 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 14:59:11,720 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 14:59:11,720 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 14:59:11,720 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 14:59:11,721 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 14:59:11,721 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 14:59:11,721 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 14:59:11,721 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-19 14:59:11,722 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 14:59:11,722 - app.services.ai_parser - INFO - ðŸ“Š Counts: 26 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-19 14:59:17,844 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:59:17,847 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 14:59:17,848 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 14:59:17,848 - app.services.ai_parser - INFO - 
2025-11-19 14:59:17,848 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:59:17,849 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 14:59:17,849 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:59:17,849 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 14:59:17,849 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 14:59:17,850 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-19 14:59:17,850 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 14:59:17,850 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 14:59:17,851 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-19 14:59:17,851 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-19 14:59:17,851 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 14:59:17,851 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 14:59:17,852 - app.services.ai_parser - INFO - 
2025-11-19 14:59:17,852 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 14:59:17,853 - app.services.ai_parser - INFO -    âœ“ Benefits: 26
2025-11-19 14:59:17,853 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 14:59:17,853 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-19 14:59:17,854 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 14:59:17,854 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 14:59:17,854 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 14:59:17,856 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a51daf6ae99c47868a40e77e584092b5.pdf â†’ 691ddb45e04f81bf5b31ec47
2025-11-19 14:59:17,856 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddb45e04f81bf5b31ec47
2025-11-19 14:59:17,862 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691ddb45e04f81bf5b31ec48 (175401 bytes)
2025-11-19 14:59:17,863 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691ddb45e04f81bf5b31ec48
2025-11-19 14:59:17,864 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 14:59:17,865 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 14:59:17,866 - app.api.routes - INFO - 
======================================================================
2025-11-19 14:59:17,866 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 14:59:17,867 - app.api.routes - INFO - ======================================================================
2025-11-19 14:59:17,867 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 14:59:17,867 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 14:59:17,867 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 14:59:17,868 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-19 14:59:17,868 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-19 14:59:17,869 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.12
2025-11-19 14:59:17,869 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 14:59:17,869 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 14:59:30,640 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 14:59:30,642 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 14:59:30,642 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 14:59:30,642 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 14:59:30,643 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 14:59:30,644 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 14:59:30,644 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763564245_96e45675da38
2025-11-19 14:59:30,644 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 14:59:30,645 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 14:59:30,645 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 14:59:30,645 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 14:59:30,645 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 14:59:30,646 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 14:59:30,646 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 14:59:30,646 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 14:59:30,646 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 14:59:30,647 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 14:59:30,647 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-19 14:59:30,647 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 14:59:30,647 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 14:59:30,647 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 14:59:30,648 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 14:59:30,648 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 14:59:30,648 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 14:59:30,650 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 14:59:30,651 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,429 bytes
2025-11-19 14:59:30,651 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 29,845 bytes
2025-11-19 14:59:30,651 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,669 bytes
2025-11-19 14:59:30,651 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,741 bytes
2025-11-19 14:59:30,652 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 48,282 bytes
2025-11-19 14:59:30,652 - app.services.mongodb_service_enhanced - INFO -    Total document: 201,330 bytes
2025-11-19 14:59:30,652 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 14:59:30,653 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 14:59:30,653 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 14:59:30,653 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 14:59:30,654 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 14:59:30,655 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 14:59:30,655 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 14:59:30,655 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 14:59:30,655 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 14:59:30,656 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 14:59:30,656 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 14:59:30,656 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 14:59:30,656 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 14:59:30,656 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 14:59:30,657 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 14:59:30,657 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 14:59:30,657 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 14:59:30,657 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 14:59:30,658 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 14:59:30,658 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 14:59:30,661 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763564245_96e45675da38
2025-11-19 14:59:30,662 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691ddb52b8ed226b2b31fea7
2025-11-19 14:59:30,664 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 14:59:30,665 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 14:59:30,665 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 14:59:30,665 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 14:59:30,666 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 14:59:30,666 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 14:59:30,667 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 14:59:30,667 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 14:59:30,667 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 14:59:30,668 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 14:59:30,668 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 14:59:30,668 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 14:59:30,669 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 14:59:30,669 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 14:59:30,669 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 14:59:30,669 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 14:59:30,670 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 14:59:30,670 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 14:59:30,670 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 14:59:30,670 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691ddb52b8ed226b2b31fea7
2025-11-19 14:59:30,671 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 14:59:30,671 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 14:59:30,671 - app.api.routes - INFO -    Comparison ID: cmp_1763564245_96e45675da38
2025-11-19 14:59:30,672 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 14:59:30,673 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 14:59:30,673 - app.api.routes - INFO - 
======================================================================
2025-11-19 14:59:30,673 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 14:59:30,673 - app.api.routes - INFO - ======================================================================
2025-11-19 14:59:30,673 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763564245_96e45675da38
2025-11-19 14:59:30,674 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 14:59:30,674 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 14:59:30,674 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 14:59:30,674 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 14:59:30,674 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 14:59:30,675 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 14:59:30,675 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 14:59:30,676 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 232
2025-11-19 14:59:30,676 - app.api.routes - INFO - ======================================================================

2025-11-19 14:59:30,676 - app.services.progress_tracker - INFO - âœ… Job completed: job_e6ff06c741bf â†’ comparison_id: cmp_1763564245_96e45675da38
2025-11-19 14:59:30,678 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 124.80s
2025-11-19 15:06:01,308 - main - INFO - 
2025-11-19 15:06:01,308 - main - INFO - ================================================================================
2025-11-19 15:06:01,309 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:06:01,313 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:01,314 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:06:01,316 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:01,316 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:06:01,318 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:06:01,318 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:06:01,320 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-19 15:06:01,321 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:06:01,323 - main - INFO - ================================================================================
2025-11-19 15:06:01,323 - main - INFO - 
2025-11-19 15:06:05,775 - main - INFO - 
2025-11-19 15:06:05,775 - main - INFO - ================================================================================
2025-11-19 15:06:05,776 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:06:05,776 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:06:05,776 - main - INFO - ================================================================================
2025-11-19 15:06:05,776 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:06:05,777 - main - INFO -   Upload Directory: uploads
2025-11-19 15:06:05,777 - main - INFO -   Max File Size: 20MB
2025-11-19 15:06:05,777 - main - INFO - ================================================================================
2025-11-19 15:06:05,777 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:06:05,778 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:06:05,778 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:06:05,803 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:06:05,808 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:06:05,808 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:06:05,809 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:06:05,809 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:06:05,809 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:06:05,809 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:05,810 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:05,821 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:06:05,822 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:06:05,824 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:06:05,826 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:06:05,826 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:06:05,826 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:06:05,827 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:05,827 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:05,837 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:06:05,837 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:06:05,838 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:06:05,838 - main - INFO - 
2025-11-19 15:06:05,838 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:06:05,838 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:06:05,838 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:06:05,839 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:06:05,839 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:06:05,839 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:06:05,839 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:06:05,839 - main - INFO - 
2025-11-19 15:06:05,840 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:06:05,840 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:06:05,840 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:06:05,840 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:06:05,840 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:06:05,841 - main - INFO - 
2025-11-19 15:06:05,841 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:06:05,841 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:06:05,841 - main - INFO -        - No manual section generation
2025-11-19 15:06:05,841 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:06:05,842 - main - INFO - 
2025-11-19 15:06:05,842 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:06:05,842 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:06:05,842 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:06:05,842 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:06:05,843 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:06:05,843 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:06:05,843 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:06:05,843 - main - INFO - 
2025-11-19 15:06:05,843 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:06:05,844 - main - INFO -      Main:
2025-11-19 15:06:05,844 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:06:05,844 - main - INFO - 
2025-11-19 15:06:05,844 - main - INFO -      Retrieval:
2025-11-19 15:06:05,844 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:06:05,845 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:06:05,845 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:06:05,846 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:06:05,847 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:06:05,847 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:06:05,848 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:06:05,848 - main - INFO - 
2025-11-19 15:06:05,848 - main - INFO -      Management:
2025-11-19 15:06:05,848 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:06:05,849 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:06:05,849 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:06:05,849 - main - INFO - 
2025-11-19 15:06:05,849 - main - INFO -      Documents (MongoDB):
2025-11-19 15:06:05,850 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:06:05,850 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:06:05,850 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:06:05,850 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:06:05,851 - main - INFO - 
2025-11-19 15:06:05,852 - main - INFO -      Diagnostics & Health:
2025-11-19 15:06:05,852 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:06:05,852 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:06:05,852 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:06:05,853 - main - INFO - 
2025-11-19 15:06:05,853 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:06:05,853 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:06:05,853 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:06:05,854 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:06:05,854 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:06:05,854 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:06:05,854 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:06:05,854 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:06:05,854 - main - INFO - 
2025-11-19 15:06:05,855 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:06:05,855 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:06:05,855 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:06:05,855 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:06:05,855 - main - INFO -      4. No re-upload needed!
2025-11-19 15:06:05,856 - main - INFO - 
2025-11-19 15:06:05,856 - main - INFO - ================================================================================
2025-11-19 15:06:05,856 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:06:05,856 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:06:05,856 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:06:05,856 - main - INFO - ================================================================================
2025-11-19 15:06:05,857 - main - INFO - 
2025-11-19 15:06:05,857 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:06:22,930 - main - INFO - 
2025-11-19 15:06:22,934 - main - INFO - ================================================================================
2025-11-19 15:06:22,935 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:06:22,936 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:22,937 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:06:22,941 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:22,942 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:06:22,943 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:06:22,944 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:06:22,944 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:06:22,945 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:06:22,945 - main - INFO - ================================================================================
2025-11-19 15:06:22,946 - main - INFO - 
2025-11-19 15:06:27,392 - main - INFO - 
2025-11-19 15:06:27,393 - main - INFO - ================================================================================
2025-11-19 15:06:27,393 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:06:27,393 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:06:27,393 - main - INFO - ================================================================================
2025-11-19 15:06:27,393 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:06:27,394 - main - INFO -   Upload Directory: uploads
2025-11-19 15:06:27,394 - main - INFO -   Max File Size: 20MB
2025-11-19 15:06:27,394 - main - INFO - ================================================================================
2025-11-19 15:06:27,394 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:06:27,395 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:06:27,396 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:06:27,444 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:06:27,455 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:06:27,455 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:06:27,456 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:06:27,456 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:06:27,456 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:06:27,456 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:27,457 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:27,468 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:06:27,470 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:06:27,471 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:06:27,473 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:06:27,473 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:06:27,473 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:06:27,473 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:27,473 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:27,483 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:06:27,485 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:06:27,485 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:06:27,485 - main - INFO - 
2025-11-19 15:06:27,485 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:06:27,486 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:06:27,486 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:06:27,486 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:06:27,486 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:06:27,486 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:06:27,487 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:06:27,487 - main - INFO - 
2025-11-19 15:06:27,487 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:06:27,487 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:06:27,487 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:06:27,487 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:06:27,488 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:06:27,488 - main - INFO - 
2025-11-19 15:06:27,488 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:06:27,488 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:06:27,488 - main - INFO -        - No manual section generation
2025-11-19 15:06:27,488 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:06:27,488 - main - INFO - 
2025-11-19 15:06:27,489 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:06:27,489 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:06:27,489 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:06:27,489 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:06:27,489 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:06:27,489 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:06:27,489 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:06:27,490 - main - INFO - 
2025-11-19 15:06:27,490 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:06:27,490 - main - INFO -      Main:
2025-11-19 15:06:27,490 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:06:27,490 - main - INFO - 
2025-11-19 15:06:27,491 - main - INFO -      Retrieval:
2025-11-19 15:06:27,491 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:06:27,491 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:06:27,491 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:06:27,491 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:06:27,491 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:06:27,492 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:06:27,492 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:06:27,492 - main - INFO - 
2025-11-19 15:06:27,492 - main - INFO -      Management:
2025-11-19 15:06:27,492 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:06:27,492 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:06:27,492 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:06:27,493 - main - INFO - 
2025-11-19 15:06:27,493 - main - INFO -      Documents (MongoDB):
2025-11-19 15:06:27,493 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:06:27,493 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:06:27,493 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:06:27,493 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:06:27,493 - main - INFO - 
2025-11-19 15:06:27,493 - main - INFO -      Diagnostics & Health:
2025-11-19 15:06:27,494 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:06:27,494 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:06:27,494 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:06:27,494 - main - INFO - 
2025-11-19 15:06:27,494 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:06:27,495 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:06:27,495 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:06:27,496 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:06:27,497 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:06:27,498 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:06:27,498 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:06:27,498 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:06:27,499 - main - INFO - 
2025-11-19 15:06:27,499 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:06:27,499 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:06:27,499 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:06:27,499 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:06:27,499 - main - INFO -      4. No re-upload needed!
2025-11-19 15:06:27,500 - main - INFO - 
2025-11-19 15:06:27,500 - main - INFO - ================================================================================
2025-11-19 15:06:27,501 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:06:27,501 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:06:27,501 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:06:27,502 - main - INFO - ================================================================================
2025-11-19 15:06:27,502 - main - INFO - 
2025-11-19 15:06:27,502 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:06:34,888 - main - INFO - 
2025-11-19 15:06:34,888 - main - INFO - ================================================================================
2025-11-19 15:06:34,889 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:06:34,891 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:34,891 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:06:34,892 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:34,893 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:06:34,894 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:06:34,894 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:06:34,895 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:06:34,895 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:06:34,895 - main - INFO - ================================================================================
2025-11-19 15:06:34,896 - main - INFO - 
2025-11-19 15:06:38,822 - main - INFO - 
2025-11-19 15:06:38,823 - main - INFO - ================================================================================
2025-11-19 15:06:38,823 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:06:38,823 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:06:38,823 - main - INFO - ================================================================================
2025-11-19 15:06:38,823 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:06:38,824 - main - INFO -   Upload Directory: uploads
2025-11-19 15:06:38,824 - main - INFO -   Max File Size: 20MB
2025-11-19 15:06:38,824 - main - INFO - ================================================================================
2025-11-19 15:06:38,824 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:06:38,825 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:06:38,825 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:06:38,859 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:06:38,867 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:06:38,868 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:06:38,869 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:06:38,869 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:06:38,869 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:06:38,869 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:38,869 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:38,892 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:06:38,894 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:06:38,896 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:06:38,899 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:06:38,900 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:06:38,901 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:06:38,903 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:38,903 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:38,936 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:06:38,936 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:06:38,937 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:06:38,937 - main - INFO - 
2025-11-19 15:06:38,937 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:06:38,937 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:06:38,938 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:06:38,938 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:06:38,938 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:06:38,938 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:06:38,938 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:06:38,938 - main - INFO - 
2025-11-19 15:06:38,939 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:06:38,939 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:06:38,939 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:06:38,939 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:06:38,939 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:06:38,939 - main - INFO - 
2025-11-19 15:06:38,939 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:06:38,940 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:06:38,940 - main - INFO -        - No manual section generation
2025-11-19 15:06:38,940 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:06:38,940 - main - INFO - 
2025-11-19 15:06:38,940 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:06:38,940 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:06:38,940 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:06:38,941 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:06:38,941 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:06:38,941 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:06:38,941 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:06:38,941 - main - INFO - 
2025-11-19 15:06:38,941 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:06:38,942 - main - INFO -      Main:
2025-11-19 15:06:38,942 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:06:38,942 - main - INFO - 
2025-11-19 15:06:38,942 - main - INFO -      Retrieval:
2025-11-19 15:06:38,942 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:06:38,942 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:06:38,942 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:06:38,943 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:06:38,943 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:06:38,943 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:06:38,943 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:06:38,943 - main - INFO - 
2025-11-19 15:06:38,943 - main - INFO -      Management:
2025-11-19 15:06:38,943 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:06:38,944 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:06:38,944 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:06:38,944 - main - INFO - 
2025-11-19 15:06:38,944 - main - INFO -      Documents (MongoDB):
2025-11-19 15:06:38,944 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:06:38,944 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:06:38,945 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:06:38,945 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:06:38,945 - main - INFO - 
2025-11-19 15:06:38,945 - main - INFO -      Diagnostics & Health:
2025-11-19 15:06:38,945 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:06:38,946 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:06:38,946 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:06:38,946 - main - INFO - 
2025-11-19 15:06:38,946 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:06:38,946 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:06:38,947 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:06:38,947 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:06:38,947 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:06:38,947 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:06:38,948 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:06:38,949 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:06:38,950 - main - INFO - 
2025-11-19 15:06:38,951 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:06:38,952 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:06:38,952 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:06:38,952 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:06:38,952 - main - INFO -      4. No re-upload needed!
2025-11-19 15:06:38,952 - main - INFO - 
2025-11-19 15:06:38,953 - main - INFO - ================================================================================
2025-11-19 15:06:38,953 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:06:38,953 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:06:38,954 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:06:38,954 - main - INFO - ================================================================================
2025-11-19 15:06:38,954 - main - INFO - 
2025-11-19 15:06:38,954 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:06:45,111 - main - INFO - 
2025-11-19 15:06:45,112 - main - INFO - ================================================================================
2025-11-19 15:06:45,112 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:06:45,113 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:45,113 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:06:45,114 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:45,114 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:06:45,115 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:06:45,116 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:06:45,116 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:06:45,117 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:06:45,117 - main - INFO - ================================================================================
2025-11-19 15:06:45,117 - main - INFO - 
2025-11-19 15:06:49,653 - main - INFO - 
2025-11-19 15:06:49,654 - main - INFO - ================================================================================
2025-11-19 15:06:49,654 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:06:49,654 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:06:49,654 - main - INFO - ================================================================================
2025-11-19 15:06:49,655 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:06:49,655 - main - INFO -   Upload Directory: uploads
2025-11-19 15:06:49,655 - main - INFO -   Max File Size: 20MB
2025-11-19 15:06:49,655 - main - INFO - ================================================================================
2025-11-19 15:06:49,656 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:06:49,656 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:06:49,656 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:06:49,702 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:06:49,707 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:06:49,707 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:06:49,707 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:06:49,707 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:06:49,708 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:06:49,708 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:49,708 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:49,720 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:06:49,721 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:06:49,721 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:06:49,723 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:06:49,723 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:06:49,724 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:06:49,724 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:49,724 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:49,750 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:06:49,750 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:06:49,750 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:06:49,751 - main - INFO - 
2025-11-19 15:06:49,752 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:06:49,752 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:06:49,752 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:06:49,752 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:06:49,753 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:06:49,753 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:06:49,753 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:06:49,753 - main - INFO - 
2025-11-19 15:06:49,753 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:06:49,754 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:06:49,754 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:06:49,754 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:06:49,754 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:06:49,754 - main - INFO - 
2025-11-19 15:06:49,754 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:06:49,755 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:06:49,755 - main - INFO -        - No manual section generation
2025-11-19 15:06:49,755 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:06:49,755 - main - INFO - 
2025-11-19 15:06:49,755 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:06:49,755 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:06:49,756 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:06:49,756 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:06:49,756 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:06:49,756 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:06:49,756 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:06:49,756 - main - INFO - 
2025-11-19 15:06:49,757 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:06:49,757 - main - INFO -      Main:
2025-11-19 15:06:49,757 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:06:49,757 - main - INFO - 
2025-11-19 15:06:49,757 - main - INFO -      Retrieval:
2025-11-19 15:06:49,757 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:06:49,757 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:06:49,758 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:06:49,758 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:06:49,758 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:06:49,758 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:06:49,758 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:06:49,758 - main - INFO - 
2025-11-19 15:06:49,759 - main - INFO -      Management:
2025-11-19 15:06:49,759 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:06:49,759 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:06:49,759 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:06:49,759 - main - INFO - 
2025-11-19 15:06:49,759 - main - INFO -      Documents (MongoDB):
2025-11-19 15:06:49,760 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:06:49,760 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:06:49,760 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:06:49,760 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:06:49,760 - main - INFO - 
2025-11-19 15:06:49,760 - main - INFO -      Diagnostics & Health:
2025-11-19 15:06:49,760 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:06:49,761 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:06:49,761 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:06:49,761 - main - INFO - 
2025-11-19 15:06:49,762 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:06:49,762 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:06:49,763 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:06:49,764 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:06:49,764 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:06:49,764 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:06:49,765 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:06:49,765 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:06:49,765 - main - INFO - 
2025-11-19 15:06:49,765 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:06:49,766 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:06:49,766 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:06:49,766 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:06:49,766 - main - INFO -      4. No re-upload needed!
2025-11-19 15:06:49,767 - main - INFO - 
2025-11-19 15:06:49,767 - main - INFO - ================================================================================
2025-11-19 15:06:49,768 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:06:49,768 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:06:49,768 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:06:49,768 - main - INFO - ================================================================================
2025-11-19 15:06:49,768 - main - INFO - 
2025-11-19 15:06:49,769 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:06:52,973 - main - INFO - 
2025-11-19 15:06:52,973 - main - INFO - ================================================================================
2025-11-19 15:06:52,973 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:06:52,973 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:06:52,973 - main - INFO - ================================================================================
2025-11-19 15:06:52,974 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:06:52,974 - main - INFO -   Upload Directory: uploads
2025-11-19 15:06:52,974 - main - INFO -   Max File Size: 20MB
2025-11-19 15:06:52,974 - main - INFO - ================================================================================
2025-11-19 15:06:52,974 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:06:52,975 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:06:52,975 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:06:53,014 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:06:53,023 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:06:53,023 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:06:53,023 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:06:53,024 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:06:53,024 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:06:53,024 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:53,025 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:53,049 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:06:53,051 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:06:53,053 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:06:53,056 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:06:53,056 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:06:53,057 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:06:53,057 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:06:53,058 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:06:53,090 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:06:53,090 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:06:53,090 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:06:53,090 - main - INFO - 
2025-11-19 15:06:53,091 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:06:53,091 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:06:53,091 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:06:53,091 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:06:53,092 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:06:53,092 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:06:53,092 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:06:53,092 - main - INFO - 
2025-11-19 15:06:53,092 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:06:53,092 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:06:53,093 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:06:53,093 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:06:53,093 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:06:53,093 - main - INFO - 
2025-11-19 15:06:53,093 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:06:53,093 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:06:53,093 - main - INFO -        - No manual section generation
2025-11-19 15:06:53,094 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:06:53,094 - main - INFO - 
2025-11-19 15:06:53,094 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:06:53,094 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:06:53,094 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:06:53,095 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:06:53,095 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:06:53,095 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:06:53,096 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:06:53,096 - main - INFO - 
2025-11-19 15:06:53,097 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:06:53,097 - main - INFO -      Main:
2025-11-19 15:06:53,097 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:06:53,097 - main - INFO - 
2025-11-19 15:06:53,098 - main - INFO -      Retrieval:
2025-11-19 15:06:53,098 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:06:53,098 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:06:53,098 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:06:53,098 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:06:53,098 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:06:53,098 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:06:53,099 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:06:53,099 - main - INFO - 
2025-11-19 15:06:53,099 - main - INFO -      Management:
2025-11-19 15:06:53,099 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:06:53,099 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:06:53,100 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:06:53,100 - main - INFO - 
2025-11-19 15:06:53,100 - main - INFO -      Documents (MongoDB):
2025-11-19 15:06:53,100 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:06:53,100 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:06:53,101 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:06:53,101 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:06:53,101 - main - INFO - 
2025-11-19 15:06:53,101 - main - INFO -      Diagnostics & Health:
2025-11-19 15:06:53,101 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:06:53,102 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:06:53,102 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:06:53,102 - main - INFO - 
2025-11-19 15:06:53,102 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:06:53,102 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:06:53,103 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:06:53,103 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:06:53,103 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:06:53,103 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:06:53,104 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:06:53,104 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:06:53,104 - main - INFO - 
2025-11-19 15:06:53,104 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:06:53,105 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:06:53,105 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:06:53,105 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:06:53,105 - main - INFO -      4. No re-upload needed!
2025-11-19 15:06:53,105 - main - INFO - 
2025-11-19 15:06:53,106 - main - INFO - ================================================================================
2025-11-19 15:06:53,106 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:06:53,106 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:06:53,106 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:06:53,106 - main - INFO - ================================================================================
2025-11-19 15:06:53,107 - main - INFO - 
2025-11-19 15:06:53,107 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:06:59,589 - main - INFO - 
2025-11-19 15:06:59,590 - main - INFO - ================================================================================
2025-11-19 15:06:59,590 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:06:59,591 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:59,591 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:06:59,592 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:06:59,592 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:06:59,593 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:06:59,593 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:06:59,594 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:06:59,594 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:06:59,594 - main - INFO - ================================================================================
2025-11-19 15:06:59,594 - main - INFO - 
2025-11-19 15:07:02,568 - main - INFO - 
2025-11-19 15:07:02,568 - main - INFO - ================================================================================
2025-11-19 15:07:02,568 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:07:02,568 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:07:02,569 - main - INFO - ================================================================================
2025-11-19 15:07:02,569 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:07:02,569 - main - INFO -   Upload Directory: uploads
2025-11-19 15:07:02,569 - main - INFO -   Max File Size: 20MB
2025-11-19 15:07:02,569 - main - INFO - ================================================================================
2025-11-19 15:07:02,569 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:07:02,570 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:07:02,570 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:07:02,605 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:07:02,609 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:07:02,609 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:07:02,610 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:07:02,610 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:07:02,610 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:07:02,610 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:07:02,611 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:07:02,619 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:07:02,622 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:07:02,623 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:07:02,625 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:07:02,625 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:07:02,625 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:07:02,625 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:07:02,626 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:07:02,632 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:07:02,632 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:07:02,632 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:07:02,633 - main - INFO - 
2025-11-19 15:07:02,633 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:07:02,633 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:07:02,633 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:07:02,634 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:07:02,634 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:07:02,634 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:07:02,634 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:07:02,634 - main - INFO - 
2025-11-19 15:07:02,635 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:07:02,635 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:07:02,635 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:07:02,635 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:07:02,635 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:07:02,636 - main - INFO - 
2025-11-19 15:07:02,636 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:07:02,636 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:07:02,636 - main - INFO -        - No manual section generation
2025-11-19 15:07:02,637 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:07:02,637 - main - INFO - 
2025-11-19 15:07:02,637 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:07:02,638 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:07:02,638 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:07:02,638 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:07:02,639 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:07:02,639 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:07:02,639 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:07:02,639 - main - INFO - 
2025-11-19 15:07:02,640 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:07:02,640 - main - INFO -      Main:
2025-11-19 15:07:02,640 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:07:02,640 - main - INFO - 
2025-11-19 15:07:02,640 - main - INFO -      Retrieval:
2025-11-19 15:07:02,640 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:07:02,640 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:07:02,641 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:07:02,641 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:07:02,641 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:07:02,641 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:07:02,641 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:07:02,641 - main - INFO - 
2025-11-19 15:07:02,642 - main - INFO -      Management:
2025-11-19 15:07:02,642 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:07:02,642 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:07:02,642 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:07:02,642 - main - INFO - 
2025-11-19 15:07:02,642 - main - INFO -      Documents (MongoDB):
2025-11-19 15:07:02,642 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:07:02,643 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:07:02,643 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:07:02,643 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:07:02,643 - main - INFO - 
2025-11-19 15:07:02,643 - main - INFO -      Diagnostics & Health:
2025-11-19 15:07:02,643 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:07:02,643 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:07:02,644 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:07:02,644 - main - INFO - 
2025-11-19 15:07:02,644 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:07:02,644 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:07:02,644 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:07:02,644 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:07:02,645 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:07:02,645 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:07:02,645 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:07:02,645 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:07:02,645 - main - INFO - 
2025-11-19 15:07:02,645 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:07:02,646 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:07:02,646 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:07:02,646 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:07:02,646 - main - INFO -      4. No re-upload needed!
2025-11-19 15:07:02,646 - main - INFO - 
2025-11-19 15:07:02,646 - main - INFO - ================================================================================
2025-11-19 15:07:02,647 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:07:02,647 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:07:02,647 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:07:02,647 - main - INFO - ================================================================================
2025-11-19 15:07:02,647 - main - INFO - 
2025-11-19 15:07:02,647 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:07:05,165 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 15:07:05,167 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 15:07:05,319 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 15:07:05,334 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.02s
2025-11-19 15:07:34,748 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 15:07:34,755 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 15:07:34,755 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:07:34,755 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:07:34,756 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:07:34,757 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:07:34,760 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 15:07:34,760 - app.api.routes - INFO -    - Remaining comparisons: 232
2025-11-19 15:07:34,761 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 15:07:34,763 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 15:07:34,765 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763564854_f9326fa5d808
2025-11-19 15:07:34,766 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_1c6bfa0ccaf9 (3 files)
2025-11-19 15:07:34,767 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_1c6bfa0ccaf9
2025-11-19 15:07:34,768 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:07:34,768 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:07:34,768 - app.api.routes - INFO - ======================================================================
2025-11-19 15:07:34,770 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ fca34ee60c5948ccbdc2430b348cf813.pdf (464206 bytes)
2025-11-19 15:07:34,771 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:07:34,771 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\fca34ee60c5948ccbdc2430b348cf813.pdf
2025-11-19 15:07:34,772 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:07:34,792 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:07:34,810 - app.api.routes - INFO - ======================================================================
2025-11-19 15:07:34,811 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 6c607ec9347c4cc292b8f7de353eb6f4.pdf (175401 bytes)
2025-11-19 15:07:34,840 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 15:07:34,840 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:07:34,841 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:07:34,841 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:07:34,841 - app.api.routes - INFO - ======================================================================
2025-11-19 15:07:34,841 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6c607ec9347c4cc292b8f7de353eb6f4.pdf
2025-11-19 15:07:34,880 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ e3c2815a1ccc41dfbf0f59cc35e47a2d.pdf (331157 bytes)
2025-11-19 15:07:34,892 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 15:07:34,893 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:07:34,893 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e3c2815a1ccc41dfbf0f59cc35e47a2d.pdf
2025-11-19 15:07:34,894 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:07:34,927 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:07:34,951 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 15:07:34,953 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 15:07:34,955 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 15:07:34,955 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:07:34,955 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:07:34,955 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 15:07:35,113 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 15:07:35,113 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:07:35,496 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:07:35,497 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:07:35,497 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 15:07:35,497 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 15:07:35,498 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:07:35,498 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:07:35,498 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 15:07:35,598 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 15:07:35,600 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:07:35,603 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:07:35,604 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:07:35,605 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 15:07:35,605 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 15:07:35,605 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 15:07:35,606 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:07:35,606 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 15:07:35,716 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 15:07:35,716 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:08:09,988 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:10,006 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:08:10,007 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:08:10,007 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:08:10,008 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 15:08:10,008 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:08:10,008 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 15:08:10,014 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 15:08:10,015 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 15:08:10,015 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:08:18,345 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:18,355 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:08:18,356 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:08:18,357 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 15:08:18,357 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 15:08:18,358 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:08:18,358 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:08:18,358 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 15:08:18,498 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:18,502 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:08:18,503 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:08:18,503 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:08:18,504 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-19 15:08:18,511 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 60 benefits from patterns
2025-11-19 15:08:18,512 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 58 total
2025-11-19 15:08:18,512 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:08:25,638 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:25,639 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:08:25,639 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:08:25,640 - app.services.ai_parser - INFO - 
2025-11-19 15:08:25,640 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:25,640 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:08:25,640 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:25,641 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 15:08:25,641 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:08:25,641 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 15:08:25,641 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 15:08:25,641 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:08:25,642 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:08:25,642 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:08:25,642 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:08:25,642 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:08:25,642 - app.services.ai_parser - INFO - 
2025-11-19 15:08:25,642 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:08:25,643 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 15:08:25,643 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 15:08:25,643 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 15:08:25,643 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:08:25,643 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:08:25,644 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:25,645 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: fca34ee60c5948ccbdc2430b348cf813.pdf â†’ 691ddd6995751f886dbc1851
2025-11-19 15:08:25,645 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddd6995751f886dbc1851
2025-11-19 15:08:25,648 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddd6995751f886dbc1852 (464206 bytes)
2025-11-19 15:08:25,648 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddd6995751f886dbc1852
2025-11-19 15:08:25,648 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:08:27,318 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:27,322 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:08:27,322 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:08:27,323 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 15:08:27,324 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 15:08:27,325 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:08:27,325 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:08:27,326 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:08:27,327 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-19 15:08:27,328 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:08:27,329 - app.services.ai_parser - INFO - ðŸ“Š Counts: 58 benefits, 29 exclusions, 8 warranties, 5 extensions
2025-11-19 15:08:35,101 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:35,105 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:08:35,106 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:08:35,107 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:08:35,107 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:08:37,157 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:37,180 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:08:37,181 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:08:37,182 - app.services.ai_parser - INFO - 
2025-11-19 15:08:37,183 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:37,184 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:08:37,184 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:37,185 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 15:08:37,186 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:08:37,186 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 500,000.00
2025-11-19 15:08:37,187 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 15:08:37,188 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:08:37,189 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:08:37,189 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-19 15:08:37,190 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:08:37,191 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:08:37,191 - app.services.ai_parser - INFO - 
2025-11-19 15:08:37,192 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:08:37,193 - app.services.ai_parser - INFO -    âœ“ Benefits: 58
2025-11-19 15:08:37,193 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 15:08:37,194 - app.services.ai_parser - INFO -    âœ“ Warranties: 8
2025-11-19 15:08:37,195 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:08:37,195 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:08:37,196 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:37,199 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6c607ec9347c4cc292b8f7de353eb6f4.pdf â†’ 691ddd7595751f886dbc1853
2025-11-19 15:08:37,200 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddd7595751f886dbc1853
2025-11-19 15:08:37,202 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691ddd7595751f886dbc1854 (175401 bytes)
2025-11-19 15:08:37,202 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691ddd7595751f886dbc1854
2025-11-19 15:08:37,202 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:08:42,393 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:42,396 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:08:42,396 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:08:42,397 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 15:08:42,398 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 15:08:42,399 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:08:42,399 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:08:42,400 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:08:42,401 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:08:42,402 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:08:42,402 - app.services.ai_parser - INFO - ðŸ“Š Counts: 17 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 15:08:48,985 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:08:48,999 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 15:08:48,999 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:08:49,000 - app.services.ai_parser - INFO - 
2025-11-19 15:08:49,001 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:49,002 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:08:49,003 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:49,003 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 15:08:49,004 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 15:08:49,004 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 15:08:49,004 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 15:08:49,004 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 15:08:49,005 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:08:49,005 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:08:49,005 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 15:08:49,006 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 15:08:49,006 - app.services.ai_parser - INFO - 
2025-11-19 15:08:49,006 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:08:49,006 - app.services.ai_parser - INFO -    âœ“ Benefits: 17
2025-11-19 15:08:49,006 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 15:08:49,007 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 15:08:49,007 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:08:49,007 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:08:49,008 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:08:49,011 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e3c2815a1ccc41dfbf0f59cc35e47a2d.pdf â†’ 691ddd8195751f886dbc1855
2025-11-19 15:08:49,011 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddd8195751f886dbc1855
2025-11-19 15:08:49,015 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691ddd8195751f886dbc1856 (331157 bytes)
2025-11-19 15:08:49,015 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691ddd8195751f886dbc1856
2025-11-19 15:08:49,015 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:08:49,016 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 15:08:49,016 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:08:49,016 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 15:08:49,017 - app.api.routes - INFO - ======================================================================
2025-11-19 15:08:49,017 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 15:08:49,017 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 15:08:49,018 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 15:08:49,018 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:08:49,019 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-19 15:08:49,019 - app.services.ai_ranker - INFO - ================================================================================
2025-11-19 15:08:49,019 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-19 15:08:49,020 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-19 15:08:49,020 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:08:49,020 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-19 15:08:49,020 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:08:49,020 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-19 15:08:49,021 - app.services.ai_ranker - INFO -    Warranties: 8
2025-11-19 15:08:49,021 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:08:49,021 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-19 15:08:49,021 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:08:49,021 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-19 15:08:49,022 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-19 15:08:49,022 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:08:49,022 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-19 15:08:49,022 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:08:49,022 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-19 15:08:49,276 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-19 15:08:49,276 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:08:49,276 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:08:49,277 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:08:49,277 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:08:49,277 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-19 15:08:49,277 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-19 15:08:49,278 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-19 15:08:49,528 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:08:49,529 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:08:49,529 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:08:49,529 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:08:49,529 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:08:49,530 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-19 15:08:49,530 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-19 15:08:49,801 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:08:49,801 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:08:49,801 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 7
2025-11-19 15:08:49,802 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:08:49,802 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:08:49,802 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-19 15:08:49,802 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:08:49,802 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-19 15:08:49,803 - app.services.ai_ranker - INFO - ================================================================================

2025-11-19 15:08:49,803 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=83.17
2025-11-19 15:08:49,803 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.74
2025-11-19 15:08:49,804 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=79.61
2025-11-19 15:08:49,804 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 15:08:49,804 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 15:09:06,768 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:09:06,778 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 15:09:06,779 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 15:09:06,779 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 15:09:06,781 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 15:09:06,781 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 15:09:06,781 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763564854_f9326fa5d808
2025-11-19 15:09:06,781 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 15:09:06,782 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 15:09:06,782 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 15:09:06,782 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 15:09:06,782 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:09:06,783 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:09:06,783 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:09:06,783 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:09:06,783 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:09:06,783 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:09:06,784 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-19 15:09:06,784 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:09:06,784 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:09:06,784 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:09:06,784 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:09:06,785 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:09:06,785 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:09:06,787 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 15:09:06,787 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,150 bytes
2025-11-19 15:09:06,787 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 28,302 bytes
2025-11-19 15:09:06,788 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,023 bytes
2025-11-19 15:09:06,788 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,737 bytes
2025-11-19 15:09:06,788 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 46,990 bytes
2025-11-19 15:09:06,788 - app.services.mongodb_service_enhanced - INFO -    Total document: 193,772 bytes
2025-11-19 15:09:06,788 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 15:09:06,789 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 15:09:06,789 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 15:09:06,789 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 15:09:06,789 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 15:09:06,789 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 15:09:06,789 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 15:09:06,790 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 15:09:06,791 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 15:09:06,791 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 15:09:06,791 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 15:09:06,791 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:09:06,791 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:09:06,792 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 15:09:06,795 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763564854_f9326fa5d808
2025-11-19 15:09:06,795 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691ddd92b8ed226b2b31fea8
2025-11-19 15:09:06,797 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 15:09:06,797 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 15:09:06,798 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 15:09:06,798 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 15:09:06,798 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 15:09:06,798 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 15:09:06,799 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 15:09:06,799 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 15:09:06,799 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 15:09:06,799 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 15:09:06,800 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 15:09:06,800 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 15:09:06,800 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:09:06,801 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 15:09:06,801 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 15:09:06,801 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 15:09:06,801 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 15:09:06,802 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 15:09:06,802 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:09:06,802 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691ddd92b8ed226b2b31fea8
2025-11-19 15:09:06,803 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 15:09:06,803 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 15:09:06,804 - app.api.routes - INFO -    Comparison ID: cmp_1763564854_f9326fa5d808
2025-11-19 15:09:06,806 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:09:06,806 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:09:06,806 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:09:06,807 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 15:09:06,807 - app.api.routes - INFO - ======================================================================
2025-11-19 15:09:06,807 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763564854_f9326fa5d808
2025-11-19 15:09:06,807 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 15:09:06,807 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 15:09:06,807 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 15:09:06,808 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:09:06,808 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:09:06,808 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:09:06,809 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:09:06,809 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 231
2025-11-19 15:09:06,810 - app.api.routes - INFO - ======================================================================

2025-11-19 15:09:06,810 - app.services.progress_tracker - INFO - âœ… Job completed: job_1c6bfa0ccaf9 â†’ comparison_id: cmp_1763564854_f9326fa5d808
2025-11-19 15:09:06,811 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 92.06s
2025-11-19 15:11:49,459 - main - INFO - 
2025-11-19 15:11:49,460 - main - INFO - ================================================================================
2025-11-19 15:11:49,460 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:11:49,461 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:11:49,463 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:11:49,466 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:11:49,466 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:11:49,467 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:11:49,468 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:11:49,471 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-19 15:11:49,472 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:11:49,473 - main - INFO - ================================================================================
2025-11-19 15:11:49,473 - main - INFO - 
2025-11-19 15:11:53,289 - main - INFO - 
2025-11-19 15:11:53,289 - main - INFO - ================================================================================
2025-11-19 15:11:53,289 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:11:53,290 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:11:53,290 - main - INFO - ================================================================================
2025-11-19 15:11:53,290 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:11:53,290 - main - INFO -   Upload Directory: uploads
2025-11-19 15:11:53,290 - main - INFO -   Max File Size: 20MB
2025-11-19 15:11:53,291 - main - INFO - ================================================================================
2025-11-19 15:11:53,291 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:11:53,291 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:11:53,292 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:11:53,336 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:11:53,347 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:11:53,347 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:11:53,348 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:11:53,348 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:11:53,348 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:11:53,349 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:11:53,349 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:11:53,378 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:11:53,379 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:11:53,381 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:11:53,383 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:11:53,383 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:11:53,384 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:11:53,384 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:11:53,385 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:11:53,418 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:11:53,423 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:11:53,424 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:11:53,434 - main - INFO - 
2025-11-19 15:11:53,434 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:11:53,438 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:11:53,442 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:11:53,442 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:11:53,451 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:11:53,455 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:11:53,468 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:11:53,471 - main - INFO - 
2025-11-19 15:11:53,474 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:11:53,475 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:11:53,484 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:11:53,484 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:11:53,485 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:11:53,486 - main - INFO - 
2025-11-19 15:11:53,486 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:11:53,486 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:11:53,486 - main - INFO -        - No manual section generation
2025-11-19 15:11:53,487 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:11:53,487 - main - INFO - 
2025-11-19 15:11:53,487 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:11:53,487 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:11:53,488 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:11:53,488 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:11:53,488 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:11:53,489 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:11:53,489 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:11:53,490 - main - INFO - 
2025-11-19 15:11:53,490 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:11:53,490 - main - INFO -      Main:
2025-11-19 15:11:53,490 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:11:53,491 - main - INFO - 
2025-11-19 15:11:53,491 - main - INFO -      Retrieval:
2025-11-19 15:11:53,491 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:11:53,491 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:11:53,491 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:11:53,492 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:11:53,492 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:11:53,492 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:11:53,492 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:11:53,492 - main - INFO - 
2025-11-19 15:11:53,493 - main - INFO -      Management:
2025-11-19 15:11:53,493 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:11:53,493 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:11:53,493 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:11:53,493 - main - INFO - 
2025-11-19 15:11:53,494 - main - INFO -      Documents (MongoDB):
2025-11-19 15:11:53,494 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:11:53,494 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:11:53,494 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:11:53,494 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:11:53,495 - main - INFO - 
2025-11-19 15:11:53,495 - main - INFO -      Diagnostics & Health:
2025-11-19 15:11:53,496 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:11:53,496 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:11:53,496 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:11:53,497 - main - INFO - 
2025-11-19 15:11:53,497 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:11:53,497 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:11:53,498 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:11:53,498 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:11:53,498 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:11:53,498 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:11:53,498 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:11:53,499 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:11:53,499 - main - INFO - 
2025-11-19 15:11:53,499 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:11:53,499 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:11:53,499 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:11:53,500 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:11:53,500 - main - INFO -      4. No re-upload needed!
2025-11-19 15:11:53,500 - main - INFO - 
2025-11-19 15:11:53,500 - main - INFO - ================================================================================
2025-11-19 15:11:53,500 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:11:53,501 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:11:53,501 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:11:53,501 - main - INFO - ================================================================================
2025-11-19 15:11:53,501 - main - INFO - 
2025-11-19 15:11:53,501 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:11:58,545 - main - INFO - 
2025-11-19 15:11:58,547 - main - INFO - ================================================================================
2025-11-19 15:11:58,549 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:11:58,552 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:11:58,552 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:11:58,553 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:11:58,554 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:11:58,555 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:11:58,556 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:11:58,556 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:11:58,557 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:11:58,558 - main - INFO - ================================================================================
2025-11-19 15:11:58,558 - main - INFO - 
2025-11-19 15:12:02,394 - main - INFO - 
2025-11-19 15:12:02,395 - main - INFO - ================================================================================
2025-11-19 15:12:02,395 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:12:02,395 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:12:02,395 - main - INFO - ================================================================================
2025-11-19 15:12:02,395 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:12:02,396 - main - INFO -   Upload Directory: uploads
2025-11-19 15:12:02,396 - main - INFO -   Max File Size: 20MB
2025-11-19 15:12:02,396 - main - INFO - ================================================================================
2025-11-19 15:12:02,396 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:12:02,397 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:12:02,397 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:12:02,421 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:12:02,425 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:12:02,425 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:12:02,426 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:12:02,426 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:12:02,426 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:12:02,426 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:12:02,426 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:12:02,437 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:12:02,438 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:12:02,439 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:12:02,440 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:12:02,440 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:12:02,441 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:12:02,441 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:12:02,441 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:12:02,466 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:12:02,468 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:12:02,469 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:12:02,470 - main - INFO - 
2025-11-19 15:12:02,471 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:12:02,471 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:12:02,471 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:12:02,472 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:12:02,472 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:12:02,472 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:12:02,473 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:12:02,473 - main - INFO - 
2025-11-19 15:12:02,473 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:12:02,474 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:12:02,474 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:12:02,474 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:12:02,474 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:12:02,475 - main - INFO - 
2025-11-19 15:12:02,475 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:12:02,475 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:12:02,475 - main - INFO -        - No manual section generation
2025-11-19 15:12:02,475 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:12:02,476 - main - INFO - 
2025-11-19 15:12:02,476 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:12:02,476 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:12:02,476 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:12:02,476 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:12:02,477 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:12:02,477 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:12:02,477 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:12:02,477 - main - INFO - 
2025-11-19 15:12:02,477 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:12:02,477 - main - INFO -      Main:
2025-11-19 15:12:02,477 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:12:02,478 - main - INFO - 
2025-11-19 15:12:02,478 - main - INFO -      Retrieval:
2025-11-19 15:12:02,478 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:12:02,478 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:12:02,478 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:12:02,479 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:12:02,479 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:12:02,479 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:12:02,479 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:12:02,479 - main - INFO - 
2025-11-19 15:12:02,480 - main - INFO -      Management:
2025-11-19 15:12:02,480 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:12:02,480 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:12:02,480 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:12:02,480 - main - INFO - 
2025-11-19 15:12:02,481 - main - INFO -      Documents (MongoDB):
2025-11-19 15:12:02,481 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:12:02,481 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:12:02,482 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:12:02,483 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:12:02,484 - main - INFO - 
2025-11-19 15:12:02,485 - main - INFO -      Diagnostics & Health:
2025-11-19 15:12:02,485 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:12:02,486 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:12:02,486 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:12:02,486 - main - INFO - 
2025-11-19 15:12:02,486 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:12:02,487 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:12:02,487 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:12:02,487 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:12:02,487 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:12:02,487 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:12:02,487 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:12:02,488 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:12:02,488 - main - INFO - 
2025-11-19 15:12:02,488 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:12:02,488 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:12:02,488 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:12:02,488 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:12:02,488 - main - INFO -      4. No re-upload needed!
2025-11-19 15:12:02,489 - main - INFO - 
2025-11-19 15:12:02,489 - main - INFO - ================================================================================
2025-11-19 15:12:02,489 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:12:02,489 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:12:02,489 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:12:02,490 - main - INFO - ================================================================================
2025-11-19 15:12:02,490 - main - INFO - 
2025-11-19 15:12:02,490 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:12:08,317 - main - INFO - 
2025-11-19 15:12:08,318 - main - INFO - ================================================================================
2025-11-19 15:12:08,318 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:12:08,320 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:12:08,320 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:12:08,321 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:12:08,322 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:12:08,324 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:12:08,325 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:12:08,326 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:12:08,326 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:12:08,326 - main - INFO - ================================================================================
2025-11-19 15:12:08,327 - main - INFO - 
2025-11-19 15:12:10,732 - main - INFO - 
2025-11-19 15:12:10,732 - main - INFO - ================================================================================
2025-11-19 15:12:10,732 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:12:10,732 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:12:10,733 - main - INFO - ================================================================================
2025-11-19 15:12:10,733 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:12:10,733 - main - INFO -   Upload Directory: uploads
2025-11-19 15:12:10,733 - main - INFO -   Max File Size: 20MB
2025-11-19 15:12:10,734 - main - INFO - ================================================================================
2025-11-19 15:12:10,734 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:12:10,734 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:12:10,734 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:12:10,750 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:12:10,754 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:12:10,754 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:12:10,755 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:12:10,755 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:12:10,755 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:12:10,755 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:12:10,756 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:12:10,761 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:12:10,763 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:12:10,764 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:12:10,766 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:12:10,767 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:12:10,767 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:12:10,768 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:12:10,768 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:12:10,800 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:12:10,801 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:12:10,802 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:12:10,802 - main - INFO - 
2025-11-19 15:12:10,802 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:12:10,803 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:12:10,803 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:12:10,804 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:12:10,804 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:12:10,804 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:12:10,805 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:12:10,806 - main - INFO - 
2025-11-19 15:12:10,806 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:12:10,807 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:12:10,807 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:12:10,808 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:12:10,808 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:12:10,808 - main - INFO - 
2025-11-19 15:12:10,809 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:12:10,809 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:12:10,809 - main - INFO -        - No manual section generation
2025-11-19 15:12:10,810 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:12:10,810 - main - INFO - 
2025-11-19 15:12:10,810 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:12:10,810 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:12:10,810 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:12:10,810 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:12:10,811 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:12:10,811 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:12:10,811 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:12:10,811 - main - INFO - 
2025-11-19 15:12:10,811 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:12:10,812 - main - INFO -      Main:
2025-11-19 15:12:10,812 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:12:10,812 - main - INFO - 
2025-11-19 15:12:10,813 - main - INFO -      Retrieval:
2025-11-19 15:12:10,813 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:12:10,813 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:12:10,814 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:12:10,814 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:12:10,814 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:12:10,814 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:12:10,815 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:12:10,815 - main - INFO - 
2025-11-19 15:12:10,815 - main - INFO -      Management:
2025-11-19 15:12:10,815 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:12:10,815 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:12:10,816 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:12:10,816 - main - INFO - 
2025-11-19 15:12:10,816 - main - INFO -      Documents (MongoDB):
2025-11-19 15:12:10,816 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:12:10,816 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:12:10,816 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:12:10,817 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:12:10,817 - main - INFO - 
2025-11-19 15:12:10,817 - main - INFO -      Diagnostics & Health:
2025-11-19 15:12:10,817 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:12:10,817 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:12:10,817 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:12:10,817 - main - INFO - 
2025-11-19 15:12:10,818 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:12:10,818 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:12:10,818 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:12:10,818 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:12:10,819 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:12:10,819 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:12:10,820 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:12:10,820 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:12:10,821 - main - INFO - 
2025-11-19 15:12:10,821 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:12:10,821 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:12:10,821 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:12:10,821 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:12:10,821 - main - INFO -      4. No re-upload needed!
2025-11-19 15:12:10,822 - main - INFO - 
2025-11-19 15:12:10,822 - main - INFO - ================================================================================
2025-11-19 15:12:10,822 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:12:10,822 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:12:10,822 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:12:10,822 - main - INFO - ================================================================================
2025-11-19 15:12:10,823 - main - INFO - 
2025-11-19 15:12:10,823 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:12:27,199 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 15:12:27,201 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 15:12:27,308 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 15:12:27,316 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-19 15:12:55,702 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 15:12:55,714 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 15:12:55,716 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:12:55,716 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:12:55,717 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:12:55,719 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:12:55,721 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 15:12:55,721 - app.api.routes - INFO -    - Remaining comparisons: 231
2025-11-19 15:12:55,722 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 15:12:55,722 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 15:12:55,722 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763565175_dfa60a465a65
2025-11-19 15:12:55,722 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_3cd686449561 (3 files)
2025-11-19 15:12:55,723 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_3cd686449561
2025-11-19 15:12:55,723 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:12:55,723 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:12:55,724 - app.api.routes - INFO - ======================================================================
2025-11-19 15:12:55,725 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ a655a2e9395445308490e59db128b317.pdf (464206 bytes)
2025-11-19 15:12:55,725 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:12:55,726 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a655a2e9395445308490e59db128b317.pdf
2025-11-19 15:12:55,726 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:12:55,749 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:12:55,767 - app.api.routes - INFO - ======================================================================
2025-11-19 15:12:55,768 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 9a12f8658465463189d45ceb92f1120f.pdf (175401 bytes)
2025-11-19 15:12:55,788 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:12:55,801 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 15:12:55,803 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\9a12f8658465463189d45ceb92f1120f.pdf
2025-11-19 15:12:55,804 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:12:55,838 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:12:55,854 - app.api.routes - INFO - ======================================================================
2025-11-19 15:12:55,857 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 15:12:55,858 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ c2037d5ca5894ba08a82789435cb718f.pdf (331157 bytes)
2025-11-19 15:12:55,858 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:12:55,859 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\c2037d5ca5894ba08a82789435cb718f.pdf
2025-11-19 15:12:55,859 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:12:55,859 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:12:55,915 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 15:12:55,918 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 15:12:55,918 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 15:12:55,919 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:12:55,919 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:12:55,919 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 15:12:56,084 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 15:12:56,084 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:12:56,423 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:12:56,424 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:12:56,424 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 15:12:56,424 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 15:12:56,425 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:12:56,425 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:12:56,425 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 15:12:56,506 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 15:12:56,506 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:12:56,507 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:12:56,508 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:12:56,508 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 15:12:56,508 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 15:12:56,509 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 15:12:56,509 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:12:56,509 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 15:12:56,607 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 15:12:56,607 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:13:25,359 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:13:25,370 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:13:25,371 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:13:25,371 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:13:25,371 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 15:13:25,372 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:13:25,372 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 15:13:25,377 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 15:13:25,377 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 15:13:25,377 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:13:33,242 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:13:33,275 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:13:33,275 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:13:33,275 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 15:13:33,275 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 15:13:33,276 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:13:33,276 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:13:33,276 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 15:13:41,401 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:13:41,412 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:13:41,413 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:13:41,413 - app.services.ai_parser - INFO - 
2025-11-19 15:13:41,414 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:13:41,415 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:13:41,416 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:13:41,416 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 15:13:41,417 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:13:41,418 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 15:13:41,419 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 15:13:41,419 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:13:41,420 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:13:41,421 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:13:41,422 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:13:41,422 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:13:41,423 - app.services.ai_parser - INFO - 
2025-11-19 15:13:41,424 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:13:41,426 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 15:13:41,427 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 15:13:41,428 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 15:13:41,429 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:13:41,430 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:13:41,430 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:13:41,434 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a655a2e9395445308490e59db128b317.pdf â†’ 691ddea58b52279376ddd6b6
2025-11-19 15:13:41,434 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddea58b52279376ddd6b6
2025-11-19 15:13:41,442 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddea58b52279376ddd6b7 (464206 bytes)
2025-11-19 15:13:41,442 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddea58b52279376ddd6b7
2025-11-19 15:13:41,443 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:13:57,355 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:13:57,360 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:13:57,361 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:13:57,361 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:13:57,362 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:14:03,782 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:14:03,785 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:14:03,785 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:14:03,786 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 15:14:03,786 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 15:14:03,787 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:14:03,787 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:14:03,788 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:14:03,789 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:14:03,789 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:14:03,790 - app.services.ai_parser - INFO - ðŸ“Š Counts: 17 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 15:14:14,203 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:14:14,204 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 15:14:14,204 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:14:14,204 - app.services.ai_parser - INFO - 
2025-11-19 15:14:14,205 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:14:14,205 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:14:14,205 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:14:14,205 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 15:14:14,206 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 15:14:14,206 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 15:14:14,206 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 15:14:14,206 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 15:14:14,207 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:14:14,207 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:14:14,207 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 15:14:14,207 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 15:14:14,207 - app.services.ai_parser - INFO - 
2025-11-19 15:14:14,208 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:14:14,208 - app.services.ai_parser - INFO -    âœ“ Benefits: 17
2025-11-19 15:14:14,208 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 15:14:14,208 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 15:14:14,208 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:14:14,208 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:14:14,209 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:14:14,210 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: c2037d5ca5894ba08a82789435cb718f.pdf â†’ 691ddec68b52279376ddd6b8
2025-11-19 15:14:14,210 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddec68b52279376ddd6b8
2025-11-19 15:14:14,212 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691ddec68b52279376ddd6b9 (331157 bytes)
2025-11-19 15:14:14,212 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691ddec68b52279376ddd6b9
2025-11-19 15:14:14,212 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:14:17,636 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:14:17,902 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:14:17,902 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:14:17,903 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:14:17,904 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:14:26,417 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:14:26,422 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:14:26,423 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:14:26,424 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 15:14:26,424 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 15:14:26,425 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:14:26,426 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:14:26,426 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:14:26,427 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:14:26,428 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:14:26,428 - app.services.ai_parser - INFO - ðŸ“Š Counts: 48 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-19 15:14:33,852 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:14:33,855 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:14:33,856 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:14:33,857 - app.services.ai_parser - INFO - 
2025-11-19 15:14:33,857 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:14:33,858 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:14:33,859 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:14:33,859 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 15:14:33,860 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:14:33,861 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-19 15:14:33,861 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 15:14:33,862 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:14:33,863 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:14:33,863 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:14:33,864 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:14:33,864 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:14:33,865 - app.services.ai_parser - INFO - 
2025-11-19 15:14:33,866 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:14:33,867 - app.services.ai_parser - INFO -    âœ“ Benefits: 48
2025-11-19 15:14:33,867 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 15:14:33,867 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-19 15:14:33,867 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:14:33,868 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:14:33,868 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:14:33,869 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 9a12f8658465463189d45ceb92f1120f.pdf â†’ 691dded98b52279376ddd6ba
2025-11-19 15:14:33,869 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691dded98b52279376ddd6ba
2025-11-19 15:14:33,874 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691dded98b52279376ddd6bb (175401 bytes)
2025-11-19 15:14:33,874 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691dded98b52279376ddd6bb
2025-11-19 15:14:33,874 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:14:33,875 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 15:14:33,875 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:14:33,875 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 15:14:33,875 - app.api.routes - INFO - ======================================================================
2025-11-19 15:14:33,875 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 15:14:33,876 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 15:14:33,876 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 15:14:33,876 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:14:33,876 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-19 15:14:33,876 - app.services.ai_ranker - INFO - ================================================================================
2025-11-19 15:14:33,877 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:14:33,877 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Tawuniya after all extraction methods
2025-11-19 15:14:33,877 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-19 15:14:33,877 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-19 15:14:33,877 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:14:33,877 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-19 15:14:33,878 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:14:33,878 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:14:33,878 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Liva Insurance after all extraction methods
2025-11-19 15:14:33,878 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-19 15:14:33,879 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-19 15:14:33,879 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:14:33,879 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-19 15:14:33,880 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:14:33,880 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:14:33,880 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Chubb Arabia after all extraction methods
2025-11-19 15:14:33,880 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-19 15:14:33,880 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-19 15:14:33,881 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:14:33,881 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-19 15:14:33,881 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:14:33,881 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-19 15:14:34,090 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-19 15:14:34,090 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:14:34,090 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:14:34,091 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:14:34,091 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:14:34,091 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-19 15:14:34,091 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-19 15:14:34,092 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-19 15:14:34,432 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:14:34,432 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:14:34,433 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 7
2025-11-19 15:14:34,433 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:14:34,433 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:14:34,433 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-19 15:14:34,434 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-19 15:14:34,752 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:14:34,753 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:14:34,753 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:14:34,753 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:14:34,753 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:14:34,753 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-19 15:14:34,754 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:14:34,754 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-19 15:14:34,754 - app.services.ai_ranker - INFO - ================================================================================

2025-11-19 15:14:34,754 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-19 15:14:34,755 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-19 15:14:34,755 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.43
2025-11-19 15:14:34,755 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 15:14:34,756 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 15:14:44,684 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:14:44,688 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 15:14:44,688 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 15:14:44,689 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 15:14:44,691 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 15:14:44,692 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 15:14:44,693 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763565175_dfa60a465a65
2025-11-19 15:14:44,693 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 15:14:44,694 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 15:14:44,695 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 15:14:44,695 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 15:14:44,696 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:14:44,697 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:14:44,697 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:14:44,698 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:14:44,699 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:14:44,699 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:14:44,700 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-19 15:14:44,701 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:14:44,701 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:14:44,702 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:14:44,703 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:14:44,704 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:14:44,704 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:14:44,709 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 15:14:44,710 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,334 bytes
2025-11-19 15:14:44,710 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 29,513 bytes
2025-11-19 15:14:44,710 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,571 bytes
2025-11-19 15:14:44,711 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,740 bytes
2025-11-19 15:14:44,711 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 48,984 bytes
2025-11-19 15:14:44,712 - app.services.mongodb_service_enhanced - INFO -    Total document: 201,633 bytes
2025-11-19 15:14:44,712 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 15:14:44,714 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 15:14:44,715 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 15:14:44,716 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 15:14:44,717 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 15:14:44,717 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 15:14:44,717 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 15:14:44,718 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 15:14:44,718 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 15:14:44,719 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 15:14:44,719 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 15:14:44,719 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 15:14:44,719 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 15:14:44,720 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 15:14:44,720 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 15:14:44,720 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 15:14:44,720 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 15:14:44,720 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:14:44,721 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:14:44,721 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 15:14:44,725 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763565175_dfa60a465a65
2025-11-19 15:14:44,726 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691ddee4b8ed226b2b31fea9
2025-11-19 15:14:44,730 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 15:14:44,730 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 15:14:44,731 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 15:14:44,731 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 15:14:44,731 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 15:14:44,731 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 15:14:44,731 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 15:14:44,732 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 15:14:44,732 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 15:14:44,732 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 15:14:44,732 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 15:14:44,733 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 15:14:44,733 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:14:44,733 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 15:14:44,733 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 15:14:44,734 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 15:14:44,734 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 15:14:44,734 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 15:14:44,734 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:14:44,735 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691ddee4b8ed226b2b31fea9
2025-11-19 15:14:44,735 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 15:14:44,735 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 15:14:44,735 - app.api.routes - INFO -    Comparison ID: cmp_1763565175_dfa60a465a65
2025-11-19 15:14:44,737 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:14:44,738 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:14:44,738 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:14:44,738 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 15:14:44,738 - app.api.routes - INFO - ======================================================================
2025-11-19 15:14:44,739 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763565175_dfa60a465a65
2025-11-19 15:14:44,739 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 15:14:44,739 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 15:14:44,739 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 15:14:44,740 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:14:44,740 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:14:44,741 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:14:44,742 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:14:44,743 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 230
2025-11-19 15:14:44,743 - app.api.routes - INFO - ======================================================================

2025-11-19 15:14:44,744 - app.services.progress_tracker - INFO - âœ… Job completed: job_3cd686449561 â†’ comparison_id: cmp_1763565175_dfa60a465a65
2025-11-19 15:14:44,746 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 109.04s
2025-11-19 15:16:53,036 - main - INFO - 
2025-11-19 15:16:53,037 - main - INFO - ================================================================================
2025-11-19 15:16:53,040 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:16:53,041 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:16:53,042 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:16:53,043 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:16:53,044 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:16:53,045 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:16:53,046 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:16:53,047 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-19 15:16:53,048 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:16:53,048 - main - INFO - ================================================================================
2025-11-19 15:16:53,048 - main - INFO - 
2025-11-19 15:16:57,757 - main - INFO - 
2025-11-19 15:16:57,758 - main - INFO - ================================================================================
2025-11-19 15:16:57,758 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:16:57,758 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:16:57,758 - main - INFO - ================================================================================
2025-11-19 15:16:57,759 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:16:57,759 - main - INFO -   Upload Directory: uploads
2025-11-19 15:16:57,759 - main - INFO -   Max File Size: 20MB
2025-11-19 15:16:57,760 - main - INFO - ================================================================================
2025-11-19 15:16:57,761 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:16:57,762 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:16:57,762 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:16:57,799 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:16:57,806 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:16:57,807 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:16:57,807 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:16:57,807 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:16:57,808 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:16:57,808 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:16:57,808 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:16:57,819 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:16:57,820 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:16:57,822 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:16:57,825 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:16:57,825 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:16:57,826 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:16:57,826 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:16:57,826 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:16:57,846 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:16:57,848 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:16:57,848 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:16:57,848 - main - INFO - 
2025-11-19 15:16:57,849 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:16:57,849 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:16:57,849 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:16:57,849 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:16:57,850 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:16:57,850 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:16:57,850 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:16:57,851 - main - INFO - 
2025-11-19 15:16:57,851 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:16:57,851 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:16:57,851 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:16:57,851 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:16:57,852 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:16:57,852 - main - INFO - 
2025-11-19 15:16:57,852 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:16:57,852 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:16:57,853 - main - INFO -        - No manual section generation
2025-11-19 15:16:57,853 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:16:57,853 - main - INFO - 
2025-11-19 15:16:57,853 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:16:57,853 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:16:57,854 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:16:57,854 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:16:57,854 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:16:57,854 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:16:57,854 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:16:57,855 - main - INFO - 
2025-11-19 15:16:57,855 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:16:57,855 - main - INFO -      Main:
2025-11-19 15:16:57,855 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:16:57,855 - main - INFO - 
2025-11-19 15:16:57,856 - main - INFO -      Retrieval:
2025-11-19 15:16:57,856 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:16:57,856 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:16:57,856 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:16:57,857 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:16:57,857 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:16:57,857 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:16:57,857 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:16:57,858 - main - INFO - 
2025-11-19 15:16:57,858 - main - INFO -      Management:
2025-11-19 15:16:57,859 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:16:57,859 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:16:57,859 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:16:57,859 - main - INFO - 
2025-11-19 15:16:57,859 - main - INFO -      Documents (MongoDB):
2025-11-19 15:16:57,860 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:16:57,860 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:16:57,860 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:16:57,860 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:16:57,861 - main - INFO - 
2025-11-19 15:16:57,861 - main - INFO -      Diagnostics & Health:
2025-11-19 15:16:57,861 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:16:57,862 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:16:57,862 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:16:57,863 - main - INFO - 
2025-11-19 15:16:57,864 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:16:57,864 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:16:57,865 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:16:57,865 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:16:57,865 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:16:57,866 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:16:57,868 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:16:57,869 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:16:57,870 - main - INFO - 
2025-11-19 15:16:57,870 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:16:57,870 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:16:57,870 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:16:57,871 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:16:57,871 - main - INFO -      4. No re-upload needed!
2025-11-19 15:16:57,871 - main - INFO - 
2025-11-19 15:16:57,871 - main - INFO - ================================================================================
2025-11-19 15:16:57,872 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:16:57,872 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:16:57,872 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:16:57,872 - main - INFO - ================================================================================
2025-11-19 15:16:57,873 - main - INFO - 
2025-11-19 15:16:57,873 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:17:03,344 - main - INFO - 
2025-11-19 15:17:03,344 - main - INFO - ================================================================================
2025-11-19 15:17:03,344 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:17:03,345 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:17:03,347 - main - INFO - ================================================================================
2025-11-19 15:17:03,348 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:17:03,348 - main - INFO -   Upload Directory: uploads
2025-11-19 15:17:03,349 - main - INFO -   Max File Size: 20MB
2025-11-19 15:17:03,350 - main - INFO - ================================================================================
2025-11-19 15:17:03,351 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:17:03,352 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:17:03,352 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:17:03,388 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:17:03,404 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:17:03,405 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:17:03,406 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:17:03,406 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:17:03,407 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:17:03,407 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:03,407 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:03,421 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:17:03,423 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:17:03,425 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:17:03,428 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:17:03,430 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:17:03,431 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:17:03,432 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:03,434 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:03,449 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:17:03,450 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:17:03,451 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:17:03,451 - main - INFO - 
2025-11-19 15:17:03,451 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:17:03,452 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:17:03,452 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:17:03,453 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:17:03,453 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:17:03,453 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:17:03,453 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:17:03,454 - main - INFO - 
2025-11-19 15:17:03,454 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:17:03,454 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:17:03,454 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:17:03,455 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:17:03,455 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:17:03,455 - main - INFO - 
2025-11-19 15:17:03,455 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:17:03,456 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:17:03,456 - main - INFO -        - No manual section generation
2025-11-19 15:17:03,456 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:17:03,457 - main - INFO - 
2025-11-19 15:17:03,457 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:17:03,457 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:17:03,458 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:17:03,458 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:17:03,458 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:17:03,459 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:17:03,459 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:17:03,459 - main - INFO - 
2025-11-19 15:17:03,459 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:17:03,460 - main - INFO -      Main:
2025-11-19 15:17:03,460 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:17:03,460 - main - INFO - 
2025-11-19 15:17:03,460 - main - INFO -      Retrieval:
2025-11-19 15:17:03,461 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:17:03,461 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:17:03,462 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:17:03,464 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:17:03,465 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:17:03,465 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:17:03,467 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:17:03,467 - main - INFO - 
2025-11-19 15:17:03,468 - main - INFO -      Management:
2025-11-19 15:17:03,468 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:17:03,468 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:17:03,469 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:17:03,469 - main - INFO - 
2025-11-19 15:17:03,469 - main - INFO -      Documents (MongoDB):
2025-11-19 15:17:03,469 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:17:03,470 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:17:03,470 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:17:03,470 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:17:03,470 - main - INFO - 
2025-11-19 15:17:03,471 - main - INFO -      Diagnostics & Health:
2025-11-19 15:17:03,471 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:17:03,471 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:17:03,472 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:17:03,472 - main - INFO - 
2025-11-19 15:17:03,472 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:17:03,472 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:17:03,473 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:17:03,473 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:17:03,473 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:17:03,473 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:17:03,474 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:17:03,474 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:17:03,474 - main - INFO - 
2025-11-19 15:17:03,474 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:17:03,475 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:17:03,475 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:17:03,475 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:17:03,476 - main - INFO -      4. No re-upload needed!
2025-11-19 15:17:03,476 - main - INFO - 
2025-11-19 15:17:03,476 - main - INFO - ================================================================================
2025-11-19 15:17:03,477 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:17:03,477 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:17:03,477 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:17:03,477 - main - INFO - ================================================================================
2025-11-19 15:17:03,478 - main - INFO - 
2025-11-19 15:17:03,479 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:17:07,874 - main - INFO - 
2025-11-19 15:17:07,874 - main - INFO - ================================================================================
2025-11-19 15:17:07,874 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:17:07,875 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:17:07,875 - main - INFO - ================================================================================
2025-11-19 15:17:07,875 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:17:07,875 - main - INFO -   Upload Directory: uploads
2025-11-19 15:17:07,875 - main - INFO -   Max File Size: 20MB
2025-11-19 15:17:07,876 - main - INFO - ================================================================================
2025-11-19 15:17:07,876 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:17:07,876 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:17:07,876 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:17:07,905 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:17:07,912 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:17:07,912 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:17:07,913 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:17:07,913 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:17:07,914 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:17:07,915 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:07,917 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:07,926 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:17:07,927 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:17:07,929 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:17:07,935 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:17:07,936 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:17:07,936 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:17:07,936 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:07,937 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:07,944 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:17:07,944 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:17:07,945 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:17:07,945 - main - INFO - 
2025-11-19 15:17:07,945 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:17:07,946 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:17:07,946 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:17:07,946 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:17:07,946 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:17:07,947 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:17:07,947 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:17:07,947 - main - INFO - 
2025-11-19 15:17:07,947 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:17:07,947 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:17:07,948 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:17:07,949 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:17:07,949 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:17:07,950 - main - INFO - 
2025-11-19 15:17:07,951 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:17:07,951 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:17:07,952 - main - INFO -        - No manual section generation
2025-11-19 15:17:07,952 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:17:07,952 - main - INFO - 
2025-11-19 15:17:07,952 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:17:07,953 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:17:07,953 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:17:07,953 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:17:07,953 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:17:07,953 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:17:07,953 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:17:07,954 - main - INFO - 
2025-11-19 15:17:07,954 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:17:07,954 - main - INFO -      Main:
2025-11-19 15:17:07,954 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:17:07,954 - main - INFO - 
2025-11-19 15:17:07,954 - main - INFO -      Retrieval:
2025-11-19 15:17:07,955 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:17:07,955 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:17:07,955 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:17:07,955 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:17:07,956 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:17:07,956 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:17:07,956 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:17:07,956 - main - INFO - 
2025-11-19 15:17:07,957 - main - INFO -      Management:
2025-11-19 15:17:07,957 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:17:07,957 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:17:07,957 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:17:07,957 - main - INFO - 
2025-11-19 15:17:07,958 - main - INFO -      Documents (MongoDB):
2025-11-19 15:17:07,958 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:17:07,958 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:17:07,958 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:17:07,959 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:17:07,959 - main - INFO - 
2025-11-19 15:17:07,959 - main - INFO -      Diagnostics & Health:
2025-11-19 15:17:07,959 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:17:07,959 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:17:07,959 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:17:07,960 - main - INFO - 
2025-11-19 15:17:07,960 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:17:07,960 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:17:07,960 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:17:07,960 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:17:07,960 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:17:07,960 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:17:07,961 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:17:07,961 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:17:07,961 - main - INFO - 
2025-11-19 15:17:07,961 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:17:07,962 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:17:07,962 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:17:07,962 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:17:07,962 - main - INFO -      4. No re-upload needed!
2025-11-19 15:17:07,963 - main - INFO - 
2025-11-19 15:17:07,963 - main - INFO - ================================================================================
2025-11-19 15:17:07,963 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:17:07,964 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:17:07,964 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:17:07,965 - main - INFO - ================================================================================
2025-11-19 15:17:07,965 - main - INFO - 
2025-11-19 15:17:07,966 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:17:11,170 - main - INFO - 
2025-11-19 15:17:11,171 - main - INFO - ================================================================================
2025-11-19 15:17:11,171 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:17:11,171 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:17:11,171 - main - INFO - ================================================================================
2025-11-19 15:17:11,172 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:17:11,172 - main - INFO -   Upload Directory: uploads
2025-11-19 15:17:11,172 - main - INFO -   Max File Size: 20MB
2025-11-19 15:17:11,172 - main - INFO - ================================================================================
2025-11-19 15:17:11,172 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:17:11,173 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:17:11,173 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:17:11,217 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:17:11,222 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:17:11,223 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:17:11,223 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:17:11,223 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:17:11,223 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:17:11,224 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:11,224 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:11,252 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:17:11,253 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:17:11,254 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:17:11,255 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:17:11,256 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:17:11,256 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:17:11,256 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:11,257 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:11,348 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:17:11,359 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:17:11,360 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:17:11,360 - main - INFO - 
2025-11-19 15:17:11,360 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:17:11,360 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:17:11,361 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:17:11,361 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:17:11,361 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:17:11,361 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:17:11,362 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:17:11,362 - main - INFO - 
2025-11-19 15:17:11,363 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:17:11,364 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:17:11,364 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:17:11,365 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:17:11,365 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:17:11,365 - main - INFO - 
2025-11-19 15:17:11,365 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:17:11,366 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:17:11,366 - main - INFO -        - No manual section generation
2025-11-19 15:17:11,366 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:17:11,366 - main - INFO - 
2025-11-19 15:17:11,367 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:17:11,367 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:17:11,367 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:17:11,368 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:17:11,368 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:17:11,368 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:17:11,368 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:17:11,369 - main - INFO - 
2025-11-19 15:17:11,369 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:17:11,369 - main - INFO -      Main:
2025-11-19 15:17:11,369 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:17:11,369 - main - INFO - 
2025-11-19 15:17:11,370 - main - INFO -      Retrieval:
2025-11-19 15:17:11,370 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:17:11,370 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:17:11,370 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:17:11,370 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:17:11,371 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:17:11,371 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:17:11,371 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:17:11,371 - main - INFO - 
2025-11-19 15:17:11,371 - main - INFO -      Management:
2025-11-19 15:17:11,372 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:17:11,372 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:17:11,372 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:17:11,372 - main - INFO - 
2025-11-19 15:17:11,372 - main - INFO -      Documents (MongoDB):
2025-11-19 15:17:11,372 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:17:11,373 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:17:11,373 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:17:11,373 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:17:11,373 - main - INFO - 
2025-11-19 15:17:11,373 - main - INFO -      Diagnostics & Health:
2025-11-19 15:17:11,373 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:17:11,374 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:17:11,374 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:17:11,374 - main - INFO - 
2025-11-19 15:17:11,374 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:17:11,374 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:17:11,374 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:17:11,375 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:17:11,375 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:17:11,375 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:17:11,375 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:17:11,375 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:17:11,375 - main - INFO - 
2025-11-19 15:17:11,375 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:17:11,376 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:17:11,376 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:17:11,376 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:17:11,376 - main - INFO -      4. No re-upload needed!
2025-11-19 15:17:11,376 - main - INFO - 
2025-11-19 15:17:11,376 - main - INFO - ================================================================================
2025-11-19 15:17:11,377 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:17:11,377 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:17:11,377 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:17:11,377 - main - INFO - ================================================================================
2025-11-19 15:17:11,377 - main - INFO - 
2025-11-19 15:17:11,378 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:17:18,215 - main - INFO - 
2025-11-19 15:17:18,216 - main - INFO - ================================================================================
2025-11-19 15:17:18,216 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:17:18,217 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:17:18,217 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:17:18,218 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:17:18,218 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:17:18,219 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:17:18,219 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:17:18,220 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:17:18,220 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:17:18,220 - main - INFO - ================================================================================
2025-11-19 15:17:18,220 - main - INFO - 
2025-11-19 15:17:21,587 - main - INFO - 
2025-11-19 15:17:21,588 - main - INFO - ================================================================================
2025-11-19 15:17:21,588 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:17:21,588 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:17:21,588 - main - INFO - ================================================================================
2025-11-19 15:17:21,589 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:17:21,589 - main - INFO -   Upload Directory: uploads
2025-11-19 15:17:21,589 - main - INFO -   Max File Size: 20MB
2025-11-19 15:17:21,589 - main - INFO - ================================================================================
2025-11-19 15:17:21,590 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:17:21,590 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:17:21,591 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:17:21,619 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:17:21,623 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:17:21,623 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:17:21,624 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:17:21,624 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:17:21,624 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:17:21,624 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:21,624 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:21,636 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:17:21,637 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:17:21,638 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:17:21,640 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:17:21,640 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:17:21,640 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:17:21,641 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:21,641 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:21,653 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:17:21,653 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:17:21,653 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:17:21,654 - main - INFO - 
2025-11-19 15:17:21,654 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:17:21,654 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:17:21,654 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:17:21,654 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:17:21,655 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:17:21,655 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:17:21,655 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:17:21,655 - main - INFO - 
2025-11-19 15:17:21,656 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:17:21,656 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:17:21,656 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:17:21,656 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:17:21,656 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:17:21,657 - main - INFO - 
2025-11-19 15:17:21,657 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:17:21,657 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:17:21,657 - main - INFO -        - No manual section generation
2025-11-19 15:17:21,657 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:17:21,657 - main - INFO - 
2025-11-19 15:17:21,658 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:17:21,658 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:17:21,658 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:17:21,658 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:17:21,659 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:17:21,659 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:17:21,659 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:17:21,659 - main - INFO - 
2025-11-19 15:17:21,659 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:17:21,660 - main - INFO -      Main:
2025-11-19 15:17:21,660 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:17:21,660 - main - INFO - 
2025-11-19 15:17:21,660 - main - INFO -      Retrieval:
2025-11-19 15:17:21,660 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:17:21,660 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:17:21,661 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:17:21,661 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:17:21,661 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:17:21,662 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:17:21,663 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:17:21,663 - main - INFO - 
2025-11-19 15:17:21,664 - main - INFO -      Management:
2025-11-19 15:17:21,664 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:17:21,665 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:17:21,665 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:17:21,665 - main - INFO - 
2025-11-19 15:17:21,665 - main - INFO -      Documents (MongoDB):
2025-11-19 15:17:21,666 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:17:21,666 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:17:21,666 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:17:21,666 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:17:21,666 - main - INFO - 
2025-11-19 15:17:21,667 - main - INFO -      Diagnostics & Health:
2025-11-19 15:17:21,667 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:17:21,667 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:17:21,668 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:17:21,668 - main - INFO - 
2025-11-19 15:17:21,669 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:17:21,669 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:17:21,669 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:17:21,669 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:17:21,669 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:17:21,670 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:17:21,670 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:17:21,670 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:17:21,670 - main - INFO - 
2025-11-19 15:17:21,670 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:17:21,671 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:17:21,671 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:17:21,671 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:17:21,671 - main - INFO -      4. No re-upload needed!
2025-11-19 15:17:21,671 - main - INFO - 
2025-11-19 15:17:21,671 - main - INFO - ================================================================================
2025-11-19 15:17:21,672 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:17:21,672 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:17:21,672 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:17:21,672 - main - INFO - ================================================================================
2025-11-19 15:17:21,672 - main - INFO - 
2025-11-19 15:17:21,672 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:17:27,936 - main - INFO - 
2025-11-19 15:17:27,936 - main - INFO - ================================================================================
2025-11-19 15:17:27,936 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:17:27,937 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:17:27,938 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:17:27,938 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:17:27,938 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:17:27,939 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:17:27,939 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:17:27,940 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:17:27,940 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:17:27,940 - main - INFO - ================================================================================
2025-11-19 15:17:27,940 - main - INFO - 
2025-11-19 15:17:30,474 - main - INFO - 
2025-11-19 15:17:30,474 - main - INFO - ================================================================================
2025-11-19 15:17:30,475 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:17:30,475 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:17:30,475 - main - INFO - ================================================================================
2025-11-19 15:17:30,475 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:17:30,475 - main - INFO -   Upload Directory: uploads
2025-11-19 15:17:30,476 - main - INFO -   Max File Size: 20MB
2025-11-19 15:17:30,476 - main - INFO - ================================================================================
2025-11-19 15:17:30,476 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:17:30,476 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:17:30,476 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:17:30,516 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:17:30,524 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:17:30,525 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:17:30,525 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:17:30,526 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:17:30,526 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:17:30,526 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:30,527 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:30,550 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:17:30,553 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:17:30,555 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:17:30,559 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:17:30,560 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:17:30,560 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:17:30,561 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:17:30,561 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:17:30,607 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:17:30,608 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:17:30,608 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:17:30,608 - main - INFO - 
2025-11-19 15:17:30,608 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:17:30,609 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:17:30,609 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:17:30,609 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:17:30,609 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:17:30,610 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:17:30,610 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:17:30,610 - main - INFO - 
2025-11-19 15:17:30,610 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:17:30,610 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:17:30,611 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:17:30,611 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:17:30,611 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:17:30,611 - main - INFO - 
2025-11-19 15:17:30,612 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:17:30,612 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:17:30,613 - main - INFO -        - No manual section generation
2025-11-19 15:17:30,613 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:17:30,614 - main - INFO - 
2025-11-19 15:17:30,614 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:17:30,614 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:17:30,614 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:17:30,615 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:17:30,615 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:17:30,615 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:17:30,615 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:17:30,615 - main - INFO - 
2025-11-19 15:17:30,616 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:17:30,616 - main - INFO -      Main:
2025-11-19 15:17:30,616 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:17:30,616 - main - INFO - 
2025-11-19 15:17:30,616 - main - INFO -      Retrieval:
2025-11-19 15:17:30,616 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:17:30,617 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:17:30,617 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:17:30,617 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:17:30,617 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:17:30,617 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:17:30,618 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:17:30,618 - main - INFO - 
2025-11-19 15:17:30,618 - main - INFO -      Management:
2025-11-19 15:17:30,618 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:17:30,618 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:17:30,618 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:17:30,619 - main - INFO - 
2025-11-19 15:17:30,619 - main - INFO -      Documents (MongoDB):
2025-11-19 15:17:30,619 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:17:30,619 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:17:30,619 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:17:30,619 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:17:30,619 - main - INFO - 
2025-11-19 15:17:30,620 - main - INFO -      Diagnostics & Health:
2025-11-19 15:17:30,620 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:17:30,620 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:17:30,620 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:17:30,620 - main - INFO - 
2025-11-19 15:17:30,620 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:17:30,621 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:17:30,621 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:17:30,621 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:17:30,621 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:17:30,621 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:17:30,621 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:17:30,622 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:17:30,622 - main - INFO - 
2025-11-19 15:17:30,622 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:17:30,622 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:17:30,622 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:17:30,622 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:17:30,623 - main - INFO -      4. No re-upload needed!
2025-11-19 15:17:30,623 - main - INFO - 
2025-11-19 15:17:30,623 - main - INFO - ================================================================================
2025-11-19 15:17:30,623 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:17:30,623 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:17:30,623 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:17:30,624 - main - INFO - ================================================================================
2025-11-19 15:17:30,624 - main - INFO - 
2025-11-19 15:17:30,624 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:17:51,948 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 15:17:51,949 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 15:17:52,041 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 15:17:52,052 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-19 15:18:15,854 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 15:18:15,859 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 15:18:15,860 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:18:15,860 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:18:15,860 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:18:15,863 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:18:15,864 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 15:18:15,865 - app.api.routes - INFO -    - Remaining comparisons: 230
2025-11-19 15:18:15,865 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 15:18:15,865 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 15:18:15,866 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763565495_f48566d9e610
2025-11-19 15:18:15,866 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_f9ed1bc90e92 (3 files)
2025-11-19 15:18:15,866 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_f9ed1bc90e92
2025-11-19 15:18:15,868 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:18:15,869 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:18:15,869 - app.api.routes - INFO - ======================================================================
2025-11-19 15:18:15,871 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 80fee99731f74109836c9aafbb71a127.pdf (464206 bytes)
2025-11-19 15:18:15,873 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:18:15,875 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\80fee99731f74109836c9aafbb71a127.pdf
2025-11-19 15:18:15,875 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:18:15,895 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:18:15,914 - app.api.routes - INFO - ======================================================================
2025-11-19 15:18:15,945 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 15:18:15,946 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 2f763299e625442f9cb65b3c121c46ba.pdf (175401 bytes)
2025-11-19 15:18:15,946 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:18:15,947 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:18:15,947 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\2f763299e625442f9cb65b3c121c46ba.pdf
2025-11-19 15:18:15,947 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:18:15,947 - app.api.routes - INFO - ======================================================================
2025-11-19 15:18:15,992 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 15:18:15,992 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 946b994d199249af92375711407efcc6.pdf (331157 bytes)
2025-11-19 15:18:15,993 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:18:15,993 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\946b994d199249af92375711407efcc6.pdf
2025-11-19 15:18:15,993 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:18:16,021 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:18:16,044 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 15:18:16,045 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 15:18:16,047 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 15:18:16,047 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:18:16,047 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:18:16,048 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 15:18:16,208 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 15:18:16,209 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:18:16,599 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:18:16,599 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:18:16,600 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 15:18:16,600 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 15:18:16,601 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:18:16,601 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:18:16,602 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 15:18:16,681 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 15:18:16,681 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:18:16,682 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:18:16,683 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:18:16,683 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 15:18:16,683 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 15:18:16,684 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 15:18:16,684 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:18:16,684 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 15:18:16,784 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 15:18:16,785 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:18:47,461 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:18:47,480 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:18:47,481 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:18:47,482 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:18:47,482 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 15:18:47,483 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:18:47,483 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 15:18:47,490 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 15:18:47,490 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 15:18:47,491 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:18:56,226 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:18:56,229 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:18:56,230 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:18:56,231 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 15:18:56,231 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 15:18:56,232 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:18:56,233 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:18:56,234 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 15:19:03,363 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:03,366 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:19:03,366 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:19:03,367 - app.services.ai_parser - INFO - 
2025-11-19 15:19:03,367 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:03,367 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:19:03,368 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:03,368 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 15:19:03,368 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:19:03,369 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 15:19:03,369 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 15:19:03,369 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:19:03,370 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:19:03,370 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:19:03,370 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:19:03,371 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:19:03,371 - app.services.ai_parser - INFO - 
2025-11-19 15:19:03,371 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:19:03,371 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 15:19:03,371 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 15:19:03,371 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 15:19:03,372 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:19:03,372 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:19:03,372 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:03,373 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 80fee99731f74109836c9aafbb71a127.pdf â†’ 691ddfe7eeedce67e2708e0a
2025-11-19 15:19:03,373 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddfe7eeedce67e2708e0a
2025-11-19 15:19:03,376 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddfe7eeedce67e2708e0b (464206 bytes)
2025-11-19 15:19:03,376 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691ddfe7eeedce67e2708e0b
2025-11-19 15:19:03,376 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:19:05,968 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:05,970 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:19:05,971 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:19:05,971 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:19:05,972 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-19 15:19:05,978 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 60 benefits from patterns
2025-11-19 15:19:05,978 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 57 total
2025-11-19 15:19:05,978 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:19:12,969 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:12,974 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:19:12,975 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:19:12,975 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 15:19:12,975 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 15:19:12,975 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:19:12,976 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:19:12,976 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:19:12,976 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:19:12,977 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:19:12,977 - app.services.ai_parser - INFO - ðŸ“Š Counts: 57 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-19 15:19:19,163 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:19,168 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:19:19,168 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:19:19,169 - app.services.ai_parser - INFO - 
2025-11-19 15:19:19,169 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:19,169 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:19:19,170 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:19,170 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 15:19:19,170 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:19:19,170 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-19 15:19:19,171 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 15:19:19,171 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:19:19,171 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO - 
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO -    âœ“ Benefits: 57
2025-11-19 15:19:19,172 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 15:19:19,173 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-19 15:19:19,173 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:19:19,173 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:19:19,173 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:19,174 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 2f763299e625442f9cb65b3c121c46ba.pdf â†’ 691ddff7eeedce67e2708e0c
2025-11-19 15:19:19,174 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691ddff7eeedce67e2708e0c
2025-11-19 15:19:19,176 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691ddff7eeedce67e2708e0d (175401 bytes)
2025-11-19 15:19:19,176 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691ddff7eeedce67e2708e0d
2025-11-19 15:19:19,177 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:19:22,183 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:22,187 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:19:22,188 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:19:22,189 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:19:22,190 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:19:27,670 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:27,679 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:19:27,679 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:19:27,679 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 15:19:27,679 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 15:19:27,680 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:19:27,680 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:19:27,680 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:19:27,680 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-19 15:19:27,680 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:19:27,681 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 15:19:36,507 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:36,520 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 15:19:36,521 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:19:36,521 - app.services.ai_parser - INFO - 
2025-11-19 15:19:36,522 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:36,522 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:19:36,522 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:36,523 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 15:19:36,523 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 15:19:36,524 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 15:19:36,524 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 15:19:36,525 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 15:19:36,525 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:19:36,525 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-19 15:19:36,526 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 15:19:36,526 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 15:19:36,526 - app.services.ai_parser - INFO - 
2025-11-19 15:19:36,527 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:19:36,527 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-19 15:19:36,527 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 15:19:36,528 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 15:19:36,528 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:19:36,529 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:19:36,529 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:19:36,531 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 946b994d199249af92375711407efcc6.pdf â†’ 691de008eeedce67e2708e0e
2025-11-19 15:19:36,531 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de008eeedce67e2708e0e
2025-11-19 15:19:36,534 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691de008eeedce67e2708e0f (331157 bytes)
2025-11-19 15:19:36,534 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691de008eeedce67e2708e0f
2025-11-19 15:19:36,534 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:19:36,535 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 15:19:36,535 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:19:36,535 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 15:19:36,536 - app.api.routes - INFO - ======================================================================
2025-11-19 15:19:36,536 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 15:19:36,537 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 15:19:36,538 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 15:19:36,538 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:19:36,539 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-19 15:19:36,539 - app.services.ai_ranker - INFO - ================================================================================
2025-11-19 15:19:36,540 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:19:36,540 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-19 15:19:36,540 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:19:36,540 - app.services.ai_ranker - INFO -    Extended data exists: False
2025-11-19 15:19:36,540 - app.services.ai_ranker - INFO -    Extended data keys: None
2025-11-19 15:19:36,541 - app.services.ai_ranker - INFO -    Subjectivities data exists: False
2025-11-19 15:19:36,541 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:19:36,541 - app.services.ai_ranker - INFO -    Subjectivities data: {}
2025-11-19 15:19:36,541 - app.services.ai_ranker - INFO -    Quote has _extended_data: False
2025-11-19 15:19:36,541 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:19:36,542 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:19:36,542 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:19:36,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-19 15:19:36,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'conditions_precedent': []
2025-11-19 15:19:36,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-19 15:19:36,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:19:36,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:19:36,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:19:36,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:19:36,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:19:36,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:19:36,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:19:36,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:19:36,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:19:36,545 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:19:36,545 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:19:36,545 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:19:36,545 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:19:36,546 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 0
2025-11-19 15:19:36,546 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:19:36,547 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Tawuniya after all extraction methods
2025-11-19 15:19:36,547 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-19 15:19:36,547 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-19 15:19:36,548 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:19:36,548 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-19 15:19:36,548 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:19:36,548 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:19:36,549 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-19 15:19:36,549 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:19:36,549 - app.services.ai_ranker - INFO -    Extended data exists: False
2025-11-19 15:19:36,549 - app.services.ai_ranker - INFO -    Extended data keys: None
2025-11-19 15:19:36,550 - app.services.ai_ranker - INFO -    Subjectivities data exists: False
2025-11-19 15:19:36,550 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:19:36,550 - app.services.ai_ranker - INFO -    Subjectivities data: {}
2025-11-19 15:19:36,550 - app.services.ai_ranker - INFO -    Quote has _extended_data: False
2025-11-19 15:19:36,551 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:19:36,551 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:19:36,551 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:19:36,552 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-19 15:19:36,553 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'conditions_precedent': []
2025-11-19 15:19:36,554 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-19 15:19:36,554 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:19:36,555 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:19:36,555 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:19:36,555 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:19:36,555 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:19:36,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:19:36,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:19:36,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:19:36,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:19:36,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:19:36,557 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:19:36,557 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:19:36,557 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:19:36,557 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 0
2025-11-19 15:19:36,558 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:19:36,558 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Chubb Arabia after all extraction methods
2025-11-19 15:19:36,558 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-19 15:19:36,558 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-19 15:19:36,559 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:19:36,559 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-19 15:19:36,559 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:19:36,559 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:19:36,560 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-19 15:19:36,560 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:19:36,560 - app.services.ai_ranker - INFO -    Extended data exists: False
2025-11-19 15:19:36,560 - app.services.ai_ranker - INFO -    Extended data keys: None
2025-11-19 15:19:36,560 - app.services.ai_ranker - INFO -    Subjectivities data exists: False
2025-11-19 15:19:36,561 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:19:36,561 - app.services.ai_ranker - INFO -    Subjectivities data: {}
2025-11-19 15:19:36,561 - app.services.ai_ranker - INFO -    Quote has _extended_data: False
2025-11-19 15:19:36,561 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:19:36,561 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:19:36,562 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:19:36,562 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-19 15:19:36,562 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'conditions_precedent': []
2025-11-19 15:19:36,562 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-19 15:19:36,563 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:19:36,563 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:19:36,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:19:36,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:19:36,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:19:36,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:19:36,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:19:36,565 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:19:36,565 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:19:36,565 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:19:36,565 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:19:36,566 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:19:36,566 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:19:36,566 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 0
2025-11-19 15:19:36,566 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:19:36,566 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Liva Insurance after all extraction methods
2025-11-19 15:19:36,567 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-19 15:19:36,567 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-19 15:19:36,567 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:19:36,567 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-19 15:19:36,568 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:19:36,568 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-19 15:19:36,883 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-19 15:19:36,883 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:19:36,884 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:19:36,884 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:19:36,884 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:19:36,884 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-19 15:19:36,885 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-19 15:19:36,885 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-19 15:19:37,199 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:19:37,200 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:19:37,200 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:19:37,200 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:19:37,200 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:19:37,201 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-19 15:19:37,201 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-19 15:19:37,515 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:19:37,515 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:19:37,516 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 7
2025-11-19 15:19:37,516 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:19:37,516 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:19:37,516 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-19 15:19:37,517 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:19:37,517 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-19 15:19:37,517 - app.services.ai_ranker - INFO - ================================================================================

2025-11-19 15:19:37,518 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-19 15:19:37,518 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.43
2025-11-19 15:19:37,518 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-19 15:19:37,518 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 15:19:37,519 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 15:19:53,840 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:19:53,843 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 15:19:53,844 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 15:19:53,844 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 15:19:53,844 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 15:19:53,845 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 15:19:53,845 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763565495_f48566d9e610
2025-11-19 15:19:53,845 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 15:19:53,845 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 15:19:53,846 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 15:19:53,846 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 15:19:53,846 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:19:53,846 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:19:53,846 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:19:53,847 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:19:53,847 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:19:53,847 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:19:53,847 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-19 15:19:53,847 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:19:53,847 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:19:53,848 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:19:53,848 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:19:53,848 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:19:53,848 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:19:53,850 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 15:19:53,851 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,336 bytes
2025-11-19 15:19:53,851 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 28,981 bytes
2025-11-19 15:19:53,851 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,307 bytes
2025-11-19 15:19:53,851 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,740 bytes
2025-11-19 15:19:53,851 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 46,281 bytes
2025-11-19 15:19:53,851 - app.services.mongodb_service_enhanced - INFO -    Total document: 194,643 bytes
2025-11-19 15:19:53,852 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 15:19:53,852 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 15:19:53,852 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 15:19:53,852 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 15:19:53,852 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 15:19:53,853 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 15:19:53,853 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 15:19:53,853 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 15:19:53,853 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 15:19:53,853 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 15:19:53,853 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 15:19:53,854 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 15:19:53,854 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 15:19:53,854 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 15:19:53,854 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 15:19:53,854 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 15:19:53,854 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 15:19:53,855 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:19:53,855 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:19:53,855 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 15:19:53,858 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763565495_f48566d9e610
2025-11-19 15:19:53,858 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691de019b8ed226b2b31feaa
2025-11-19 15:19:53,860 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 15:19:53,861 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 15:19:53,861 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 15:19:53,861 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 15:19:53,861 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 15:19:53,861 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 15:19:53,862 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 15:19:53,862 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 15:19:53,862 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 15:19:53,862 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 15:19:53,862 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 15:19:53,862 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 15:19:53,863 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:19:53,863 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 15:19:53,863 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 15:19:53,863 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 15:19:53,864 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 15:19:53,864 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 15:19:53,864 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:19:53,864 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691de019b8ed226b2b31feaa
2025-11-19 15:19:53,865 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 15:19:53,865 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 15:19:53,865 - app.api.routes - INFO -    Comparison ID: cmp_1763565495_f48566d9e610
2025-11-19 15:19:53,867 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:19:53,867 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:19:53,867 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:19:53,867 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 15:19:53,867 - app.api.routes - INFO - ======================================================================
2025-11-19 15:19:53,868 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763565495_f48566d9e610
2025-11-19 15:19:53,868 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 15:19:53,868 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 15:19:53,868 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 15:19:53,868 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:19:53,869 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:19:53,869 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:19:53,870 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:19:53,873 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 229
2025-11-19 15:19:53,874 - app.api.routes - INFO - ======================================================================

2025-11-19 15:19:53,874 - app.services.progress_tracker - INFO - âœ… Job completed: job_f9ed1bc90e92 â†’ comparison_id: cmp_1763565495_f48566d9e610
2025-11-19 15:19:53,875 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 98.02s
2025-11-19 15:20:37,371 - main - INFO - 
2025-11-19 15:20:37,372 - main - INFO - ================================================================================
2025-11-19 15:20:37,372 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:20:37,374 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:20:37,374 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:20:37,375 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:20:37,376 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:20:37,377 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:20:37,378 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:20:37,380 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-19 15:20:37,381 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:20:37,382 - main - INFO - ================================================================================
2025-11-19 15:20:37,382 - main - INFO - 
2025-11-19 15:20:41,311 - main - INFO - 
2025-11-19 15:20:41,312 - main - INFO - ================================================================================
2025-11-19 15:20:41,312 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:20:41,312 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:20:41,312 - main - INFO - ================================================================================
2025-11-19 15:20:41,313 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:20:41,313 - main - INFO -   Upload Directory: uploads
2025-11-19 15:20:41,313 - main - INFO -   Max File Size: 20MB
2025-11-19 15:20:41,313 - main - INFO - ================================================================================
2025-11-19 15:20:41,314 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:20:41,314 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:20:41,314 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:20:41,335 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:20:41,342 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:20:41,342 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:20:41,343 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:20:41,343 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:20:41,343 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:20:41,343 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:20:41,343 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:20:41,351 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:20:41,354 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:20:41,355 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:20:41,357 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:20:41,357 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:20:41,357 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:20:41,358 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:20:41,358 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:20:41,364 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:20:41,364 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:20:41,365 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:20:41,365 - main - INFO - 
2025-11-19 15:20:41,365 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:20:41,365 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:20:41,366 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:20:41,366 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:20:41,366 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:20:41,366 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:20:41,366 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:20:41,367 - main - INFO - 
2025-11-19 15:20:41,367 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:20:41,367 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:20:41,367 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:20:41,368 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:20:41,368 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:20:41,368 - main - INFO - 
2025-11-19 15:20:41,368 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:20:41,368 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:20:41,368 - main - INFO -        - No manual section generation
2025-11-19 15:20:41,369 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:20:41,369 - main - INFO - 
2025-11-19 15:20:41,369 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:20:41,369 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:20:41,370 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:20:41,370 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:20:41,370 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:20:41,371 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:20:41,371 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:20:41,371 - main - INFO - 
2025-11-19 15:20:41,371 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:20:41,372 - main - INFO -      Main:
2025-11-19 15:20:41,372 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:20:41,372 - main - INFO - 
2025-11-19 15:20:41,372 - main - INFO -      Retrieval:
2025-11-19 15:20:41,372 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:20:41,372 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:20:41,373 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:20:41,373 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:20:41,373 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:20:41,373 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:20:41,373 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:20:41,373 - main - INFO - 
2025-11-19 15:20:41,373 - main - INFO -      Management:
2025-11-19 15:20:41,374 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:20:41,374 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:20:41,374 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:20:41,374 - main - INFO - 
2025-11-19 15:20:41,374 - main - INFO -      Documents (MongoDB):
2025-11-19 15:20:41,374 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:20:41,374 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:20:41,375 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:20:41,375 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:20:41,375 - main - INFO - 
2025-11-19 15:20:41,375 - main - INFO -      Diagnostics & Health:
2025-11-19 15:20:41,375 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:20:41,375 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:20:41,375 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:20:41,376 - main - INFO - 
2025-11-19 15:20:41,376 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:20:41,376 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:20:41,376 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:20:41,376 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:20:41,377 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:20:41,377 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:20:41,377 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:20:41,377 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:20:41,377 - main - INFO - 
2025-11-19 15:20:41,377 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:20:41,377 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:20:41,378 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:20:41,378 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:20:41,378 - main - INFO -      4. No re-upload needed!
2025-11-19 15:20:41,378 - main - INFO - 
2025-11-19 15:20:41,378 - main - INFO - ================================================================================
2025-11-19 15:20:41,378 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:20:41,379 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:20:41,379 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:20:41,379 - main - INFO - ================================================================================
2025-11-19 15:20:41,379 - main - INFO - 
2025-11-19 15:20:41,380 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:20:50,653 - main - INFO - 
2025-11-19 15:20:50,653 - main - INFO - ================================================================================
2025-11-19 15:20:50,653 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:20:50,654 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:20:50,655 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:20:50,656 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:20:50,657 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:20:50,659 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:20:50,660 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:20:50,661 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:20:50,662 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:20:50,662 - main - INFO - ================================================================================
2025-11-19 15:20:50,662 - main - INFO - 
2025-11-19 15:20:55,518 - main - INFO - 
2025-11-19 15:20:55,519 - main - INFO - ================================================================================
2025-11-19 15:20:55,519 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:20:55,519 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:20:55,520 - main - INFO - ================================================================================
2025-11-19 15:20:55,520 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:20:55,520 - main - INFO -   Upload Directory: uploads
2025-11-19 15:20:55,520 - main - INFO -   Max File Size: 20MB
2025-11-19 15:20:55,521 - main - INFO - ================================================================================
2025-11-19 15:20:55,522 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:20:55,523 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:20:55,524 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:20:55,551 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:20:55,560 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:20:55,560 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:20:55,561 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:20:55,561 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:20:55,561 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:20:55,562 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:20:55,563 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:20:55,575 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:20:55,576 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:20:55,577 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:20:55,581 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:20:55,581 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:20:55,581 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:20:55,582 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:20:55,582 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:20:55,592 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:20:55,592 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:20:55,592 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:20:55,593 - main - INFO - 
2025-11-19 15:20:55,593 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:20:55,593 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:20:55,593 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:20:55,594 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:20:55,594 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:20:55,594 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:20:55,594 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:20:55,594 - main - INFO - 
2025-11-19 15:20:55,595 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:20:55,595 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:20:55,595 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:20:55,596 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:20:55,596 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:20:55,597 - main - INFO - 
2025-11-19 15:20:55,597 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:20:55,597 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:20:55,598 - main - INFO -        - No manual section generation
2025-11-19 15:20:55,598 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:20:55,598 - main - INFO - 
2025-11-19 15:20:55,598 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:20:55,598 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:20:55,599 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:20:55,599 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:20:55,599 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:20:55,599 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:20:55,599 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:20:55,600 - main - INFO - 
2025-11-19 15:20:55,600 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:20:55,600 - main - INFO -      Main:
2025-11-19 15:20:55,600 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:20:55,600 - main - INFO - 
2025-11-19 15:20:55,601 - main - INFO -      Retrieval:
2025-11-19 15:20:55,601 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:20:55,601 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:20:55,601 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:20:55,601 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:20:55,602 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:20:55,602 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:20:55,602 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:20:55,602 - main - INFO - 
2025-11-19 15:20:55,603 - main - INFO -      Management:
2025-11-19 15:20:55,603 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:20:55,603 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:20:55,603 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:20:55,604 - main - INFO - 
2025-11-19 15:20:55,604 - main - INFO -      Documents (MongoDB):
2025-11-19 15:20:55,604 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:20:55,604 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:20:55,605 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:20:55,605 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:20:55,605 - main - INFO - 
2025-11-19 15:20:55,605 - main - INFO -      Diagnostics & Health:
2025-11-19 15:20:55,605 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:20:55,606 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:20:55,606 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:20:55,607 - main - INFO - 
2025-11-19 15:20:55,607 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:20:55,607 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:20:55,608 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:20:55,608 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:20:55,608 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:20:55,608 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:20:55,609 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:20:55,609 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:20:55,609 - main - INFO - 
2025-11-19 15:20:55,609 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:20:55,609 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:20:55,609 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:20:55,610 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:20:55,610 - main - INFO -      4. No re-upload needed!
2025-11-19 15:20:55,610 - main - INFO - 
2025-11-19 15:20:55,610 - main - INFO - ================================================================================
2025-11-19 15:20:55,610 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:20:55,611 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:20:55,611 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:20:55,611 - main - INFO - ================================================================================
2025-11-19 15:20:55,611 - main - INFO - 
2025-11-19 15:20:55,612 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:20:58,836 - main - INFO - 
2025-11-19 15:20:58,836 - main - INFO - ================================================================================
2025-11-19 15:20:58,837 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:20:58,837 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:20:58,837 - main - INFO - ================================================================================
2025-11-19 15:20:58,837 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:20:58,838 - main - INFO -   Upload Directory: uploads
2025-11-19 15:20:58,838 - main - INFO -   Max File Size: 20MB
2025-11-19 15:20:58,838 - main - INFO - ================================================================================
2025-11-19 15:20:58,839 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:20:58,840 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:20:58,841 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:20:58,861 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:20:58,865 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:20:58,866 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:20:58,866 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:20:58,866 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:20:58,866 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:20:58,867 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:20:58,867 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:20:58,877 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:20:58,878 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:20:58,879 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:20:58,880 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:20:58,881 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:20:58,881 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:20:58,881 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:20:58,881 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:20:58,908 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:20:58,908 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:20:58,908 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:20:58,908 - main - INFO - 
2025-11-19 15:20:58,909 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:20:58,909 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:20:58,909 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:20:58,909 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:20:58,909 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:20:58,910 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:20:58,910 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:20:58,910 - main - INFO - 
2025-11-19 15:20:58,910 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:20:58,910 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:20:58,910 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:20:58,911 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:20:58,911 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:20:58,911 - main - INFO - 
2025-11-19 15:20:58,911 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:20:58,911 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:20:58,911 - main - INFO -        - No manual section generation
2025-11-19 15:20:58,912 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:20:58,912 - main - INFO - 
2025-11-19 15:20:58,912 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:20:58,912 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:20:58,912 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:20:58,912 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:20:58,912 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:20:58,913 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:20:58,913 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:20:58,913 - main - INFO - 
2025-11-19 15:20:58,913 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:20:58,913 - main - INFO -      Main:
2025-11-19 15:20:58,913 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:20:58,914 - main - INFO - 
2025-11-19 15:20:58,914 - main - INFO -      Retrieval:
2025-11-19 15:20:58,914 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:20:58,914 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:20:58,914 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:20:58,914 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:20:58,915 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:20:58,915 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:20:58,915 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:20:58,915 - main - INFO - 
2025-11-19 15:20:58,915 - main - INFO -      Management:
2025-11-19 15:20:58,915 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:20:58,915 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:20:58,916 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:20:58,916 - main - INFO - 
2025-11-19 15:20:58,916 - main - INFO -      Documents (MongoDB):
2025-11-19 15:20:58,916 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:20:58,916 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:20:58,916 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:20:58,916 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:20:58,917 - main - INFO - 
2025-11-19 15:20:58,917 - main - INFO -      Diagnostics & Health:
2025-11-19 15:20:58,917 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:20:58,917 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:20:58,917 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:20:58,917 - main - INFO - 
2025-11-19 15:20:58,918 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:20:58,918 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:20:58,918 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:20:58,918 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:20:58,918 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:20:58,919 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:20:58,919 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:20:58,919 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:20:58,919 - main - INFO - 
2025-11-19 15:20:58,919 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:20:58,920 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:20:58,920 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:20:58,920 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:20:58,920 - main - INFO -      4. No re-upload needed!
2025-11-19 15:20:58,920 - main - INFO - 
2025-11-19 15:20:58,920 - main - INFO - ================================================================================
2025-11-19 15:20:58,921 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:20:58,921 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:20:58,921 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:20:58,922 - main - INFO - ================================================================================
2025-11-19 15:20:58,923 - main - INFO - 
2025-11-19 15:20:58,924 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:01,373 - main - INFO - 
2025-11-19 15:21:01,373 - main - INFO - ================================================================================
2025-11-19 15:21:01,374 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:21:01,375 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:21:01,377 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:21:01,379 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:21:01,379 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:21:01,380 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:21:01,381 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:21:01,381 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:21:01,381 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:21:01,381 - main - INFO - ================================================================================
2025-11-19 15:21:01,382 - main - INFO - 
2025-11-19 15:21:05,136 - main - INFO - 
2025-11-19 15:21:05,137 - main - INFO - ================================================================================
2025-11-19 15:21:05,137 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:21:05,137 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:21:05,137 - main - INFO - ================================================================================
2025-11-19 15:21:05,138 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:21:05,138 - main - INFO -   Upload Directory: uploads
2025-11-19 15:21:05,138 - main - INFO -   Max File Size: 20MB
2025-11-19 15:21:05,138 - main - INFO - ================================================================================
2025-11-19 15:21:05,139 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:21:05,139 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:21:05,139 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:21:05,187 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:21:05,196 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:21:05,197 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:21:05,198 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:21:05,199 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:21:05,199 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:21:05,199 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:05,200 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:05,242 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:21:05,243 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:21:05,244 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:21:05,248 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:21:05,248 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:21:05,249 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:21:05,249 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:05,249 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:05,289 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:21:05,289 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:21:05,289 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:21:05,289 - main - INFO - 
2025-11-19 15:21:05,290 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:21:05,290 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:21:05,290 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:21:05,290 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:21:05,290 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:21:05,291 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:21:05,291 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:21:05,291 - main - INFO - 
2025-11-19 15:21:05,291 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:21:05,291 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:21:05,292 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:21:05,292 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:21:05,292 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:21:05,292 - main - INFO - 
2025-11-19 15:21:05,292 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:21:05,293 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:21:05,293 - main - INFO -        - No manual section generation
2025-11-19 15:21:05,293 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:21:05,293 - main - INFO - 
2025-11-19 15:21:05,294 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:21:05,294 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:21:05,294 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:21:05,294 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:21:05,295 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:21:05,295 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:21:05,296 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:21:05,297 - main - INFO - 
2025-11-19 15:21:05,297 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:21:05,298 - main - INFO -      Main:
2025-11-19 15:21:05,298 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:21:05,298 - main - INFO - 
2025-11-19 15:21:05,299 - main - INFO -      Retrieval:
2025-11-19 15:21:05,299 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:21:05,299 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:21:05,300 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:21:05,300 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:21:05,300 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:21:05,301 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:21:05,301 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:21:05,301 - main - INFO - 
2025-11-19 15:21:05,302 - main - INFO -      Management:
2025-11-19 15:21:05,302 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:21:05,302 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:21:05,302 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:21:05,302 - main - INFO - 
2025-11-19 15:21:05,303 - main - INFO -      Documents (MongoDB):
2025-11-19 15:21:05,303 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:21:05,303 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:21:05,303 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:21:05,303 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:21:05,303 - main - INFO - 
2025-11-19 15:21:05,304 - main - INFO -      Diagnostics & Health:
2025-11-19 15:21:05,304 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:21:05,304 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:21:05,304 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:21:05,305 - main - INFO - 
2025-11-19 15:21:05,305 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:21:05,305 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:21:05,305 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:21:05,305 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:21:05,305 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:21:05,306 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:21:05,306 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:21:05,306 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:21:05,306 - main - INFO - 
2025-11-19 15:21:05,306 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:21:05,306 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:21:05,307 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:21:05,307 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:21:05,307 - main - INFO -      4. No re-upload needed!
2025-11-19 15:21:05,307 - main - INFO - 
2025-11-19 15:21:05,307 - main - INFO - ================================================================================
2025-11-19 15:21:05,307 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:21:05,307 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:21:05,308 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:21:05,308 - main - INFO - ================================================================================
2025-11-19 15:21:05,308 - main - INFO - 
2025-11-19 15:21:05,308 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:06,459 - main - INFO - 
2025-11-19 15:21:06,459 - main - INFO - ================================================================================
2025-11-19 15:21:06,459 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:21:06,460 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:21:06,461 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:21:06,462 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:21:06,462 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:21:06,463 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:21:06,463 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:21:06,464 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:21:06,464 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:21:06,464 - main - INFO - ================================================================================
2025-11-19 15:21:06,464 - main - INFO - 
2025-11-19 15:21:11,150 - main - INFO - 
2025-11-19 15:21:11,151 - main - INFO - ================================================================================
2025-11-19 15:21:11,151 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:21:11,151 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:21:11,151 - main - INFO - ================================================================================
2025-11-19 15:21:11,152 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:21:11,152 - main - INFO -   Upload Directory: uploads
2025-11-19 15:21:11,152 - main - INFO -   Max File Size: 20MB
2025-11-19 15:21:11,152 - main - INFO - ================================================================================
2025-11-19 15:21:11,153 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:21:11,153 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:21:11,153 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:21:11,177 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:21:11,183 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:21:11,184 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:21:11,184 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:21:11,185 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:21:11,185 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:21:11,186 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:11,186 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:11,198 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:21:11,200 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:21:11,202 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:21:11,205 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:21:11,205 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:21:11,206 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:21:11,206 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:11,206 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:11,215 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:21:11,215 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:21:11,215 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:21:11,216 - main - INFO - 
2025-11-19 15:21:11,216 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:21:11,216 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:21:11,216 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:21:11,216 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:21:11,217 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:21:11,217 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:21:11,217 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:21:11,217 - main - INFO - 
2025-11-19 15:21:11,218 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:21:11,218 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:21:11,218 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:21:11,218 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:21:11,218 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:21:11,218 - main - INFO - 
2025-11-19 15:21:11,219 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:21:11,219 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:21:11,219 - main - INFO -        - No manual section generation
2025-11-19 15:21:11,219 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:21:11,219 - main - INFO - 
2025-11-19 15:21:11,219 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:21:11,220 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:21:11,220 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:21:11,220 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:21:11,220 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:21:11,220 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:21:11,220 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:21:11,221 - main - INFO - 
2025-11-19 15:21:11,221 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:21:11,221 - main - INFO -      Main:
2025-11-19 15:21:11,221 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:21:11,221 - main - INFO - 
2025-11-19 15:21:11,221 - main - INFO -      Retrieval:
2025-11-19 15:21:11,221 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:21:11,222 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:21:11,222 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:21:11,222 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:21:11,222 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:21:11,222 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:21:11,223 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:21:11,223 - main - INFO - 
2025-11-19 15:21:11,223 - main - INFO -      Management:
2025-11-19 15:21:11,223 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:21:11,223 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:21:11,223 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:21:11,223 - main - INFO - 
2025-11-19 15:21:11,224 - main - INFO -      Documents (MongoDB):
2025-11-19 15:21:11,224 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:21:11,224 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:21:11,224 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:21:11,224 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:21:11,224 - main - INFO - 
2025-11-19 15:21:11,225 - main - INFO -      Diagnostics & Health:
2025-11-19 15:21:11,225 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:21:11,225 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:21:11,225 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:21:11,225 - main - INFO - 
2025-11-19 15:21:11,225 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:21:11,226 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:21:11,227 - main - INFO - 
2025-11-19 15:21:11,227 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:21:11,227 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:21:11,227 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:21:11,227 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:21:11,228 - main - INFO -      4. No re-upload needed!
2025-11-19 15:21:11,228 - main - INFO - 
2025-11-19 15:21:11,228 - main - INFO - ================================================================================
2025-11-19 15:21:11,228 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:21:11,228 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:21:11,229 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:21:11,229 - main - INFO - ================================================================================
2025-11-19 15:21:11,229 - main - INFO - 
2025-11-19 15:21:11,229 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:15,662 - main - INFO - 
2025-11-19 15:21:15,662 - main - INFO - ================================================================================
2025-11-19 15:21:15,662 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:21:15,663 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:21:15,664 - main - INFO - ================================================================================
2025-11-19 15:21:15,664 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:21:15,664 - main - INFO -   Upload Directory: uploads
2025-11-19 15:21:15,665 - main - INFO -   Max File Size: 20MB
2025-11-19 15:21:15,665 - main - INFO - ================================================================================
2025-11-19 15:21:15,665 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:21:15,666 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:21:15,666 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:21:15,703 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:21:15,709 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:21:15,709 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:21:15,709 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:21:15,710 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:21:15,710 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:21:15,710 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:15,710 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:15,717 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:21:15,718 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:21:15,719 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:21:15,721 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:21:15,721 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:21:15,722 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:21:15,722 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:15,722 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:15,731 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:21:15,732 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:21:15,732 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:21:15,732 - main - INFO - 
2025-11-19 15:21:15,732 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:21:15,733 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:21:15,733 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:21:15,733 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:21:15,733 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:21:15,734 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:21:15,734 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:21:15,734 - main - INFO - 
2025-11-19 15:21:15,734 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:21:15,735 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:21:15,735 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:21:15,735 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:21:15,735 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:21:15,736 - main - INFO - 
2025-11-19 15:21:15,737 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:21:15,737 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:21:15,737 - main - INFO -        - No manual section generation
2025-11-19 15:21:15,738 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:21:15,738 - main - INFO - 
2025-11-19 15:21:15,738 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:21:15,738 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:21:15,738 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:21:15,739 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:21:15,739 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:21:15,739 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:21:15,739 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:21:15,739 - main - INFO - 
2025-11-19 15:21:15,740 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:21:15,740 - main - INFO -      Main:
2025-11-19 15:21:15,740 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:21:15,740 - main - INFO - 
2025-11-19 15:21:15,740 - main - INFO -      Retrieval:
2025-11-19 15:21:15,741 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:21:15,741 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:21:15,741 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:21:15,741 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:21:15,742 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:21:15,742 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:21:15,742 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:21:15,743 - main - INFO - 
2025-11-19 15:21:15,744 - main - INFO -      Management:
2025-11-19 15:21:15,744 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:21:15,745 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:21:15,745 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:21:15,745 - main - INFO - 
2025-11-19 15:21:15,746 - main - INFO -      Documents (MongoDB):
2025-11-19 15:21:15,746 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:21:15,746 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:21:15,746 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:21:15,746 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:21:15,747 - main - INFO - 
2025-11-19 15:21:15,747 - main - INFO -      Diagnostics & Health:
2025-11-19 15:21:15,747 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:21:15,747 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:21:15,747 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:21:15,748 - main - INFO - 
2025-11-19 15:21:15,748 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:21:15,748 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:21:15,748 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:21:15,749 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:21:15,749 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:21:15,749 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:21:15,749 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:21:15,750 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:21:15,750 - main - INFO - 
2025-11-19 15:21:15,750 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:21:15,750 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:21:15,750 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:21:15,750 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:21:15,751 - main - INFO -      4. No re-upload needed!
2025-11-19 15:21:15,751 - main - INFO - 
2025-11-19 15:21:15,751 - main - INFO - ================================================================================
2025-11-19 15:21:15,751 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:21:15,752 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:21:15,752 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:21:15,752 - main - INFO - ================================================================================
2025-11-19 15:21:15,752 - main - INFO - 
2025-11-19 15:21:15,752 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:19,986 - main - INFO - 
2025-11-19 15:21:19,987 - main - INFO - ================================================================================
2025-11-19 15:21:19,987 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:21:19,987 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:21:19,987 - main - INFO - ================================================================================
2025-11-19 15:21:19,987 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:21:19,988 - main - INFO -   Upload Directory: uploads
2025-11-19 15:21:19,988 - main - INFO -   Max File Size: 20MB
2025-11-19 15:21:19,988 - main - INFO - ================================================================================
2025-11-19 15:21:19,988 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:21:19,988 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:21:19,989 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:21:20,046 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:21:20,056 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:21:20,056 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:21:20,057 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:21:20,057 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:21:20,057 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:21:20,057 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:20,057 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:20,065 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:21:20,067 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:21:20,067 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:21:20,069 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:21:20,070 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:21:20,070 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:21:20,070 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:20,071 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:20,082 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:21:20,082 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:21:20,082 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:21:20,083 - main - INFO - 
2025-11-19 15:21:20,083 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:21:20,083 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:21:20,083 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:21:20,083 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:21:20,083 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:21:20,084 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:21:20,084 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:21:20,084 - main - INFO - 
2025-11-19 15:21:20,084 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:21:20,084 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:21:20,085 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:21:20,085 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:21:20,085 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:21:20,085 - main - INFO - 
2025-11-19 15:21:20,086 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:21:20,086 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:21:20,087 - main - INFO -        - No manual section generation
2025-11-19 15:21:20,087 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:21:20,087 - main - INFO - 
2025-11-19 15:21:20,088 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:21:20,088 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:21:20,088 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:21:20,089 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:21:20,090 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:21:20,090 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:21:20,091 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:21:20,091 - main - INFO - 
2025-11-19 15:21:20,091 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:21:20,091 - main - INFO -      Main:
2025-11-19 15:21:20,091 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:21:20,091 - main - INFO - 
2025-11-19 15:21:20,092 - main - INFO -      Retrieval:
2025-11-19 15:21:20,092 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:21:20,092 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:21:20,092 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:21:20,092 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:21:20,093 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:21:20,093 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:21:20,093 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:21:20,093 - main - INFO - 
2025-11-19 15:21:20,093 - main - INFO -      Management:
2025-11-19 15:21:20,094 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:21:20,094 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:21:20,094 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:21:20,094 - main - INFO - 
2025-11-19 15:21:20,094 - main - INFO -      Documents (MongoDB):
2025-11-19 15:21:20,094 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:21:20,095 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:21:20,095 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:21:20,096 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:21:20,097 - main - INFO - 
2025-11-19 15:21:20,097 - main - INFO -      Diagnostics & Health:
2025-11-19 15:21:20,098 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:21:20,098 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:21:20,098 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:21:20,099 - main - INFO - 
2025-11-19 15:21:20,099 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:21:20,099 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:21:20,099 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:21:20,100 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:21:20,100 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:21:20,100 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:21:20,101 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:21:20,101 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:21:20,101 - main - INFO - 
2025-11-19 15:21:20,101 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:21:20,102 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:21:20,102 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:21:20,103 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:21:20,103 - main - INFO -      4. No re-upload needed!
2025-11-19 15:21:20,103 - main - INFO - 
2025-11-19 15:21:20,103 - main - INFO - ================================================================================
2025-11-19 15:21:20,103 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:21:20,104 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:21:20,104 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:21:20,104 - main - INFO - ================================================================================
2025-11-19 15:21:20,104 - main - INFO - 
2025-11-19 15:21:20,105 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:23,456 - main - INFO - 
2025-11-19 15:21:23,456 - main - INFO - ================================================================================
2025-11-19 15:21:23,456 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:21:23,456 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:21:23,457 - main - INFO - ================================================================================
2025-11-19 15:21:23,457 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:21:23,457 - main - INFO -   Upload Directory: uploads
2025-11-19 15:21:23,457 - main - INFO -   Max File Size: 20MB
2025-11-19 15:21:23,457 - main - INFO - ================================================================================
2025-11-19 15:21:23,458 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:21:23,458 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:21:23,458 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:21:23,477 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:21:23,485 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:21:23,485 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:21:23,486 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:21:23,486 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:21:23,486 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:21:23,486 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:23,487 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:23,493 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:21:23,494 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:21:23,495 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:21:23,497 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:21:23,498 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:21:23,498 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:21:23,500 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:23,502 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:23,532 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:21:23,533 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:21:23,533 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:21:23,534 - main - INFO - 
2025-11-19 15:21:23,535 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:21:23,536 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:21:23,537 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:21:23,537 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:21:23,538 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:21:23,538 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:21:23,538 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:21:23,538 - main - INFO - 
2025-11-19 15:21:23,539 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:21:23,539 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:21:23,539 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:21:23,540 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:21:23,540 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:21:23,540 - main - INFO - 
2025-11-19 15:21:23,540 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:21:23,541 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:21:23,541 - main - INFO -        - No manual section generation
2025-11-19 15:21:23,541 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:21:23,541 - main - INFO - 
2025-11-19 15:21:23,541 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:21:23,541 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:21:23,542 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:21:23,542 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:21:23,542 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:21:23,542 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:21:23,542 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:21:23,543 - main - INFO - 
2025-11-19 15:21:23,543 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:21:23,543 - main - INFO -      Main:
2025-11-19 15:21:23,543 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:21:23,543 - main - INFO - 
2025-11-19 15:21:23,543 - main - INFO -      Retrieval:
2025-11-19 15:21:23,544 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:21:23,544 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:21:23,544 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:21:23,544 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:21:23,544 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:21:23,544 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:21:23,545 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:21:23,545 - main - INFO - 
2025-11-19 15:21:23,545 - main - INFO -      Management:
2025-11-19 15:21:23,545 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:21:23,545 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:21:23,546 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:21:23,546 - main - INFO - 
2025-11-19 15:21:23,546 - main - INFO -      Documents (MongoDB):
2025-11-19 15:21:23,546 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:21:23,546 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:21:23,546 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:21:23,547 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:21:23,547 - main - INFO - 
2025-11-19 15:21:23,547 - main - INFO -      Diagnostics & Health:
2025-11-19 15:21:23,547 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:21:23,547 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:21:23,547 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:21:23,548 - main - INFO - 
2025-11-19 15:21:23,548 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:21:23,548 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:21:23,548 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:21:23,548 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:21:23,549 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:21:23,549 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:21:23,549 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:21:23,550 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:21:23,550 - main - INFO - 
2025-11-19 15:21:23,550 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:21:23,551 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:21:23,551 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:21:23,551 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:21:23,551 - main - INFO -      4. No re-upload needed!
2025-11-19 15:21:23,552 - main - INFO - 
2025-11-19 15:21:23,552 - main - INFO - ================================================================================
2025-11-19 15:21:23,552 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:21:23,552 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:21:23,552 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:21:23,552 - main - INFO - ================================================================================
2025-11-19 15:21:23,553 - main - INFO - 
2025-11-19 15:21:23,553 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:29,137 - main - INFO - 
2025-11-19 15:21:29,138 - main - INFO - ================================================================================
2025-11-19 15:21:29,140 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:21:29,147 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:21:29,153 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:21:29,155 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:21:29,162 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:21:29,163 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:21:29,163 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:21:29,164 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:21:29,164 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:21:29,165 - main - INFO - ================================================================================
2025-11-19 15:21:29,165 - main - INFO - 
2025-11-19 15:21:31,813 - main - INFO - 
2025-11-19 15:21:31,814 - main - INFO - ================================================================================
2025-11-19 15:21:31,814 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:21:31,814 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:21:31,814 - main - INFO - ================================================================================
2025-11-19 15:21:31,814 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:21:31,815 - main - INFO -   Upload Directory: uploads
2025-11-19 15:21:31,815 - main - INFO -   Max File Size: 20MB
2025-11-19 15:21:31,815 - main - INFO - ================================================================================
2025-11-19 15:21:31,815 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:21:31,815 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:21:31,816 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:21:31,832 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:21:31,836 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:21:31,836 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:21:31,837 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:21:31,837 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:21:31,837 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:21:31,837 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:31,838 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:31,843 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:21:31,844 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:21:31,845 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:21:31,847 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:21:31,848 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:21:31,848 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:21:31,848 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:21:31,849 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:21:31,858 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:21:31,858 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:21:31,858 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:21:31,859 - main - INFO - 
2025-11-19 15:21:31,859 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:21:31,859 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:21:31,859 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:21:31,860 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:21:31,860 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:21:31,860 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:21:31,860 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:21:31,861 - main - INFO - 
2025-11-19 15:21:31,861 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:21:31,861 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:21:31,861 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:21:31,861 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:21:31,861 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:21:31,862 - main - INFO - 
2025-11-19 15:21:31,862 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:21:31,862 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:21:31,863 - main - INFO -        - No manual section generation
2025-11-19 15:21:31,863 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:21:31,863 - main - INFO - 
2025-11-19 15:21:31,863 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:21:31,864 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:21:31,864 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:21:31,864 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:21:31,864 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:21:31,864 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:21:31,865 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:21:31,865 - main - INFO - 
2025-11-19 15:21:31,865 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:21:31,865 - main - INFO -      Main:
2025-11-19 15:21:31,865 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:21:31,866 - main - INFO - 
2025-11-19 15:21:31,866 - main - INFO -      Retrieval:
2025-11-19 15:21:31,866 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:21:31,866 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:21:31,866 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:21:31,867 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:21:31,867 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:21:31,867 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:21:31,867 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:21:31,868 - main - INFO - 
2025-11-19 15:21:31,868 - main - INFO -      Management:
2025-11-19 15:21:31,868 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:21:31,869 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:21:31,869 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:21:31,870 - main - INFO - 
2025-11-19 15:21:31,871 - main - INFO -      Documents (MongoDB):
2025-11-19 15:21:31,872 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:21:31,872 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:21:31,872 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:21:31,872 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:21:31,872 - main - INFO - 
2025-11-19 15:21:31,873 - main - INFO -      Diagnostics & Health:
2025-11-19 15:21:31,873 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:21:31,873 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:21:31,873 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:21:31,873 - main - INFO - 
2025-11-19 15:21:31,874 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:21:31,874 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:21:31,874 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:21:31,874 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:21:31,874 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:21:31,874 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:21:31,875 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:21:31,875 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:21:31,875 - main - INFO - 
2025-11-19 15:21:31,875 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:21:31,875 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:21:31,875 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:21:31,875 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:21:31,876 - main - INFO -      4. No re-upload needed!
2025-11-19 15:21:31,876 - main - INFO - 
2025-11-19 15:21:31,876 - main - INFO - ================================================================================
2025-11-19 15:21:31,876 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:21:31,876 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:21:31,876 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:21:31,876 - main - INFO - ================================================================================
2025-11-19 15:21:31,877 - main - INFO - 
2025-11-19 15:21:31,877 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:21:47,533 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 15:21:47,534 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 15:21:47,632 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 15:21:47,642 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-19 15:22:24,191 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 15:22:24,203 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 15:22:24,203 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:22:24,206 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:22:24,207 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:22:24,209 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:22:24,211 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 15:22:24,211 - app.api.routes - INFO -    - Remaining comparisons: 229
2025-11-19 15:22:24,211 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 15:22:24,211 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 15:22:24,212 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763565744_34320d9873de
2025-11-19 15:22:24,212 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_b23d3f44c0e1 (3 files)
2025-11-19 15:22:24,212 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_b23d3f44c0e1
2025-11-19 15:22:24,213 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:22:24,214 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:22:24,214 - app.api.routes - INFO - ======================================================================
2025-11-19 15:22:24,216 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 4988d3eab1f74388b3566fa2b124d725.pdf (464206 bytes)
2025-11-19 15:22:24,216 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:22:24,217 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\4988d3eab1f74388b3566fa2b124d725.pdf
2025-11-19 15:22:24,217 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:22:24,218 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:22:24,259 - app.api.routes - INFO - ======================================================================
2025-11-19 15:22:24,277 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 99693d4fea4c46ab930dca93721cfd05.pdf (175401 bytes)
2025-11-19 15:22:24,290 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 15:22:24,290 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:22:24,291 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:22:24,291 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\99693d4fea4c46ab930dca93721cfd05.pdf
2025-11-19 15:22:24,291 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:22:24,291 - app.api.routes - INFO - ======================================================================
2025-11-19 15:22:24,340 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 15:22:24,340 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 31b625740253455d97a8b2eb9b1c5720.pdf (331157 bytes)
2025-11-19 15:22:24,341 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:22:24,341 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:22:24,341 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\31b625740253455d97a8b2eb9b1c5720.pdf
2025-11-19 15:22:24,341 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:22:24,342 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 15:22:24,358 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 15:22:24,373 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:22:24,391 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:22:24,399 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 15:22:24,399 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 15:22:24,560 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 15:22:24,560 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:22:24,910 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:22:24,910 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:22:24,910 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 15:22:24,911 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 15:22:24,911 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:22:24,911 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:22:24,912 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 15:22:24,990 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 15:22:24,990 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:22:24,991 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:22:24,991 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:22:24,992 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 15:22:24,992 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 15:22:24,992 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 15:22:24,992 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:22:24,993 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 15:22:25,115 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 15:22:25,116 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:22:52,999 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:22:53,007 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:22:53,007 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:22:53,008 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:22:53,008 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 15:22:53,008 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:22:53,009 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 15:22:53,014 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 15:22:53,015 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 15:22:53,015 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:23:00,996 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:01,064 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:23:01,065 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:23:01,066 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 15:23:01,066 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 15:23:01,067 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:23:01,068 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:23:01,068 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 15:23:07,310 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:07,327 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:23:07,328 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:23:07,329 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:23:07,329 - app.services.ai_parser - WARNING - âš ï¸ Only 5 benefits, using fallback...
2025-11-19 15:23:07,340 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 32 benefits from patterns
2025-11-19 15:23:07,342 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 37 total
2025-11-19 15:23:07,342 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:23:08,879 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:08,885 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:23:08,886 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:23:08,887 - app.services.ai_parser - INFO - 
2025-11-19 15:23:08,888 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:08,888 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:23:08,889 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:08,890 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 15:23:08,890 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:23:08,891 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 15:23:08,892 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 15:23:08,892 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:23:08,893 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:23:08,894 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:23:08,895 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:23:08,895 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:23:08,896 - app.services.ai_parser - INFO - 
2025-11-19 15:23:08,896 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:23:08,897 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 15:23:08,898 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 15:23:08,898 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 15:23:08,898 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:23:08,898 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:23:08,899 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:08,900 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 4988d3eab1f74388b3566fa2b124d725.pdf â†’ 691de0dcce127eab9fc72ffe
2025-11-19 15:23:08,900 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de0dcce127eab9fc72ffe
2025-11-19 15:23:08,906 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691de0dcce127eab9fc72fff (464206 bytes)
2025-11-19 15:23:08,906 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691de0dcce127eab9fc72fff
2025-11-19 15:23:08,906 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:23:10,118 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:10,119 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:23:10,119 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:23:10,119 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:23:10,120 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-19 15:23:10,123 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 60 benefits from patterns
2025-11-19 15:23:10,123 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 57 total
2025-11-19 15:23:10,123 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:23:12,396 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:12,401 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:23:12,401 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:23:12,402 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 15:23:12,402 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 15:23:12,403 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:23:12,403 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:23:12,403 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:23:12,403 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:23:12,403 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:23:12,404 - app.services.ai_parser - INFO - ðŸ“Š Counts: 37 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 15:23:19,705 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:19,709 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 15:23:19,709 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:23:19,710 - app.services.ai_parser - INFO - 
2025-11-19 15:23:19,711 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:19,712 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:23:19,712 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:19,713 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 15:23:19,714 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 15:23:19,714 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 15:23:19,715 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 15:23:19,715 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 15:23:19,716 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:23:19,717 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:23:19,717 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 15:23:19,718 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 15:23:19,719 - app.services.ai_parser - INFO - 
2025-11-19 15:23:19,719 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:23:19,720 - app.services.ai_parser - INFO -    âœ“ Benefits: 37
2025-11-19 15:23:19,721 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 15:23:19,721 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 15:23:19,722 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:23:19,723 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:23:19,723 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:19,725 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 31b625740253455d97a8b2eb9b1c5720.pdf â†’ 691de0e7ce127eab9fc73000
2025-11-19 15:23:19,726 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de0e7ce127eab9fc73000
2025-11-19 15:23:19,730 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691de0e7ce127eab9fc73001 (331157 bytes)
2025-11-19 15:23:19,731 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691de0e7ce127eab9fc73001
2025-11-19 15:23:19,732 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:23:22,237 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:22,238 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:23:22,238 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:23:22,238 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 15:23:22,238 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 15:23:22,239 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:23:22,239 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:23:22,239 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:23:22,239 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:23:22,240 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:23:22,240 - app.services.ai_parser - INFO - ðŸ“Š Counts: 57 benefits, 29 exclusions, 8 warranties, 5 extensions
2025-11-19 15:23:31,059 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:31,067 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:23:31,067 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:23:31,067 - app.services.ai_parser - INFO - 
2025-11-19 15:23:31,068 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:31,068 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:23:31,068 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:31,068 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 15:23:31,068 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:23:31,069 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-19 15:23:31,069 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 15:23:31,069 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:23:31,069 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:23:31,069 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:23:31,070 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:23:31,070 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:23:31,070 - app.services.ai_parser - INFO - 
2025-11-19 15:23:31,070 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:23:31,070 - app.services.ai_parser - INFO -    âœ“ Benefits: 57
2025-11-19 15:23:31,071 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 15:23:31,071 - app.services.ai_parser - INFO -    âœ“ Warranties: 8
2025-11-19 15:23:31,071 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:23:31,071 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:23:31,071 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:23:31,072 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 99693d4fea4c46ab930dca93721cfd05.pdf â†’ 691de0f3ce127eab9fc73002
2025-11-19 15:23:31,073 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de0f3ce127eab9fc73002
2025-11-19 15:23:31,074 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691de0f3ce127eab9fc73003 (175401 bytes)
2025-11-19 15:23:31,075 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691de0f3ce127eab9fc73003
2025-11-19 15:23:31,075 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:23:31,075 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 15:23:31,075 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:23:31,076 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 15:23:31,076 - app.api.routes - INFO - ======================================================================
2025-11-19 15:23:31,076 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 15:23:31,076 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 15:23:31,076 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 15:23:31,077 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:23:31,077 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-19 15:23:31,077 - app.services.ai_ranker - INFO - ================================================================================
2025-11-19 15:23:31,077 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:23:31,077 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-19 15:23:31,078 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:23:31,078 - app.services.ai_ranker - INFO -    Extended data exists: False
2025-11-19 15:23:31,078 - app.services.ai_ranker - INFO -    Extended data keys: None
2025-11-19 15:23:31,078 - app.services.ai_ranker - INFO -    Subjectivities data exists: False
2025-11-19 15:23:31,079 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:23:31,079 - app.services.ai_ranker - INFO -    Subjectivities data: {}
2025-11-19 15:23:31,079 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: False
2025-11-19 15:23:31,080 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:23:31,080 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:23:31,080 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:23:31,080 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-19 15:23:31,081 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'conditions_precedent': []
2025-11-19 15:23:31,081 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-19 15:23:31,082 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:23:31,082 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:23:31,082 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:23:31,082 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:23:31,083 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:23:31,083 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:23:31,083 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:23:31,084 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:23:31,084 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:23:31,084 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:23:31,085 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:23:31,085 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:23:31,085 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:23:31,085 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 0
2025-11-19 15:23:31,086 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:23:31,088 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Tawuniya after all extraction methods
2025-11-19 15:23:31,089 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-19 15:23:31,089 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-19 15:23:31,089 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:23:31,090 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-19 15:23:31,090 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:23:31,090 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:23:31,090 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-19 15:23:31,091 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:23:31,091 - app.services.ai_ranker - INFO -    Extended data exists: False
2025-11-19 15:23:31,091 - app.services.ai_ranker - INFO -    Extended data keys: None
2025-11-19 15:23:31,091 - app.services.ai_ranker - INFO -    Subjectivities data exists: False
2025-11-19 15:23:31,091 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:23:31,092 - app.services.ai_ranker - INFO -    Subjectivities data: {}
2025-11-19 15:23:31,092 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: False
2025-11-19 15:23:31,092 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:23:31,092 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:23:31,092 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:23:31,093 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-19 15:23:31,093 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'conditions_precedent': []
2025-11-19 15:23:31,093 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-19 15:23:31,093 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:23:31,093 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:23:31,093 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:23:31,094 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:23:31,094 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:23:31,094 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:23:31,094 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:23:31,094 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:23:31,095 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:23:31,095 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:23:31,095 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:23:31,095 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:23:31,096 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:23:31,096 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 0
2025-11-19 15:23:31,097 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:23:31,097 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Liva Insurance after all extraction methods
2025-11-19 15:23:31,098 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-19 15:23:31,098 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-19 15:23:31,098 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:23:31,099 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-19 15:23:31,099 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:23:31,099 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:23:31,100 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-19 15:23:31,100 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:23:31,100 - app.services.ai_ranker - INFO -    Extended data exists: False
2025-11-19 15:23:31,101 - app.services.ai_ranker - INFO -    Extended data keys: None
2025-11-19 15:23:31,101 - app.services.ai_ranker - INFO -    Subjectivities data exists: False
2025-11-19 15:23:31,101 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:23:31,101 - app.services.ai_ranker - INFO -    Subjectivities data: {}
2025-11-19 15:23:31,101 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: False
2025-11-19 15:23:31,102 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:23:31,102 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:23:31,102 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:23:31,103 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-19 15:23:31,103 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'conditions_precedent': []
2025-11-19 15:23:31,103 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-19 15:23:31,104 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:23:31,104 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:23:31,104 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:23:31,105 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:23:31,105 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:23:31,105 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:23:31,105 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:23:31,106 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:23:31,106 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:23:31,106 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:23:31,106 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:23:31,106 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:23:31,106 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:23:31,107 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 0
2025-11-19 15:23:31,107 - app.services.ai_ranker - INFO -    âš ï¸ No subjectivities found with full extraction, trying fallback method
2025-11-19 15:23:31,107 - app.services.ai_ranker - WARNING -    âš ï¸ No subjectivities found for Chubb Arabia after all extraction methods
2025-11-19 15:23:31,107 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-19 15:23:31,107 - app.services.ai_ranker - INFO -    Warranties: 8
2025-11-19 15:23:31,108 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-19 15:23:31,108 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-19 15:23:31,108 - app.services.ai_ranker - INFO -    Subjectivities: 0
2025-11-19 15:23:31,108 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-19 15:23:31,415 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-19 15:23:31,416 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:23:31,416 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:23:31,416 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:23:31,417 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:23:31,417 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-19 15:23:31,417 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-19 15:23:31,417 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-19 15:23:31,750 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:23:31,751 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:23:31,751 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 7
2025-11-19 15:23:31,751 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:23:31,751 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:23:31,752 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-19 15:23:31,752 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-19 15:23:32,026 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:23:32,026 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:23:32,026 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:23:32,027 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:23:32,027 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:23:32,027 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-19 15:23:32,027 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:23:32,027 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-19 15:23:32,028 - app.services.ai_ranker - INFO - ================================================================================

2025-11-19 15:23:32,028 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=84.72
2025-11-19 15:23:32,028 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=81.15
2025-11-19 15:23:32,029 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=82.74
2025-11-19 15:23:32,029 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 15:23:32,029 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 15:23:42,423 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:23:42,426 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 15:23:42,426 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 15:23:42,427 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 15:23:42,427 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 15:23:42,428 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 15:23:42,428 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763565744_34320d9873de
2025-11-19 15:23:42,429 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 15:23:42,429 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 15:23:42,430 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 15:23:42,430 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 15:23:42,430 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:23:42,430 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:23:42,431 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:23:42,431 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:23:42,431 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:23:42,431 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:23:42,432 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-19 15:23:42,432 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:23:42,432 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:23:42,432 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:23:42,432 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:23:42,433 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:23:42,433 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:23:42,435 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 15:23:42,435 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,397 bytes
2025-11-19 15:23:42,435 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 29,794 bytes
2025-11-19 15:23:42,435 - app.services.mongodb_service_enhanced - INFO -    Data table: 12,686 bytes
2025-11-19 15:23:42,436 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,740 bytes
2025-11-19 15:23:42,436 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 48,141 bytes
2025-11-19 15:23:42,436 - app.services.mongodb_service_enhanced - INFO -    Total document: 200,991 bytes
2025-11-19 15:23:42,436 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 15:23:42,436 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 15:23:42,437 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 15:23:42,437 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 15:23:42,437 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 15:23:42,437 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 15:23:42,437 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 15:23:42,437 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 15:23:42,438 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 15:23:42,439 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 15:23:42,439 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 15:23:42,439 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:23:42,439 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:23:42,440 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 15:23:42,443 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763565744_34320d9873de
2025-11-19 15:23:42,443 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691de0feb8ed226b2b31feab
2025-11-19 15:23:42,446 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 15:23:42,446 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 15:23:42,447 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 15:23:42,447 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 15:23:42,447 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 15:23:42,447 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 15:23:42,448 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 15:23:42,448 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 15:23:42,448 - app.services.mongodb_service_enhanced - INFO -    - First row keys (24): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 15:23:42,448 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 15:23:42,449 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 15:23:42,449 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 15:23:42,449 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:23:42,450 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 15:23:42,450 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 15:23:42,450 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 15:23:42,451 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 15:23:42,451 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 15:23:42,451 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:23:42,452 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691de0feb8ed226b2b31feab
2025-11-19 15:23:42,452 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 15:23:42,452 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 15:23:42,452 - app.api.routes - INFO -    Comparison ID: cmp_1763565744_34320d9873de
2025-11-19 15:23:42,455 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:23:42,456 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:23:42,456 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:23:42,457 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 15:23:42,457 - app.api.routes - INFO - ======================================================================
2025-11-19 15:23:42,458 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763565744_34320d9873de
2025-11-19 15:23:42,460 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 15:23:42,461 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 15:23:42,463 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 15:23:42,464 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:23:42,464 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:23:42,466 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:23:42,467 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:23:42,469 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 228
2025-11-19 15:23:42,469 - app.api.routes - INFO - ======================================================================

2025-11-19 15:23:42,469 - app.services.progress_tracker - INFO - âœ… Job completed: job_b23d3f44c0e1 â†’ comparison_id: cmp_1763565744_34320d9873de
2025-11-19 15:23:42,471 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 78.28s
2025-11-19 15:27:45,206 - main - INFO - 
2025-11-19 15:27:45,217 - main - INFO - ================================================================================
2025-11-19 15:27:45,218 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:27:45,219 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:27:45,224 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:27:45,226 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:27:45,226 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:27:45,228 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:27:45,237 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:27:45,249 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-19 15:27:45,252 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:27:45,254 - main - INFO - ================================================================================
2025-11-19 15:27:45,257 - main - INFO - 
2025-11-19 15:27:49,242 - main - INFO - 
2025-11-19 15:27:49,243 - main - INFO - ================================================================================
2025-11-19 15:27:49,243 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:27:49,243 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:27:49,243 - main - INFO - ================================================================================
2025-11-19 15:27:49,244 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:27:49,244 - main - INFO -   Upload Directory: uploads
2025-11-19 15:27:49,244 - main - INFO -   Max File Size: 20MB
2025-11-19 15:27:49,244 - main - INFO - ================================================================================
2025-11-19 15:27:49,245 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:27:49,245 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:27:49,245 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:27:49,265 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:27:49,273 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:27:49,273 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:27:49,273 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:27:49,274 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:27:49,274 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:27:49,274 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:27:49,274 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:27:49,281 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:27:49,282 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:27:49,284 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:27:49,288 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:27:49,288 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:27:49,289 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:27:49,289 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:27:49,289 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:27:49,326 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:27:49,327 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:27:49,327 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:27:49,328 - main - INFO - 
2025-11-19 15:27:49,328 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:27:49,329 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:27:49,329 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:27:49,330 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:27:49,330 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:27:49,331 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:27:49,331 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:27:49,332 - main - INFO - 
2025-11-19 15:27:49,332 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:27:49,333 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:27:49,333 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:27:49,334 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:27:49,334 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:27:49,334 - main - INFO - 
2025-11-19 15:27:49,335 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:27:49,335 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:27:49,336 - main - INFO -        - No manual section generation
2025-11-19 15:27:49,336 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:27:49,337 - main - INFO - 
2025-11-19 15:27:49,338 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:27:49,339 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:27:49,339 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:27:49,340 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:27:49,340 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:27:49,340 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:27:49,340 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:27:49,340 - main - INFO - 
2025-11-19 15:27:49,341 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:27:49,341 - main - INFO -      Main:
2025-11-19 15:27:49,341 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:27:49,341 - main - INFO - 
2025-11-19 15:27:49,341 - main - INFO -      Retrieval:
2025-11-19 15:27:49,342 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:27:49,342 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:27:49,342 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:27:49,342 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:27:49,342 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:27:49,342 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:27:49,343 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:27:49,343 - main - INFO - 
2025-11-19 15:27:49,343 - main - INFO -      Management:
2025-11-19 15:27:49,343 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:27:49,343 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:27:49,343 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:27:49,344 - main - INFO - 
2025-11-19 15:27:49,344 - main - INFO -      Documents (MongoDB):
2025-11-19 15:27:49,344 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:27:49,344 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:27:49,344 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:27:49,344 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:27:49,345 - main - INFO - 
2025-11-19 15:27:49,345 - main - INFO -      Diagnostics & Health:
2025-11-19 15:27:49,345 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:27:49,345 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:27:49,345 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:27:49,345 - main - INFO - 
2025-11-19 15:27:49,346 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:27:49,346 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:27:49,346 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:27:49,346 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:27:49,346 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:27:49,346 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:27:49,346 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:27:49,347 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:27:49,347 - main - INFO - 
2025-11-19 15:27:49,347 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:27:49,347 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:27:49,347 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:27:49,348 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:27:49,348 - main - INFO -      4. No re-upload needed!
2025-11-19 15:27:49,348 - main - INFO - 
2025-11-19 15:27:49,348 - main - INFO - ================================================================================
2025-11-19 15:27:49,348 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:27:49,349 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:27:49,349 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:27:49,349 - main - INFO - ================================================================================
2025-11-19 15:27:49,349 - main - INFO - 
2025-11-19 15:27:49,349 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:28:01,765 - main - INFO - 
2025-11-19 15:28:01,765 - main - INFO - ================================================================================
2025-11-19 15:28:01,766 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:28:01,767 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:28:01,767 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:28:01,768 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:28:01,768 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:28:01,769 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:28:01,769 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:28:01,769 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:28:01,769 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:28:01,770 - main - INFO - ================================================================================
2025-11-19 15:28:01,770 - main - INFO - 
2025-11-19 15:28:05,304 - main - INFO - 
2025-11-19 15:28:05,305 - main - INFO - ================================================================================
2025-11-19 15:28:05,305 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:28:05,305 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:28:05,305 - main - INFO - ================================================================================
2025-11-19 15:28:05,306 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:28:05,306 - main - INFO -   Upload Directory: uploads
2025-11-19 15:28:05,306 - main - INFO -   Max File Size: 20MB
2025-11-19 15:28:05,306 - main - INFO - ================================================================================
2025-11-19 15:28:05,306 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:28:05,307 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:28:05,307 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:28:05,326 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:28:05,334 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:28:05,334 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:28:05,335 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:28:05,335 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:28:05,335 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:28:05,335 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:28:05,335 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:28:05,369 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:28:05,370 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:28:05,372 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:28:05,374 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:28:05,374 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:28:05,375 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:28:05,375 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:28:05,375 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:28:05,384 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:28:05,385 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:28:05,385 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:28:05,385 - main - INFO - 
2025-11-19 15:28:05,386 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:28:05,386 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:28:05,386 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:28:05,386 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:28:05,387 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:28:05,387 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:28:05,387 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:28:05,387 - main - INFO - 
2025-11-19 15:28:05,388 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:28:05,388 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:28:05,388 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:28:05,388 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:28:05,388 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:28:05,389 - main - INFO - 
2025-11-19 15:28:05,389 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:28:05,389 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:28:05,389 - main - INFO -        - No manual section generation
2025-11-19 15:28:05,389 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:28:05,390 - main - INFO - 
2025-11-19 15:28:05,390 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:28:05,390 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:28:05,390 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:28:05,390 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:28:05,391 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:28:05,391 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:28:05,391 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:28:05,391 - main - INFO - 
2025-11-19 15:28:05,391 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:28:05,392 - main - INFO -      Main:
2025-11-19 15:28:05,392 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:28:05,392 - main - INFO - 
2025-11-19 15:28:05,392 - main - INFO -      Retrieval:
2025-11-19 15:28:05,392 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:28:05,392 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:28:05,393 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:28:05,393 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:28:05,393 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:28:05,393 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:28:05,393 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:28:05,394 - main - INFO - 
2025-11-19 15:28:05,394 - main - INFO -      Management:
2025-11-19 15:28:05,394 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:28:05,394 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:28:05,395 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:28:05,395 - main - INFO - 
2025-11-19 15:28:05,396 - main - INFO -      Documents (MongoDB):
2025-11-19 15:28:05,398 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:28:05,398 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:28:05,399 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:28:05,399 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:28:05,399 - main - INFO - 
2025-11-19 15:28:05,399 - main - INFO -      Diagnostics & Health:
2025-11-19 15:28:05,400 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:28:05,400 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:28:05,400 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:28:05,400 - main - INFO - 
2025-11-19 15:28:05,401 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:28:05,401 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:28:05,401 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:28:05,401 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:28:05,402 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:28:05,402 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:28:05,402 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:28:05,402 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:28:05,403 - main - INFO - 
2025-11-19 15:28:05,403 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:28:05,403 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:28:05,403 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:28:05,404 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:28:05,404 - main - INFO -      4. No re-upload needed!
2025-11-19 15:28:05,404 - main - INFO - 
2025-11-19 15:28:05,404 - main - INFO - ================================================================================
2025-11-19 15:28:05,405 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:28:05,405 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:28:05,405 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:28:05,405 - main - INFO - ================================================================================
2025-11-19 15:28:05,406 - main - INFO - 
2025-11-19 15:28:05,406 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:28:11,791 - main - INFO - 
2025-11-19 15:28:11,791 - main - INFO - ================================================================================
2025-11-19 15:28:11,792 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:28:11,793 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:28:11,795 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:28:11,796 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:28:11,798 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:28:11,801 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:28:11,802 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:28:11,802 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:28:11,803 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:28:11,803 - main - INFO - ================================================================================
2025-11-19 15:28:11,804 - main - INFO - 
2025-11-19 15:28:15,545 - main - INFO - 
2025-11-19 15:28:15,546 - main - INFO - ================================================================================
2025-11-19 15:28:15,547 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:28:15,547 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:28:15,548 - main - INFO - ================================================================================
2025-11-19 15:28:15,548 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:28:15,548 - main - INFO -   Upload Directory: uploads
2025-11-19 15:28:15,549 - main - INFO -   Max File Size: 20MB
2025-11-19 15:28:15,549 - main - INFO - ================================================================================
2025-11-19 15:28:15,550 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:28:15,551 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:28:15,551 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:28:15,571 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:28:15,575 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:28:15,575 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:28:15,575 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:28:15,575 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:28:15,576 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:28:15,576 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:28:15,576 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:28:15,586 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:28:15,587 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:28:15,588 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:28:15,589 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:28:15,590 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:28:15,590 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:28:15,590 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:28:15,590 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:28:15,600 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:28:15,600 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:28:15,601 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:28:15,601 - main - INFO - 
2025-11-19 15:28:15,601 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:28:15,601 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:28:15,602 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:28:15,602 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:28:15,602 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:28:15,602 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:28:15,602 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:28:15,603 - main - INFO - 
2025-11-19 15:28:15,603 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:28:15,603 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:28:15,603 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:28:15,603 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:28:15,604 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:28:15,604 - main - INFO - 
2025-11-19 15:28:15,604 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:28:15,604 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:28:15,604 - main - INFO -        - No manual section generation
2025-11-19 15:28:15,605 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:28:15,605 - main - INFO - 
2025-11-19 15:28:15,605 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:28:15,605 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:28:15,605 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:28:15,606 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:28:15,606 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:28:15,606 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:28:15,606 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:28:15,606 - main - INFO - 
2025-11-19 15:28:15,607 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:28:15,607 - main - INFO -      Main:
2025-11-19 15:28:15,607 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:28:15,607 - main - INFO - 
2025-11-19 15:28:15,607 - main - INFO -      Retrieval:
2025-11-19 15:28:15,607 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:28:15,608 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:28:15,608 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:28:15,608 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:28:15,608 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:28:15,608 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:28:15,609 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:28:15,609 - main - INFO - 
2025-11-19 15:28:15,609 - main - INFO -      Management:
2025-11-19 15:28:15,609 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:28:15,609 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:28:15,609 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:28:15,610 - main - INFO - 
2025-11-19 15:28:15,610 - main - INFO -      Documents (MongoDB):
2025-11-19 15:28:15,610 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:28:15,610 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:28:15,610 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:28:15,610 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:28:15,611 - main - INFO - 
2025-11-19 15:28:15,611 - main - INFO -      Diagnostics & Health:
2025-11-19 15:28:15,611 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:28:15,611 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:28:15,611 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:28:15,612 - main - INFO - 
2025-11-19 15:28:15,612 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:28:15,613 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:28:15,614 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:28:15,614 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:28:15,614 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:28:15,615 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:28:15,615 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:28:15,615 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:28:15,615 - main - INFO - 
2025-11-19 15:28:15,615 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:28:15,616 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:28:15,616 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:28:15,616 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:28:15,617 - main - INFO -      4. No re-upload needed!
2025-11-19 15:28:15,617 - main - INFO - 
2025-11-19 15:28:15,617 - main - INFO - ================================================================================
2025-11-19 15:28:15,618 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:28:15,618 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:28:15,618 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:28:15,618 - main - INFO - ================================================================================
2025-11-19 15:28:15,618 - main - INFO - 
2025-11-19 15:28:15,619 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:28:22,210 - main - INFO - 
2025-11-19 15:28:22,210 - main - INFO - ================================================================================
2025-11-19 15:28:22,210 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:28:22,212 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:28:22,213 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:28:22,215 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:28:22,215 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:28:22,216 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:28:22,217 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:28:22,217 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 15:28:22,217 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:28:22,217 - main - INFO - ================================================================================
2025-11-19 15:28:22,218 - main - INFO - 
2025-11-19 15:28:25,158 - main - INFO - 
2025-11-19 15:28:25,159 - main - INFO - ================================================================================
2025-11-19 15:28:25,159 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:28:25,159 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:28:25,159 - main - INFO - ================================================================================
2025-11-19 15:28:25,160 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:28:25,160 - main - INFO -   Upload Directory: uploads
2025-11-19 15:28:25,160 - main - INFO -   Max File Size: 20MB
2025-11-19 15:28:25,160 - main - INFO - ================================================================================
2025-11-19 15:28:25,161 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:28:25,161 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:28:25,161 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:28:25,179 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:28:25,187 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:28:25,188 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:28:25,188 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:28:25,188 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:28:25,188 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:28:25,189 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:28:25,189 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:28:25,208 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:28:25,209 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:28:25,209 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:28:25,211 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:28:25,211 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:28:25,212 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:28:25,212 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:28:25,213 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:28:25,241 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:28:25,242 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:28:25,243 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:28:25,243 - main - INFO - 
2025-11-19 15:28:25,243 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:28:25,244 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:28:25,244 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:28:25,244 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:28:25,245 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:28:25,245 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:28:25,246 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:28:25,247 - main - INFO - 
2025-11-19 15:28:25,247 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:28:25,248 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:28:25,248 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:28:25,249 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:28:25,249 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:28:25,249 - main - INFO - 
2025-11-19 15:28:25,249 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:28:25,250 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:28:25,250 - main - INFO -        - No manual section generation
2025-11-19 15:28:25,250 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:28:25,251 - main - INFO - 
2025-11-19 15:28:25,251 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:28:25,251 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:28:25,252 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:28:25,252 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:28:25,252 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:28:25,253 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:28:25,253 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:28:25,253 - main - INFO - 
2025-11-19 15:28:25,253 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:28:25,254 - main - INFO -      Main:
2025-11-19 15:28:25,254 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:28:25,255 - main - INFO - 
2025-11-19 15:28:25,255 - main - INFO -      Retrieval:
2025-11-19 15:28:25,256 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:28:25,256 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:28:25,256 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:28:25,257 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:28:25,257 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:28:25,257 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:28:25,258 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:28:25,258 - main - INFO - 
2025-11-19 15:28:25,258 - main - INFO -      Management:
2025-11-19 15:28:25,258 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:28:25,258 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:28:25,258 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:28:25,259 - main - INFO - 
2025-11-19 15:28:25,259 - main - INFO -      Documents (MongoDB):
2025-11-19 15:28:25,259 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:28:25,259 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:28:25,259 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:28:25,259 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:28:25,260 - main - INFO - 
2025-11-19 15:28:25,260 - main - INFO -      Diagnostics & Health:
2025-11-19 15:28:25,260 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:28:25,260 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:28:25,260 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:28:25,260 - main - INFO - 
2025-11-19 15:28:25,260 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:28:25,261 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:28:25,261 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:28:25,261 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:28:25,261 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:28:25,261 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:28:25,262 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:28:25,262 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:28:25,262 - main - INFO - 
2025-11-19 15:28:25,263 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:28:25,263 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:28:25,263 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:28:25,263 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:28:25,264 - main - INFO -      4. No re-upload needed!
2025-11-19 15:28:25,264 - main - INFO - 
2025-11-19 15:28:25,264 - main - INFO - ================================================================================
2025-11-19 15:28:25,264 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:28:25,264 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:28:25,265 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:28:25,265 - main - INFO - ================================================================================
2025-11-19 15:28:25,265 - main - INFO - 
2025-11-19 15:28:25,265 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 15:28:28,795 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 15:28:28,800 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.01s
2025-11-19 15:28:28,895 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 15:28:28,910 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.02s
2025-11-19 15:28:57,248 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-19 15:28:57,253 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 690b5e52447df54e13f39f1e
2025-11-19 15:28:57,254 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:28:57,254 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:28:57,254 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:28:57,256 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:28:57,257 - app.api.routes - INFO - âœ… User 690b5e52447df54e13f39f1e can perform comparison
2025-11-19 15:28:57,258 - app.api.routes - INFO -    - Remaining comparisons: 228
2025-11-19 15:28:57,258 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-19 15:28:57,258 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-19 15:28:57,259 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763566137_c200157806d3
2025-11-19 15:28:57,259 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_28a79a71ef54 (3 files)
2025-11-19 15:28:57,259 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_28a79a71ef54
2025-11-19 15:28:57,260 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:28:57,260 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:28:57,260 - app.api.routes - INFO - ======================================================================
2025-11-19 15:28:57,262 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ a1bcdd7499f942ad98565c19125877a2.pdf (464206 bytes)
2025-11-19 15:28:57,264 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:28:57,265 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a1bcdd7499f942ad98565c19125877a2.pdf
2025-11-19 15:28:57,265 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:28:57,265 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:28:57,308 - app.api.routes - INFO - ======================================================================
2025-11-19 15:28:57,309 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 42871f7c77ea48998032be6168cf50b9.pdf (175401 bytes)
2025-11-19 15:28:57,334 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:28:57,338 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-19 15:28:57,338 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\42871f7c77ea48998032be6168cf50b9.pdf
2025-11-19 15:28:57,338 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:28:57,355 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:28:57,375 - app.api.routes - INFO - ======================================================================
2025-11-19 15:28:57,389 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-19 15:28:57,390 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 3b03071d27f74c688d5897bcee75ad04.pdf (331157 bytes)
2025-11-19 15:28:57,390 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:28:57,391 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\3b03071d27f74c688d5897bcee75ad04.pdf
2025-11-19 15:28:57,391 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:28:57,409 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:28:57,425 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-19 15:28:57,438 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-19 15:28:57,450 - app.services.pdf_extractor - INFO - Successfully extracted 18289 characters from 8 pages
2025-11-19 15:28:57,451 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:28:57,452 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:28:57,453 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-19 15:28:57,614 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-19 15:28:57,614 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:28:57,994 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:28:57,995 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:28:57,995 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-19 15:28:57,996 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-19 15:28:57,996 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:28:57,996 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:28:57,997 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-19 15:28:58,080 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-19 15:28:58,080 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:28:58,082 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:28:58,082 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:28:58,083 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-19 15:28:58,083 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-19 15:28:58,083 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-19 15:28:58,083 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-19 15:28:58,084 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-19 15:28:58,182 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-19 15:28:58,183 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-19 15:29:28,392 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:29:28,415 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:29:28,415 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:29:28,416 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:29:28,416 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-19 15:29:28,417 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:29:28,417 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-19 15:29:28,423 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-19 15:29:28,423 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-19 15:29:28,423 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:29:37,491 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:29:37,505 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:29:37,505 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:29:37,506 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-19 15:29:37,507 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-19 15:29:37,508 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:29:37,509 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:29:37,509 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-19 15:29:44,602 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:29:44,603 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:29:44,603 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:29:44,604 - app.services.ai_parser - INFO - 
2025-11-19 15:29:44,604 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:29:44,604 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:29:44,605 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:29:44,605 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-19 15:29:44,605 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-19 15:29:44,605 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-19 15:29:44,606 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-19 15:29:44,606 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:29:44,606 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-19 15:29:44,606 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-19 15:29:44,607 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:29:44,607 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:29:44,607 - app.services.ai_parser - INFO - 
2025-11-19 15:29:44,607 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:29:44,607 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-19 15:29:44,607 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-19 15:29:44,608 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-19 15:29:44,608 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:29:44,608 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:29:44,608 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:29:44,609 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a1bcdd7499f942ad98565c19125877a2.pdf â†’ 691de2689af75ddd9799d566
2025-11-19 15:29:44,610 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de2689af75ddd9799d566
2025-11-19 15:29:44,612 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691de2689af75ddd9799d567 (464206 bytes)
2025-11-19 15:29:44,613 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691de2689af75ddd9799d567
2025-11-19 15:29:44,613 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-19 15:29:50,611 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:29:50,615 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:29:50,615 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:29:50,616 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:29:50,616 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:29:58,093 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:29:58,097 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:29:58,097 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:29:58,098 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-19 15:29:58,098 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-19 15:29:58,099 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:29:58,100 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:29:58,100 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:29:58,101 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-19 15:29:58,102 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:29:58,102 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-19 15:30:06,000 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:30:06,020 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-19 15:30:06,020 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:30:06,020 - app.services.ai_parser - INFO - 
2025-11-19 15:30:06,020 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:30:06,021 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:30:06,021 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:30:06,021 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-19 15:30:06,021 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-19 15:30:06,022 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-19 15:30:06,022 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-19 15:30:06,022 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-19 15:30:06,022 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-19 15:30:06,022 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO - 
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-19 15:30:06,023 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-19 15:30:06,024 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:30:06,024 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:30:06,024 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:30:06,025 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 3b03071d27f74c688d5897bcee75ad04.pdf â†’ 691de27e9af75ddd9799d568
2025-11-19 15:30:06,025 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de27e9af75ddd9799d568
2025-11-19 15:30:06,027 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691de27e9af75ddd9799d569 (331157 bytes)
2025-11-19 15:30:06,027 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691de27e9af75ddd9799d569
2025-11-19 15:30:06,027 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-19 15:30:09,208 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:30:09,480 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-19 15:30:09,481 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-19 15:30:09,481 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-19 15:30:09,482 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-19 15:30:17,250 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:30:17,253 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-19 15:30:17,254 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-19 15:30:17,254 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-19 15:30:17,254 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-19 15:30:17,255 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:30:17,255 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:30:17,255 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-19 15:30:17,256 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:30:17,256 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-19 15:30:17,256 - app.services.ai_parser - INFO - ðŸ“Š Counts: 38 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-19 15:30:26,085 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:30:26,096 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-19 15:30:26,096 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-19 15:30:26,097 - app.services.ai_parser - INFO - 
2025-11-19 15:30:26,098 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:30:26,099 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:30:26,100 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:30:26,100 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-19 15:30:26,101 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-19 15:30:26,102 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-19 15:30:26,103 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-19 15:30:26,103 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-19 15:30:26,104 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-19 15:30:26,105 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-19 15:30:26,105 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-19 15:30:26,106 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-19 15:30:26,107 - app.services.ai_parser - INFO - 
2025-11-19 15:30:26,107 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-19 15:30:26,108 - app.services.ai_parser - INFO -    âœ“ Benefits: 38
2025-11-19 15:30:26,109 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-19 15:30:26,109 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-19 15:30:26,110 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-19 15:30:26,111 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-19 15:30:26,111 - app.services.ai_parser - INFO - ======================================================================
2025-11-19 15:30:26,115 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 42871f7c77ea48998032be6168cf50b9.pdf â†’ 691de2929af75ddd9799d56a
2025-11-19 15:30:26,115 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691de2929af75ddd9799d56a
2025-11-19 15:30:26,119 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691de2929af75ddd9799d56b (175401 bytes)
2025-11-19 15:30:26,120 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 691de2929af75ddd9799d56b
2025-11-19 15:30:26,120 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-19 15:30:26,121 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-19 15:30:26,122 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:30:26,122 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-19 15:30:26,123 - app.api.routes - INFO - ======================================================================
2025-11-19 15:30:26,124 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-19 15:30:26,124 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-19 15:30:26,125 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-19 15:30:26,126 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:30:26,126 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-19 15:30:26,126 - app.services.ai_ranker - INFO - ================================================================================
2025-11-19 15:30:26,127 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:30:26,127 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-19 15:30:26,128 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:30:26,128 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-19 15:30:26,128 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:30:26,129 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-19 15:30:26,129 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:30:26,130 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-19 15:30:26,131 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-19 15:30:26,131 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:30:26,132 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:30:26,132 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:30:26,133 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "Minimization of losses": "SR 250,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Industries Seepage, Pollution and Co
2025-11-19 15:30:26,137 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-19 15:30:26,138 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-19 15:30:26,138 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-19 15:30:26,139 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:30:26,139 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:30:26,139 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:30:26,139 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:30:26,140 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:30:26,140 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:30:26,140 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:30:26,141 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:30:26,141 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:30:26,141 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:30:26,141 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:30:26,142 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:30:26,142 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:30:26,142 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-19 15:30:26,142 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-19 15:30:26,143 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-19 15:30:26,143 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-19 15:30:26,143 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-19 15:30:26,143 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-19 15:30:26,143 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-19 15:30:26,143 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-19 15:30:26,144 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:30:26,144 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-19 15:30:26,144 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:30:26,144 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-19 15:30:26,144 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:30:26,145 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-19 15:30:26,145 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:30:26,145 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension', 'Professional Valuation Report required for properties with total Sum Insured exceeding SR40m'], 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers'], 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of the Sum Insured into major components', 'Full description of all stock insured for warehouses']}
2025-11-19 15:30:26,146 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-19 15:30:26,147 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:30:26,147 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:30:26,147 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:30:26,147 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "1,564,652,306.28",
    "business_interruption": "650,000,000.00",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 1M to SR 40M",
        "deductible": "5%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5%, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5%, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5%, min SR 1,000,000",
        "ap
2025-11-19 15:30:26,149 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-19 15:30:26,150 - app.services.ai_ranker - INFO -    âœ… Found 2 items in key 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers']
2025-11-19 15:30:26,150 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of the Sum Insured into major components', 'Full description of all stock insured for warehouses']
2025-11-19 15:30:26,150 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:30:26,150 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:30:26,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:30:26,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:30:26,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:30:26,152 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:30:26,152 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:30:26,153 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:30:26,153 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:30:26,153 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:30:26,153 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:30:26,154 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:30:26,154 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:30:26,154 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 9
2025-11-19 15:30:26,154 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-19 15:30:26,154 - app.services.ai_ranker - INFO -    âœ… Extracted 9 subjectivities for Liva Insurance
2025-11-19 15:30:26,155 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-19 15:30:26,155 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-19 15:30:26,155 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-19 15:30:26,155 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-19 15:30:26,155 - app.services.ai_ranker - INFO -    Subjectivities: 9
2025-11-19 15:30:26,156 - app.services.ai_ranker - INFO - 
============================================================
2025-11-19 15:30:26,156 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-19 15:30:26,156 - app.services.ai_ranker - INFO - ============================================================
2025-11-19 15:30:26,156 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-19 15:30:26,156 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:30:26,157 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-19 15:30:26,157 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-19 15:30:26,157 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-19 15:30:26,157 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-19 15:30:26,157 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-19 15:30:26,158 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-19 15:30:26,158 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-19 15:30:26,158 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount minimum SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount minimum SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount minimum SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount minimum SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_in
2025-11-19 15:30:26,159 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-19 15:30:26,159 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-19 15:30:26,160 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-19 15:30:26,160 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-19 15:30:26,160 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-19 15:30:26,160 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-19 15:30:26,160 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-19 15:30:26,160 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-19 15:30:26,161 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-19 15:30:26,161 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-19 15:30:26,161 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-19 15:30:26,161 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-19 15:30:26,161 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-19 15:30:26,162 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-19 15:30:26,162 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-19 15:30:26,162 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-19 15:30:26,162 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-19 15:30:26,163 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-19 15:30:26,163 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-19 15:30:26,163 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-19 15:30:26,163 - app.services.ai_ranker - INFO -    Warranties: 10
2025-11-19 15:30:26,164 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-19 15:30:26,164 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-19 15:30:26,164 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-19 15:30:26,164 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-19 15:30:26,535 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-19 15:30:26,536 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:30:26,536 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:30:26,536 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:30:26,536 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:30:26,537 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-19 15:30:26,537 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-19 15:30:26,537 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-19 15:30:26,858 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:30:26,858 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:30:26,858 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 7
2025-11-19 15:30:26,858 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 9
2025-11-19 15:30:26,859 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:30:26,859 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-19 15:30:26,859 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-19 15:30:27,241 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-19 15:30:27,241 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-19 15:30:27,241 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-19 15:30:27,242 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-19 15:30:27,242 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-19 15:30:27,242 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-19 15:30:27,242 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-19 15:30:27,243 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-19 15:30:27,243 - app.services.ai_ranker - INFO - ================================================================================

2025-11-19 15:30:27,243 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=86.52
2025-11-19 15:30:27,244 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=83.24
2025-11-19 15:30:27,244 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=83.92
2025-11-19 15:30:27,244 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-19 15:30:27,244 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-19 15:30:38,684 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-19 15:30:38,687 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-19 15:30:38,688 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-19 15:30:38,689 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-19 15:30:38,690 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-19 15:30:38,691 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-19 15:30:38,692 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763566137_c200157806d3
2025-11-19 15:30:38,692 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-19 15:30:38,693 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-19 15:30:38,694 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-19 15:30:38,695 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-19 15:30:38,695 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:30:38,696 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:30:38,696 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:30:38,697 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:30:38,697 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:30:38,698 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:30:38,699 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-19 15:30:38,700 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-19 15:30:38,700 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-19 15:30:38,701 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-19 15:30:38,701 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-19 15:30:38,702 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-19 15:30:38,703 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-19 15:30:38,708 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-19 15:30:38,708 - app.services.mongodb_service_enhanced - INFO -    Summary: 5,024 bytes
2025-11-19 15:30:38,708 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 32,031 bytes
2025-11-19 15:30:38,709 - app.services.mongodb_service_enhanced - INFO -    Data table: 14,692 bytes
2025-11-19 15:30:38,709 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,741 bytes
2025-11-19 15:30:38,709 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 48,133 bytes
2025-11-19 15:30:38,709 - app.services.mongodb_service_enhanced - INFO -    Total document: 210,638 bytes
2025-11-19 15:30:38,709 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-19 15:30:38,710 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-19 15:30:38,710 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-19 15:30:38,710 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-19 15:30:38,710 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-19 15:30:38,711 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-19 15:30:38,711 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-19 15:30:38,711 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-19 15:30:38,711 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-19 15:30:38,711 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-19 15:30:38,711 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-19 15:30:38,712 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:30:38,713 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:30:38,713 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-19 15:30:38,716 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763566137_c200157806d3
2025-11-19 15:30:38,717 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691de29eb8ed226b2b31feac
2025-11-19 15:30:38,719 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-19 15:30:38,719 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-19 15:30:38,719 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-19 15:30:38,720 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-19 15:30:38,720 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-19 15:30:38,721 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-19 15:30:38,721 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-19 15:30:38,721 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-19 15:30:38,721 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-19 15:30:38,722 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-19 15:30:38,723 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-19 15:30:38,723 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-19 15:30:38,724 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-19 15:30:38,725 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-19 15:30:38,725 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-19 15:30:38,725 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-19 15:30:38,726 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-19 15:30:38,726 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-19 15:30:38,726 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-19 15:30:38,727 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691de29eb8ed226b2b31feac
2025-11-19 15:30:38,727 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-19 15:30:38,727 - app.api.routes - INFO -    Collection: comparisons
2025-11-19 15:30:38,727 - app.api.routes - INFO -    Comparison ID: cmp_1763566137_c200157806d3
2025-11-19 15:30:38,731 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:30:38,731 - app.api.routes - INFO - âœ… Recorded comparison usage for user 690b5e52447df54e13f39f1e
2025-11-19 15:30:38,732 - app.api.routes - INFO - 
======================================================================
2025-11-19 15:30:38,732 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-19 15:30:38,732 - app.api.routes - INFO - ======================================================================
2025-11-19 15:30:38,732 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763566137_c200157806d3
2025-11-19 15:30:38,733 - app.api.routes - INFO - ðŸ‘¤ User ID: 690b5e52447df54e13f39f1e
2025-11-19 15:30:38,733 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-19 15:30:38,733 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-19 15:30:38,733 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 690b5e52447df54e13f39f1e
2025-11-19 15:30:38,733 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-19 15:30:38,734 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-19 15:30:38,735 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-19 15:30:38,736 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 227
2025-11-19 15:30:38,736 - app.api.routes - INFO - ======================================================================

2025-11-19 15:30:38,737 - app.services.progress_tracker - INFO - âœ… Job completed: job_28a79a71ef54 â†’ comparison_id: cmp_1763566137_c200157806d3
2025-11-19 15:30:38,739 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 101.49s
2025-11-19 15:38:25,286 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-19 15:38:25,287 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-19 15:48:01,357 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1763566137_c200157806d3/pdf
2025-11-19 15:48:01,359 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1763566137_c200157806d3
2025-11-19 15:48:01,365 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1763566137_c200157806d3
2025-11-19 15:48:01,366 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-19 15:48:01,366 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-19 15:48:01,367 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-19 15:48:01,368 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-19 15:48:01,369 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-19 15:48:01,369 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-19 15:48:01,376 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-19 15:48:01,377 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-19 15:48:01,378 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-19 15:48:01,378 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-19 15:48:01,379 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-19 15:48:01,379 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-19 15:48:01,381 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-19 15:48:01,687 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1763566137_c200157806d3
2025-11-19 15:48:01,688 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1763566137_c200157806d3_20251119_154801.pdf (138129 bytes)
2025-11-19 15:48:01,689 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1763566137_c200157806d3/pdf - 200 - 0.33s
2025-11-19 15:56:00,693 - main - INFO - 
2025-11-19 15:56:00,694 - main - INFO - ================================================================================
2025-11-19 15:56:00,694 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 15:56:00,695 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:56:00,695 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 15:56:00,696 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 15:56:00,696 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 15:56:00,697 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 15:56:00,698 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 15:56:00,699 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-19 15:56:00,700 - main - INFO -   âœ… Application stopped successfully
2025-11-19 15:56:00,700 - main - INFO - ================================================================================
2025-11-19 15:56:00,700 - main - INFO - 
2025-11-19 15:56:03,640 - main - INFO - 
2025-11-19 15:56:03,640 - main - INFO - ================================================================================
2025-11-19 15:56:03,640 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 15:56:03,640 - main - INFO -   Production-Ready Complete Integration
2025-11-19 15:56:03,641 - main - INFO - ================================================================================
2025-11-19 15:56:03,641 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 15:56:03,641 - main - INFO -   Upload Directory: uploads
2025-11-19 15:56:03,641 - main - INFO -   Max File Size: 20MB
2025-11-19 15:56:03,641 - main - INFO - ================================================================================
2025-11-19 15:56:03,642 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 15:56:03,642 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 15:56:03,642 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 15:56:03,687 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 15:56:03,701 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 15:56:03,701 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 15:56:03,702 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 15:56:03,702 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 15:56:03,703 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 15:56:03,703 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:56:03,704 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:56:03,730 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 15:56:03,732 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'insurance_comparison', 'local']
2025-11-19 15:56:03,733 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': ['user_documents', 'admins', 'users']
2025-11-19 15:56:03,737 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 11 documents
2025-11-19 15:56:03,738 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 15:56:03,738 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 15:56:03,739 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 15:56:03,739 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 15:56:03,760 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 15:56:03,761 - main - INFO -   âœ… User Documents Service connected
2025-11-19 15:56:03,761 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 15:56:03,761 - main - INFO - 
2025-11-19 15:56:03,761 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 15:56:03,762 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 15:56:03,762 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 15:56:03,762 - main - INFO -        - Separates warranties from extensions
2025-11-19 15:56:03,762 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 15:56:03,762 - main - INFO -        - Correct deductible tier detection
2025-11-19 15:56:03,763 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 15:56:03,763 - main - INFO - 
2025-11-19 15:56:03,763 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 15:56:03,763 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 15:56:03,763 - main - INFO -        - Identifies unique items per provider
2025-11-19 15:56:03,764 - main - INFO -        - Transparent scoring methodology
2025-11-19 15:56:03,764 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 15:56:03,764 - main - INFO - 
2025-11-19 15:56:03,764 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 15:56:03,765 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 15:56:03,765 - main - INFO -        - No manual section generation
2025-11-19 15:56:03,765 - main - INFO -        - Complete MongoDB integration
2025-11-19 15:56:03,765 - main - INFO - 
2025-11-19 15:56:03,765 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 15:56:03,766 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 15:56:03,766 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 15:56:03,766 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 15:56:03,766 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 15:56:03,767 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 15:56:03,767 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 15:56:03,767 - main - INFO - 
2025-11-19 15:56:03,767 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 15:56:03,768 - main - INFO -      Main:
2025-11-19 15:56:03,768 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 15:56:03,768 - main - INFO - 
2025-11-19 15:56:03,768 - main - INFO -      Retrieval:
2025-11-19 15:56:03,769 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 15:56:03,769 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 15:56:03,769 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 15:56:03,769 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 15:56:03,769 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 15:56:03,769 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 15:56:03,770 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 15:56:03,770 - main - INFO - 
2025-11-19 15:56:03,770 - main - INFO -      Management:
2025-11-19 15:56:03,770 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 15:56:03,770 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 15:56:03,770 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 15:56:03,771 - main - INFO - 
2025-11-19 15:56:03,771 - main - INFO -      Documents (MongoDB):
2025-11-19 15:56:03,771 - main - INFO -        GET  /api/documents                All documents
2025-11-19 15:56:03,771 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 15:56:03,771 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 15:56:03,771 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 15:56:03,772 - main - INFO - 
2025-11-19 15:56:03,772 - main - INFO -      Diagnostics & Health:
2025-11-19 15:56:03,772 - main - INFO -        GET  /api/health                   System health
2025-11-19 15:56:03,772 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 15:56:03,772 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 15:56:03,772 - main - INFO - 
2025-11-19 15:56:03,773 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 15:56:03,773 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 15:56:03,773 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 15:56:03,773 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 15:56:03,773 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 15:56:03,774 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 15:56:03,774 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 15:56:03,774 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 15:56:03,774 - main - INFO - 
2025-11-19 15:56:03,774 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 15:56:03,775 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 15:56:03,775 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 15:56:03,775 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 15:56:03,775 - main - INFO -      4. No re-upload needed!
2025-11-19 15:56:03,775 - main - INFO - 
2025-11-19 15:56:03,775 - main - INFO - ================================================================================
2025-11-19 15:56:03,776 - main - INFO -   âœ… Application started successfully!
2025-11-19 15:56:03,776 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 15:56:03,776 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 15:56:03,776 - main - INFO - ================================================================================
2025-11-19 15:56:03,776 - main - INFO - 
2025-11-19 15:56:03,777 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 23:25:22,078 - main - INFO - 
2025-11-19 23:25:22,078 - main - INFO - ================================================================================
2025-11-19 23:25:22,079 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 23:25:22,079 - main - INFO -   Production-Ready Complete Integration
2025-11-19 23:25:22,079 - main - INFO - ================================================================================
2025-11-19 23:25:22,080 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 23:25:22,080 - main - INFO -   Upload Directory: uploads
2025-11-19 23:25:22,080 - main - INFO -   Max File Size: 20MB
2025-11-19 23:25:22,081 - main - INFO - ================================================================================
2025-11-19 23:25:22,081 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 23:25:22,082 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 23:25:22,082 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 23:25:22,209 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 23:25:22,341 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 23:25:22,341 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 23:25:22,341 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 23:25:22,342 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 23:25:22,342 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 23:25:22,342 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 23:25:22,342 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 23:25:22,362 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 23:25:22,364 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-19 23:25:22,365 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-19 23:25:22,370 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-19 23:25:22,370 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-19 23:25:22,370 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 23:25:22,371 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 23:25:22,371 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 23:25:22,372 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 23:25:22,380 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 23:25:22,381 - main - INFO -   âœ… User Documents Service connected
2025-11-19 23:25:22,382 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 23:25:22,387 - main - INFO - 
2025-11-19 23:25:22,388 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 23:25:22,390 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 23:25:22,391 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 23:25:22,392 - main - INFO -        - Separates warranties from extensions
2025-11-19 23:25:22,392 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 23:25:22,393 - main - INFO -        - Correct deductible tier detection
2025-11-19 23:25:22,394 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 23:25:22,395 - main - INFO - 
2025-11-19 23:25:22,397 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 23:25:22,397 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 23:25:22,398 - main - INFO -        - Identifies unique items per provider
2025-11-19 23:25:22,398 - main - INFO -        - Transparent scoring methodology
2025-11-19 23:25:22,398 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 23:25:22,399 - main - INFO - 
2025-11-19 23:25:22,400 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 23:25:22,404 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 23:25:22,405 - main - INFO -        - No manual section generation
2025-11-19 23:25:22,406 - main - INFO -        - Complete MongoDB integration
2025-11-19 23:25:22,407 - main - INFO - 
2025-11-19 23:25:22,407 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 23:25:22,407 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 23:25:22,408 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 23:25:22,408 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 23:25:22,408 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 23:25:22,409 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 23:25:22,411 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 23:25:22,412 - main - INFO - 
2025-11-19 23:25:22,412 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 23:25:22,412 - main - INFO -      Main:
2025-11-19 23:25:22,413 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 23:25:22,413 - main - INFO - 
2025-11-19 23:25:22,413 - main - INFO -      Retrieval:
2025-11-19 23:25:22,414 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 23:25:22,414 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 23:25:22,414 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 23:25:22,414 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 23:25:22,415 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 23:25:22,415 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 23:25:22,415 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 23:25:22,420 - main - INFO - 
2025-11-19 23:25:22,421 - main - INFO -      Management:
2025-11-19 23:25:22,422 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 23:25:22,423 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 23:25:22,423 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 23:25:22,424 - main - INFO - 
2025-11-19 23:25:22,424 - main - INFO -      Documents (MongoDB):
2025-11-19 23:25:22,424 - main - INFO -        GET  /api/documents                All documents
2025-11-19 23:25:22,425 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 23:25:22,425 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 23:25:22,425 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 23:25:22,425 - main - INFO - 
2025-11-19 23:25:22,426 - main - INFO -      Diagnostics & Health:
2025-11-19 23:25:22,426 - main - INFO -        GET  /api/health                   System health
2025-11-19 23:25:22,427 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 23:25:22,427 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 23:25:22,427 - main - INFO - 
2025-11-19 23:25:22,428 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 23:25:22,428 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 23:25:22,429 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 23:25:22,429 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 23:25:22,429 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 23:25:22,429 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 23:25:22,430 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 23:25:22,430 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 23:25:22,430 - main - INFO - 
2025-11-19 23:25:22,430 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 23:25:22,431 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 23:25:22,431 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 23:25:22,432 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 23:25:22,432 - main - INFO -      4. No re-upload needed!
2025-11-19 23:25:22,433 - main - INFO - 
2025-11-19 23:25:22,433 - main - INFO - ================================================================================
2025-11-19 23:25:22,433 - main - INFO -   âœ… Application started successfully!
2025-11-19 23:25:22,434 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 23:25:22,434 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 23:25:22,434 - main - INFO - ================================================================================
2025-11-19 23:25:22,434 - main - INFO - 
2025-11-19 23:25:22,434 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-19 23:25:30,163 - main - INFO - ðŸ“¥ GET /docs
2025-11-19 23:25:30,165 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-19 23:25:31,012 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-19 23:25:31,020 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-19 23:28:40,849 - main - INFO - 
2025-11-19 23:28:40,850 - main - INFO - ================================================================================
2025-11-19 23:28:40,850 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-19 23:28:40,851 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 23:28:40,851 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-19 23:28:40,852 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-19 23:28:40,853 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-19 23:28:40,853 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-19 23:28:40,854 - main - INFO -   âœ… User Documents Service connection closed
2025-11-19 23:28:40,854 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-19 23:28:40,854 - main - INFO -   âœ… Application stopped successfully
2025-11-19 23:28:40,855 - main - INFO - ================================================================================
2025-11-19 23:28:40,856 - main - INFO - 
2025-11-19 23:28:43,692 - main - INFO - 
2025-11-19 23:28:43,693 - main - INFO - ================================================================================
2025-11-19 23:28:43,693 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-19 23:28:43,693 - main - INFO -   Production-Ready Complete Integration
2025-11-19 23:28:43,694 - main - INFO - ================================================================================
2025-11-19 23:28:43,694 - main - INFO -   AI Model: gpt-4o-mini
2025-11-19 23:28:43,694 - main - INFO -   Upload Directory: uploads
2025-11-19 23:28:43,695 - main - INFO -   Max File Size: 20MB
2025-11-19 23:28:43,695 - main - INFO - ================================================================================
2025-11-19 23:28:43,695 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-19 23:28:43,695 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-19 23:28:43,696 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-19 23:28:43,755 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-19 23:28:43,760 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-19 23:28:43,760 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-19 23:28:43,760 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-19 23:28:43,761 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-19 23:28:43,761 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-19 23:28:43,761 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 23:28:43,762 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-19 23:28:43,788 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-19 23:28:43,789 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-19 23:28:43,790 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-19 23:28:43,790 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-19 23:28:43,791 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-19 23:28:43,791 - main - INFO -   âœ… User Subscription Service connected
2025-11-19 23:28:43,791 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-19 23:28:43,791 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-19 23:28:43,792 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-19 23:28:43,820 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-19 23:28:43,820 - main - INFO -   âœ… User Documents Service connected
2025-11-19 23:28:43,821 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-19 23:28:43,821 - main - INFO - 
2025-11-19 23:28:43,821 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-19 23:28:43,821 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-19 23:28:43,822 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-19 23:28:43,822 - main - INFO -        - Separates warranties from extensions
2025-11-19 23:28:43,822 - main - INFO -        - Extracts subjectivities & operational details
2025-11-19 23:28:43,822 - main - INFO -        - Correct deductible tier detection
2025-11-19 23:28:43,823 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-19 23:28:43,823 - main - INFO - 
2025-11-19 23:28:43,823 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-19 23:28:43,823 - main - INFO -        - Generates ALL sections comprehensively
2025-11-19 23:28:43,823 - main - INFO -        - Identifies unique items per provider
2025-11-19 23:28:43,824 - main - INFO -        - Transparent scoring methodology
2025-11-19 23:28:43,824 - main - INFO -        - Uses full _extended_data from parser
2025-11-19 23:28:43,824 - main - INFO - 
2025-11-19 23:28:43,824 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-19 23:28:43,824 - main - INFO -        - Single endpoint auto-populates everything
2025-11-19 23:28:43,824 - main - INFO -        - No manual section generation
2025-11-19 23:28:43,824 - main - INFO -        - Complete MongoDB integration
2025-11-19 23:28:43,825 - main - INFO - 
2025-11-19 23:28:43,825 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-19 23:28:43,825 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-19 23:28:43,825 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-19 23:28:43,825 - main - INFO -      âœ… Subjectivities: Now included
2025-11-19 23:28:43,826 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-19 23:28:43,826 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-19 23:28:43,826 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-19 23:28:43,826 - main - INFO - 
2025-11-19 23:28:43,826 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-19 23:28:43,826 - main - INFO -      Main:
2025-11-19 23:28:43,827 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-19 23:28:43,827 - main - INFO - 
2025-11-19 23:28:43,827 - main - INFO -      Retrieval:
2025-11-19 23:28:43,827 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-19 23:28:43,827 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-19 23:28:43,827 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-19 23:28:43,828 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-19 23:28:43,828 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-19 23:28:43,828 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-19 23:28:43,828 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-19 23:28:43,828 - main - INFO - 
2025-11-19 23:28:43,828 - main - INFO -      Management:
2025-11-19 23:28:43,828 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-19 23:28:43,829 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-19 23:28:43,829 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-19 23:28:43,829 - main - INFO - 
2025-11-19 23:28:43,829 - main - INFO -      Documents (MongoDB):
2025-11-19 23:28:43,829 - main - INFO -        GET  /api/documents                All documents
2025-11-19 23:28:43,829 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-19 23:28:43,830 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-19 23:28:43,830 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-19 23:28:43,830 - main - INFO - 
2025-11-19 23:28:43,830 - main - INFO -      Diagnostics & Health:
2025-11-19 23:28:43,830 - main - INFO -        GET  /api/health                   System health
2025-11-19 23:28:43,830 - main - INFO -        GET  /api/status                   Detailed status
2025-11-19 23:28:43,831 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-19 23:28:43,831 - main - INFO - 
2025-11-19 23:28:43,831 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-19 23:28:43,832 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-19 23:28:43,832 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-19 23:28:43,832 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-19 23:28:43,832 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-19 23:28:43,833 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-19 23:28:43,833 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-19 23:28:43,833 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-19 23:28:43,833 - main - INFO - 
2025-11-19 23:28:43,833 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-19 23:28:43,834 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-19 23:28:43,834 - main - INFO -      2. Receive comparison_id + complete data
2025-11-19 23:28:43,834 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-19 23:28:43,834 - main - INFO -      4. No re-upload needed!
2025-11-19 23:28:43,835 - main - INFO - 
2025-11-19 23:28:43,835 - main - INFO - ================================================================================
2025-11-19 23:28:43,835 - main - INFO -   âœ… Application started successfully!
2025-11-19 23:28:43,835 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-19 23:28:43,836 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-19 23:28:43,836 - main - INFO - ================================================================================
2025-11-19 23:28:43,836 - main - INFO - 
2025-11-19 23:28:43,837 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:27:37,615 - main - INFO - ðŸ“¥ OPTIONS /compare-quotes
2025-11-20 00:27:37,617 - main - INFO - ðŸ“¤ OPTIONS /compare-quotes - 200 - 0.00s
2025-11-20 00:27:37,622 - main - INFO - ðŸ“¥ POST /compare-quotes
2025-11-20 00:27:37,624 - main - INFO - ðŸ“¤ POST /compare-quotes - 404 - 0.00s
2025-11-20 00:29:44,968 - main - INFO - 
2025-11-20 00:29:44,969 - main - INFO - ================================================================================
2025-11-20 00:29:44,969 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:29:44,970 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:29:44,971 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:29:44,972 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:29:44,972 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:29:44,973 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:29:44,973 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:29:44,974 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:29:44,974 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:29:44,974 - main - INFO - ================================================================================
2025-11-20 00:29:44,974 - main - INFO - 
2025-11-20 00:29:54,662 - main - INFO - 
2025-11-20 00:29:54,662 - main - INFO - ================================================================================
2025-11-20 00:29:54,662 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:29:54,663 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:29:54,663 - main - INFO - ================================================================================
2025-11-20 00:29:54,663 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:29:54,663 - main - INFO -   Upload Directory: uploads
2025-11-20 00:29:54,663 - main - INFO -   Max File Size: 20MB
2025-11-20 00:29:54,663 - main - INFO - ================================================================================
2025-11-20 00:29:54,664 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:29:54,664 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:29:54,664 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:29:54,686 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:29:54,692 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:29:54,692 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:29:54,693 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:29:54,693 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:29:54,693 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:29:54,694 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:29:54,694 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:29:54,731 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:29:54,734 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:29:54,736 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:29:54,736 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:29:54,737 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:29:54,738 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:29:54,738 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:29:54,739 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:29:54,739 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:29:54,769 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:29:54,770 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:29:54,770 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:29:54,771 - main - INFO - 
2025-11-20 00:29:54,771 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:29:54,772 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:29:54,772 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:29:54,773 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:29:54,773 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:29:54,775 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:29:54,775 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:29:54,776 - main - INFO - 
2025-11-20 00:29:54,776 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:29:54,777 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:29:54,777 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:29:54,777 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:29:54,778 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:29:54,778 - main - INFO - 
2025-11-20 00:29:54,778 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:29:54,779 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:29:54,779 - main - INFO -        - No manual section generation
2025-11-20 00:29:54,779 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:29:54,780 - main - INFO - 
2025-11-20 00:29:54,780 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:29:54,780 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:29:54,780 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:29:54,781 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:29:54,781 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:29:54,782 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:29:54,782 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:29:54,782 - main - INFO - 
2025-11-20 00:29:54,783 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:29:54,783 - main - INFO -      Main:
2025-11-20 00:29:54,783 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:29:54,783 - main - INFO - 
2025-11-20 00:29:54,784 - main - INFO -      Retrieval:
2025-11-20 00:29:54,784 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:29:54,784 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:29:54,785 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:29:54,785 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:29:54,785 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:29:54,785 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:29:54,785 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:29:54,786 - main - INFO - 
2025-11-20 00:29:54,786 - main - INFO -      Management:
2025-11-20 00:29:54,786 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:29:54,786 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:29:54,787 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:29:54,787 - main - INFO - 
2025-11-20 00:29:54,787 - main - INFO -      Documents (MongoDB):
2025-11-20 00:29:54,787 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:29:54,788 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:29:54,788 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:29:54,788 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:29:54,788 - main - INFO - 
2025-11-20 00:29:54,788 - main - INFO -      Diagnostics & Health:
2025-11-20 00:29:54,789 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:29:54,789 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:29:54,789 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:29:54,789 - main - INFO - 
2025-11-20 00:29:54,789 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:29:54,789 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:29:54,790 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:29:54,790 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:29:54,790 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:29:54,790 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:29:54,791 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:29:54,791 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:29:54,792 - main - INFO - 
2025-11-20 00:29:54,792 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:29:54,792 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:29:54,792 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:29:54,793 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:29:54,793 - main - INFO -      4. No re-upload needed!
2025-11-20 00:29:54,793 - main - INFO - 
2025-11-20 00:29:54,793 - main - INFO - ================================================================================
2025-11-20 00:29:54,794 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:29:54,794 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:29:54,794 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:29:54,794 - main - INFO - ================================================================================
2025-11-20 00:29:54,794 - main - INFO - 
2025-11-20 00:29:54,795 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:36:46,165 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-20 00:36:46,166 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-20 00:36:46,169 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 00:36:46,173 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 00:36:46,173 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:36:46,173 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-20 00:36:46,174 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 00:36:46,175 - app.services.user_subscription_service - WARNING - âš ï¸  User not found with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:36:46,176 - app.services.user_subscription_service - WARNING -    Database: hakem-ai-backend
2025-11-20 00:36:46,176 - app.services.user_subscription_service - WARNING -    Collection: users
2025-11-20 00:36:46,178 - app.services.user_subscription_service - INFO - ðŸ“Š Total users in collection: 0
2025-11-20 00:36:46,178 - app.api.routes - WARNING - âŒ Comparison not allowed for user 691cd2d361d4fb6ef0028740: User not found with ID: 691cd2d361d4fb6ef0028740. Please check database name matches NestJS backend.
2025-11-20 00:36:46,180 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.01s
2025-11-20 00:38:06,698 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 00:38:06,704 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 00:38:06,705 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:38:06,706 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-20 00:38:06,707 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 00:38:06,710 - app.services.user_subscription_service - WARNING - âš ï¸  User not found with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:38:06,711 - app.services.user_subscription_service - WARNING -    Database: hakem-ai-backend
2025-11-20 00:38:06,711 - app.services.user_subscription_service - WARNING -    Collection: users
2025-11-20 00:38:06,714 - app.services.user_subscription_service - INFO - ðŸ“Š Total users in collection: 0
2025-11-20 00:38:06,715 - app.api.routes - WARNING - âŒ Comparison not allowed for user 691cd2d361d4fb6ef0028740: User not found with ID: 691cd2d361d4fb6ef0028740. Please check database name matches NestJS backend.
2025-11-20 00:38:06,716 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.02s
2025-11-20 00:44:00,851 - main - INFO - 
2025-11-20 00:44:00,852 - main - INFO - ================================================================================
2025-11-20 00:44:00,853 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:44:00,855 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:44:00,857 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:44:00,860 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:44:00,861 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:44:00,863 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:44:00,864 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:44:00,864 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:44:00,865 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:44:00,865 - main - INFO - ================================================================================
2025-11-20 00:44:00,865 - main - INFO - 
2025-11-20 00:44:06,410 - main - INFO - 
2025-11-20 00:44:06,411 - main - INFO - ================================================================================
2025-11-20 00:44:06,411 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:44:06,411 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:44:06,411 - main - INFO - ================================================================================
2025-11-20 00:44:06,412 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:44:06,412 - main - INFO -   Upload Directory: uploads
2025-11-20 00:44:06,412 - main - INFO -   Max File Size: 20MB
2025-11-20 00:44:06,412 - main - INFO - ================================================================================
2025-11-20 00:44:06,413 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:44:06,413 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:44:06,413 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:44:06,448 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:44:06,453 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:44:06,454 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:44:06,454 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:44:06,455 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:44:06,455 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:44:06,455 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:44:06,456 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:44:06,464 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:44:06,465 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:44:06,466 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:44:06,466 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:44:06,466 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:44:06,466 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:44:06,467 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:44:06,467 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:44:06,467 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:44:06,510 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:44:06,511 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:44:06,511 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:44:06,511 - main - INFO - 
2025-11-20 00:44:06,511 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:44:06,512 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:44:06,512 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:44:06,512 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:44:06,512 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:44:06,512 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:44:06,513 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:44:06,513 - main - INFO - 
2025-11-20 00:44:06,513 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:44:06,513 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:44:06,514 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:44:06,514 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:44:06,514 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:44:06,514 - main - INFO - 
2025-11-20 00:44:06,515 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:44:06,515 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:44:06,515 - main - INFO -        - No manual section generation
2025-11-20 00:44:06,516 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:44:06,516 - main - INFO - 
2025-11-20 00:44:06,516 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:44:06,516 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:44:06,517 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:44:06,517 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:44:06,517 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:44:06,518 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:44:06,518 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:44:06,518 - main - INFO - 
2025-11-20 00:44:06,518 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:44:06,518 - main - INFO -      Main:
2025-11-20 00:44:06,519 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:44:06,519 - main - INFO - 
2025-11-20 00:44:06,519 - main - INFO -      Retrieval:
2025-11-20 00:44:06,519 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:44:06,519 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:44:06,520 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:44:06,520 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:44:06,520 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:44:06,520 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:44:06,521 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:44:06,521 - main - INFO - 
2025-11-20 00:44:06,521 - main - INFO -      Management:
2025-11-20 00:44:06,521 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:44:06,521 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:44:06,522 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:44:06,522 - main - INFO - 
2025-11-20 00:44:06,522 - main - INFO -      Documents (MongoDB):
2025-11-20 00:44:06,523 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:44:06,523 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:44:06,524 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:44:06,524 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:44:06,524 - main - INFO - 
2025-11-20 00:44:06,525 - main - INFO -      Diagnostics & Health:
2025-11-20 00:44:06,525 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:44:06,525 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:44:06,525 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:44:06,526 - main - INFO - 
2025-11-20 00:44:06,526 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:44:06,526 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:44:06,526 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:44:06,526 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:44:06,527 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:44:06,527 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:44:06,527 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:44:06,527 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:44:06,527 - main - INFO - 
2025-11-20 00:44:06,528 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:44:06,528 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:44:06,528 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:44:06,528 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:44:06,528 - main - INFO -      4. No re-upload needed!
2025-11-20 00:44:06,529 - main - INFO - 
2025-11-20 00:44:06,529 - main - INFO - ================================================================================
2025-11-20 00:44:06,529 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:44:06,529 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:44:06,529 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:44:06,530 - main - INFO - ================================================================================
2025-11-20 00:44:06,530 - main - INFO - 
2025-11-20 00:44:06,530 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:45:00,106 - main - INFO - 
2025-11-20 00:45:00,106 - main - INFO - ================================================================================
2025-11-20 00:45:00,106 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:45:00,107 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:45:00,108 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:45:00,109 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:45:00,109 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:45:00,110 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:45:00,110 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:45:00,111 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:45:00,111 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:45:00,112 - main - INFO - ================================================================================
2025-11-20 00:45:00,112 - main - INFO - 
2025-11-20 00:45:37,393 - main - INFO - 
2025-11-20 00:45:37,393 - main - INFO - ================================================================================
2025-11-20 00:45:37,394 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:45:37,394 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:45:37,394 - main - INFO - ================================================================================
2025-11-20 00:45:37,394 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:45:37,395 - main - INFO -   Upload Directory: uploads
2025-11-20 00:45:37,395 - main - INFO -   Max File Size: 20MB
2025-11-20 00:45:37,395 - main - INFO - ================================================================================
2025-11-20 00:45:37,395 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:45:37,396 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:45:37,396 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:45:37,438 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:45:37,455 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:45:37,456 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:45:37,456 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:45:37,457 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:45:37,457 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:45:37,457 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:45:37,458 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:45:37,470 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:45:37,472 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:45:37,473 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:45:37,474 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:45:37,474 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:45:37,474 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:45:37,475 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:45:37,475 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:45:37,475 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:45:37,501 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:45:37,502 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:45:37,502 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:45:37,503 - main - INFO - 
2025-11-20 00:45:37,503 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:45:37,503 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:45:37,504 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:45:37,504 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:45:37,504 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:45:37,505 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:45:37,505 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:45:37,505 - main - INFO - 
2025-11-20 00:45:37,506 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:45:37,506 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:45:37,506 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:45:37,506 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:45:37,507 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:45:37,508 - main - INFO - 
2025-11-20 00:45:37,508 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:45:37,509 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:45:37,509 - main - INFO -        - No manual section generation
2025-11-20 00:45:37,509 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:45:37,510 - main - INFO - 
2025-11-20 00:45:37,510 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:45:37,510 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:45:37,510 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:45:37,511 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:45:37,511 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:45:37,511 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:45:37,511 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:45:37,511 - main - INFO - 
2025-11-20 00:45:37,512 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:45:37,512 - main - INFO -      Main:
2025-11-20 00:45:37,512 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:45:37,512 - main - INFO - 
2025-11-20 00:45:37,513 - main - INFO -      Retrieval:
2025-11-20 00:45:37,513 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:45:37,513 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:45:37,513 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:45:37,514 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:45:37,514 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:45:37,514 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:45:37,514 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:45:37,514 - main - INFO - 
2025-11-20 00:45:37,515 - main - INFO -      Management:
2025-11-20 00:45:37,515 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:45:37,515 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:45:37,515 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:45:37,516 - main - INFO - 
2025-11-20 00:45:37,516 - main - INFO -      Documents (MongoDB):
2025-11-20 00:45:37,516 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:45:37,516 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:45:37,516 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:45:37,517 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:45:37,517 - main - INFO - 
2025-11-20 00:45:37,517 - main - INFO -      Diagnostics & Health:
2025-11-20 00:45:37,517 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:45:37,517 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:45:37,518 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:45:37,518 - main - INFO - 
2025-11-20 00:45:37,518 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:45:37,518 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:45:37,518 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:45:37,519 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:45:37,519 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:45:37,519 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:45:37,519 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:45:37,519 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:45:37,519 - main - INFO - 
2025-11-20 00:45:37,519 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:45:37,520 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:45:37,520 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:45:37,520 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:45:37,520 - main - INFO -      4. No re-upload needed!
2025-11-20 00:45:37,520 - main - INFO - 
2025-11-20 00:45:37,521 - main - INFO - ================================================================================
2025-11-20 00:45:37,521 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:45:37,521 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:45:37,521 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:45:37,521 - main - INFO - ================================================================================
2025-11-20 00:45:37,522 - main - INFO - 
2025-11-20 00:45:37,522 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:45:46,886 - main - INFO - 
2025-11-20 00:45:46,887 - main - INFO - ================================================================================
2025-11-20 00:45:46,888 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:45:46,891 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:45:46,892 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:45:46,895 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:45:46,897 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:45:46,899 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:45:46,900 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:45:46,903 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:45:46,904 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:45:46,904 - main - INFO - ================================================================================
2025-11-20 00:45:46,905 - main - INFO - 
2025-11-20 00:46:28,763 - main - INFO - 
2025-11-20 00:46:28,763 - main - INFO - ================================================================================
2025-11-20 00:46:28,763 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:46:28,763 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:46:28,763 - main - INFO - ================================================================================
2025-11-20 00:46:28,764 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:46:28,764 - main - INFO -   Upload Directory: uploads
2025-11-20 00:46:28,764 - main - INFO -   Max File Size: 20MB
2025-11-20 00:46:28,764 - main - INFO - ================================================================================
2025-11-20 00:46:28,765 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:46:28,765 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:46:28,765 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:46:28,782 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:46:28,788 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:46:28,789 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:46:28,789 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:46:28,789 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:46:28,791 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:46:28,792 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:46:28,792 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:46:28,800 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:46:28,801 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:46:28,802 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:46:28,802 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:46:28,803 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:46:28,803 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:46:28,803 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:46:28,803 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:46:28,804 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:46:28,832 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:46:28,832 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:46:28,833 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:46:28,833 - main - INFO - 
2025-11-20 00:46:28,833 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:46:28,834 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:46:28,834 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:46:28,834 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:46:28,834 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:46:28,835 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:46:28,835 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:46:28,835 - main - INFO - 
2025-11-20 00:46:28,835 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:46:28,836 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:46:28,836 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:46:28,836 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:46:28,836 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:46:28,837 - main - INFO - 
2025-11-20 00:46:28,837 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:46:28,838 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:46:28,839 - main - INFO -        - No manual section generation
2025-11-20 00:46:28,839 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:46:28,839 - main - INFO - 
2025-11-20 00:46:28,840 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:46:28,840 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:46:28,840 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:46:28,841 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:46:28,841 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:46:28,841 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:46:28,842 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:46:28,842 - main - INFO - 
2025-11-20 00:46:28,842 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:46:28,842 - main - INFO -      Main:
2025-11-20 00:46:28,843 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:46:28,843 - main - INFO - 
2025-11-20 00:46:28,843 - main - INFO -      Retrieval:
2025-11-20 00:46:28,843 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:46:28,843 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:46:28,844 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:46:28,844 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:46:28,844 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:46:28,844 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:46:28,845 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:46:28,845 - main - INFO - 
2025-11-20 00:46:28,845 - main - INFO -      Management:
2025-11-20 00:46:28,846 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:46:28,846 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:46:28,846 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:46:28,846 - main - INFO - 
2025-11-20 00:46:28,847 - main - INFO -      Documents (MongoDB):
2025-11-20 00:46:28,847 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:46:28,847 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:46:28,847 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:46:28,848 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:46:28,848 - main - INFO - 
2025-11-20 00:46:28,848 - main - INFO -      Diagnostics & Health:
2025-11-20 00:46:28,849 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:46:28,849 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:46:28,849 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:46:28,849 - main - INFO - 
2025-11-20 00:46:28,849 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:46:28,850 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:46:28,850 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:46:28,850 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:46:28,850 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:46:28,851 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:46:28,851 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:46:28,851 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:46:28,851 - main - INFO - 
2025-11-20 00:46:28,851 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:46:28,852 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:46:28,852 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:46:28,852 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:46:28,852 - main - INFO -      4. No re-upload needed!
2025-11-20 00:46:28,853 - main - INFO - 
2025-11-20 00:46:28,853 - main - INFO - ================================================================================
2025-11-20 00:46:28,853 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:46:28,853 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:46:28,854 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:46:28,855 - main - INFO - ================================================================================
2025-11-20 00:46:28,856 - main - INFO - 
2025-11-20 00:46:28,856 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:47:35,439 - main - INFO - 
2025-11-20 00:47:35,440 - main - INFO - ================================================================================
2025-11-20 00:47:35,441 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:47:35,444 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:47:35,445 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:47:35,448 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:47:35,449 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:47:35,452 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:47:35,453 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:47:35,456 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:47:35,457 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:47:35,457 - main - INFO - ================================================================================
2025-11-20 00:47:35,458 - main - INFO - 
2025-11-20 00:47:50,401 - main - INFO - 
2025-11-20 00:47:50,401 - main - INFO - ================================================================================
2025-11-20 00:47:50,401 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:47:50,402 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:47:50,402 - main - INFO - ================================================================================
2025-11-20 00:47:50,402 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:47:50,402 - main - INFO -   Upload Directory: uploads
2025-11-20 00:47:50,402 - main - INFO -   Max File Size: 20MB
2025-11-20 00:47:50,402 - main - INFO - ================================================================================
2025-11-20 00:47:50,403 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:47:50,403 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:47:50,403 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:47:50,444 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:47:50,453 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:47:50,453 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:47:50,453 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:47:50,454 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:47:50,456 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:47:50,456 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:47:50,457 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:47:50,465 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:47:50,466 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:47:50,467 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:47:50,467 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:47:50,467 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:47:50,468 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:47:50,468 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:47:50,468 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:47:50,468 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:47:50,493 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:47:50,493 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:47:50,494 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:47:50,494 - main - INFO - 
2025-11-20 00:47:50,494 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:47:50,495 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:47:50,495 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:47:50,495 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:47:50,496 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:47:50,497 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:47:50,497 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:47:50,498 - main - INFO - 
2025-11-20 00:47:50,498 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:47:50,498 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:47:50,499 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:47:50,499 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:47:50,499 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:47:50,500 - main - INFO - 
2025-11-20 00:47:50,500 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:47:50,500 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:47:50,500 - main - INFO -        - No manual section generation
2025-11-20 00:47:50,501 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:47:50,501 - main - INFO - 
2025-11-20 00:47:50,501 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:47:50,502 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:47:50,502 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:47:50,502 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:47:50,502 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:47:50,503 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:47:50,503 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:47:50,503 - main - INFO - 
2025-11-20 00:47:50,503 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:47:50,505 - main - INFO -      Main:
2025-11-20 00:47:50,505 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:47:50,506 - main - INFO - 
2025-11-20 00:47:50,506 - main - INFO -      Retrieval:
2025-11-20 00:47:50,507 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:47:50,507 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:47:50,508 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:47:50,508 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:47:50,508 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:47:50,508 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:47:50,509 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:47:50,509 - main - INFO - 
2025-11-20 00:47:50,509 - main - INFO -      Management:
2025-11-20 00:47:50,509 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:47:50,510 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:47:50,511 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:47:50,511 - main - INFO - 
2025-11-20 00:47:50,511 - main - INFO -      Documents (MongoDB):
2025-11-20 00:47:50,511 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:47:50,512 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:47:50,512 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:47:50,512 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:47:50,512 - main - INFO - 
2025-11-20 00:47:50,513 - main - INFO -      Diagnostics & Health:
2025-11-20 00:47:50,513 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:47:50,513 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:47:50,513 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:47:50,514 - main - INFO - 
2025-11-20 00:47:50,514 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:47:50,514 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:47:50,514 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:47:50,514 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:47:50,515 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:47:50,515 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:47:50,515 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:47:50,515 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:47:50,516 - main - INFO - 
2025-11-20 00:47:50,516 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:47:50,516 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:47:50,516 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:47:50,517 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:47:50,517 - main - INFO -      4. No re-upload needed!
2025-11-20 00:47:50,517 - main - INFO - 
2025-11-20 00:47:50,517 - main - INFO - ================================================================================
2025-11-20 00:47:50,517 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:47:50,518 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:47:50,518 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:47:50,518 - main - INFO - ================================================================================
2025-11-20 00:47:50,518 - main - INFO - 
2025-11-20 00:47:50,519 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:53:40,202 - main - INFO - 
2025-11-20 00:53:40,203 - main - INFO - ================================================================================
2025-11-20 00:53:40,203 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:53:40,205 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:53:40,206 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:53:40,207 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:53:40,207 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:53:40,208 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:53:40,209 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:53:40,209 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:53:40,210 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:53:40,210 - main - INFO - ================================================================================
2025-11-20 00:53:40,210 - main - INFO - 
2025-11-20 00:53:43,372 - main - INFO - 
2025-11-20 00:53:43,372 - main - INFO - ================================================================================
2025-11-20 00:53:43,372 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:53:43,373 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:53:43,373 - main - INFO - ================================================================================
2025-11-20 00:53:43,373 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:53:43,373 - main - INFO -   Upload Directory: uploads
2025-11-20 00:53:43,374 - main - INFO -   Max File Size: 20MB
2025-11-20 00:53:43,374 - main - INFO - ================================================================================
2025-11-20 00:53:43,374 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:53:43,375 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:53:43,375 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:53:43,412 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:53:43,537 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:53:43,538 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:53:43,539 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:53:43,540 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:53:43,540 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:53:43,541 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:53:43,542 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:53:43,561 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:53:43,564 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:53:43,566 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:53:43,566 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:53:43,566 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:53:43,567 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:53:43,567 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:53:43,567 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:53:43,568 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:53:43,602 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:53:43,602 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:53:43,603 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:53:43,603 - main - INFO - 
2025-11-20 00:53:43,603 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:53:43,604 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:53:43,605 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:53:43,606 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:53:43,606 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:53:43,607 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:53:43,607 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:53:43,608 - main - INFO - 
2025-11-20 00:53:43,608 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:53:43,608 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:53:43,609 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:53:43,609 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:53:43,609 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:53:43,609 - main - INFO - 
2025-11-20 00:53:43,610 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:53:43,610 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:53:43,610 - main - INFO -        - No manual section generation
2025-11-20 00:53:43,610 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:53:43,611 - main - INFO - 
2025-11-20 00:53:43,611 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:53:43,611 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:53:43,612 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:53:43,612 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:53:43,612 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:53:43,613 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:53:43,613 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:53:43,613 - main - INFO - 
2025-11-20 00:53:43,613 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:53:43,614 - main - INFO -      Main:
2025-11-20 00:53:43,614 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:53:43,614 - main - INFO - 
2025-11-20 00:53:43,614 - main - INFO -      Retrieval:
2025-11-20 00:53:43,615 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:53:43,615 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:53:43,615 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:53:43,616 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:53:43,616 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:53:43,616 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:53:43,616 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:53:43,617 - main - INFO - 
2025-11-20 00:53:43,617 - main - INFO -      Management:
2025-11-20 00:53:43,617 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:53:43,617 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:53:43,617 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:53:43,618 - main - INFO - 
2025-11-20 00:53:43,618 - main - INFO -      Documents (MongoDB):
2025-11-20 00:53:43,618 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:53:43,619 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:53:43,619 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:53:43,619 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:53:43,619 - main - INFO - 
2025-11-20 00:53:43,620 - main - INFO -      Diagnostics & Health:
2025-11-20 00:53:43,620 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:53:43,620 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:53:43,620 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:53:43,621 - main - INFO - 
2025-11-20 00:53:43,622 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:53:43,622 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:53:43,623 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:53:43,623 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:53:43,623 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:53:43,623 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:53:43,624 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:53:43,624 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:53:43,624 - main - INFO - 
2025-11-20 00:53:43,624 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:53:43,625 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:53:43,625 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:53:43,625 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:53:43,625 - main - INFO -      4. No re-upload needed!
2025-11-20 00:53:43,625 - main - INFO - 
2025-11-20 00:53:43,626 - main - INFO - ================================================================================
2025-11-20 00:53:43,626 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:53:43,626 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:53:43,627 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:53:43,627 - main - INFO - ================================================================================
2025-11-20 00:53:43,627 - main - INFO - 
2025-11-20 00:53:43,628 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:53:46,025 - main - INFO - 
2025-11-20 00:53:46,026 - main - INFO - ================================================================================
2025-11-20 00:53:46,026 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:53:46,027 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:53:46,027 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:53:46,028 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:53:46,029 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:53:46,030 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:53:46,030 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:53:46,031 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:53:46,031 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:53:46,032 - main - INFO - ================================================================================
2025-11-20 00:53:46,032 - main - INFO - 
2025-11-20 00:54:17,823 - main - INFO - 
2025-11-20 00:54:17,823 - main - INFO - ================================================================================
2025-11-20 00:54:17,823 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:54:17,823 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:54:17,824 - main - INFO - ================================================================================
2025-11-20 00:54:17,824 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:54:17,824 - main - INFO -   Upload Directory: uploads
2025-11-20 00:54:17,824 - main - INFO -   Max File Size: 20MB
2025-11-20 00:54:17,824 - main - INFO - ================================================================================
2025-11-20 00:54:17,825 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:54:17,825 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:54:17,826 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:54:17,862 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:54:17,867 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:54:17,867 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:54:17,868 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:54:17,868 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:54:17,868 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:54:17,869 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:54:17,869 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:54:17,891 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:54:17,892 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:54:17,893 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:54:17,893 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:54:17,894 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:54:17,894 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:54:17,895 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:54:17,895 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:54:17,895 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:54:17,924 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:54:17,924 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:54:17,925 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:54:17,925 - main - INFO - 
2025-11-20 00:54:17,925 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:54:17,925 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:54:17,926 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:54:17,926 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:54:17,926 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:54:17,926 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:54:17,926 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:54:17,927 - main - INFO - 
2025-11-20 00:54:17,927 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:54:17,927 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:54:17,928 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:54:17,928 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:54:17,928 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:54:17,928 - main - INFO - 
2025-11-20 00:54:17,929 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:54:17,929 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:54:17,929 - main - INFO -        - No manual section generation
2025-11-20 00:54:17,930 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:54:17,930 - main - INFO - 
2025-11-20 00:54:17,930 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:54:17,930 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:54:17,931 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:54:17,931 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:54:17,931 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:54:17,931 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:54:17,932 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:54:17,932 - main - INFO - 
2025-11-20 00:54:17,932 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:54:17,933 - main - INFO -      Main:
2025-11-20 00:54:17,933 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:54:17,933 - main - INFO - 
2025-11-20 00:54:17,933 - main - INFO -      Retrieval:
2025-11-20 00:54:17,933 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:54:17,934 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:54:17,934 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:54:17,934 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:54:17,934 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:54:17,935 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:54:17,935 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:54:17,935 - main - INFO - 
2025-11-20 00:54:17,935 - main - INFO -      Management:
2025-11-20 00:54:17,936 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:54:17,936 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:54:17,936 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:54:17,936 - main - INFO - 
2025-11-20 00:54:17,937 - main - INFO -      Documents (MongoDB):
2025-11-20 00:54:17,937 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:54:17,937 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:54:17,938 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:54:17,938 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:54:17,938 - main - INFO - 
2025-11-20 00:54:17,939 - main - INFO -      Diagnostics & Health:
2025-11-20 00:54:17,939 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:54:17,939 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:54:17,939 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:54:17,940 - main - INFO - 
2025-11-20 00:54:17,940 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:54:17,940 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:54:17,941 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:54:17,941 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:54:17,941 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:54:17,941 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:54:17,942 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:54:17,942 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:54:17,942 - main - INFO - 
2025-11-20 00:54:17,942 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:54:17,943 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:54:17,943 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:54:17,943 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:54:17,944 - main - INFO -      4. No re-upload needed!
2025-11-20 00:54:17,944 - main - INFO - 
2025-11-20 00:54:17,944 - main - INFO - ================================================================================
2025-11-20 00:54:17,944 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:54:17,946 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:54:17,946 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:54:17,947 - main - INFO - ================================================================================
2025-11-20 00:54:17,947 - main - INFO - 
2025-11-20 00:54:17,947 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 00:56:28,067 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-20 00:56:28,068 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-20 00:56:28,072 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 00:56:28,077 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 00:56:28,078 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:56:28,079 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-20 00:56:28,079 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 00:56:28,081 - app.services.user_subscription_service - WARNING - âš ï¸  User not found with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:56:28,081 - app.services.user_subscription_service - WARNING -    Database: hakem-ai-backend
2025-11-20 00:56:28,082 - app.services.user_subscription_service - WARNING -    Collection: users
2025-11-20 00:56:28,083 - app.services.user_subscription_service - INFO - ðŸ“Š Total users in collection: 0
2025-11-20 00:56:28,084 - app.api.routes - WARNING - âŒ Comparison not allowed for user 691cd2d361d4fb6ef0028740: User not found with ID: 691cd2d361d4fb6ef0028740. Please check database name matches NestJS backend.
2025-11-20 00:56:28,085 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.01s
2025-11-20 00:57:27,527 - main - INFO - ðŸ“¥ GET /docs
2025-11-20 00:57:27,529 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-20 00:57:27,780 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-20 00:57:27,788 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-20 00:57:58,358 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 00:57:58,361 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 00:57:58,362 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:57:58,362 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-20 00:57:58,363 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 00:57:58,364 - app.services.user_subscription_service - WARNING - âš ï¸  User not found with ID: 691cd2d361d4fb6ef0028740
2025-11-20 00:57:58,364 - app.services.user_subscription_service - WARNING -    Database: hakem-ai-backend
2025-11-20 00:57:58,365 - app.services.user_subscription_service - WARNING -    Collection: users
2025-11-20 00:57:58,369 - app.services.user_subscription_service - INFO - ðŸ“Š Total users in collection: 0
2025-11-20 00:57:58,370 - app.api.routes - WARNING - âŒ Comparison not allowed for user 691cd2d361d4fb6ef0028740: User not found with ID: 691cd2d361d4fb6ef0028740. Please check database name matches NestJS backend.
2025-11-20 00:57:58,373 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.01s
2025-11-20 00:59:54,200 - main - INFO - 
2025-11-20 00:59:54,201 - main - INFO - ================================================================================
2025-11-20 00:59:54,201 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 00:59:54,202 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:59:54,202 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 00:59:54,203 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 00:59:54,204 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 00:59:54,205 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 00:59:54,206 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 00:59:54,208 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 00:59:54,209 - main - INFO -   âœ… Application stopped successfully
2025-11-20 00:59:54,210 - main - INFO - ================================================================================
2025-11-20 00:59:54,211 - main - INFO - 
2025-11-20 00:59:57,411 - main - INFO - 
2025-11-20 00:59:57,411 - main - INFO - ================================================================================
2025-11-20 00:59:57,411 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 00:59:57,411 - main - INFO -   Production-Ready Complete Integration
2025-11-20 00:59:57,412 - main - INFO - ================================================================================
2025-11-20 00:59:57,412 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 00:59:57,412 - main - INFO -   Upload Directory: uploads
2025-11-20 00:59:57,413 - main - INFO -   Max File Size: 20MB
2025-11-20 00:59:57,413 - main - INFO - ================================================================================
2025-11-20 00:59:57,413 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 00:59:57,414 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 00:59:57,414 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 00:59:57,458 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 00:59:57,464 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 00:59:57,464 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 00:59:57,465 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 00:59:57,465 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 00:59:57,465 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 00:59:57,466 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:59:57,466 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:59:57,491 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 00:59:57,493 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 00:59:57,494 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 00:59:57,495 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 00:59:57,495 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 00:59:57,495 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 00:59:57,496 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 00:59:57,496 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 00:59:57,496 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 00:59:57,522 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 00:59:57,522 - main - INFO -   âœ… User Documents Service connected
2025-11-20 00:59:57,522 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 00:59:57,523 - main - INFO - 
2025-11-20 00:59:57,523 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 00:59:57,523 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 00:59:57,523 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 00:59:57,523 - main - INFO -        - Separates warranties from extensions
2025-11-20 00:59:57,524 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 00:59:57,524 - main - INFO -        - Correct deductible tier detection
2025-11-20 00:59:57,524 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 00:59:57,525 - main - INFO - 
2025-11-20 00:59:57,525 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 00:59:57,526 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 00:59:57,526 - main - INFO -        - Identifies unique items per provider
2025-11-20 00:59:57,526 - main - INFO -        - Transparent scoring methodology
2025-11-20 00:59:57,527 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 00:59:57,527 - main - INFO - 
2025-11-20 00:59:57,527 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 00:59:57,527 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 00:59:57,528 - main - INFO -        - No manual section generation
2025-11-20 00:59:57,528 - main - INFO -        - Complete MongoDB integration
2025-11-20 00:59:57,528 - main - INFO - 
2025-11-20 00:59:57,529 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 00:59:57,529 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 00:59:57,529 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 00:59:57,529 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 00:59:57,530 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 00:59:57,530 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 00:59:57,530 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 00:59:57,530 - main - INFO - 
2025-11-20 00:59:57,530 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 00:59:57,531 - main - INFO -      Main:
2025-11-20 00:59:57,531 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 00:59:57,531 - main - INFO - 
2025-11-20 00:59:57,531 - main - INFO -      Retrieval:
2025-11-20 00:59:57,532 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 00:59:57,532 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 00:59:57,532 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 00:59:57,532 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 00:59:57,532 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 00:59:57,533 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 00:59:57,533 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 00:59:57,533 - main - INFO - 
2025-11-20 00:59:57,534 - main - INFO -      Management:
2025-11-20 00:59:57,534 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 00:59:57,534 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 00:59:57,534 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 00:59:57,535 - main - INFO - 
2025-11-20 00:59:57,535 - main - INFO -      Documents (MongoDB):
2025-11-20 00:59:57,535 - main - INFO -        GET  /api/documents                All documents
2025-11-20 00:59:57,536 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 00:59:57,536 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 00:59:57,536 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 00:59:57,536 - main - INFO - 
2025-11-20 00:59:57,537 - main - INFO -      Diagnostics & Health:
2025-11-20 00:59:57,537 - main - INFO -        GET  /api/health                   System health
2025-11-20 00:59:57,537 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 00:59:57,537 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 00:59:57,537 - main - INFO - 
2025-11-20 00:59:57,538 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 00:59:57,538 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 00:59:57,538 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 00:59:57,539 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 00:59:57,539 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 00:59:57,539 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 00:59:57,539 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 00:59:57,539 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 00:59:57,540 - main - INFO - 
2025-11-20 00:59:57,540 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 00:59:57,540 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 00:59:57,540 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 00:59:57,540 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 00:59:57,540 - main - INFO -      4. No re-upload needed!
2025-11-20 00:59:57,541 - main - INFO - 
2025-11-20 00:59:57,541 - main - INFO - ================================================================================
2025-11-20 00:59:57,541 - main - INFO -   âœ… Application started successfully!
2025-11-20 00:59:57,541 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 00:59:57,541 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 00:59:57,541 - main - INFO - ================================================================================
2025-11-20 00:59:57,542 - main - INFO - 
2025-11-20 00:59:57,542 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 01:00:00,685 - main - INFO - 
2025-11-20 01:00:00,685 - main - INFO - ================================================================================
2025-11-20 01:00:00,685 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 01:00:00,686 - main - INFO -   Production-Ready Complete Integration
2025-11-20 01:00:00,687 - main - INFO - ================================================================================
2025-11-20 01:00:00,687 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 01:00:00,687 - main - INFO -   Upload Directory: uploads
2025-11-20 01:00:00,688 - main - INFO -   Max File Size: 20MB
2025-11-20 01:00:00,688 - main - INFO - ================================================================================
2025-11-20 01:00:00,689 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 01:00:00,689 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 01:00:00,689 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 01:00:00,722 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 01:00:00,730 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 01:00:00,730 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 01:00:00,730 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 01:00:00,731 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 01:00:00,731 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 01:00:00,731 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:00:00,732 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 01:00:00,754 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 01:00:00,755 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 01:00:00,756 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 01:00:00,757 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 01:00:00,757 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 01:00:00,757 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 01:00:00,758 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 01:00:00,758 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:00:00,758 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 01:00:00,784 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 01:00:00,784 - main - INFO -   âœ… User Documents Service connected
2025-11-20 01:00:00,784 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 01:00:00,785 - main - INFO - 
2025-11-20 01:00:00,785 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 01:00:00,785 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 01:00:00,785 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 01:00:00,786 - main - INFO -        - Separates warranties from extensions
2025-11-20 01:00:00,786 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 01:00:00,786 - main - INFO -        - Correct deductible tier detection
2025-11-20 01:00:00,786 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 01:00:00,787 - main - INFO - 
2025-11-20 01:00:00,787 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 01:00:00,787 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 01:00:00,787 - main - INFO -        - Identifies unique items per provider
2025-11-20 01:00:00,788 - main - INFO -        - Transparent scoring methodology
2025-11-20 01:00:00,789 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 01:00:00,789 - main - INFO - 
2025-11-20 01:00:00,790 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 01:00:00,790 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 01:00:00,791 - main - INFO -        - No manual section generation
2025-11-20 01:00:00,791 - main - INFO -        - Complete MongoDB integration
2025-11-20 01:00:00,792 - main - INFO - 
2025-11-20 01:00:00,792 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 01:00:00,792 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 01:00:00,793 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 01:00:00,793 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 01:00:00,793 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 01:00:00,793 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 01:00:00,794 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 01:00:00,794 - main - INFO - 
2025-11-20 01:00:00,794 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 01:00:00,795 - main - INFO -      Main:
2025-11-20 01:00:00,795 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 01:00:00,795 - main - INFO - 
2025-11-20 01:00:00,796 - main - INFO -      Retrieval:
2025-11-20 01:00:00,796 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 01:00:00,797 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 01:00:00,797 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 01:00:00,797 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 01:00:00,797 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 01:00:00,798 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 01:00:00,798 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 01:00:00,798 - main - INFO - 
2025-11-20 01:00:00,799 - main - INFO -      Management:
2025-11-20 01:00:00,799 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 01:00:00,799 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 01:00:00,800 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 01:00:00,800 - main - INFO - 
2025-11-20 01:00:00,800 - main - INFO -      Documents (MongoDB):
2025-11-20 01:00:00,800 - main - INFO -        GET  /api/documents                All documents
2025-11-20 01:00:00,801 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 01:00:00,801 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 01:00:00,801 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 01:00:00,801 - main - INFO - 
2025-11-20 01:00:00,802 - main - INFO -      Diagnostics & Health:
2025-11-20 01:00:00,802 - main - INFO -        GET  /api/health                   System health
2025-11-20 01:00:00,802 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 01:00:00,802 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 01:00:00,802 - main - INFO - 
2025-11-20 01:00:00,803 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 01:00:00,803 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 01:00:00,803 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 01:00:00,803 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 01:00:00,804 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 01:00:00,804 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 01:00:00,804 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 01:00:00,805 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 01:00:00,806 - main - INFO - 
2025-11-20 01:00:00,806 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 01:00:00,806 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 01:00:00,807 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 01:00:00,807 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 01:00:00,807 - main - INFO -      4. No re-upload needed!
2025-11-20 01:00:00,807 - main - INFO - 
2025-11-20 01:00:00,808 - main - INFO - ================================================================================
2025-11-20 01:00:00,808 - main - INFO -   âœ… Application started successfully!
2025-11-20 01:00:00,808 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 01:00:00,808 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 01:00:00,809 - main - INFO - ================================================================================
2025-11-20 01:00:00,809 - main - INFO - 
2025-11-20 01:00:00,809 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 01:00:03,797 - main - INFO - 
2025-11-20 01:00:03,798 - main - INFO - ================================================================================
2025-11-20 01:00:03,798 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 01:00:03,798 - main - INFO -   Production-Ready Complete Integration
2025-11-20 01:00:03,798 - main - INFO - ================================================================================
2025-11-20 01:00:03,799 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 01:00:03,799 - main - INFO -   Upload Directory: uploads
2025-11-20 01:00:03,799 - main - INFO -   Max File Size: 20MB
2025-11-20 01:00:03,800 - main - INFO - ================================================================================
2025-11-20 01:00:03,800 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 01:00:03,800 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 01:00:03,801 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 01:00:03,845 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 01:00:03,850 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 01:00:03,851 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 01:00:03,851 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakem-ai-backend
2025-11-20 01:00:03,851 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 01:00:03,852 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 01:00:03,852 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:00:03,852 - app.services.user_subscription_service - INFO -    Database: hakem-ai-backend
2025-11-20 01:00:03,875 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 01:00:03,876 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 01:00:03,877 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakem-ai-backend': []
2025-11-20 01:00:03,878 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'hakem-ai-backend'
2025-11-20 01:00:03,878 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-20 01:00:03,878 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 01:00:03,879 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 01:00:03,879 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:00:03,879 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 01:00:03,904 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 01:00:03,905 - main - INFO -   âœ… User Documents Service connected
2025-11-20 01:00:03,905 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 01:00:03,906 - main - INFO - 
2025-11-20 01:00:03,906 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 01:00:03,906 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 01:00:03,907 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 01:00:03,907 - main - INFO -        - Separates warranties from extensions
2025-11-20 01:00:03,907 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 01:00:03,908 - main - INFO -        - Correct deductible tier detection
2025-11-20 01:00:03,908 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 01:00:03,908 - main - INFO - 
2025-11-20 01:00:03,908 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 01:00:03,909 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 01:00:03,909 - main - INFO -        - Identifies unique items per provider
2025-11-20 01:00:03,909 - main - INFO -        - Transparent scoring methodology
2025-11-20 01:00:03,909 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 01:00:03,910 - main - INFO - 
2025-11-20 01:00:03,910 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 01:00:03,910 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 01:00:03,910 - main - INFO -        - No manual section generation
2025-11-20 01:00:03,911 - main - INFO -        - Complete MongoDB integration
2025-11-20 01:00:03,911 - main - INFO - 
2025-11-20 01:00:03,911 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 01:00:03,911 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 01:00:03,912 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 01:00:03,912 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 01:00:03,912 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 01:00:03,912 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 01:00:03,912 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 01:00:03,913 - main - INFO - 
2025-11-20 01:00:03,913 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 01:00:03,913 - main - INFO -      Main:
2025-11-20 01:00:03,914 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 01:00:03,914 - main - INFO - 
2025-11-20 01:00:03,914 - main - INFO -      Retrieval:
2025-11-20 01:00:03,914 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 01:00:03,914 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 01:00:03,915 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 01:00:03,915 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 01:00:03,915 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 01:00:03,915 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 01:00:03,915 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 01:00:03,916 - main - INFO - 
2025-11-20 01:00:03,916 - main - INFO -      Management:
2025-11-20 01:00:03,916 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 01:00:03,917 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 01:00:03,917 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 01:00:03,917 - main - INFO - 
2025-11-20 01:00:03,917 - main - INFO -      Documents (MongoDB):
2025-11-20 01:00:03,917 - main - INFO -        GET  /api/documents                All documents
2025-11-20 01:00:03,918 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 01:00:03,918 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 01:00:03,918 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 01:00:03,918 - main - INFO - 
2025-11-20 01:00:03,918 - main - INFO -      Diagnostics & Health:
2025-11-20 01:00:03,919 - main - INFO -        GET  /api/health                   System health
2025-11-20 01:00:03,919 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 01:00:03,919 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 01:00:03,919 - main - INFO - 
2025-11-20 01:00:03,920 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 01:00:03,920 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 01:00:03,920 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 01:00:03,920 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 01:00:03,920 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 01:00:03,921 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 01:00:03,921 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 01:00:03,922 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 01:00:03,922 - main - INFO - 
2025-11-20 01:00:03,923 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 01:00:03,923 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 01:00:03,923 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 01:00:03,923 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 01:00:03,924 - main - INFO -      4. No re-upload needed!
2025-11-20 01:00:03,924 - main - INFO - 
2025-11-20 01:00:03,924 - main - INFO - ================================================================================
2025-11-20 01:00:03,924 - main - INFO -   âœ… Application started successfully!
2025-11-20 01:00:03,924 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 01:00:03,925 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 01:00:03,925 - main - INFO - ================================================================================
2025-11-20 01:00:03,925 - main - INFO - 
2025-11-20 01:00:03,926 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 01:00:03,934 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 01:00:03,936 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 01:00:03,937 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:00:03,937 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakem-ai-backend
2025-11-20 01:00:03,937 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:00:03,940 - app.services.user_subscription_service - WARNING - âš ï¸  User not found with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:00:03,940 - app.services.user_subscription_service - WARNING -    Database: hakem-ai-backend
2025-11-20 01:00:03,940 - app.services.user_subscription_service - WARNING -    Collection: users
2025-11-20 01:00:03,942 - app.services.user_subscription_service - INFO - ðŸ“Š Total users in collection: 0
2025-11-20 01:00:03,943 - app.api.routes - WARNING - âŒ Comparison not allowed for user 691cd2d361d4fb6ef0028740: User not found with ID: 691cd2d361d4fb6ef0028740. Please check database name matches NestJS backend.
2025-11-20 01:00:03,944 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.01s
2025-11-20 01:12:25,265 - main - INFO - 
2025-11-20 01:12:25,265 - main - INFO - ================================================================================
2025-11-20 01:12:25,265 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 01:12:25,266 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 01:12:25,266 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 01:12:25,267 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 01:12:25,268 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 01:12:25,269 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 01:12:25,270 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 01:12:25,271 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-20 01:12:25,271 - main - INFO -   âœ… Application stopped successfully
2025-11-20 01:12:25,271 - main - INFO - ================================================================================
2025-11-20 01:12:25,271 - main - INFO - 
2025-11-20 01:12:28,077 - main - INFO - 
2025-11-20 01:12:28,077 - main - INFO - ================================================================================
2025-11-20 01:12:28,077 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 01:12:28,077 - main - INFO -   Production-Ready Complete Integration
2025-11-20 01:12:28,078 - main - INFO - ================================================================================
2025-11-20 01:12:28,078 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 01:12:28,078 - main - INFO -   Upload Directory: uploads
2025-11-20 01:12:28,079 - main - INFO -   Max File Size: 20MB
2025-11-20 01:12:28,079 - main - INFO - ================================================================================
2025-11-20 01:12:28,079 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 01:12:28,080 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 01:12:28,080 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 01:12:28,111 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 01:12:28,117 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 01:12:28,118 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 01:12:28,118 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-20 01:12:28,118 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 01:12:28,118 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 01:12:28,119 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:12:28,119 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-20 01:12:28,145 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 01:12:28,147 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 01:12:28,149 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['users', 'admins', 'comparisons', 'individual_pdf_extractions']
2025-11-20 01:12:28,161 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 1 documents
2025-11-20 01:12:28,162 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 01:12:28,162 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 01:12:28,163 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:12:28,163 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 01:12:28,192 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 01:12:28,192 - main - INFO -   âœ… User Documents Service connected
2025-11-20 01:12:28,193 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 01:12:28,193 - main - INFO - 
2025-11-20 01:12:28,193 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 01:12:28,193 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 01:12:28,194 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 01:12:28,194 - main - INFO -        - Separates warranties from extensions
2025-11-20 01:12:28,194 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 01:12:28,194 - main - INFO -        - Correct deductible tier detection
2025-11-20 01:12:28,195 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 01:12:28,195 - main - INFO - 
2025-11-20 01:12:28,195 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 01:12:28,195 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 01:12:28,195 - main - INFO -        - Identifies unique items per provider
2025-11-20 01:12:28,196 - main - INFO -        - Transparent scoring methodology
2025-11-20 01:12:28,196 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 01:12:28,196 - main - INFO - 
2025-11-20 01:12:28,196 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 01:12:28,197 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 01:12:28,197 - main - INFO -        - No manual section generation
2025-11-20 01:12:28,198 - main - INFO -        - Complete MongoDB integration
2025-11-20 01:12:28,198 - main - INFO - 
2025-11-20 01:12:28,199 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 01:12:28,199 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 01:12:28,199 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 01:12:28,199 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 01:12:28,200 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 01:12:28,200 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 01:12:28,200 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 01:12:28,200 - main - INFO - 
2025-11-20 01:12:28,200 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 01:12:28,201 - main - INFO -      Main:
2025-11-20 01:12:28,201 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 01:12:28,201 - main - INFO - 
2025-11-20 01:12:28,201 - main - INFO -      Retrieval:
2025-11-20 01:12:28,202 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 01:12:28,202 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 01:12:28,202 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 01:12:28,202 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 01:12:28,203 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 01:12:28,203 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 01:12:28,203 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 01:12:28,203 - main - INFO - 
2025-11-20 01:12:28,204 - main - INFO -      Management:
2025-11-20 01:12:28,204 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 01:12:28,204 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 01:12:28,204 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 01:12:28,204 - main - INFO - 
2025-11-20 01:12:28,205 - main - INFO -      Documents (MongoDB):
2025-11-20 01:12:28,205 - main - INFO -        GET  /api/documents                All documents
2025-11-20 01:12:28,206 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 01:12:28,207 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 01:12:28,207 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 01:12:28,208 - main - INFO - 
2025-11-20 01:12:28,208 - main - INFO -      Diagnostics & Health:
2025-11-20 01:12:28,209 - main - INFO -        GET  /api/health                   System health
2025-11-20 01:12:28,209 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 01:12:28,209 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 01:12:28,209 - main - INFO - 
2025-11-20 01:12:28,210 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 01:12:28,210 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 01:12:28,210 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 01:12:28,210 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 01:12:28,211 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 01:12:28,211 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 01:12:28,211 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 01:12:28,211 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 01:12:28,211 - main - INFO - 
2025-11-20 01:12:28,212 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 01:12:28,212 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 01:12:28,212 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 01:12:28,212 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 01:12:28,213 - main - INFO -      4. No re-upload needed!
2025-11-20 01:12:28,213 - main - INFO - 
2025-11-20 01:12:28,213 - main - INFO - ================================================================================
2025-11-20 01:12:28,213 - main - INFO -   âœ… Application started successfully!
2025-11-20 01:12:28,214 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 01:12:28,214 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 01:12:28,214 - main - INFO - ================================================================================
2025-11-20 01:12:28,215 - main - INFO - 
2025-11-20 01:12:28,215 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 01:12:31,544 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 01:12:31,548 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 01:12:31,548 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:12:31,549 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:12:31,549 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:12:31,551 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:12:31,553 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 01:12:31,553 - app.api.routes - INFO -    - Remaining comparisons: 50
2025-11-20 01:12:31,554 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 01:12:31,554 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 01:12:31,554 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763583151_512f45ee511f
2025-11-20 01:12:31,556 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_c95f944cdeff (1 files)
2025-11-20 01:12:31,556 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_c95f944cdeff
2025-11-20 01:12:31,557 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:12:31,557 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:12:31,558 - app.api.routes - INFO - ======================================================================
2025-11-20 01:12:31,559 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ ca838a4080fb4097898644b60e5345f6.pdf (331157 bytes)
2025-11-20 01:12:31,559 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:12:31,560 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\ca838a4080fb4097898644b60e5345f6.pdf
2025-11-20 01:12:31,685 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 01:12:31,687 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:12:31,688 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:12:31,688 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 01:12:31,689 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 01:12:31,690 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 01:12:31,690 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 01:12:31,691 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 01:12:31,812 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 01:12:31,812 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 01:13:09,726 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:13:09,737 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 01:13:09,738 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 01:13:09,740 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 01:13:09,741 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 01:13:16,220 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:13:16,221 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 01:13:16,222 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 01:13:16,223 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 01:13:16,223 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 01:13:16,223 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:13:16,224 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:13:16,224 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:13:16,224 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 01:13:16,224 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 01:13:16,225 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 01:13:21,010 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:13:21,019 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 01:13:21,019 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 01:13:21,020 - app.services.ai_parser - INFO - 
2025-11-20 01:13:21,020 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:13:21,020 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:13:21,020 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:13:21,021 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 01:13:21,021 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 01:13:21,021 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 01:13:21,022 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 01:13:21,022 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 01:13:21,022 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 01:13:21,023 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 01:13:21,023 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 01:13:21,023 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 01:13:21,023 - app.services.ai_parser - INFO - 
2025-11-20 01:13:21,024 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 01:13:21,024 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-20 01:13:21,024 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 01:13:21,025 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 01:13:21,025 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 01:13:21,025 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 01:13:21,025 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:13:21,028 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: ca838a4080fb4097898644b60e5345f6.pdf â†’ 691e24e1c45222374f8268fd
2025-11-20 01:13:21,029 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691e24e1c45222374f8268fd
2025-11-20 01:13:21,051 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e24e1c45222374f8268fe (331157 bytes)
2025-11-20 01:13:21,052 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e24e1c45222374f8268fe
2025-11-20 01:13:21,052 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:13:21,053 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 01:13:21,053 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:13:21,053 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 01:13:21,054 - app.api.routes - INFO - ======================================================================
2025-11-20 01:13:21,054 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 01:13:21,054 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763583151_512f45ee511f
2025-11-20 01:13:21,055 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 01:13:21,055 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 01:13:21,056 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 01:13:21,057 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 01:13:21,057 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 01:13:21,057 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 01:13:21,058 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 01:13:21,058 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 01:13:21,059 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 01:13:21,059 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 01:13:21,060 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 01:13:21,061 - app.services.mongodb_service_enhanced - INFO -    Summary: 936 bytes
2025-11-20 01:13:21,061 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 01:13:21,061 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 01:13:21,062 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 01:13:21,062 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,052 bytes
2025-11-20 01:13:21,062 - app.services.mongodb_service_enhanced - INFO -    Total document: 31,595 bytes
2025-11-20 01:13:21,062 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 01:13:21,063 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 01:13:21,063 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:13:21,064 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:13:21,064 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 01:13:21,068 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763583151_512f45ee511f
2025-11-20 01:13:21,068 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691e24e12fcd474cc2a2179f
2025-11-20 01:13:21,070 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 01:13:21,071 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 01:13:21,071 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 01:13:21,071 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 01:13:21,072 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 01:13:21,072 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 01:13:21,073 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 01:13:21,073 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 01:13:21,073 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:13:21,074 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 01:13:21,074 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 01:13:21,075 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 01:13:21,075 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 01:13:21,075 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 01:13:21,076 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:13:21,076 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691e24e12fcd474cc2a2179f
2025-11-20 01:13:21,076 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 01:13:21,077 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 01:13:21,077 - app.api.routes - INFO -    Comparison ID: cmp_1763583151_512f45ee511f
2025-11-20 01:13:21,081 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:13:21,082 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:13:21,082 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:13:21,082 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 01:13:21,083 - app.api.routes - INFO - ======================================================================
2025-11-20 01:13:21,083 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763583151_512f45ee511f
2025-11-20 01:13:21,083 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:13:21,084 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 01:13:21,084 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 01:13:21,085 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:13:21,085 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:13:21,085 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:13:21,086 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:13:21,087 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 49
2025-11-20 01:13:21,088 - app.api.routes - INFO - ======================================================================

2025-11-20 01:13:21,088 - app.services.progress_tracker - INFO - âœ… Job completed: job_c95f944cdeff â†’ comparison_id: cmp_1763583151_512f45ee511f
2025-11-20 01:13:21,090 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 49.55s
2025-11-20 01:13:54,260 - main - INFO - 
2025-11-20 01:13:54,261 - main - INFO - ================================================================================
2025-11-20 01:13:54,262 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 01:13:54,265 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 01:13:54,266 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 01:13:54,269 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 01:13:54,270 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 01:13:54,273 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 01:13:54,274 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 01:13:54,279 - main - INFO -   âœ… Cleaned up 1 temporary files
2025-11-20 01:13:54,284 - main - INFO -   âœ… Application stopped successfully
2025-11-20 01:13:54,286 - main - INFO - ================================================================================
2025-11-20 01:13:54,290 - main - INFO - 
2025-11-20 01:14:02,121 - main - INFO - 
2025-11-20 01:14:02,121 - main - INFO - ================================================================================
2025-11-20 01:14:02,121 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 01:14:02,121 - main - INFO -   Production-Ready Complete Integration
2025-11-20 01:14:02,122 - main - INFO - ================================================================================
2025-11-20 01:14:02,122 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 01:14:02,122 - main - INFO -   Upload Directory: uploads
2025-11-20 01:14:02,122 - main - INFO -   Max File Size: 20MB
2025-11-20 01:14:02,123 - main - INFO - ================================================================================
2025-11-20 01:14:02,123 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 01:14:02,123 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 01:14:02,124 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 01:14:02,176 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 01:14:02,181 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 01:14:02,181 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 01:14:02,181 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-20 01:14:02,182 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 01:14:02,182 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 01:14:02,182 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:14:02,183 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-20 01:14:02,210 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 01:14:02,212 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 01:14:02,213 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['users', 'admins', 'comparisons', 'individual_pdf_extractions']
2025-11-20 01:14:02,215 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 1 documents
2025-11-20 01:14:02,216 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 01:14:02,216 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 01:14:02,216 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:14:02,217 - app.services.user_documents_service - INFO -    Database: hakem-ai-backend
2025-11-20 01:14:02,224 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 01:14:02,224 - main - INFO -   âœ… User Documents Service connected
2025-11-20 01:14:02,225 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 01:14:02,225 - main - INFO - 
2025-11-20 01:14:02,225 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 01:14:02,226 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 01:14:02,226 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 01:14:02,226 - main - INFO -        - Separates warranties from extensions
2025-11-20 01:14:02,227 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 01:14:02,227 - main - INFO -        - Correct deductible tier detection
2025-11-20 01:14:02,227 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 01:14:02,227 - main - INFO - 
2025-11-20 01:14:02,228 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 01:14:02,228 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 01:14:02,228 - main - INFO -        - Identifies unique items per provider
2025-11-20 01:14:02,228 - main - INFO -        - Transparent scoring methodology
2025-11-20 01:14:02,228 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 01:14:02,229 - main - INFO - 
2025-11-20 01:14:02,229 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 01:14:02,229 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 01:14:02,230 - main - INFO -        - No manual section generation
2025-11-20 01:14:02,230 - main - INFO -        - Complete MongoDB integration
2025-11-20 01:14:02,231 - main - INFO - 
2025-11-20 01:14:02,231 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 01:14:02,231 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 01:14:02,232 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 01:14:02,232 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 01:14:02,232 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 01:14:02,233 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 01:14:02,233 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 01:14:02,233 - main - INFO - 
2025-11-20 01:14:02,233 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 01:14:02,234 - main - INFO -      Main:
2025-11-20 01:14:02,234 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 01:14:02,234 - main - INFO - 
2025-11-20 01:14:02,234 - main - INFO -      Retrieval:
2025-11-20 01:14:02,235 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 01:14:02,235 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 01:14:02,235 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 01:14:02,236 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 01:14:02,236 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 01:14:02,236 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 01:14:02,237 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 01:14:02,237 - main - INFO - 
2025-11-20 01:14:02,237 - main - INFO -      Management:
2025-11-20 01:14:02,238 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 01:14:02,238 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 01:14:02,238 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 01:14:02,238 - main - INFO - 
2025-11-20 01:14:02,238 - main - INFO -      Documents (MongoDB):
2025-11-20 01:14:02,239 - main - INFO -        GET  /api/documents                All documents
2025-11-20 01:14:02,239 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 01:14:02,239 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 01:14:02,239 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 01:14:02,240 - main - INFO - 
2025-11-20 01:14:02,240 - main - INFO -      Diagnostics & Health:
2025-11-20 01:14:02,240 - main - INFO -        GET  /api/health                   System health
2025-11-20 01:14:02,241 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 01:14:02,241 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 01:14:02,241 - main - INFO - 
2025-11-20 01:14:02,242 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 01:14:02,242 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 01:14:02,242 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 01:14:02,243 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 01:14:02,243 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 01:14:02,243 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 01:14:02,244 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 01:14:02,244 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 01:14:02,244 - main - INFO - 
2025-11-20 01:14:02,244 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 01:14:02,245 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 01:14:02,245 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 01:14:02,245 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 01:14:02,246 - main - INFO -      4. No re-upload needed!
2025-11-20 01:14:02,246 - main - INFO - 
2025-11-20 01:14:02,246 - main - INFO - ================================================================================
2025-11-20 01:14:02,247 - main - INFO -   âœ… Application started successfully!
2025-11-20 01:14:02,247 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 01:14:02,247 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 01:14:02,247 - main - INFO - ================================================================================
2025-11-20 01:14:02,248 - main - INFO - 
2025-11-20 01:14:02,248 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 01:14:12,270 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 01:14:12,273 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 01:14:12,274 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:14:12,274 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:14:12,275 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:14:12,276 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:14:12,277 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 01:14:12,278 - app.api.routes - INFO -    - Remaining comparisons: 49
2025-11-20 01:14:12,278 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 01:14:12,279 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 01:14:12,279 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763583252_934bc98a333c
2025-11-20 01:14:12,280 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_ed8da0880c08 (1 files)
2025-11-20 01:14:12,281 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_ed8da0880c08
2025-11-20 01:14:12,281 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:14:12,281 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:14:12,282 - app.api.routes - INFO - ======================================================================
2025-11-20 01:14:12,283 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ bec113054cf74b9e9d3ed6b264c2fbfe.pdf (331157 bytes)
2025-11-20 01:14:12,283 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:14:12,284 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\bec113054cf74b9e9d3ed6b264c2fbfe.pdf
2025-11-20 01:14:12,343 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 01:14:12,344 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:14:12,344 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:14:12,345 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 01:14:12,346 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 01:14:12,346 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 01:14:12,346 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 01:14:12,347 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 01:14:12,466 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 01:14:12,466 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 01:14:36,007 - main - INFO - ðŸ“¥ GET /api/progress/Job_ed8da0880c08
2025-11-20 01:14:36,008 - main - INFO - ðŸ“¤ GET /api/progress/Job_ed8da0880c08 - 404 - 0.00s
2025-11-20 01:14:49,176 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:14:49,197 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 01:14:49,198 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 01:14:49,199 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 01:14:49,199 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 01:14:53,284 - main - INFO - ðŸ“¥ GET /api/progress/job_ed8da0880c08
2025-11-20 01:14:53,285 - main - INFO - ðŸ“¤ GET /api/progress/job_ed8da0880c08 - 200 - 0.00s
2025-11-20 01:14:55,253 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:14:55,255 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 01:14:55,255 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 01:14:55,256 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 01:14:55,256 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 01:14:55,256 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:14:55,257 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:14:55,257 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:14:55,257 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 01:14:55,258 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 01:14:55,258 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 01:15:00,108 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:15:00,113 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 01:15:00,113 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 01:15:00,113 - app.services.ai_parser - INFO - 
2025-11-20 01:15:00,114 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:15:00,114 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:15:00,114 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:15:00,114 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 01:15:00,114 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 01:15:00,115 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 01:15:00,115 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 01:15:00,115 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 01:15:00,115 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 01:15:00,116 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 01:15:00,116 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 01:15:00,116 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 01:15:00,116 - app.services.ai_parser - INFO - 
2025-11-20 01:15:00,116 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 01:15:00,117 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-20 01:15:00,117 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 01:15:00,117 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 01:15:00,117 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 01:15:00,117 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 01:15:00,118 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:15:00,119 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: bec113054cf74b9e9d3ed6b264c2fbfe.pdf â†’ 691e25447c97b3ef993ff83e
2025-11-20 01:15:00,120 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691e25447c97b3ef993ff83e
2025-11-20 01:15:00,122 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e25447c97b3ef993ff83f (331157 bytes)
2025-11-20 01:15:00,123 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e25447c97b3ef993ff83f
2025-11-20 01:15:00,123 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:15:00,124 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 01:15:00,124 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:15:00,125 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 01:15:00,126 - app.api.routes - INFO - ======================================================================
2025-11-20 01:15:00,127 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 01:15:00,127 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763583252_934bc98a333c
2025-11-20 01:15:00,127 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 01:15:00,128 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 01:15:00,128 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 01:15:00,129 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 01:15:00,129 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 01:15:00,129 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 01:15:00,130 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 01:15:00,130 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 01:15:00,131 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 01:15:00,131 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 01:15:00,133 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 01:15:00,133 - app.services.mongodb_service_enhanced - INFO -    Summary: 940 bytes
2025-11-20 01:15:00,134 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 01:15:00,134 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 01:15:00,135 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 01:15:00,135 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,654 bytes
2025-11-20 01:15:00,135 - app.services.mongodb_service_enhanced - INFO -    Total document: 32,807 bytes
2025-11-20 01:15:00,135 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 01:15:00,136 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 01:15:00,136 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:15:00,137 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:15:00,137 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 01:15:00,140 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763583252_934bc98a333c
2025-11-20 01:15:00,140 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691e25442fcd474cc2a217a0
2025-11-20 01:15:00,144 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 01:15:00,145 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 01:15:00,146 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 01:15:00,146 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 01:15:00,146 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 01:15:00,147 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 01:15:00,147 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 01:15:00,147 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 01:15:00,148 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:15:00,148 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 01:15:00,149 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 01:15:00,149 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 01:15:00,149 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 01:15:00,150 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 01:15:00,150 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:15:00,151 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691e25442fcd474cc2a217a0
2025-11-20 01:15:00,151 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 01:15:00,151 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 01:15:00,152 - app.api.routes - INFO -    Comparison ID: cmp_1763583252_934bc98a333c
2025-11-20 01:15:00,154 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:15:00,154 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:15:00,154 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:15:00,155 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 01:15:00,155 - app.api.routes - INFO - ======================================================================
2025-11-20 01:15:00,155 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763583252_934bc98a333c
2025-11-20 01:15:00,156 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:15:00,156 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 01:15:00,157 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 01:15:00,157 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:15:00,158 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:15:00,158 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:15:00,159 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:15:00,160 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 48
2025-11-20 01:15:00,161 - app.api.routes - INFO - ======================================================================

2025-11-20 01:15:00,161 - app.services.progress_tracker - INFO - âœ… Job completed: job_ed8da0880c08 â†’ comparison_id: cmp_1763583252_934bc98a333c
2025-11-20 01:15:00,162 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 47.89s
2025-11-20 01:15:05,031 - main - INFO - ðŸ“¥ GET /api/progress/job_ed8da0880c08
2025-11-20 01:15:05,033 - main - INFO - ðŸ“¤ GET /api/progress/job_ed8da0880c08 - 200 - 0.00s
2025-11-20 01:18:13,796 - main - INFO - 
2025-11-20 01:18:13,797 - main - INFO - ================================================================================
2025-11-20 01:18:13,797 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-20 01:18:13,798 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 01:18:13,798 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-20 01:18:13,799 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-20 01:18:13,799 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-20 01:18:13,800 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-20 01:18:13,801 - main - INFO -   âœ… User Documents Service connection closed
2025-11-20 01:18:13,802 - main - INFO -   âœ… Cleaned up 1 temporary files
2025-11-20 01:18:13,803 - main - INFO -   âœ… Application stopped successfully
2025-11-20 01:18:13,803 - main - INFO - ================================================================================
2025-11-20 01:18:13,804 - main - INFO - 
2025-11-20 01:18:16,818 - main - INFO - 
2025-11-20 01:18:16,819 - main - INFO - ================================================================================
2025-11-20 01:18:16,819 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 01:18:16,819 - main - INFO -   Production-Ready Complete Integration
2025-11-20 01:18:16,820 - main - INFO - ================================================================================
2025-11-20 01:18:16,820 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 01:18:16,820 - main - INFO -   Upload Directory: uploads
2025-11-20 01:18:16,820 - main - INFO -   Max File Size: 20MB
2025-11-20 01:18:16,821 - main - INFO - ================================================================================
2025-11-20 01:18:16,821 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 01:18:16,822 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 01:18:16,822 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 01:18:16,843 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 01:18:16,848 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 01:18:16,849 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 01:18:16,849 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-20 01:18:16,849 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 01:18:16,850 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 01:18:16,850 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:18:16,850 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-20 01:18:16,892 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 01:18:16,893 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 01:18:16,895 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['users', 'admins', 'comparisons', 'individual_pdf_extractions']
2025-11-20 01:18:16,896 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 1 documents
2025-11-20 01:18:16,897 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 01:18:16,897 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 01:18:16,897 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 01:18:16,898 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-20 01:18:16,925 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 01:18:16,925 - main - INFO -   âœ… User Documents Service connected
2025-11-20 01:18:16,926 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 01:18:16,926 - main - INFO - 
2025-11-20 01:18:16,926 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 01:18:16,927 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 01:18:16,927 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 01:18:16,927 - main - INFO -        - Separates warranties from extensions
2025-11-20 01:18:16,927 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 01:18:16,928 - main - INFO -        - Correct deductible tier detection
2025-11-20 01:18:16,928 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 01:18:16,928 - main - INFO - 
2025-11-20 01:18:16,928 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 01:18:16,928 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 01:18:16,929 - main - INFO -        - Identifies unique items per provider
2025-11-20 01:18:16,929 - main - INFO -        - Transparent scoring methodology
2025-11-20 01:18:16,929 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 01:18:16,929 - main - INFO - 
2025-11-20 01:18:16,929 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 01:18:16,929 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 01:18:16,930 - main - INFO -        - No manual section generation
2025-11-20 01:18:16,930 - main - INFO -        - Complete MongoDB integration
2025-11-20 01:18:16,930 - main - INFO - 
2025-11-20 01:18:16,930 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 01:18:16,930 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 01:18:16,930 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 01:18:16,931 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 01:18:16,931 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 01:18:16,931 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 01:18:16,931 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 01:18:16,931 - main - INFO - 
2025-11-20 01:18:16,932 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 01:18:16,932 - main - INFO -      Main:
2025-11-20 01:18:16,932 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 01:18:16,932 - main - INFO - 
2025-11-20 01:18:16,932 - main - INFO -      Retrieval:
2025-11-20 01:18:16,932 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 01:18:16,933 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 01:18:16,933 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 01:18:16,933 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 01:18:16,933 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 01:18:16,933 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 01:18:16,933 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 01:18:16,934 - main - INFO - 
2025-11-20 01:18:16,934 - main - INFO -      Management:
2025-11-20 01:18:16,934 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 01:18:16,934 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 01:18:16,934 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 01:18:16,934 - main - INFO - 
2025-11-20 01:18:16,935 - main - INFO -      Documents (MongoDB):
2025-11-20 01:18:16,935 - main - INFO -        GET  /api/documents                All documents
2025-11-20 01:18:16,935 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 01:18:16,935 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 01:18:16,935 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 01:18:16,935 - main - INFO - 
2025-11-20 01:18:16,936 - main - INFO -      Diagnostics & Health:
2025-11-20 01:18:16,936 - main - INFO -        GET  /api/health                   System health
2025-11-20 01:18:16,936 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 01:18:16,936 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 01:18:16,936 - main - INFO - 
2025-11-20 01:18:16,937 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 01:18:16,937 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 01:18:16,937 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 01:18:16,937 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 01:18:16,937 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 01:18:16,938 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 01:18:16,938 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 01:18:16,938 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 01:18:16,938 - main - INFO - 
2025-11-20 01:18:16,938 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 01:18:16,939 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 01:18:16,939 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 01:18:16,939 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 01:18:16,939 - main - INFO -      4. No re-upload needed!
2025-11-20 01:18:16,939 - main - INFO - 
2025-11-20 01:18:16,940 - main - INFO - ================================================================================
2025-11-20 01:18:16,940 - main - INFO -   âœ… Application started successfully!
2025-11-20 01:18:16,940 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 01:18:16,941 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 01:18:16,941 - main - INFO - ================================================================================
2025-11-20 01:18:16,942 - main - INFO - 
2025-11-20 01:18:16,942 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 01:23:02,196 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-20 01:23:02,197 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-20 01:23:02,199 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 01:23:02,202 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 01:23:02,203 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:23:02,203 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:23:02,203 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:23:02,205 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:23:02,208 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 01:23:02,208 - app.api.routes - INFO -    - Remaining comparisons: 48
2025-11-20 01:23:02,209 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 01:23:02,209 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 01:23:02,210 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763583782_00a7fa9d24fa
2025-11-20 01:23:02,210 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_bfef7905501d (1 files)
2025-11-20 01:23:02,210 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_bfef7905501d
2025-11-20 01:23:02,211 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:23:02,211 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:02,211 - app.api.routes - INFO - ======================================================================
2025-11-20 01:23:02,212 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ e900a3d4d0d648c0afafbf45bd198ce8.pdf (331157 bytes)
2025-11-20 01:23:02,213 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:02,213 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e900a3d4d0d648c0afafbf45bd198ce8.pdf
2025-11-20 01:23:02,269 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 01:23:02,269 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:02,270 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:02,270 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 01:23:02,271 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 01:23:02,271 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 01:23:02,271 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 01:23:02,272 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 01:23:02,386 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 01:23:02,386 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 01:23:27,807 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 01:23:27,811 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 01:23:27,811 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:23:27,812 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:23:27,812 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:23:27,813 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:23:27,814 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 01:23:27,815 - app.api.routes - INFO -    - Remaining comparisons: 48
2025-11-20 01:23:27,815 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 01:23:27,816 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-20 01:23:27,816 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763583807_b4203d41421a
2025-11-20 01:23:27,816 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_fe44e0d0c6c1 (2 files)
2025-11-20 01:23:27,817 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_fe44e0d0c6c1
2025-11-20 01:23:27,817 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:23:27,818 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:27,818 - app.api.routes - INFO - ======================================================================
2025-11-20 01:23:27,819 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 45966282d598470191ea60d4e3decf8a.pdf (331157 bytes)
2025-11-20 01:23:27,819 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:27,820 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:23:27,820 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\45966282d598470191ea60d4e3decf8a.pdf
2025-11-20 01:23:27,820 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-20 01:23:27,821 - app.api.routes - INFO - ======================================================================
2025-11-20 01:23:27,868 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 01:23:27,869 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 3364f1dceae748bda24c1d82e0a6cccf.pdf (464206 bytes)
2025-11-20 01:23:27,869 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-20 01:23:27,870 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\3364f1dceae748bda24c1d82e0a6cccf.pdf
2025-11-20 01:23:27,870 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:27,899 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:27,908 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 01:23:27,922 - app.services.pdf_extractor - INFO - Successfully extracted 15284 characters from 7 pages
2025-11-20 01:23:27,923 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 01:23:27,924 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 01:23:27,924 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 01:23:27,925 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 01:23:28,040 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 01:23:28,040 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 01:23:28,044 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-20 01:23:28,045 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-20 01:23:28,045 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-20 01:23:28,046 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-20 01:23:28,046 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-20 01:23:28,046 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 01:23:28,047 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-20 01:23:28,297 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-20 01:23:28,297 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 01:23:46,399 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:23:46,425 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 01:23:46,425 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 01:23:46,426 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 01:23:46,426 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-20 01:23:46,427 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-20 01:23:46,427 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-20 01:23:46,432 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-20 01:23:46,433 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-20 01:23:46,433 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 01:23:47,597 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:23:47,599 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 01:23:47,599 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 01:23:47,600 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 01:23:47,600 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 01:23:52,467 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:23:52,470 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 01:23:52,471 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 01:23:52,472 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-20 01:23:52,472 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-20 01:23:52,473 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-20 01:23:52,475 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 01:23:52,475 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-20 01:23:52,988 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:23:52,998 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 01:23:52,999 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 01:23:53,000 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 01:23:53,002 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 01:23:53,003 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:23:53,004 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:23:53,005 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:23:53,005 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 01:23:53,006 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 01:23:53,007 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 01:23:57,682 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:23:57,686 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 01:23:57,687 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 01:23:57,688 - app.services.ai_parser - INFO - 
2025-11-20 01:23:57,689 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:23:57,691 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:57,693 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:23:57,694 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 01:23:57,695 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 01:23:57,696 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 01:23:57,699 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 01:23:57,700 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 01:23:57,702 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 01:23:57,703 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 01:23:57,704 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 01:23:57,704 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 01:23:57,705 - app.services.ai_parser - INFO - 
2025-11-20 01:23:57,706 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 01:23:57,707 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-20 01:23:57,708 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 01:23:57,709 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 01:23:57,709 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 01:23:57,710 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 01:23:57,711 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:23:57,714 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e900a3d4d0d648c0afafbf45bd198ce8.pdf â†’ 691e275dbc077a321b122ba9
2025-11-20 01:23:57,715 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691e275dbc077a321b122ba9
2025-11-20 01:23:57,734 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e275dbc077a321b122baa (331157 bytes)
2025-11-20 01:23:57,735 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e275dbc077a321b122baa
2025-11-20 01:23:57,735 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:23:57,735 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 01:23:57,736 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:23:57,736 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 01:23:57,736 - app.api.routes - INFO - ======================================================================
2025-11-20 01:23:57,736 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 01:23:57,737 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763583782_00a7fa9d24fa
2025-11-20 01:23:57,737 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 01:23:57,737 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 01:23:57,738 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 01:23:57,738 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 01:23:57,738 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 01:23:57,738 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 01:23:57,739 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 01:23:57,739 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 01:23:57,739 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 01:23:57,740 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 01:23:57,740 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 01:23:57,741 - app.services.mongodb_service_enhanced - INFO -    Summary: 940 bytes
2025-11-20 01:23:57,742 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 01:23:57,742 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 01:23:57,743 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 01:23:57,743 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,030 bytes
2025-11-20 01:23:57,743 - app.services.mongodb_service_enhanced - INFO -    Total document: 31,559 bytes
2025-11-20 01:23:57,744 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 01:23:57,744 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 01:23:57,744 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:23:57,745 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:23:57,745 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 01:23:57,747 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763583782_00a7fa9d24fa
2025-11-20 01:23:57,748 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691e275d2fcd474cc2a217a1
2025-11-20 01:23:57,749 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 01:23:57,750 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 01:23:57,750 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 01:23:57,750 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 01:23:57,751 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 01:23:57,751 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 01:23:57,751 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 01:23:57,752 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 01:23:57,752 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:23:57,752 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 01:23:57,753 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 01:23:57,753 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 01:23:57,753 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 01:23:57,753 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 01:23:57,754 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:23:57,754 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691e275d2fcd474cc2a217a1
2025-11-20 01:23:57,754 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 01:23:57,755 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 01:23:57,755 - app.api.routes - INFO -    Comparison ID: cmp_1763583782_00a7fa9d24fa
2025-11-20 01:23:57,758 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:23:57,758 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:23:57,759 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:23:57,760 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 01:23:57,760 - app.api.routes - INFO - ======================================================================
2025-11-20 01:23:57,761 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763583782_00a7fa9d24fa
2025-11-20 01:23:57,761 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:23:57,762 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 01:23:57,762 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 01:23:57,762 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:23:57,762 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:23:57,763 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:23:57,764 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:23:57,765 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 47
2025-11-20 01:23:57,765 - app.api.routes - INFO - ======================================================================

2025-11-20 01:23:57,766 - app.services.progress_tracker - INFO - âœ… Job completed: job_bfef7905501d â†’ comparison_id: cmp_1763583782_00a7fa9d24fa
2025-11-20 01:23:57,767 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 55.57s
2025-11-20 01:23:59,252 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:23:59,259 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-20 01:23:59,259 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 01:23:59,259 - app.services.ai_parser - INFO - 
2025-11-20 01:23:59,260 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:23:59,260 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-20 01:23:59,260 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:23:59,260 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-20 01:23:59,261 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-20 01:23:59,261 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-20 01:23:59,261 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-20 01:23:59,262 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-20 01:23:59,262 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-20 01:23:59,262 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-20 01:23:59,263 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-20 01:23:59,263 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-20 01:23:59,263 - app.services.ai_parser - INFO - 
2025-11-20 01:23:59,263 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 01:23:59,264 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-20 01:23:59,264 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-20 01:23:59,264 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-20 01:23:59,265 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 01:23:59,265 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 01:23:59,265 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:23:59,267 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 3364f1dceae748bda24c1d82e0a6cccf.pdf â†’ 691e275fbc077a321b122bab
2025-11-20 01:23:59,267 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691e275fbc077a321b122bab
2025-11-20 01:23:59,270 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691e275fbc077a321b122bac (464206 bytes)
2025-11-20 01:23:59,270 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691e275fbc077a321b122bac
2025-11-20 01:23:59,271 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-20 01:24:15,737 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:24:15,744 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 01:24:15,745 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 01:24:15,746 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 01:24:15,747 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 01:24:20,834 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:24:20,839 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 01:24:20,840 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 01:24:20,841 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 01:24:20,843 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 01:24:20,844 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:24:20,845 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:24:20,846 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 01:24:20,847 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 01:24:20,848 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 01:24:20,849 - app.services.ai_parser - INFO - ðŸ“Š Counts: 17 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 01:24:26,154 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:24:26,156 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 01:24:26,157 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 01:24:26,157 - app.services.ai_parser - INFO - 
2025-11-20 01:24:26,158 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:24:26,158 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:24:26,159 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:24:26,159 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 01:24:26,160 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 01:24:26,160 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 01:24:26,161 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 01:24:26,161 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 01:24:26,162 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 01:24:26,162 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 01:24:26,163 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 01:24:26,163 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 01:24:26,164 - app.services.ai_parser - INFO - 
2025-11-20 01:24:26,165 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 01:24:26,166 - app.services.ai_parser - INFO -    âœ“ Benefits: 17
2025-11-20 01:24:26,166 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 01:24:26,167 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 01:24:26,167 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 01:24:26,168 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 01:24:26,168 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 01:24:26,170 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 45966282d598470191ea60d4e3decf8a.pdf â†’ 691e277abc077a321b122bad
2025-11-20 01:24:26,170 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691e277abc077a321b122bad
2025-11-20 01:24:26,172 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e277abc077a321b122bae (331157 bytes)
2025-11-20 01:24:26,173 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691e277abc077a321b122bae
2025-11-20 01:24:26,173 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 01:24:26,174 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-20 01:24:26,174 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:24:26,174 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-20 01:24:26,174 - app.api.routes - INFO - ======================================================================
2025-11-20 01:24:26,175 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-20 01:24:26,175 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-20 01:24:26,176 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-20 01:24:26,177 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-20 01:24:26,177 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-20 01:24:26,177 - app.services.ai_ranker - INFO - ================================================================================
2025-11-20 01:24:26,178 - app.services.ai_ranker - INFO - 
============================================================
2025-11-20 01:24:26,178 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-20 01:24:26,178 - app.services.ai_ranker - INFO - ============================================================
2025-11-20 01:24:26,179 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-20 01:24:26,179 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:24:26,179 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-20 01:24:26,180 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-20 01:24:26,180 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-20 01:24:26,181 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-20 01:24:26,181 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-20 01:24:26,181 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-20 01:24:26,181 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-20 01:24:26,182 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "Minimization of losses": "SR 250,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Industries Seepage, Pollution and
2025-11-20 01:24:26,185 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-20 01:24:26,185 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-20 01:24:26,185 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-20 01:24:26,186 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-20 01:24:26,186 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-20 01:24:26,186 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-20 01:24:26,187 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-20 01:24:26,187 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-20 01:24:26,187 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-20 01:24:26,187 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-20 01:24:26,188 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-20 01:24:26,188 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-20 01:24:26,189 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-20 01:24:26,189 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-20 01:24:26,189 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-20 01:24:26,190 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-20 01:24:26,190 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-20 01:24:26,190 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-20 01:24:26,191 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-20 01:24:26,191 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-20 01:24:26,191 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-20 01:24:26,192 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-20 01:24:26,193 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-20 01:24:26,193 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-20 01:24:26,193 - app.services.ai_ranker - INFO - 
============================================================
2025-11-20 01:24:26,194 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-20 01:24:26,194 - app.services.ai_ranker - INFO - ============================================================
2025-11-20 01:24:26,194 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-20 01:24:26,195 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:24:26,195 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-20 01:24:26,195 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-20 01:24:26,196 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension', 'Professional Valuation Report required for properties with total Sum Insured exceeding SR40m'], 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers'], 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']}
2025-11-20 01:24:26,196 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-20 01:24:26,196 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-20 01:24:26,197 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-20 01:24:26,197 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-20 01:24:26,197 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SR 1,564,652,306.28",
    "business_interruption": "SR 650,000,000.00",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40,000,000",
        "deductible": "5% of claim amount (nil minimum if Sum Insured < SR 1,000,000, min SR 50,000 if SR 1,000,000 to SR 40,000,000)",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40,000,001 to SR 100,000,000",
        "deductible": "5% of claim amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100,000,001 to SR 500,000,000",
        "deductible": "5% of claim amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500,000,001",
        "deductible"
2025-11-20 01:24:26,200 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-20 01:24:26,200 - app.services.ai_ranker - INFO -    âœ… Found 2 items in key 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers']
2025-11-20 01:24:26,201 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']
2025-11-20 01:24:26,201 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-20 01:24:26,201 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-20 01:24:26,202 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-20 01:24:26,202 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-20 01:24:26,202 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-20 01:24:26,203 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-20 01:24:26,203 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-20 01:24:26,203 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-20 01:24:26,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-20 01:24:26,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-20 01:24:26,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-20 01:24:26,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-20 01:24:26,205 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-20 01:24:26,205 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 9
2025-11-20 01:24:26,205 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-20 01:24:26,205 - app.services.ai_ranker - INFO -    âœ… Extracted 9 subjectivities for Liva Insurance
2025-11-20 01:24:26,206 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-20 01:24:26,207 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-20 01:24:26,207 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-20 01:24:26,208 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-20 01:24:26,208 - app.services.ai_ranker - INFO -    Subjectivities: 9
2025-11-20 01:24:26,208 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-20 01:24:26,349 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-20 01:24:26,349 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-20 01:24:26,349 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-20 01:24:26,350 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-20 01:24:26,350 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-20 01:24:26,350 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-20 01:24:26,351 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-20 01:24:26,351 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-20 01:24:26,504 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-20 01:24:26,504 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-20 01:24:26,504 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-20 01:24:26,505 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 9
2025-11-20 01:24:26,505 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-20 01:24:26,505 - app.services.ai_ranker - INFO -       â€¢ Warranted valid civil defense certificates during the currency of the policy
2025-11-20 01:24:26,506 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-20 01:24:26,506 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-20 01:24:26,506 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-20 01:24:26,507 - app.services.ai_ranker - INFO - ================================================================================

2025-11-20 01:24:26,507 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=88.12
2025-11-20 01:24:26,507 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=84.79
2025-11-20 01:24:26,508 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-20 01:24:26,508 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-20 01:24:32,791 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 01:24:32,793 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-20 01:24:32,793 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-20 01:24:32,794 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-20 01:24:32,794 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-20 01:24:32,795 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 01:24:32,795 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763583807_b4203d41421a
2025-11-20 01:24:32,795 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-20 01:24:32,796 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 01:24:32,796 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-20 01:24:32,796 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-20 01:24:32,797 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 01:24:32,797 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 01:24:32,797 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 01:24:32,797 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 01:24:32,798 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 01:24:32,798 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 01:24:32,799 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-20 01:24:32,799 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 01:24:32,800 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 01:24:32,800 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 01:24:32,801 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 01:24:32,801 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 01:24:32,801 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 01:24:32,804 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 01:24:32,804 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,277 bytes
2025-11-20 01:24:32,804 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 21,841 bytes
2025-11-20 01:24:32,804 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,668 bytes
2025-11-20 01:24:32,805 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,446 bytes
2025-11-20 01:24:32,805 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 29,864 bytes
2025-11-20 01:24:32,805 - app.services.mongodb_service_enhanced - INFO -    Total document: 139,387 bytes
2025-11-20 01:24:32,806 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-20 01:24:32,807 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-20 01:24:32,808 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-20 01:24:32,808 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-20 01:24:32,808 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-20 01:24:32,808 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-20 01:24:32,808 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-20 01:24:32,809 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-20 01:24:32,810 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-20 01:24:32,810 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-20 01:24:32,810 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-20 01:24:32,811 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-20 01:24:32,811 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-20 01:24:32,811 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-20 01:24:32,811 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-20 01:24:32,812 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 01:24:32,812 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-20 01:24:32,812 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:24:32,813 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:24:32,813 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 01:24:32,817 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763583807_b4203d41421a
2025-11-20 01:24:32,817 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691e27802fcd474cc2a217a2
2025-11-20 01:24:32,819 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 01:24:32,819 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 01:24:32,819 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 01:24:32,820 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 01:24:32,820 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 01:24:32,820 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 01:24:32,821 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 01:24:32,821 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-20 01:24:32,821 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-20 01:24:32,821 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-20 01:24:32,822 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-20 01:24:32,822 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-20 01:24:32,822 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 01:24:32,823 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 01:24:32,824 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 01:24:32,824 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 01:24:32,824 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 01:24:32,825 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 01:24:32,825 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 01:24:32,826 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691e27802fcd474cc2a217a2
2025-11-20 01:24:32,826 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 01:24:32,826 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 01:24:32,827 - app.api.routes - INFO -    Comparison ID: cmp_1763583807_b4203d41421a
2025-11-20 01:24:32,829 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:24:32,829 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 01:24:32,829 - app.api.routes - INFO - 
======================================================================
2025-11-20 01:24:32,830 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 01:24:32,830 - app.api.routes - INFO - ======================================================================
2025-11-20 01:24:32,830 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763583807_b4203d41421a
2025-11-20 01:24:32,831 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:24:32,831 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-20 01:24:32,831 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-20 01:24:32,831 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 01:24:32,832 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 01:24:32,832 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 01:24:32,833 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 01:24:32,834 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 46
2025-11-20 01:24:32,835 - app.api.routes - INFO - ======================================================================

2025-11-20 01:24:32,835 - app.services.progress_tracker - INFO - âœ… Job completed: job_fe44e0d0c6c1 â†’ comparison_id: cmp_1763583807_b4203d41421a
2025-11-20 01:24:32,837 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 65.03s
2025-11-20 01:33:16,968 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 2 old progress entries
2025-11-20 01:33:16,969 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 2 old entries
2025-11-20 19:21:44,850 - main - INFO - 
2025-11-20 19:21:44,850 - main - INFO - ================================================================================
2025-11-20 19:21:44,850 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-20 19:21:44,851 - main - INFO -   Production-Ready Complete Integration
2025-11-20 19:21:44,851 - main - INFO - ================================================================================
2025-11-20 19:21:44,851 - main - INFO -   AI Model: gpt-4o-mini
2025-11-20 19:21:44,851 - main - INFO -   Upload Directory: uploads
2025-11-20 19:21:44,851 - main - INFO -   Max File Size: 20MB
2025-11-20 19:21:44,851 - main - INFO - ================================================================================
2025-11-20 19:21:44,852 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-20 19:21:44,852 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-20 19:21:44,852 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-20 19:21:45,276 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-20 19:21:45,281 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-20 19:21:45,282 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-20 19:21:45,282 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-20 19:21:45,283 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-20 19:21:45,283 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-20 19:21:45,284 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 19:21:45,284 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-20 19:21:45,294 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-20 19:21:45,296 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-20 19:21:45,298 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['users', 'admins', 'comparisons', 'individual_pdf_extractions', 'user_documents']
2025-11-20 19:21:45,301 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 1 documents
2025-11-20 19:21:45,301 - main - INFO -   âœ… User Subscription Service connected
2025-11-20 19:21:45,301 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-20 19:21:45,302 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-20 19:21:45,302 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-20 19:21:45,325 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-20 19:21:45,325 - main - INFO -   âœ… User Documents Service connected
2025-11-20 19:21:45,325 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-20 19:21:45,325 - main - INFO - 
2025-11-20 19:21:45,326 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-20 19:21:45,326 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-20 19:21:45,326 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-20 19:21:45,327 - main - INFO -        - Separates warranties from extensions
2025-11-20 19:21:45,327 - main - INFO -        - Extracts subjectivities & operational details
2025-11-20 19:21:45,327 - main - INFO -        - Correct deductible tier detection
2025-11-20 19:21:45,328 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-20 19:21:45,328 - main - INFO - 
2025-11-20 19:21:45,328 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-20 19:21:45,328 - main - INFO -        - Generates ALL sections comprehensively
2025-11-20 19:21:45,329 - main - INFO -        - Identifies unique items per provider
2025-11-20 19:21:45,329 - main - INFO -        - Transparent scoring methodology
2025-11-20 19:21:45,329 - main - INFO -        - Uses full _extended_data from parser
2025-11-20 19:21:45,330 - main - INFO - 
2025-11-20 19:21:45,330 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-20 19:21:45,330 - main - INFO -        - Single endpoint auto-populates everything
2025-11-20 19:21:45,331 - main - INFO -        - No manual section generation
2025-11-20 19:21:45,331 - main - INFO -        - Complete MongoDB integration
2025-11-20 19:21:45,331 - main - INFO - 
2025-11-20 19:21:45,331 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-20 19:21:45,331 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-20 19:21:45,332 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-20 19:21:45,332 - main - INFO -      âœ… Subjectivities: Now included
2025-11-20 19:21:45,332 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-20 19:21:45,333 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-20 19:21:45,333 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-20 19:21:45,333 - main - INFO - 
2025-11-20 19:21:45,334 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-20 19:21:45,334 - main - INFO -      Main:
2025-11-20 19:21:45,334 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-20 19:21:45,335 - main - INFO - 
2025-11-20 19:21:45,335 - main - INFO -      Retrieval:
2025-11-20 19:21:45,335 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-20 19:21:45,335 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-20 19:21:45,336 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-20 19:21:45,336 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-20 19:21:45,337 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-20 19:21:45,338 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-20 19:21:45,338 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-20 19:21:45,338 - main - INFO - 
2025-11-20 19:21:45,339 - main - INFO -      Management:
2025-11-20 19:21:45,339 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-20 19:21:45,340 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-20 19:21:45,340 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-20 19:21:45,340 - main - INFO - 
2025-11-20 19:21:45,340 - main - INFO -      Documents (MongoDB):
2025-11-20 19:21:45,341 - main - INFO -        GET  /api/documents                All documents
2025-11-20 19:21:45,341 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-20 19:21:45,341 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-20 19:21:45,341 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-20 19:21:45,342 - main - INFO - 
2025-11-20 19:21:45,342 - main - INFO -      Diagnostics & Health:
2025-11-20 19:21:45,342 - main - INFO -        GET  /api/health                   System health
2025-11-20 19:21:45,343 - main - INFO -        GET  /api/status                   Detailed status
2025-11-20 19:21:45,343 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-20 19:21:45,343 - main - INFO - 
2025-11-20 19:21:45,343 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-20 19:21:45,344 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-20 19:21:45,344 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-20 19:21:45,344 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-20 19:21:45,344 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-20 19:21:45,345 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-20 19:21:45,345 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-20 19:21:45,345 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-20 19:21:45,346 - main - INFO - 
2025-11-20 19:21:45,346 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-20 19:21:45,348 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-20 19:21:45,348 - main - INFO -      2. Receive comparison_id + complete data
2025-11-20 19:21:45,348 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-20 19:21:45,349 - main - INFO -      4. No re-upload needed!
2025-11-20 19:21:45,350 - main - INFO - 
2025-11-20 19:21:45,350 - main - INFO - ================================================================================
2025-11-20 19:21:45,350 - main - INFO -   âœ… Application started successfully!
2025-11-20 19:21:45,351 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-20 19:21:45,351 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-20 19:21:45,351 - main - INFO - ================================================================================
2025-11-20 19:21:45,351 - main - INFO - 
2025-11-20 19:21:45,352 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-20 20:43:45,581 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-20 20:43:45,584 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-20 20:43:45,587 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 20:43:45,604 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 20:43:45,605 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 20:43:45,606 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 20:43:45,606 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 20:43:45,615 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 20:43:45,620 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 20:43:45,620 - app.api.routes - INFO -    - Remaining comparisons: 46
2025-11-20 20:43:45,620 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 20:43:45,621 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 20:43:45,621 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763653425_861dd24c8099
2025-11-20 20:43:45,621 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_01f4de23797d (1 files)
2025-11-20 20:43:45,622 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_01f4de23797d
2025-11-20 20:43:45,623 - app.api.routes - INFO - 
======================================================================
2025-11-20 20:43:45,623 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:43:45,623 - app.api.routes - INFO - ======================================================================
2025-11-20 20:43:45,625 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 29a345e7c8674ea5a76ec39992ea4edf.pdf (331157 bytes)
2025-11-20 20:43:45,628 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:43:45,632 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\29a345e7c8674ea5a76ec39992ea4edf.pdf
2025-11-20 20:43:45,784 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 20:43:45,785 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:43:45,785 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:43:45,786 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 20:43:45,789 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 20:43:45,789 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 20:43:45,790 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 20:43:45,792 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 20:43:45,909 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 20:43:45,910 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 20:44:42,682 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 20:44:42,705 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 20:44:42,705 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 20:44:42,706 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 20:44:42,707 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 20:44:48,977 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 20:44:48,995 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 20:44:48,996 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 20:44:48,998 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 20:44:48,999 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 20:44:49,000 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 20:44:49,004 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 20:44:49,006 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 20:44:49,008 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 20:44:49,013 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 20:44:49,015 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 20:44:54,591 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 20:44:54,598 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 20:44:54,599 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 20:44:54,600 - app.services.ai_parser - INFO - 
2025-11-20 20:44:54,601 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 20:44:54,602 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:44:54,603 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 20:44:54,604 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 20:44:54,605 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 20:44:54,605 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 20:44:54,608 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 20:44:54,609 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 20:44:54,609 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 20:44:54,610 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 20:44:54,611 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 20:44:54,611 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 20:44:54,612 - app.services.ai_parser - INFO - 
2025-11-20 20:44:54,614 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 20:44:54,614 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-20 20:44:54,615 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 20:44:54,615 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 20:44:54,616 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 20:44:54,617 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 20:44:54,618 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 20:44:54,622 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 29a345e7c8674ea5a76ec39992ea4edf.pdf â†’ 691f3776f6f4dfed6c22931b
2025-11-20 20:44:54,622 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691f3776f6f4dfed6c22931b
2025-11-20 20:44:54,626 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f3776f6f4dfed6c22931c (331157 bytes)
2025-11-20 20:44:54,626 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f3776f6f4dfed6c22931c
2025-11-20 20:44:54,628 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:44:54,629 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 20:44:54,629 - app.api.routes - INFO - 
======================================================================
2025-11-20 20:44:54,629 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 20:44:54,629 - app.api.routes - INFO - ======================================================================
2025-11-20 20:44:54,631 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 20:44:54,631 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763653425_861dd24c8099
2025-11-20 20:44:54,631 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 20:44:54,631 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 20:44:54,632 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 20:44:54,632 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 20:44:54,633 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 20:44:54,635 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 20:44:54,636 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 20:44:54,637 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 20:44:54,637 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 20:44:54,638 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 20:44:54,650 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 20:44:54,651 - app.services.mongodb_service_enhanced - INFO -    Summary: 940 bytes
2025-11-20 20:44:54,651 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 20:44:54,651 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 20:44:54,651 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 20:44:54,652 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,674 bytes
2025-11-20 20:44:54,652 - app.services.mongodb_service_enhanced - INFO -    Total document: 32,847 bytes
2025-11-20 20:44:54,652 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 20:44:54,652 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 20:44:54,653 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 20:44:54,653 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 20:44:54,654 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 20:44:54,675 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763653425_861dd24c8099
2025-11-20 20:44:54,676 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691f37762fcd474cc2a217a3
2025-11-20 20:44:54,690 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 20:44:54,690 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 20:44:54,690 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 20:44:54,691 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 20:44:54,691 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 20:44:54,691 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 20:44:54,691 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 20:44:54,692 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 20:44:54,692 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 20:44:54,692 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 20:44:54,692 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 20:44:54,693 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 20:44:54,693 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 20:44:54,694 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 20:44:54,694 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 20:44:54,695 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691f37762fcd474cc2a217a3
2025-11-20 20:44:54,695 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 20:44:54,696 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 20:44:54,696 - app.api.routes - INFO -    Comparison ID: cmp_1763653425_861dd24c8099
2025-11-20 20:44:54,705 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 20:44:54,706 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 20:44:54,706 - app.api.routes - INFO - 
======================================================================
2025-11-20 20:44:54,706 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 20:44:54,706 - app.api.routes - INFO - ======================================================================
2025-11-20 20:44:54,706 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763653425_861dd24c8099
2025-11-20 20:44:54,707 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 20:44:54,707 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 20:44:54,707 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 20:44:54,707 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 20:44:54,707 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 20:44:54,708 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 20:44:54,709 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 20:44:54,711 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 45
2025-11-20 20:44:54,711 - app.api.routes - INFO - ======================================================================

2025-11-20 20:44:54,711 - app.services.progress_tracker - INFO - âœ… Job completed: job_01f4de23797d â†’ comparison_id: cmp_1763653425_861dd24c8099
2025-11-20 20:44:54,713 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 69.13s
2025-11-20 20:44:56,837 - main - INFO - ðŸ“¥ GET /api/progress/job_01f4de23797d
2025-11-20 20:44:56,839 - main - INFO - ðŸ“¤ GET /api/progress/job_01f4de23797d - 200 - 0.00s
2025-11-20 20:51:45,519 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-20 20:51:45,521 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-20 20:53:02,200 - main - INFO - ðŸ“¥ GET /docs
2025-11-20 20:53:02,203 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-20 20:53:02,424 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-20 20:53:02,443 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.02s
2025-11-20 20:53:46,464 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 20:53:46,467 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 20:53:46,475 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 20:53:46,476 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 20:53:46,477 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 20:53:46,480 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 20:53:46,484 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 20:53:46,484 - app.api.routes - INFO -    - Remaining comparisons: 45
2025-11-20 20:53:46,484 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 20:53:46,485 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 20:53:46,485 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763654026_e5ac05264689
2025-11-20 20:53:46,485 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_ac1029f1b772 (1 files)
2025-11-20 20:53:46,486 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_ac1029f1b772
2025-11-20 20:53:46,486 - app.api.routes - INFO - 
======================================================================
2025-11-20 20:53:46,487 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:53:46,487 - app.api.routes - INFO - ======================================================================
2025-11-20 20:53:46,488 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ e59f6c0f6207429c9c097fa8b42e1c4b.pdf (331157 bytes)
2025-11-20 20:53:46,488 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:53:46,489 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e59f6c0f6207429c9c097fa8b42e1c4b.pdf
2025-11-20 20:53:46,543 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 20:53:46,545 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:53:46,545 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:53:46,546 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 20:53:46,546 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 20:53:46,547 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 20:53:46,547 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 20:53:46,548 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 20:53:46,667 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 20:53:46,667 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 20:54:12,505 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:12,508 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:15,609 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:15,609 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:16,415 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:16,415 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:16,910 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:16,911 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:17,373 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:17,374 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:17,779 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:17,781 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:18,168 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:18,169 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:18,521 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:18,523 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:18,953 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:18,954 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:19,357 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:19,359 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:19,737 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:19,738 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:20,144 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:20,145 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:20,544 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:20,545 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:20,958 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:20,959 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:21,263 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:21,264 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:21,630 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:21,631 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:22,035 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:22,035 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:22,390 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:22,391 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:22,725 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:22,726 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:23,070 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:23,070 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:23,380 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:23,381 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:23,702 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:23,703 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:24,023 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:24,024 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:24,381 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:24,382 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:24,737 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:24,738 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:25,086 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:25,087 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:25,382 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:25,383 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:25,623 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:25,624 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:25,806 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:25,807 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:25,989 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:25,989 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:26,168 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:26,169 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:26,334 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:26,335 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:26,496 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:26,497 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:26,661 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:26,662 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:26,966 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:26,967 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:27,293 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:27,295 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:27,644 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:27,645 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:27,915 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:27,916 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:28,103 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:28,103 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:28,325 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:28,326 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:28,569 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:28,569 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:28,758 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:28,759 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:28,949 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:28,949 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:29,302 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:29,303 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:29,492 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:29,493 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:29,677 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:29,678 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:29,872 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:29,872 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:30,053 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:30,054 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:30,231 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:30,232 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:30,430 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:30,431 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:30,615 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:30,615 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:30,813 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:30,814 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:30,999 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:31,000 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:31,173 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:31,174 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:31,358 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:31,359 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:31,557 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:31,558 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:31,732 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:31,733 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:31,924 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:31,925 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:32,109 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:32,109 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:32,284 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:32,285 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:32,470 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:32,471 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:32,645 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:32,646 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:32,838 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:32,839 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:33,055 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:33,060 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.01s
2025-11-20 20:54:33,309 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:33,315 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.01s
2025-11-20 20:54:33,620 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:33,621 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:35,292 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:35,293 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:35,925 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:35,926 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:36,517 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:36,518 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:42,425 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:42,428 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:45,149 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:45,150 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:47,315 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:47,316 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:54:51,414 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:54:51,414 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:55:04,241 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 20:55:04,504 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 20:55:04,505 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 20:55:04,505 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 20:55:04,505 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 20:55:07,635 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:55:07,636 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:55:10,428 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 20:55:10,434 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 20:55:10,435 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 20:55:10,437 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 20:55:10,438 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 20:55:10,440 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 20:55:10,441 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 20:55:10,441 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 20:55:10,443 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 20:55:10,446 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 20:55:10,447 - app.services.ai_parser - INFO - ðŸ“Š Counts: 52 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 20:55:15,484 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:55:15,487 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 20:55:17,900 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 20:55:17,918 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-20 20:55:17,918 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 20:55:17,918 - app.services.ai_parser - INFO - 
2025-11-20 20:55:17,918 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 20:55:17,919 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:55:17,919 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 20:55:17,919 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 20:55:17,919 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 20:55:17,920 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 20:55:17,920 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 20:55:17,920 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-20 20:55:17,920 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 20:55:17,921 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-20 20:55:17,921 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 20:55:17,921 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 20:55:17,921 - app.services.ai_parser - INFO - 
2025-11-20 20:55:17,922 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 20:55:17,922 - app.services.ai_parser - INFO -    âœ“ Benefits: 52
2025-11-20 20:55:17,922 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 20:55:17,922 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 20:55:17,923 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 20:55:17,923 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 20:55:17,923 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 20:55:17,925 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e59f6c0f6207429c9c097fa8b42e1c4b.pdf â†’ 691f39e5f6f4dfed6c22931d
2025-11-20 20:55:17,925 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691f39e5f6f4dfed6c22931d
2025-11-20 20:55:17,927 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f39e5f6f4dfed6c22931e (331157 bytes)
2025-11-20 20:55:17,928 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f39e5f6f4dfed6c22931e
2025-11-20 20:55:17,929 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 20:55:17,929 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 20:55:17,930 - app.api.routes - INFO - 
======================================================================
2025-11-20 20:55:17,930 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 20:55:17,930 - app.api.routes - INFO - ======================================================================
2025-11-20 20:55:17,931 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 20:55:17,931 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763654026_e5ac05264689
2025-11-20 20:55:17,931 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 20:55:17,932 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 20:55:17,932 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 20:55:17,932 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 20:55:17,933 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 20:55:17,933 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 20:55:17,933 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 20:55:17,933 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 20:55:17,934 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 20:55:17,934 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 20:55:17,935 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 20:55:17,935 - app.services.mongodb_service_enhanced - INFO -    Summary: 1,004 bytes
2025-11-20 20:55:17,935 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 20:55:17,935 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 20:55:17,936 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 20:55:17,936 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 19,386 bytes
2025-11-20 20:55:17,936 - app.services.mongodb_service_enhanced - INFO -    Total document: 42,399 bytes
2025-11-20 20:55:17,936 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 20:55:17,937 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 20:55:17,937 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 20:55:17,937 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 20:55:17,938 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 20:55:17,940 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763654026_e5ac05264689
2025-11-20 20:55:17,940 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691f39e52fcd474cc2a217a4
2025-11-20 20:55:17,942 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 20:55:17,942 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 20:55:17,942 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 20:55:17,943 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 20:55:17,943 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 20:55:17,943 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 20:55:17,943 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 20:55:17,944 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 20:55:17,944 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 20:55:17,945 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 20:55:17,946 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 20:55:17,946 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 20:55:17,946 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 20:55:17,947 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 20:55:17,947 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 20:55:17,947 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691f39e52fcd474cc2a217a4
2025-11-20 20:55:17,948 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 20:55:17,948 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 20:55:17,948 - app.api.routes - INFO -    Comparison ID: cmp_1763654026_e5ac05264689
2025-11-20 20:55:17,951 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 20:55:17,951 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 20:55:17,951 - app.api.routes - INFO - 
======================================================================
2025-11-20 20:55:17,952 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 20:55:17,952 - app.api.routes - INFO - ======================================================================
2025-11-20 20:55:17,952 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763654026_e5ac05264689
2025-11-20 20:55:17,952 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 20:55:17,953 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 20:55:17,953 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 20:55:17,953 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 20:55:17,954 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 20:55:17,954 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 20:55:17,955 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 20:55:17,956 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 44
2025-11-20 20:55:17,957 - app.api.routes - INFO - ======================================================================

2025-11-20 20:55:17,957 - app.services.progress_tracker - INFO - âœ… Job completed: job_ac1029f1b772 â†’ comparison_id: cmp_1763654026_e5ac05264689
2025-11-20 20:55:17,958 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 91.49s
2025-11-20 20:55:25,569 - main - INFO - ðŸ“¥ GET /api/progress/job_ac1029f1b772
2025-11-20 20:55:25,570 - main - INFO - ðŸ“¤ GET /api/progress/job_ac1029f1b772 - 200 - 0.00s
2025-11-20 21:01:45,545 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-20 21:01:45,547 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-20 23:52:07,709 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-20 23:52:07,715 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.01s
2025-11-20 23:52:07,719 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 23:52:07,731 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 23:52:07,732 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 23:52:07,732 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 23:52:07,733 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 23:52:07,738 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 23:52:07,740 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 23:52:07,740 - app.api.routes - INFO -    - Remaining comparisons: 44
2025-11-20 23:52:07,741 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 23:52:07,741 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 23:52:07,741 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763664727_bc30c2841180
2025-11-20 23:52:07,743 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_bfe6cef188ff (1 files)
2025-11-20 23:52:07,743 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_bfe6cef188ff
2025-11-20 23:52:07,744 - app.api.routes - INFO - 
======================================================================
2025-11-20 23:52:07,745 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:52:07,745 - app.api.routes - INFO - ======================================================================
2025-11-20 23:52:07,747 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 161d7401d74f40598e049e77bd637ded.pdf (331157 bytes)
2025-11-20 23:52:07,749 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:52:07,751 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\161d7401d74f40598e049e77bd637ded.pdf
2025-11-20 23:52:07,814 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 23:52:07,814 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:52:07,815 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:52:07,816 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 23:52:07,816 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 23:52:07,817 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 23:52:07,817 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 23:52:07,817 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 23:52:07,934 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 23:52:07,934 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 23:52:53,773 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 23:52:54,040 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 23:52:54,041 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 23:52:54,041 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 23:52:54,041 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 23:53:00,912 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 23:53:00,919 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 23:53:00,920 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 23:53:00,922 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 23:53:00,923 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 23:53:00,925 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 23:53:00,927 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 23:53:00,930 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 23:53:00,933 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 23:53:00,933 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 23:53:00,934 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 23:53:07,976 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 23:53:07,978 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 23:53:07,978 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 23:53:07,978 - app.services.ai_parser - INFO - 
2025-11-20 23:53:07,979 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 23:53:07,979 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:53:07,979 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 23:53:07,980 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 23:53:07,980 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 23:53:07,980 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 23:53:07,980 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 23:53:07,981 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 23:53:07,981 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 23:53:07,981 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 23:53:07,981 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 23:53:07,982 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 23:53:07,982 - app.services.ai_parser - INFO - 
2025-11-20 23:53:07,982 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 23:53:07,983 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-20 23:53:07,983 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 23:53:07,983 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 23:53:07,983 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 23:53:07,984 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 23:53:07,984 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 23:53:07,989 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 161d7401d74f40598e049e77bd637ded.pdf â†’ 691f6393f6f4dfed6c22931f
2025-11-20 23:53:07,989 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691f6393f6f4dfed6c22931f
2025-11-20 23:53:07,994 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f6393f6f4dfed6c229320 (331157 bytes)
2025-11-20 23:53:07,994 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f6393f6f4dfed6c229320
2025-11-20 23:53:07,995 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:53:07,995 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 23:53:07,996 - app.api.routes - INFO - 
======================================================================
2025-11-20 23:53:07,996 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 23:53:07,996 - app.api.routes - INFO - ======================================================================
2025-11-20 23:53:07,997 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 23:53:07,998 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763664727_bc30c2841180
2025-11-20 23:53:07,999 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 23:53:07,999 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 23:53:08,001 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 23:53:08,001 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 23:53:08,002 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 23:53:08,003 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 23:53:08,003 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 23:53:08,004 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 23:53:08,005 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 23:53:08,005 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 23:53:08,006 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 23:53:08,006 - app.services.mongodb_service_enhanced - INFO -    Summary: 940 bytes
2025-11-20 23:53:08,007 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 23:53:08,007 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 23:53:08,007 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 23:53:08,007 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,228 bytes
2025-11-20 23:53:08,008 - app.services.mongodb_service_enhanced - INFO -    Total document: 31,955 bytes
2025-11-20 23:53:08,008 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 23:53:08,009 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 23:53:08,009 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 23:53:08,010 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 23:53:08,011 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 23:53:08,015 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763664727_bc30c2841180
2025-11-20 23:53:08,015 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691f63942fcd474cc2a217a5
2025-11-20 23:53:08,017 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 23:53:08,017 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 23:53:08,017 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 23:53:08,018 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 23:53:08,018 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 23:53:08,018 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 23:53:08,019 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 23:53:08,019 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 23:53:08,019 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 23:53:08,020 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 23:53:08,020 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 23:53:08,021 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 23:53:08,021 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 23:53:08,021 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 23:53:08,022 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 23:53:08,022 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691f63942fcd474cc2a217a5
2025-11-20 23:53:08,022 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 23:53:08,023 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 23:53:08,023 - app.api.routes - INFO -    Comparison ID: cmp_1763664727_bc30c2841180
2025-11-20 23:53:08,025 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 23:53:08,026 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 23:53:08,026 - app.api.routes - INFO - 
======================================================================
2025-11-20 23:53:08,027 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 23:53:08,027 - app.api.routes - INFO - ======================================================================
2025-11-20 23:53:08,029 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763664727_bc30c2841180
2025-11-20 23:53:08,030 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 23:53:08,031 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 23:53:08,031 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 23:53:08,032 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 23:53:08,033 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 23:53:08,033 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 23:53:08,034 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 23:53:08,040 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 43
2025-11-20 23:53:08,068 - app.api.routes - INFO - ======================================================================

2025-11-20 23:53:08,075 - app.services.progress_tracker - INFO - âœ… Job completed: job_bfe6cef188ff â†’ comparison_id: cmp_1763664727_bc30c2841180
2025-11-20 23:53:08,085 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 60.37s
2025-11-20 23:58:28,273 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-20 23:58:28,285 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-20 23:58:28,286 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 23:58:28,288 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 23:58:28,289 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 23:58:28,293 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 23:58:28,298 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-20 23:58:28,298 - app.api.routes - INFO -    - Remaining comparisons: 43
2025-11-20 23:58:28,299 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-20 23:58:28,299 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-20 23:58:28,300 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763665108_1588296ca071
2025-11-20 23:58:28,300 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_375547040de5 (1 files)
2025-11-20 23:58:28,301 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_375547040de5
2025-11-20 23:58:28,301 - app.api.routes - INFO - 
======================================================================
2025-11-20 23:58:28,303 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:58:28,303 - app.api.routes - INFO - ======================================================================
2025-11-20 23:58:28,305 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 1c5a78335f9a4e389360630d8a883983.pdf (331157 bytes)
2025-11-20 23:58:28,305 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:58:28,306 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\1c5a78335f9a4e389360630d8a883983.pdf
2025-11-20 23:58:28,383 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-20 23:58:28,415 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:58:28,418 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:58:28,419 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-20 23:58:28,419 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-20 23:58:28,420 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-20 23:58:28,420 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-20 23:58:28,420 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-20 23:58:28,542 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-20 23:58:28,542 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-20 23:59:16,975 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 23:59:16,981 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-20 23:59:16,982 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-20 23:59:16,984 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-20 23:59:16,985 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-20 23:59:24,995 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 23:59:24,999 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-20 23:59:24,999 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-20 23:59:25,000 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-20 23:59:25,001 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-20 23:59:25,003 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 23:59:25,004 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 23:59:25,004 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-20 23:59:25,005 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 23:59:25,006 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-20 23:59:25,006 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-20 23:59:32,958 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 23:59:32,965 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-20 23:59:32,966 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-20 23:59:32,968 - app.services.ai_parser - INFO - 
2025-11-20 23:59:32,969 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 23:59:32,971 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:59:32,972 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 23:59:32,973 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-20 23:59:32,975 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-20 23:59:32,976 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-20 23:59:32,977 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-20 23:59:32,978 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-20 23:59:32,979 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-20 23:59:32,979 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-20 23:59:32,980 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-20 23:59:32,981 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-20 23:59:32,981 - app.services.ai_parser - INFO - 
2025-11-20 23:59:32,981 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-20 23:59:32,982 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-20 23:59:32,982 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-20 23:59:32,983 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-20 23:59:32,983 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-20 23:59:32,983 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-20 23:59:32,984 - app.services.ai_parser - INFO - ======================================================================
2025-11-20 23:59:32,988 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 1c5a78335f9a4e389360630d8a883983.pdf â†’ 691f6514f6f4dfed6c229321
2025-11-20 23:59:32,989 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691f6514f6f4dfed6c229321
2025-11-20 23:59:32,992 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f6514f6f4dfed6c229322 (331157 bytes)
2025-11-20 23:59:32,993 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f6514f6f4dfed6c229322
2025-11-20 23:59:32,993 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-20 23:59:32,994 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-20 23:59:32,994 - app.api.routes - INFO - 
======================================================================
2025-11-20 23:59:32,995 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-20 23:59:32,996 - app.api.routes - INFO - ======================================================================
2025-11-20 23:59:32,996 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-20 23:59:32,998 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763665108_1588296ca071
2025-11-20 23:59:32,998 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-20 23:59:32,998 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-20 23:59:32,999 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-20 23:59:32,999 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-20 23:59:32,999 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-20 23:59:32,999 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-20 23:59:33,000 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-20 23:59:33,000 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-20 23:59:33,001 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-20 23:59:33,001 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-20 23:59:33,002 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-20 23:59:33,002 - app.services.mongodb_service_enhanced - INFO -    Summary: 947 bytes
2025-11-20 23:59:33,002 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-20 23:59:33,003 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-20 23:59:33,003 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-20 23:59:33,003 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,439 bytes
2025-11-20 23:59:33,003 - app.services.mongodb_service_enhanced - INFO -    Total document: 32,391 bytes
2025-11-20 23:59:33,003 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-20 23:59:33,004 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-20 23:59:33,004 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 23:59:33,004 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 23:59:33,004 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-20 23:59:33,007 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763665108_1588296ca071
2025-11-20 23:59:33,007 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691f65152fcd474cc2a217a6
2025-11-20 23:59:33,008 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-20 23:59:33,009 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-20 23:59:33,010 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-20 23:59:33,011 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-20 23:59:33,011 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-20 23:59:33,011 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-20 23:59:33,012 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-20 23:59:33,013 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-20 23:59:33,013 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-20 23:59:33,014 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-20 23:59:33,014 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-20 23:59:33,014 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-20 23:59:33,015 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-20 23:59:33,015 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-20 23:59:33,015 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-20 23:59:33,016 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691f65152fcd474cc2a217a6
2025-11-20 23:59:33,016 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-20 23:59:33,016 - app.api.routes - INFO -    Collection: comparisons
2025-11-20 23:59:33,017 - app.api.routes - INFO -    Comparison ID: cmp_1763665108_1588296ca071
2025-11-20 23:59:33,019 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 23:59:33,019 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-20 23:59:33,020 - app.api.routes - INFO - 
======================================================================
2025-11-20 23:59:33,020 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-20 23:59:33,020 - app.api.routes - INFO - ======================================================================
2025-11-20 23:59:33,021 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763665108_1588296ca071
2025-11-20 23:59:33,021 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-20 23:59:33,021 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-20 23:59:33,021 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-20 23:59:33,022 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-20 23:59:33,022 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-20 23:59:33,022 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-20 23:59:33,024 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-20 23:59:33,025 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 42
2025-11-20 23:59:33,025 - app.api.routes - INFO - ======================================================================

2025-11-20 23:59:33,026 - app.services.progress_tracker - INFO - âœ… Job completed: job_375547040de5 â†’ comparison_id: cmp_1763665108_1588296ca071
2025-11-20 23:59:33,027 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 64.75s
2025-11-21 00:01:45,839 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-21 00:01:45,841 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 00:01:51,714 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 00:01:51,723 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-21 00:01:51,724 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 00:01:51,725 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 00:01:51,728 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 00:01:51,731 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 00:01:51,733 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-21 00:01:51,733 - app.api.routes - INFO -    - Remaining comparisons: 42
2025-11-21 00:01:51,734 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 00:01:51,734 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-21 00:01:51,735 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763665311_0eabe3ee0b75
2025-11-21 00:01:51,735 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_12dae721c1dc (1 files)
2025-11-21 00:01:51,736 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_12dae721c1dc
2025-11-21 00:01:51,738 - app.api.routes - INFO - 
======================================================================
2025-11-21 00:01:51,739 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 00:01:51,740 - app.api.routes - INFO - ======================================================================
2025-11-21 00:01:51,741 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 0bbcc73ab64e48e4a2a153175d2f2e03.pdf (331157 bytes)
2025-11-21 00:01:51,744 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 00:01:51,744 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\0bbcc73ab64e48e4a2a153175d2f2e03.pdf
2025-11-21 00:01:51,799 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-21 00:01:51,799 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 00:01:51,800 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-21 00:01:51,800 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-21 00:01:51,801 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-21 00:01:51,801 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-21 00:01:51,801 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 00:01:51,802 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-21 00:01:51,922 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-21 00:01:51,923 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 00:02:41,372 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 00:02:41,381 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 00:02:41,382 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 00:02:41,382 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 00:02:41,383 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 00:02:47,303 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 00:02:47,313 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 00:02:47,339 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 00:02:47,340 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-21 00:02:47,349 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-21 00:02:47,351 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 00:02:47,371 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 00:02:47,371 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 00:02:47,371 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-21 00:02:47,371 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 00:02:47,372 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-21 00:02:56,428 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 00:02:56,432 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-21 00:02:56,432 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 00:02:56,433 - app.services.ai_parser - INFO - 
2025-11-21 00:02:56,433 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 00:02:56,433 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-21 00:02:56,434 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 00:02:56,434 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-21 00:02:56,434 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-21 00:02:56,435 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-21 00:02:56,435 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-21 00:02:56,435 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-21 00:02:56,436 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-21 00:02:56,436 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5%, min SR 1,500,000
2025-11-21 00:02:56,437 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-21 00:02:56,437 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-21 00:02:56,437 - app.services.ai_parser - INFO - 
2025-11-21 00:02:56,438 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 00:02:56,438 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-21 00:02:56,438 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-21 00:02:56,438 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-21 00:02:56,439 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 00:02:56,439 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 00:02:56,440 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 00:02:56,442 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 0bbcc73ab64e48e4a2a153175d2f2e03.pdf â†’ 691f65e0f6f4dfed6c229323
2025-11-21 00:02:56,442 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691f65e0f6f4dfed6c229323
2025-11-21 00:02:56,446 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f65e0f6f4dfed6c229324 (331157 bytes)
2025-11-21 00:02:56,446 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 691f65e0f6f4dfed6c229324
2025-11-21 00:02:56,447 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 00:02:56,447 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-21 00:02:56,447 - app.api.routes - INFO - 
======================================================================
2025-11-21 00:02:56,448 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-21 00:02:56,448 - app.api.routes - INFO - ======================================================================
2025-11-21 00:02:56,448 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 00:02:56,449 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763665311_0eabe3ee0b75
2025-11-21 00:02:56,449 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-21 00:02:56,449 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 00:02:56,450 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-21 00:02:56,450 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-21 00:02:56,450 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 00:02:56,451 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 00:02:56,451 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 00:02:56,451 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 00:02:56,452 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 00:02:56,452 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 00:02:56,454 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 00:02:56,454 - app.services.mongodb_service_enhanced - INFO -    Summary: 954 bytes
2025-11-21 00:02:56,455 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-21 00:02:56,455 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-21 00:02:56,455 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-21 00:02:56,456 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,292 bytes
2025-11-21 00:02:56,456 - app.services.mongodb_service_enhanced - INFO -    Total document: 32,111 bytes
2025-11-21 00:02:56,456 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 00:02:56,457 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-21 00:02:56,457 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 00:02:56,457 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 00:02:56,458 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 00:02:56,461 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763665311_0eabe3ee0b75
2025-11-21 00:02:56,461 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691f65e02fcd474cc2a217a7
2025-11-21 00:02:56,464 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 00:02:56,465 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 00:02:56,465 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 00:02:56,465 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 00:02:56,466 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 00:02:56,466 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 00:02:56,466 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 00:02:56,466 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-21 00:02:56,467 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 00:02:56,468 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 00:02:56,468 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 00:02:56,468 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 00:02:56,469 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 00:02:56,469 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 00:02:56,469 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 00:02:56,470 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691f65e02fcd474cc2a217a7
2025-11-21 00:02:56,470 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-21 00:02:56,470 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 00:02:56,471 - app.api.routes - INFO -    Comparison ID: cmp_1763665311_0eabe3ee0b75
2025-11-21 00:02:56,473 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 00:02:56,473 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 00:02:56,473 - app.api.routes - INFO - 
======================================================================
2025-11-21 00:02:56,474 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 00:02:56,474 - app.api.routes - INFO - ======================================================================
2025-11-21 00:02:56,474 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763665311_0eabe3ee0b75
2025-11-21 00:02:56,474 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-21 00:02:56,475 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-21 00:02:56,475 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-21 00:02:56,475 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 00:02:56,475 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 00:02:56,476 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 00:02:56,477 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 00:02:56,479 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 41
2025-11-21 00:02:56,479 - app.api.routes - INFO - ======================================================================

2025-11-21 00:02:56,479 - app.services.progress_tracker - INFO - âœ… Job completed: job_12dae721c1dc â†’ comparison_id: cmp_1763665311_0eabe3ee0b75
2025-11-21 00:02:56,481 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 64.77s
2025-11-21 00:04:08,168 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-21 00:04:08,171 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-21 00:04:08,187 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 00:04:08,208 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-21 00:04:08,209 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 00:04:08,209 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 00:04:08,209 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 00:04:08,213 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 00:04:08,214 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-21 00:04:08,215 - app.api.routes - INFO -    - Remaining comparisons: 41
2025-11-21 00:04:08,215 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 00:04:08,215 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-21 00:04:08,215 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763665448_10fe7e54247d
2025-11-21 00:04:08,216 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_e3f1de942316 (1 files)
2025-11-21 00:04:08,216 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_e3f1de942316
2025-11-21 00:04:08,216 - app.api.routes - INFO - 
======================================================================
2025-11-21 00:04:08,217 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 00:04:08,217 - app.api.routes - INFO - ======================================================================
2025-11-21 00:04:08,218 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ f4b02da59b1f4ec8a79657244446cafe.pdf (464206 bytes)
2025-11-21 00:04:08,219 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 00:04:08,219 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\f4b02da59b1f4ec8a79657244446cafe.pdf
2025-11-21 00:04:08,283 - app.services.pdf_extractor - INFO - Successfully extracted 15284 characters from 7 pages
2025-11-21 00:04:08,284 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 00:04:08,284 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 00:04:08,285 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-21 00:04:08,286 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-21 00:04:08,286 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 00:04:08,286 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 00:04:08,286 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-21 00:04:08,595 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-21 00:04:08,595 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 00:04:33,206 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 00:04:33,212 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 00:04:33,213 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 00:04:33,214 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 00:04:33,215 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-21 00:04:33,218 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 00:04:33,219 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-21 00:04:33,237 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-21 00:04:33,238 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-21 00:04:33,238 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 00:04:40,489 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 00:04:40,494 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 00:04:40,495 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 00:04:40,495 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-21 00:04:40,495 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-21 00:04:40,496 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 00:04:40,496 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 00:04:40,496 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-21 00:04:46,833 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 00:04:46,843 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-21 00:04:46,844 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 00:04:46,844 - app.services.ai_parser - INFO - 
2025-11-21 00:04:46,845 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 00:04:46,845 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 00:04:46,845 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 00:04:46,846 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-21 00:04:46,846 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 00:04:46,846 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-21 00:04:46,847 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-21 00:04:46,847 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-21 00:04:46,848 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-21 00:04:46,848 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 00:04:46,848 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 00:04:46,849 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 00:04:46,849 - app.services.ai_parser - INFO - 
2025-11-21 00:04:46,850 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 00:04:46,851 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-21 00:04:46,851 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-21 00:04:46,851 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-21 00:04:46,852 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 00:04:46,852 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 00:04:46,852 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 00:04:46,854 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: f4b02da59b1f4ec8a79657244446cafe.pdf â†’ 691f664ef6f4dfed6c229325
2025-11-21 00:04:46,854 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 691f664ef6f4dfed6c229325
2025-11-21 00:04:46,858 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691f664ef6f4dfed6c229326 (464206 bytes)
2025-11-21 00:04:46,858 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 691f664ef6f4dfed6c229326
2025-11-21 00:04:46,858 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 00:04:46,859 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-21 00:04:46,859 - app.api.routes - INFO - 
======================================================================
2025-11-21 00:04:46,860 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-21 00:04:46,860 - app.api.routes - INFO - ======================================================================
2025-11-21 00:04:46,861 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 00:04:46,861 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763665448_10fe7e54247d
2025-11-21 00:04:46,862 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-21 00:04:46,862 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 00:04:46,863 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-21 00:04:46,863 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-21 00:04:46,863 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 00:04:46,864 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 00:04:46,864 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 00:04:46,864 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 00:04:46,865 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 00:04:46,865 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 00:04:46,866 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 00:04:46,866 - app.services.mongodb_service_enhanced - INFO -    Summary: 1,092 bytes
2025-11-21 00:04:46,866 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-21 00:04:46,867 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-21 00:04:46,867 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-21 00:04:46,867 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 15,007 bytes
2025-11-21 00:04:46,868 - app.services.mongodb_service_enhanced - INFO -    Total document: 33,817 bytes
2025-11-21 00:04:46,868 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 00:04:46,868 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-21 00:04:46,868 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 00:04:46,869 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 00:04:46,869 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 00:04:46,872 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763665448_10fe7e54247d
2025-11-21 00:04:46,872 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 691f664e2fcd474cc2a217a8
2025-11-21 00:04:46,873 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 00:04:46,874 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 00:04:46,874 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 00:04:46,874 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 00:04:46,874 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 00:04:46,875 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 00:04:46,875 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 00:04:46,875 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-21 00:04:46,876 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 00:04:46,877 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 00:04:46,877 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 00:04:46,877 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 00:04:46,877 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 00:04:46,878 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 00:04:46,878 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 00:04:46,878 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 691f664e2fcd474cc2a217a8
2025-11-21 00:04:46,879 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-21 00:04:46,879 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 00:04:46,879 - app.api.routes - INFO -    Comparison ID: cmp_1763665448_10fe7e54247d
2025-11-21 00:04:46,882 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 00:04:46,882 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 00:04:46,883 - app.api.routes - INFO - 
======================================================================
2025-11-21 00:04:46,883 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 00:04:46,883 - app.api.routes - INFO - ======================================================================
2025-11-21 00:04:46,884 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763665448_10fe7e54247d
2025-11-21 00:04:46,884 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-21 00:04:46,884 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-21 00:04:46,885 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-21 00:04:46,885 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 00:04:46,885 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 00:04:46,886 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 00:04:46,887 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 00:04:46,888 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 40
2025-11-21 00:04:46,888 - app.api.routes - INFO - ======================================================================

2025-11-21 00:04:46,888 - app.services.progress_tracker - INFO - âœ… Job completed: job_e3f1de942316 â†’ comparison_id: cmp_1763665448_10fe7e54247d
2025-11-21 00:04:46,890 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 38.70s
2025-11-21 00:06:45,862 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-21 00:06:45,864 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 00:11:45,868 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 2 old progress entries
2025-11-21 00:11:45,869 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 2 old entries
2025-11-21 00:27:04,100 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 00:27:04,101 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 00:27:04,105 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:27:04,115 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:27:04,116 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:27:45,206 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:27:45,214 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:27:45,216 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:27:48,003 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:27:48,011 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:27:48,016 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:27:51,981 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:27:52,008 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:27:52,015 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.03s
2025-11-21 00:27:58,243 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:27:58,252 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:27:58,254 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:27:58,273 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:27:58,284 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:27:58,286 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:28:12,475 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:28:12,511 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:28:12,543 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.07s
2025-11-21 00:28:41,648 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:28:41,650 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:28:41,651 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 00:28:41,653 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:28:41,657 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:28:41,659 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:32:19,407 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:32:19,409 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:32:19,409 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 00:44:16,128 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 00:44:16,129 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 00:44:16,132 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:44:16,134 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:44:16,135 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 00:44:41,991 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:44:42,025 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:44:42,077 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.09s
2025-11-21 00:57:24,814 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 00:57:24,824 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.01s
2025-11-21 00:57:24,828 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:57:24,834 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:57:24,835 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 00:57:39,799 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 00:57:39,833 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 00:57:39,888 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.09s
2025-11-21 01:03:18,363 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 01:03:18,371 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 01:03:18,373 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 01:03:18,388 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 01:03:18,402 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 01:03:18,406 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.02s
2025-11-21 01:17:26,545 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 01:17:26,548 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 01:17:26,550 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 01:17:26,553 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.01s
2025-11-21 01:17:26,559 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 01:17:26,567 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 01:17:26,568 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 01:17:26,573 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 01:17:26,580 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 01:17:26,581 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 01:17:30,180 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 01:17:30,192 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 01:17:30,195 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.02s
2025-11-21 01:51:24,478 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents/undefined/download
2025-11-21 01:51:24,479 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents/undefined/download - 200 - 0.00s
2025-11-21 01:51:24,482 - main - INFO - ðŸ“¥ GET /api/my-documents/undefined/download
2025-11-21 01:51:24,485 - main - INFO - ðŸ“¤ GET /api/my-documents/undefined/download - 404 - 0.00s
2025-11-21 01:53:24,598 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 01:53:24,599 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 01:53:24,601 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 01:53:24,604 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 01:53:24,605 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 01:53:33,033 - main - INFO - ðŸ“¥ GET /api/my-documents/undefined/download
2025-11-21 01:53:33,034 - main - INFO - ðŸ“¤ GET /api/my-documents/undefined/download - 404 - 0.00s
2025-11-21 19:01:54,735 - main - INFO - 
2025-11-21 19:01:54,735 - main - INFO - ================================================================================
2025-11-21 19:01:54,735 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 19:01:54,736 - main - INFO -   Production-Ready Complete Integration
2025-11-21 19:01:54,736 - main - INFO - ================================================================================
2025-11-21 19:01:54,736 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 19:01:54,736 - main - INFO -   Upload Directory: uploads
2025-11-21 19:01:54,736 - main - INFO -   Max File Size: 20MB
2025-11-21 19:01:54,737 - main - INFO - ================================================================================
2025-11-21 19:01:54,737 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 19:01:54,738 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 19:01:54,738 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 19:01:55,168 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 19:01:55,186 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 19:01:55,187 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 19:01:55,188 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 19:01:55,189 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 19:01:55,190 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 19:01:55,191 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 19:01:55,192 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 19:01:55,254 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 19:01:55,257 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local', 'tap2save']
2025-11-21 19:01:55,260 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['users', 'admins', 'comparisons', 'individual_pdf_extractions', 'user_documents']
2025-11-21 19:01:55,269 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 1 documents
2025-11-21 19:01:55,270 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 19:01:55,270 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 19:01:55,272 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 19:01:55,272 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 19:01:55,311 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 19:01:55,312 - main - INFO -   âœ… User Documents Service connected
2025-11-21 19:01:55,312 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 19:01:55,312 - main - INFO - 
2025-11-21 19:01:55,313 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 19:01:55,313 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 19:01:55,314 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 19:01:55,314 - main - INFO -        - Separates warranties from extensions
2025-11-21 19:01:55,315 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 19:01:55,315 - main - INFO -        - Correct deductible tier detection
2025-11-21 19:01:55,315 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 19:01:55,316 - main - INFO - 
2025-11-21 19:01:55,316 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 19:01:55,316 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 19:01:55,317 - main - INFO -        - Identifies unique items per provider
2025-11-21 19:01:55,317 - main - INFO -        - Transparent scoring methodology
2025-11-21 19:01:55,317 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 19:01:55,318 - main - INFO - 
2025-11-21 19:01:55,319 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 19:01:55,320 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 19:01:55,320 - main - INFO -        - No manual section generation
2025-11-21 19:01:55,320 - main - INFO -        - Complete MongoDB integration
2025-11-21 19:01:55,320 - main - INFO - 
2025-11-21 19:01:55,321 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 19:01:55,321 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 19:01:55,321 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 19:01:55,321 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 19:01:55,322 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 19:01:55,322 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 19:01:55,322 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 19:01:55,323 - main - INFO - 
2025-11-21 19:01:55,323 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 19:01:55,323 - main - INFO -      Main:
2025-11-21 19:01:55,323 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 19:01:55,324 - main - INFO - 
2025-11-21 19:01:55,324 - main - INFO -      Retrieval:
2025-11-21 19:01:55,324 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 19:01:55,324 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 19:01:55,325 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 19:01:55,325 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 19:01:55,325 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 19:01:55,326 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 19:01:55,327 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 19:01:55,328 - main - INFO - 
2025-11-21 19:01:55,328 - main - INFO -      Management:
2025-11-21 19:01:55,328 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 19:01:55,328 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 19:01:55,329 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 19:01:55,329 - main - INFO - 
2025-11-21 19:01:55,329 - main - INFO -      Documents (MongoDB):
2025-11-21 19:01:55,330 - main - INFO -        GET  /api/documents                All documents
2025-11-21 19:01:55,330 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 19:01:55,331 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 19:01:55,331 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 19:01:55,332 - main - INFO - 
2025-11-21 19:01:55,332 - main - INFO -      Diagnostics & Health:
2025-11-21 19:01:55,332 - main - INFO -        GET  /api/health                   System health
2025-11-21 19:01:55,332 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 19:01:55,332 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 19:01:55,333 - main - INFO - 
2025-11-21 19:01:55,333 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 19:01:55,334 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 19:01:55,334 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 19:01:55,334 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 19:01:55,334 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 19:01:55,335 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 19:01:55,335 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 19:01:55,335 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 19:01:55,335 - main - INFO - 
2025-11-21 19:01:55,336 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 19:01:55,336 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 19:01:55,336 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 19:01:55,336 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 19:01:55,337 - main - INFO -      4. No re-upload needed!
2025-11-21 19:01:55,337 - main - INFO - 
2025-11-21 19:01:55,339 - main - INFO - ================================================================================
2025-11-21 19:01:55,340 - main - INFO -   âœ… Application started successfully!
2025-11-21 19:01:55,340 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 19:01:55,341 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 19:01:55,341 - main - INFO - ================================================================================
2025-11-21 19:01:55,341 - main - INFO - 
2025-11-21 19:01:55,342 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 19:03:50,373 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 19:03:50,373 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 19:03:50,374 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 19:03:50,375 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 19:03:50,377 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 19:03:50,380 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:03:50,381 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 19:03:50,385 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 19:03:50,392 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:03:50,395 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 19:08:22,776 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 19:08:22,779 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:08:22,779 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 19:18:20,561 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 19:18:20,565 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 19:18:20,568 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 19:18:20,571 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:18:20,573 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 19:18:32,111 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents/691f664ef6f4dfed6c229326/download
2025-11-21 19:18:32,112 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents/691f664ef6f4dfed6c229326/download - 200 - 0.00s
2025-11-21 19:18:32,114 - main - INFO - ðŸ“¥ GET /api/my-documents/691f664ef6f4dfed6c229326/download
2025-11-21 19:18:32,118 - app.services.user_documents_service - INFO - ðŸ“‹ Found 9 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:18:32,118 - main - INFO - ðŸ“¤ GET /api/my-documents/691f664ef6f4dfed6c229326/download - 200 - 0.00s
2025-11-21 19:21:02,460 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents/691f664ef6f4dfed6c229326
2025-11-21 19:21:02,462 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents/691f664ef6f4dfed6c229326 - 200 - 0.00s
2025-11-21 19:21:02,468 - main - INFO - ðŸ“¥ DELETE /api/my-documents/691f664ef6f4dfed6c229326
2025-11-21 19:21:02,476 - app.services.user_documents_service - INFO - âœ… Deleted document 691f664ef6f4dfed6c229326 for user 691cd2d361d4fb6ef0028740
2025-11-21 19:21:02,476 - main - INFO - ðŸ“¤ DELETE /api/my-documents/691f664ef6f4dfed6c229326 - 200 - 0.01s
2025-11-21 19:51:37,759 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 19:51:37,762 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 19:51:37,763 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 19:51:37,768 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.01s
2025-11-21 19:51:37,780 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 19:51:37,785 - app.services.user_documents_service - INFO - ðŸ“‹ Found 8 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:51:37,788 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 19:51:37,791 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 19:51:37,799 - app.services.user_documents_service - INFO - ðŸ“‹ Found 8 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 19:51:37,800 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 20:05:31,326 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-21 20:05:31,328 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-21 20:05:31,334 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 20:05:31,368 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-21 20:05:31,369 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 20:05:31,370 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:05:31,370 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:05:31,372 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 20:05:31,374 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-21 20:05:31,375 - app.api.routes - INFO -    - Remaining comparisons: 40
2025-11-21 20:05:31,375 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 20:05:31,375 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-21 20:05:31,376 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763737531_51d18b082cbe
2025-11-21 20:05:31,377 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_0fad1dce05f7 (2 files)
2025-11-21 20:05:31,377 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_0fad1dce05f7
2025-11-21 20:05:31,379 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:05:31,379 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 20:05:31,380 - app.api.routes - INFO - ======================================================================
2025-11-21 20:05:31,383 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 7205fc3366aa43909b8e1d6182dceb15.pdf (331157 bytes)
2025-11-21 20:05:31,383 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 20:05:31,389 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\7205fc3366aa43909b8e1d6182dceb15.pdf
2025-11-21 20:05:31,389 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:05:31,392 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 20:05:31,437 - app.api.routes - INFO - ======================================================================
2025-11-21 20:05:31,507 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 6a5a450fcd1a459ca629cabe8bd8274d.pdf (464206 bytes)
2025-11-21 20:05:31,507 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 20:05:31,508 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6a5a450fcd1a459ca629cabe8bd8274d.pdf
2025-11-21 20:05:31,541 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-21 20:05:31,592 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 20:05:31,603 - app.services.pdf_extractor - INFO - Successfully extracted 15284 characters from 7 pages
2025-11-21 20:05:31,604 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-21 20:05:31,606 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-21 20:05:31,609 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-21 20:05:31,609 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-21 20:05:31,609 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 20:05:31,610 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-21 20:05:31,730 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-21 20:05:31,731 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 20:05:31,742 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 20:05:31,743 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 20:05:31,743 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-21 20:05:31,744 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-21 20:05:31,745 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 20:05:31,746 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 20:05:31,746 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-21 20:05:32,017 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-21 20:05:32,019 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 20:06:01,392 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:01,666 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 20:06:01,667 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 20:06:01,669 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 20:06:01,670 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-21 20:06:01,671 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:06:01,672 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-21 20:06:01,682 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-21 20:06:01,683 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-21 20:06:01,683 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 20:06:11,274 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:11,281 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 20:06:11,282 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 20:06:11,283 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-21 20:06:11,283 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-21 20:06:11,284 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:06:11,285 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 20:06:11,287 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 3 extensions
2025-11-21 20:06:19,660 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:19,906 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-21 20:06:19,907 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 20:06:19,908 - app.services.ai_parser - INFO - 
2025-11-21 20:06:19,909 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:06:19,910 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 20:06:19,911 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:06:19,912 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-21 20:06:19,913 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 20:06:19,914 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-21 20:06:19,915 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-21 20:06:19,916 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-21 20:06:19,917 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-21 20:06:19,917 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:06:19,918 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 20:06:19,922 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 20:06:19,922 - app.services.ai_parser - INFO - 
2025-11-21 20:06:19,923 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 20:06:19,924 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-21 20:06:19,924 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-21 20:06:19,925 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-21 20:06:19,926 - app.services.ai_parser - INFO -    âœ“ Extensions: 3
2025-11-21 20:06:19,926 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 20:06:19,927 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:06:19,931 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6a5a450fcd1a459ca629cabe8bd8274d.pdf â†’ 69207febf77930ca79fe5d30
2025-11-21 20:06:19,931 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69207febf77930ca79fe5d30
2025-11-21 20:06:19,936 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69207febf77930ca79fe5d31 (464206 bytes)
2025-11-21 20:06:19,937 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 69207febf77930ca79fe5d31
2025-11-21 20:06:19,937 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 20:06:24,522 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:25,323 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 20:06:25,324 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 20:06:25,325 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 20:06:25,326 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 20:06:34,050 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:34,062 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 20:06:34,063 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 20:06:34,063 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-21 20:06:34,064 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-21 20:06:34,065 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 20:06:34,065 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 20:06:34,066 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 20:06:34,068 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-21 20:06:34,070 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 20:06:34,073 - app.services.ai_parser - INFO - ðŸ“Š Counts: 17 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-21 20:06:41,534 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:41,540 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-21 20:06:41,541 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 20:06:41,543 - app.services.ai_parser - INFO - 
2025-11-21 20:06:41,544 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:06:41,545 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-21 20:06:41,546 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:06:41,547 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-21 20:06:41,548 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-21 20:06:41,549 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-21 20:06:41,550 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-21 20:06:41,551 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-21 20:06:41,555 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-21 20:06:41,557 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-21 20:06:41,559 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-21 20:06:41,561 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-21 20:06:41,562 - app.services.ai_parser - INFO - 
2025-11-21 20:06:41,563 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 20:06:41,565 - app.services.ai_parser - INFO -    âœ“ Benefits: 17
2025-11-21 20:06:41,567 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-21 20:06:41,568 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-21 20:06:41,569 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 20:06:41,574 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 20:06:41,575 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:06:41,580 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 7205fc3366aa43909b8e1d6182dceb15.pdf â†’ 69208001f77930ca79fe5d32
2025-11-21 20:06:41,580 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69208001f77930ca79fe5d32
2025-11-21 20:06:41,586 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69208001f77930ca79fe5d33 (331157 bytes)
2025-11-21 20:06:41,587 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 69208001f77930ca79fe5d33
2025-11-21 20:06:41,588 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 20:06:41,589 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-21 20:06:41,589 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:06:41,590 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-21 20:06:41,590 - app.api.routes - INFO - ======================================================================
2025-11-21 20:06:41,591 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-21 20:06:41,591 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-21 20:06:41,592 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-21 20:06:41,593 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 20:06:41,594 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-21 20:06:41,595 - app.services.ai_ranker - INFO - ================================================================================
2025-11-21 20:06:41,595 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 20:06:41,595 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-21 20:06:41,596 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 20:06:41,596 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 20:06:41,597 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:06:41,597 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 20:06:41,597 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 20:06:41,598 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-21 20:06:41,598 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 20:06:41,599 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 20:06:41,599 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 20:06:41,599 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 20:06:41,600 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "Minimization of losses": "SR 250,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Industries Seepage, Pollution and Contamination",
      "Nuclear Risks Exclusion - NMA 1975A",
      "Sabotage and terrorism",
      "Property cyber data exclusion LMA 5401",
      "Clar
2025-11-21 20:06:41,603 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 20:06:41,604 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-21 20:06:41,605 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-21 20:06:41,605 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 20:06:41,605 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 20:06:41,605 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 20:06:41,606 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 20:06:41,606 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 20:06:41,606 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 20:06:41,607 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 20:06:41,607 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 20:06:41,607 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 20:06:41,608 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 20:06:41,608 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 20:06:41,609 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 20:06:41,609 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 20:06:41,610 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-21 20:06:41,610 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 20:06:41,611 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-21 20:06:41,611 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-21 20:06:41,611 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-21 20:06:41,612 - app.services.ai_ranker - INFO -    Extensions: 3
2025-11-21 20:06:41,612 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-21 20:06:41,612 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-21 20:06:41,612 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 20:06:41,613 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-21 20:06:41,613 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 20:06:41,613 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 20:06:41,613 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:06:41,614 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 20:06:41,614 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 20:06:41,614 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension', 'Professional Valuation Report required for properties with total Sum Insured exceeding SR40m'], 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers'], 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']}
2025-11-21 20:06:41,615 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 20:06:41,615 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 20:06:41,615 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 20:06:41,616 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 20:06:41,616 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "1,564,652,306.28",
    "business_interruption": "650,000,000.00",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40,000,000",
        "deductible": "5% of claim amount (nil minimum if Sum Insured < SR 1,000,000, min SR 50,000 if SR 1,000,000 to SR 40,000,000)",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40,000,001 to SR 100,000,000",
        "deductible": "5% of claim amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100,000,001 to SR 500,000,000",
        "deductible": "5% of claim amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500,000,000",
        "deductible": "5% 
2025-11-21 20:06:41,618 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-21 20:06:41,618 - app.services.ai_ranker - INFO -    âœ… Found 2 items in key 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers']
2025-11-21 20:06:41,619 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']
2025-11-21 20:06:41,620 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 20:06:41,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 20:06:41,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 20:06:41,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 20:06:41,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 20:06:41,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 20:06:41,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 20:06:41,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 20:06:41,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 20:06:41,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 20:06:41,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 20:06:41,625 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 20:06:41,626 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 20:06:41,627 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 9
2025-11-21 20:06:41,627 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-21 20:06:41,628 - app.services.ai_ranker - INFO -    âœ… Extracted 9 subjectivities for Liva Insurance
2025-11-21 20:06:41,628 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-21 20:06:41,628 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-21 20:06:41,629 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 20:06:41,629 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-21 20:06:41,629 - app.services.ai_ranker - INFO -    Subjectivities: 9
2025-11-21 20:06:41,629 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-21 20:06:41,783 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-21 20:06:41,784 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 20:06:41,784 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 20:06:41,784 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-21 20:06:41,785 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 20:06:41,785 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-21 20:06:41,786 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-21 20:06:41,787 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-21 20:06:41,950 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-21 20:06:41,950 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 2
2025-11-21 20:06:41,951 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 20:06:41,951 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 9
2025-11-21 20:06:41,951 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 20:06:41,952 - app.services.ai_ranker - INFO -       â€¢ Warranted valid civil defense certificates during the currency of the policy
2025-11-21 20:06:41,952 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-21 20:06:41,953 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 20:06:41,954 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-21 20:06:41,954 - app.services.ai_ranker - INFO - ================================================================================

2025-11-21 20:06:41,955 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=86.52
2025-11-21 20:06:41,956 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=84.79
2025-11-21 20:06:41,956 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-21 20:06:41,957 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-21 20:06:51,933 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:06:52,165 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-21 20:06:52,166 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-21 20:06:52,166 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-21 20:06:52,169 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-21 20:06:52,170 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 20:06:52,171 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763737531_51d18b082cbe
2025-11-21 20:06:52,173 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-21 20:06:52,173 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 20:06:52,174 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-21 20:06:52,174 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-21 20:06:52,175 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 20:06:52,176 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 20:06:52,176 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 20:06:52,177 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 20:06:52,178 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 20:06:52,178 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 20:06:52,179 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-21 20:06:52,179 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 20:06:52,180 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 20:06:52,180 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 20:06:52,180 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 20:06:52,181 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 20:06:52,181 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 20:06:52,184 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 20:06:52,185 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,319 bytes
2025-11-21 20:06:52,186 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 22,175 bytes
2025-11-21 20:06:52,187 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,841 bytes
2025-11-21 20:06:52,187 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,446 bytes
2025-11-21 20:06:52,188 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 29,875 bytes
2025-11-21 20:06:52,188 - app.services.mongodb_service_enhanced - INFO -    Total document: 140,591 bytes
2025-11-21 20:06:52,188 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-21 20:06:52,189 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-21 20:06:52,189 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-21 20:06:52,190 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-21 20:06:52,190 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-21 20:06:52,190 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-21 20:06:52,190 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-21 20:06:52,191 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-21 20:06:52,191 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-21 20:06:52,191 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-21 20:06:52,192 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-21 20:06:52,192 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-21 20:06:52,193 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-21 20:06:52,193 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-21 20:06:52,194 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-21 20:06:52,194 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 20:06:52,194 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-21 20:06:52,195 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 20:06:52,195 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:06:52,196 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 20:06:52,199 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763737531_51d18b082cbe
2025-11-21 20:06:52,200 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6920800c2fcd474cc2a217a9
2025-11-21 20:06:52,202 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 20:06:52,203 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 20:06:52,203 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 20:06:52,204 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 20:06:52,204 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 20:06:52,204 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 20:06:52,205 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 20:06:52,205 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-21 20:06:52,205 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-21 20:06:52,206 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-21 20:06:52,206 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-21 20:06:52,207 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-21 20:06:52,207 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 20:06:52,207 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 20:06:52,208 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 20:06:52,208 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 20:06:52,208 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 20:06:52,208 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 20:06:52,209 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:06:52,210 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6920800c2fcd474cc2a217a9
2025-11-21 20:06:52,210 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-21 20:06:52,211 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 20:06:52,211 - app.api.routes - INFO -    Comparison ID: cmp_1763737531_51d18b082cbe
2025-11-21 20:06:52,213 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 20:06:52,214 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 20:06:52,214 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:06:52,214 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 20:06:52,214 - app.api.routes - INFO - ======================================================================
2025-11-21 20:06:52,215 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763737531_51d18b082cbe
2025-11-21 20:06:52,215 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-21 20:06:52,215 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-21 20:06:52,215 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-21 20:06:52,215 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 20:06:52,216 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:06:52,216 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:06:52,217 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 20:06:52,219 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 39
2025-11-21 20:06:52,219 - app.api.routes - INFO - ======================================================================

2025-11-21 20:06:52,220 - app.services.progress_tracker - INFO - âœ… Job completed: job_0fad1dce05f7 â†’ comparison_id: cmp_1763737531_51d18b082cbe
2025-11-21 20:06:52,222 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 80.89s
2025-11-21 20:11:55,468 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-21 20:11:55,470 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 23:09:29,677 - main - INFO - ðŸ“¥ GET /docs
2025-11-21 23:09:29,687 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.01s
2025-11-21 23:09:29,910 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-21 23:09:29,952 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.04s
2025-11-21 23:11:00,526 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 23:11:00,551 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-21 23:11:00,552 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 23:11:00,553 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 23:11:00,554 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 23:11:00,562 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 23:11:00,564 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-21 23:11:00,565 - app.api.routes - INFO -    - Remaining comparisons: 39
2025-11-21 23:11:00,565 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 23:11:00,566 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-21 23:11:00,566 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763748660_46358080c2b0
2025-11-21 23:11:00,567 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_d23524b0d531 (2 files)
2025-11-21 23:11:00,567 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_d23524b0d531
2025-11-21 23:11:00,568 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:11:00,569 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:11:00,569 - app.api.routes - INFO - ======================================================================
2025-11-21 23:11:00,571 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 758d016594584749b540794ad23156f0.pdf (331157 bytes)
2025-11-21 23:11:00,571 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:11:00,572 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:11:00,573 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\758d016594584749b540794ad23156f0.pdf
2025-11-21 23:11:00,573 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:11:00,593 - app.api.routes - INFO - ======================================================================
2025-11-21 23:11:00,636 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-21 23:11:00,636 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 8d171ecb35d747ebbf09a0dc673e55d7.pdf (464206 bytes)
2025-11-21 23:11:00,637 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:11:00,637 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:11:00,637 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\8d171ecb35d747ebbf09a0dc673e55d7.pdf
2025-11-21 23:11:00,638 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:11:00,656 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-21 23:11:00,696 - app.services.pdf_extractor - INFO - Successfully extracted 15284 characters from 7 pages
2025-11-21 23:11:00,697 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-21 23:11:00,698 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-21 23:11:00,698 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 23:11:00,699 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-21 23:11:00,816 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-21 23:11:00,816 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 23:11:00,834 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:11:00,834 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:11:00,835 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-21 23:11:00,835 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-21 23:11:00,836 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 23:11:00,836 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 23:11:00,837 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-21 23:11:01,091 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-21 23:11:01,091 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 23:11:26,866 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:11:26,878 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 23:11:26,879 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 23:11:26,881 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 23:11:26,882 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-21 23:11:26,884 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 23:11:26,885 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-21 23:11:26,893 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-21 23:11:26,894 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-21 23:11:26,896 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 23:11:33,343 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:11:33,348 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 23:11:33,349 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 23:11:33,350 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-21 23:11:33,352 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-21 23:11:33,353 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 23:11:33,354 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 23:11:33,355 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-21 23:11:39,077 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:11:39,086 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-21 23:11:39,087 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 23:11:39,089 - app.services.ai_parser - INFO - 
2025-11-21 23:11:39,090 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:11:39,091 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:11:39,093 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:11:39,097 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-21 23:11:39,098 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 23:11:39,099 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-21 23:11:39,100 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-21 23:11:39,100 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-21 23:11:39,101 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-21 23:11:39,101 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 23:11:39,102 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 23:11:39,103 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 23:11:39,103 - app.services.ai_parser - INFO - 
2025-11-21 23:11:39,104 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 23:11:39,104 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-21 23:11:39,104 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-21 23:11:39,105 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-21 23:11:39,105 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 23:11:39,106 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 23:11:39,106 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:11:39,112 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 8d171ecb35d747ebbf09a0dc673e55d7.pdf â†’ 6920ab5bf77930ca79fe5d34
2025-11-21 23:11:39,112 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920ab5bf77930ca79fe5d34
2025-11-21 23:11:39,121 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 6920ab5bf77930ca79fe5d35 (464206 bytes)
2025-11-21 23:11:39,122 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 6920ab5bf77930ca79fe5d35
2025-11-21 23:11:39,122 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:11:43,294 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:11:43,300 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 23:11:43,302 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 23:11:43,303 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 23:11:43,304 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 23:11:47,907 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:11:47,912 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 23:11:47,915 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 23:11:47,916 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-21 23:11:47,918 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-21 23:11:47,918 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 23:11:47,918 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 23:11:47,919 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 23:11:47,920 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-21 23:11:47,921 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 23:11:47,921 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-21 23:11:59,426 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:11:59,435 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-21 23:11:59,437 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 23:11:59,438 - app.services.ai_parser - INFO - 
2025-11-21 23:11:59,439 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:11:59,440 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:11:59,441 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:11:59,442 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-21 23:11:59,443 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-21 23:11:59,444 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-21 23:11:59,445 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-21 23:11:59,446 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-21 23:11:59,448 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-21 23:11:59,449 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-21 23:11:59,450 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-21 23:11:59,451 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-21 23:11:59,452 - app.services.ai_parser - INFO - 
2025-11-21 23:11:59,452 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 23:11:59,453 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-21 23:11:59,455 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-21 23:11:59,456 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-21 23:11:59,457 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 23:11:59,457 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 23:11:59,458 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:11:59,460 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 758d016594584749b540794ad23156f0.pdf â†’ 6920ab6ff77930ca79fe5d36
2025-11-21 23:11:59,461 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920ab6ff77930ca79fe5d36
2025-11-21 23:11:59,466 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 6920ab6ff77930ca79fe5d37 (331157 bytes)
2025-11-21 23:11:59,467 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 6920ab6ff77930ca79fe5d37
2025-11-21 23:11:59,467 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:11:59,468 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-21 23:11:59,469 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:11:59,469 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-21 23:11:59,470 - app.api.routes - INFO - ======================================================================
2025-11-21 23:11:59,470 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-21 23:11:59,470 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-21 23:11:59,471 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-21 23:11:59,471 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 23:11:59,472 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-21 23:11:59,472 - app.services.ai_ranker - INFO - ================================================================================
2025-11-21 23:11:59,472 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 23:11:59,472 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-21 23:11:59,473 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 23:11:59,473 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 23:11:59,473 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:11:59,474 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 23:11:59,474 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 23:11:59,474 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-21 23:11:59,475 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 23:11:59,475 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 23:11:59,475 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 23:11:59,475 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 23:11:59,476 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.0,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "SAMA/IA minimum deductibles",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "burglary_clause": "Limited to SR 5,000,000 in aggregate",
    "underground_services": "up to SR 500,000 any one occurrence & in aggreg
2025-11-21 23:11:59,478 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 23:11:59,479 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-21 23:11:59,479 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-21 23:11:59,479 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 23:11:59,480 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 23:11:59,481 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 23:11:59,482 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 23:11:59,482 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 23:11:59,482 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 23:11:59,483 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 23:11:59,483 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 23:11:59,483 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 23:11:59,484 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 23:11:59,484 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 23:11:59,484 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 23:11:59,485 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 23:11:59,485 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-21 23:11:59,485 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 23:11:59,486 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-21 23:11:59,486 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-21 23:11:59,486 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-21 23:11:59,487 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 23:11:59,487 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-21 23:11:59,487 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-21 23:11:59,488 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 23:11:59,488 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-21 23:11:59,488 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 23:11:59,488 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 23:11:59,489 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:11:59,489 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 23:11:59,489 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 23:11:59,490 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension', 'Professional Valuation Report required for properties with total Sum Insured exceeding SR40m'], 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers'], 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']}
2025-11-21 23:11:59,490 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 23:11:59,491 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 23:11:59,491 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 23:11:59,491 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 23:11:59,491 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SR 1,564,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40,000,000",
        "deductible": "5% of claim amount (nil minimum if Sum Insured < SR 1,000,000, min SR 50,000 if SR 1,000,000 to SR 40,000,000)",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40,000,001 to SR 100,000,000",
        "deductible": "5% of claim amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100,000,001 to SR 500,000,000",
        "deductible": "5% of claim amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500,000,000",
        "deductible": "5% 
2025-11-21 23:11:59,493 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-21 23:11:59,493 - app.services.ai_ranker - INFO -    âœ… Found 2 items in key 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers']
2025-11-21 23:11:59,494 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']
2025-11-21 23:11:59,494 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 23:11:59,494 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 23:11:59,495 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 23:11:59,495 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 23:11:59,495 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 23:11:59,496 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 23:11:59,497 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 23:11:59,498 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 23:11:59,498 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 23:11:59,499 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 23:11:59,499 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 23:11:59,500 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 23:11:59,500 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 23:11:59,500 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 9
2025-11-21 23:11:59,501 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-21 23:11:59,501 - app.services.ai_ranker - INFO -    âœ… Extracted 9 subjectivities for Liva Insurance
2025-11-21 23:11:59,501 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-21 23:11:59,502 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-21 23:11:59,502 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 23:11:59,503 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-21 23:11:59,503 - app.services.ai_ranker - INFO -    Subjectivities: 9
2025-11-21 23:11:59,503 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-21 23:11:59,652 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-21 23:11:59,652 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 23:11:59,653 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 23:11:59,653 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-21 23:11:59,653 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 23:11:59,653 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-21 23:11:59,654 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-21 23:11:59,654 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-21 23:11:59,812 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-21 23:11:59,812 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 23:11:59,812 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 23:11:59,813 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 9
2025-11-21 23:11:59,813 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 23:11:59,813 - app.services.ai_ranker - INFO -       â€¢ Warranted valid civil defense certificates during the currency of the policy
2025-11-21 23:11:59,814 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-21 23:11:59,814 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 23:11:59,814 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-21 23:11:59,815 - app.services.ai_ranker - INFO - ================================================================================

2025-11-21 23:11:59,815 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=88.12
2025-11-21 23:11:59,816 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=84.79
2025-11-21 23:11:59,816 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-21 23:11:59,816 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-21 23:12:58,088 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:12:58,093 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-21 23:12:58,094 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-21 23:12:58,095 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-21 23:12:58,099 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-21 23:12:58,100 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 23:12:58,101 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763748660_46358080c2b0
2025-11-21 23:12:58,103 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-21 23:12:58,107 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 23:12:58,108 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-21 23:12:58,108 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-21 23:12:58,108 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 23:12:58,109 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 23:12:58,109 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 23:12:58,109 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 23:12:58,110 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 23:12:58,110 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 23:12:58,110 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-21 23:12:58,111 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 23:12:58,111 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 23:12:58,111 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 23:12:58,112 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 23:12:58,112 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 23:12:58,112 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 23:12:58,114 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 23:12:58,115 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,256 bytes
2025-11-21 23:12:58,115 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 22,193 bytes
2025-11-21 23:12:58,115 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,884 bytes
2025-11-21 23:12:58,116 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,446 bytes
2025-11-21 23:12:58,116 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 29,286 bytes
2025-11-21 23:12:58,116 - app.services.mongodb_service_enhanced - INFO -    Total document: 139,283 bytes
2025-11-21 23:12:58,117 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-21 23:12:58,117 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-21 23:12:58,117 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-21 23:12:58,117 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-21 23:12:58,118 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-21 23:12:58,118 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-21 23:12:58,119 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-21 23:12:58,120 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-21 23:12:58,120 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-21 23:12:58,121 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-21 23:12:58,122 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-21 23:12:58,122 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-21 23:12:58,122 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-21 23:12:58,123 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-21 23:12:58,123 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-21 23:12:58,123 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 23:12:58,124 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-21 23:12:58,124 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 23:12:58,124 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:12:58,125 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 23:12:58,128 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763748660_46358080c2b0
2025-11-21 23:12:58,129 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6920abaa2fcd474cc2a217aa
2025-11-21 23:12:58,131 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 23:12:58,131 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 23:12:58,132 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 23:12:58,132 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 23:12:58,132 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 23:12:58,133 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 23:12:58,133 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 23:12:58,133 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-21 23:12:58,134 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-21 23:12:58,134 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-21 23:12:58,134 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-21 23:12:58,135 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-21 23:12:58,135 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 23:12:58,135 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 23:12:58,136 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 23:12:58,136 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 23:12:58,137 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 23:12:58,138 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 23:12:58,138 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:12:58,139 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6920abaa2fcd474cc2a217aa
2025-11-21 23:12:58,139 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-21 23:12:58,140 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 23:12:58,140 - app.api.routes - INFO -    Comparison ID: cmp_1763748660_46358080c2b0
2025-11-21 23:12:58,142 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 23:12:58,143 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 23:12:58,143 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:12:58,143 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 23:12:58,144 - app.api.routes - INFO - ======================================================================
2025-11-21 23:12:58,144 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763748660_46358080c2b0
2025-11-21 23:12:58,144 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-21 23:12:58,145 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-21 23:12:58,145 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-21 23:12:58,145 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 23:12:58,146 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 23:12:58,146 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 23:12:58,147 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 23:12:58,149 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 38
2025-11-21 23:12:58,149 - app.api.routes - INFO - ======================================================================

2025-11-21 23:12:58,150 - app.services.progress_tracker - INFO - âœ… Job completed: job_d23524b0d531 â†’ comparison_id: cmp_1763748660_46358080c2b0
2025-11-21 23:12:58,152 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 117.63s
2025-11-21 23:22:20,610 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-21 23:22:20,612 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 23:51:20,945 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 23:51:20,948 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 23:51:20,950 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.01s
2025-11-21 23:51:20,958 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.01s
2025-11-21 23:51:20,975 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 23:51:20,982 - app.services.user_documents_service - INFO - ðŸ“‹ Found 12 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 23:51:20,983 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.01s
2025-11-21 23:51:20,990 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 23:51:20,993 - app.services.user_documents_service - INFO - ðŸ“‹ Found 12 documents for user 691cd2d361d4fb6ef0028740
2025-11-21 23:51:20,994 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 23:51:30,110 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-21 23:51:30,110 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-21 23:51:30,113 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 23:51:30,118 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691cd2d361d4fb6ef0028740
2025-11-21 23:51:30,118 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 23:51:30,119 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 23:51:30,119 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 23:51:30,120 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 23:51:30,121 - app.api.routes - INFO - âœ… User 691cd2d361d4fb6ef0028740 can perform comparison
2025-11-21 23:51:30,122 - app.api.routes - INFO -    - Remaining comparisons: 38
2025-11-21 23:51:30,124 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 23:51:30,125 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-21 23:51:30,125 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763751090_563ad31efd51
2025-11-21 23:51:30,126 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_c67e733d528a (2 files)
2025-11-21 23:51:30,126 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_c67e733d528a
2025-11-21 23:51:30,127 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:51:30,127 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:51:30,127 - app.api.routes - INFO - ======================================================================
2025-11-21 23:51:30,129 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Liva.pdf â†’ 9a8c487291984304a845aaea90171d11.pdf (331157 bytes)
2025-11-21 23:51:30,131 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:51:30,131 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:51:30,134 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:51:30,135 - app.api.routes - INFO - ======================================================================
2025-11-21 23:51:30,132 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\9a8c487291984304a845aaea90171d11.pdf
2025-11-21 23:51:30,137 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya.pdf â†’ d2d91ac6bc75480992eba20b447539a5.pdf (464206 bytes)
2025-11-21 23:51:30,199 - app.services.pdf_extractor - INFO - Successfully extracted 18308 characters from 8 pages
2025-11-21 23:51:30,199 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:51:30,201 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:51:30,202 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\d2d91ac6bc75480992eba20b447539a5.pdf
2025-11-21 23:51:30,202 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:51:30,203 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Liva Insurance (pattern: \bliva\b)
2025-11-21 23:51:30,244 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Liva Insurance
2025-11-21 23:51:30,264 - app.services.pdf_extractor - INFO - Successfully extracted 15284 characters from 7 pages
2025-11-21 23:51:30,264 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): No.  Description
2025-11-21 23:51:30,264 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 23:51:30,265 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-21 23:51:30,385 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-21 23:51:30,385 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 23:51:30,390 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:51:30,391 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:51:30,391 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-21 23:51:30,391 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-21 23:51:30,392 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 23:51:30,393 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 23:51:30,393 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-21 23:51:30,655 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-21 23:51:30,655 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 23:51:52,567 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:51:52,571 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 23:51:52,572 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 23:51:52,572 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 23:51:52,573 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-21 23:51:52,573 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 23:51:52,573 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-21 23:51:52,577 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-21 23:51:52,578 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-21 23:51:52,578 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 23:51:59,086 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:51:59,090 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 23:51:59,091 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 23:51:59,092 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-21 23:51:59,092 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-21 23:51:59,092 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 23:51:59,093 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 23:51:59,093 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-21 23:52:04,852 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:52:04,854 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-21 23:52:04,854 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 23:52:04,854 - app.services.ai_parser - INFO - 
2025-11-21 23:52:04,855 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:52:04,855 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:52:04,855 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:52:04,856 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-21 23:52:04,856 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 23:52:04,856 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-21 23:52:04,857 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-21 23:52:04,857 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-21 23:52:04,858 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-21 23:52:04,858 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 23:52:04,859 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 23:52:04,859 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 23:52:04,860 - app.services.ai_parser - INFO - 
2025-11-21 23:52:04,860 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 23:52:04,861 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-21 23:52:04,861 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-21 23:52:04,861 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-21 23:52:04,862 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 23:52:04,862 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 23:52:04,862 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:52:04,864 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: d2d91ac6bc75480992eba20b447539a5.pdf â†’ 6920b4d4f77930ca79fe5d38
2025-11-21 23:52:04,865 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920b4d4f77930ca79fe5d38
2025-11-21 23:52:04,871 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 6920b4d4f77930ca79fe5d39 (464206 bytes)
2025-11-21 23:52:04,871 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya.pdf â†’ 6920b4d4f77930ca79fe5d39
2025-11-21 23:52:04,871 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya.pdf
2025-11-21 23:52:17,638 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:52:17,644 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 23:52:17,645 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 23:52:17,646 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 23:52:17,647 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 23:52:28,069 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:52:28,076 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 23:52:28,076 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 23:52:28,077 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.379%o on Total Sum insured of SAR 1,564,652,306.28' â†’ '0.379â€°'
2025-11-21 23:52:28,077 - app.services.ai_parser - INFO - ðŸ’° Calculated: 593003.22 from SI: 1564652306.28 Ã— Rate: 0.379%o on Total Sum insured of SAR 1,564,652,306.28
2025-11-21 23:52:28,077 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 23:52:28,078 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 23:52:28,078 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 23:52:28,078 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-21 23:52:28,079 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 23:52:28,079 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 26 exclusions, 12 warranties, 5 extensions
2025-11-21 23:52:32,665 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:52:32,670 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-21 23:52:32,671 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 23:52:32,671 - app.services.ai_parser - INFO - 
2025-11-21 23:52:32,672 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:52:32,673 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:52:32,674 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:52:32,675 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-21 23:52:32,676 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: No.  Description
2025-11-21 23:52:32,676 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 593,003.00
2025-11-21 23:52:32,677 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.379â€°
2025-11-21 23:52:32,677 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-21 23:52:32,678 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-21 23:52:32,678 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, min SR 1,500,000
2025-11-21 23:52:32,679 - app.services.ai_parser - INFO - â° Validity: 15 days from date of indication
2025-11-21 23:52:32,679 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-21 23:52:32,680 - app.services.ai_parser - INFO - 
2025-11-21 23:52:32,680 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 23:52:32,680 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-21 23:52:32,681 - app.services.ai_parser - INFO -    âœ“ Exclusions: 26
2025-11-21 23:52:32,681 - app.services.ai_parser - INFO -    âœ“ Warranties: 12
2025-11-21 23:52:32,686 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 23:52:32,686 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 23:52:32,686 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 23:52:32,688 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 9a8c487291984304a845aaea90171d11.pdf â†’ 6920b4f0f77930ca79fe5d3a
2025-11-21 23:52:32,691 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920b4f0f77930ca79fe5d3a
2025-11-21 23:52:32,695 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 6920b4f0f77930ca79fe5d3b (331157 bytes)
2025-11-21 23:52:32,695 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Liva.pdf â†’ 6920b4f0f77930ca79fe5d3b
2025-11-21 23:52:32,695 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Liva.pdf
2025-11-21 23:52:32,696 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-21 23:52:32,696 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:52:32,697 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-21 23:52:32,697 - app.api.routes - INFO - ======================================================================
2025-11-21 23:52:32,697 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-21 23:52:32,697 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-21 23:52:32,698 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-21 23:52:32,698 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 23:52:32,698 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-21 23:52:32,698 - app.services.ai_ranker - INFO - ================================================================================
2025-11-21 23:52:32,699 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 23:52:32,699 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-21 23:52:32,700 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 23:52:32,701 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 23:52:32,701 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:52:32,702 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 23:52:32,703 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 23:52:32,703 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-21 23:52:32,704 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 23:52:32,704 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 23:52:32,704 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 23:52:32,705 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 23:52:32,706 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "Minimization of losses": "SR 250,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Industries Seepage, Pollution and
2025-11-21 23:52:32,709 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 23:52:32,709 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-21 23:52:32,709 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-21 23:52:32,710 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 23:52:32,710 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 23:52:32,711 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 23:52:32,711 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 23:52:32,711 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 23:52:32,712 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 23:52:32,712 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 23:52:32,712 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 23:52:32,712 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 23:52:32,713 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 23:52:32,713 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 23:52:32,713 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 23:52:32,713 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 23:52:32,714 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-21 23:52:32,714 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 23:52:32,714 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-21 23:52:32,715 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-21 23:52:32,715 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-21 23:52:32,715 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 23:52:32,716 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-21 23:52:32,716 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-21 23:52:32,717 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 23:52:32,718 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-21 23:52:32,719 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 23:52:32,719 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 23:52:32,720 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:52:32,720 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 23:52:32,720 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 23:52:32,721 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension', 'Professional Valuation Report required for properties with total Sum Insured exceeding SR40m'], 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers'], 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']}
2025-11-21 23:52:32,722 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 23:52:32,722 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 23:52:32,723 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 23:52:32,723 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 23:52:32,724 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "1,564,652,306.28",
    "business_interruption": "650,000,000.00",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40,000,000",
        "deductible": "5% of claim amount (nil minimum if Sum Insured < SR 1,000,000, min SR 50,000 if SR 1,000,000 to SR 40,000,000)",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40,000,001 to SR 100,000,000",
        "deductible": "5% of claim amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100,000,001 to SR 500,000,000",
        "deductible": "5% of claim amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500,000,001",
        "deductible": "5% 
2025-11-21 23:52:32,727 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-21 23:52:32,728 - app.services.ai_ranker - INFO -    âœ… Found 2 items in key 'conditions_precedent': ['No cover given if without business contingency plan', 'No cover given if unable to provide names of Public Utilities/Service Providers']
2025-11-21 23:52:32,728 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'documentation_required': ['Detailed lists of items covered under gross profit for BI', 'Breakdown of Sum Insured into major components', 'Full description of all stock insured for warehouses']
2025-11-21 23:52:32,728 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 23:52:32,729 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 23:52:32,729 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 23:52:32,729 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 23:52:32,730 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 23:52:32,730 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 23:52:32,730 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 23:52:32,764 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 23:52:32,764 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 23:52:32,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 23:52:32,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 23:52:32,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 23:52:32,773 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 23:52:32,809 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 9
2025-11-21 23:52:32,824 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Business contingency plan required for BI with sum insured SR20m and above', 'Names of Suppliers and Customers required for BI with Suppliers and Customers Extension', 'Names of Public Utilities/Service Providers required for BI with Public Utilities Extension']
2025-11-21 23:52:32,825 - app.services.ai_ranker - INFO -    âœ… Extracted 9 subjectivities for Liva Insurance
2025-11-21 23:52:32,826 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-21 23:52:32,827 - app.services.ai_ranker - INFO -    Warranties: 12
2025-11-21 23:52:32,827 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 23:52:32,828 - app.services.ai_ranker - INFO -    Exclusions: 26
2025-11-21 23:52:32,828 - app.services.ai_ranker - INFO -    Subjectivities: 9
2025-11-21 23:52:32,828 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-21 23:52:32,997 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-21 23:52:32,997 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 23:52:32,997 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 23:52:32,998 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-21 23:52:32,998 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 23:52:32,998 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-21 23:52:32,999 - app.services.ai_ranker - INFO -       â€¢ (W2) Waste warranty
2025-11-21 23:52:32,999 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-21 23:52:33,169 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-21 23:52:33,169 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 23:52:33,169 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 23:52:33,170 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 9
2025-11-21 23:52:33,170 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 23:52:33,170 - app.services.ai_ranker - INFO -       â€¢ Warranted valid civil defense certificates during the currency of the policy
2025-11-21 23:52:33,170 - app.services.ai_ranker - INFO -       â€¢ Warranted that the insured to implement all risk recommendations within the give...
2025-11-21 23:52:33,171 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 23:52:33,171 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-21 23:52:33,171 - app.services.ai_ranker - INFO - ================================================================================

2025-11-21 23:52:33,172 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=88.12
2025-11-21 23:52:33,172 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=84.79
2025-11-21 23:52:33,172 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-21 23:52:33,173 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-21 23:52:43,664 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 23:52:43,671 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-21 23:52:43,672 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-21 23:52:43,673 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-21 23:52:43,674 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-21 23:52:43,675 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 23:52:43,675 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763751090_563ad31efd51
2025-11-21 23:52:43,676 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-21 23:52:43,676 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 23:52:43,677 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-21 23:52:43,677 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-21 23:52:43,677 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 23:52:43,677 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 23:52:43,678 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 23:52:43,678 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 23:52:43,679 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 23:52:43,679 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 23:52:43,680 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-21 23:52:43,680 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 23:52:43,681 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 23:52:43,681 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 23:52:43,681 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 23:52:43,682 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 23:52:43,682 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 23:52:43,685 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 23:52:43,686 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,270 bytes
2025-11-21 23:52:43,686 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 22,372 bytes
2025-11-21 23:52:43,687 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,939 bytes
2025-11-21 23:52:43,687 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,446 bytes
2025-11-21 23:52:43,688 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 29,402 bytes
2025-11-21 23:52:43,688 - app.services.mongodb_service_enhanced - INFO -    Total document: 140,039 bytes
2025-11-21 23:52:43,688 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-21 23:52:43,689 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-21 23:52:43,689 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-21 23:52:43,689 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-21 23:52:43,690 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-21 23:52:43,690 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-21 23:52:43,690 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-21 23:52:43,690 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-21 23:52:43,692 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-21 23:52:43,693 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-21 23:52:43,694 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-21 23:52:43,694 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-21 23:52:43,695 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-21 23:52:43,695 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-21 23:52:43,695 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-21 23:52:43,696 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 23:52:43,696 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-21 23:52:43,696 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 23:52:43,697 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:52:43,698 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 23:52:43,702 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763751090_563ad31efd51
2025-11-21 23:52:43,703 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6920b4fb2fcd474cc2a217ab
2025-11-21 23:52:43,705 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 23:52:43,706 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 23:52:43,706 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 23:52:43,707 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 23:52:43,707 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 23:52:43,708 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 23:52:43,708 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 23:52:43,708 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-21 23:52:43,709 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-21 23:52:43,710 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-21 23:52:43,710 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-21 23:52:43,711 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-21 23:52:43,711 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 23:52:43,711 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 23:52:43,712 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 23:52:43,712 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 23:52:43,713 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 23:52:43,713 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 23:52:43,713 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 23:52:43,714 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6920b4fb2fcd474cc2a217ab
2025-11-21 23:52:43,714 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-21 23:52:43,714 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 23:52:43,714 - app.api.routes - INFO -    Comparison ID: cmp_1763751090_563ad31efd51
2025-11-21 23:52:43,718 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 23:52:43,718 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691cd2d361d4fb6ef0028740
2025-11-21 23:52:43,719 - app.api.routes - INFO - 
======================================================================
2025-11-21 23:52:43,719 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 23:52:43,720 - app.api.routes - INFO - ======================================================================
2025-11-21 23:52:43,720 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763751090_563ad31efd51
2025-11-21 23:52:43,720 - app.api.routes - INFO - ðŸ‘¤ User ID: 691cd2d361d4fb6ef0028740
2025-11-21 23:52:43,721 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-21 23:52:43,721 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-21 23:52:43,721 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691cd2d361d4fb6ef0028740
2025-11-21 23:52:43,722 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 23:52:43,723 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 23:52:43,725 - app.services.user_subscription_service - INFO - âœ… Found user: wasay (wasay7757@gmail.com)
2025-11-21 23:52:43,727 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 37
2025-11-21 23:52:43,727 - app.api.routes - INFO - ======================================================================

2025-11-21 23:52:43,727 - app.services.progress_tracker - INFO - âœ… Job completed: job_c67e733d528a â†’ comparison_id: cmp_1763751090_563ad31efd51
2025-11-21 23:52:43,729 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 73.62s
2025-11-22 00:02:20,669 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-22 00:02:20,670 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 20:06:20,570 - main - INFO - 
2025-11-21 20:06:20,570 - main - INFO - ================================================================================
2025-11-21 20:06:20,570 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:06:20,570 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:06:20,571 - main - INFO - ================================================================================
2025-11-21 20:06:20,571 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:06:20,571 - main - INFO -   Upload Directory: uploads
2025-11-21 20:06:20,571 - main - INFO -   Max File Size: 20MB
2025-11-21 20:06:20,571 - main - INFO - ================================================================================
2025-11-21 20:06:20,572 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:06:20,572 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:06:20,572 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:06:20,937 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:06:20,942 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:06:20,942 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:06:20,942 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:06:20,943 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:06:20,943 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:06:20,943 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:06:20,944 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:06:20,951 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:06:20,952 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:06:20,955 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'users']
2025-11-21 20:06:20,983 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 3 documents
2025-11-21 20:06:20,983 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:06:20,984 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:06:20,984 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:06:20,984 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:06:21,010 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:06:21,011 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:06:21,011 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:06:21,011 - main - INFO - 
2025-11-21 20:06:21,011 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:06:21,012 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:06:21,012 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:06:21,012 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:06:21,012 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:06:21,013 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:06:21,013 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:06:21,013 - main - INFO - 
2025-11-21 20:06:21,013 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:06:21,014 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:06:21,014 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:06:21,014 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:06:21,014 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:06:21,015 - main - INFO - 
2025-11-21 20:06:21,015 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:06:21,015 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:06:21,016 - main - INFO -        - No manual section generation
2025-11-21 20:06:21,016 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:06:21,016 - main - INFO - 
2025-11-21 20:06:21,016 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:06:21,016 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:06:21,017 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:06:21,017 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:06:21,017 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:06:21,017 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:06:21,018 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:06:21,018 - main - INFO - 
2025-11-21 20:06:21,018 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:06:21,018 - main - INFO -      Main:
2025-11-21 20:06:21,019 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:06:21,019 - main - INFO - 
2025-11-21 20:06:21,019 - main - INFO -      Retrieval:
2025-11-21 20:06:21,019 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:06:21,020 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:06:21,020 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:06:21,021 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:06:21,021 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:06:21,022 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:06:21,022 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:06:21,023 - main - INFO - 
2025-11-21 20:06:21,023 - main - INFO -      Management:
2025-11-21 20:06:21,023 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:06:21,024 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:06:21,024 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:06:21,024 - main - INFO - 
2025-11-21 20:06:21,024 - main - INFO -      Documents (MongoDB):
2025-11-21 20:06:21,025 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:06:21,025 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:06:21,026 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:06:21,029 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:06:21,030 - main - INFO - 
2025-11-21 20:06:21,030 - main - INFO -      Diagnostics & Health:
2025-11-21 20:06:21,031 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:06:21,031 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:06:21,031 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:06:21,031 - main - INFO - 
2025-11-21 20:06:21,032 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:06:21,032 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:06:21,032 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:06:21,032 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:06:21,033 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:06:21,033 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:06:21,033 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:06:21,033 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:06:21,034 - main - INFO - 
2025-11-21 20:06:21,034 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:06:21,034 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:06:21,034 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:06:21,035 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:06:21,035 - main - INFO -      4. No re-upload needed!
2025-11-21 20:06:21,035 - main - INFO - 
2025-11-21 20:06:21,035 - main - INFO - ================================================================================
2025-11-21 20:06:21,035 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:06:21,036 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:06:21,036 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:06:21,036 - main - INFO - ================================================================================
2025-11-21 20:06:21,037 - main - INFO - 
2025-11-21 20:06:21,037 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:08:27,272 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-21 20:08:27,273 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-21 20:08:27,278 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 20:08:27,286 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 6920c66c9cae7cc174116244
2025-11-21 20:08:27,287 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 6920c66c9cae7cc174116244
2025-11-21 20:08:27,288 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:08:27,289 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:08:27,292 - app.services.user_subscription_service - INFO - âœ… Found user: muneebalianwar69 (anwar202@gmail.com)
2025-11-21 20:08:27,293 - app.api.routes - WARNING - âŒ Comparison not allowed for user 6920c66c9cae7cc174116244: Account is pending activation. Please upload payment proof and wait for admin approval.
2025-11-21 20:08:27,294 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 403 - 0.02s
2025-11-21 20:11:51,115 - main - INFO - 
2025-11-21 20:11:51,115 - main - INFO - ================================================================================
2025-11-21 20:11:51,116 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:11:51,116 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:11:51,116 - main - INFO - ================================================================================
2025-11-21 20:11:51,116 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:11:51,116 - main - INFO -   Upload Directory: uploads
2025-11-21 20:11:51,116 - main - INFO -   Max File Size: 20MB
2025-11-21 20:11:51,117 - main - INFO - ================================================================================
2025-11-21 20:11:51,117 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:11:51,117 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:11:51,118 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:11:51,668 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:11:51,676 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:11:51,677 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:11:51,678 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:11:51,678 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:11:51,678 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:11:51,678 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:11:51,679 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:11:51,702 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:11:51,704 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:11:51,707 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'users']
2025-11-21 20:11:51,709 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:11:51,709 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:11:51,710 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:11:51,710 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:11:51,710 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:11:51,741 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:11:51,741 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:11:51,742 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:11:51,742 - main - INFO - 
2025-11-21 20:11:51,742 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:11:51,742 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:11:51,742 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:11:51,743 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:11:51,743 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:11:51,743 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:11:51,743 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:11:51,744 - main - INFO - 
2025-11-21 20:11:51,744 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:11:51,744 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:11:51,744 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:11:51,744 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:11:51,745 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:11:51,745 - main - INFO - 
2025-11-21 20:11:51,745 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:11:51,745 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:11:51,746 - main - INFO -        - No manual section generation
2025-11-21 20:11:51,746 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:11:51,746 - main - INFO - 
2025-11-21 20:11:51,746 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:11:51,747 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:11:51,747 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:11:51,747 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:11:51,747 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:11:51,748 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:11:51,748 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:11:51,748 - main - INFO - 
2025-11-21 20:11:51,748 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:11:51,748 - main - INFO -      Main:
2025-11-21 20:11:51,749 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:11:51,749 - main - INFO - 
2025-11-21 20:11:51,749 - main - INFO -      Retrieval:
2025-11-21 20:11:51,749 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:11:51,750 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:11:51,750 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:11:51,750 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:11:51,751 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:11:51,751 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:11:51,751 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:11:51,752 - main - INFO - 
2025-11-21 20:11:51,752 - main - INFO -      Management:
2025-11-21 20:11:51,752 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:11:51,753 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:11:51,753 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:11:51,753 - main - INFO - 
2025-11-21 20:11:51,753 - main - INFO -      Documents (MongoDB):
2025-11-21 20:11:51,754 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:11:51,755 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:11:51,756 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:11:51,757 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:11:51,757 - main - INFO - 
2025-11-21 20:11:51,757 - main - INFO -      Diagnostics & Health:
2025-11-21 20:11:51,757 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:11:51,758 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:11:51,758 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:11:51,758 - main - INFO - 
2025-11-21 20:11:51,758 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:11:51,759 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:11:51,759 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:11:51,759 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:11:51,759 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:11:51,759 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:11:51,759 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:11:51,760 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:11:51,760 - main - INFO - 
2025-11-21 20:11:51,760 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:11:51,760 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:11:51,760 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:11:51,761 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:11:51,761 - main - INFO -      4. No re-upload needed!
2025-11-21 20:11:51,761 - main - INFO - 
2025-11-21 20:11:51,761 - main - INFO - ================================================================================
2025-11-21 20:11:51,761 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:11:51,761 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:11:51,762 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:11:51,762 - main - INFO - ================================================================================
2025-11-21 20:11:51,762 - main - INFO - 
2025-11-21 20:11:51,762 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:23:11,196 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-21 20:23:11,197 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-21 20:23:11,201 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 20:23:11,207 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 6920c66c9cae7cc174116244
2025-11-21 20:23:11,207 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 6920c66c9cae7cc174116244
2025-11-21 20:23:11,207 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:23:11,208 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:23:11,212 - app.services.user_subscription_service - INFO - âœ… Found user: muneebalianwar69 (anwar202@gmail.com)
2025-11-21 20:23:11,213 - app.api.routes - INFO - âœ… User 6920c66c9cae7cc174116244 can perform comparison
2025-11-21 20:23:11,214 - app.api.routes - INFO -    - Remaining comparisons: 250
2025-11-21 20:23:11,214 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 20:23:11,214 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-21 20:23:11,215 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763756591_f905cb815527
2025-11-21 20:23:11,217 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_724d3569b9ac (1 files)
2025-11-21 20:23:11,217 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_724d3569b9ac
2025-11-21 20:23:11,218 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:23:11,219 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:23:11,219 - app.api.routes - INFO - ======================================================================
2025-11-21 20:23:11,220 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ c6bfe9d49a3b40f19fe8ff9b11c8c304.pdf (464206 bytes)
2025-11-21 20:23:11,221 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:23:11,223 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\c6bfe9d49a3b40f19fe8ff9b11c8c304.pdf
2025-11-21 20:23:11,406 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-21 20:23:11,407 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:23:11,408 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:23:11,410 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-21 20:23:11,411 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-21 20:23:11,411 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 20:23:11,411 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 20:23:11,412 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-21 20:23:11,582 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-21 20:23:11,583 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 20:23:33,867 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:23:33,889 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 20:23:33,889 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 20:23:33,890 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 20:23:33,891 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-21 20:23:33,892 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:23:33,892 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-21 20:23:33,901 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-21 20:23:33,901 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-21 20:23:33,902 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 20:23:40,652 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:23:40,657 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 20:23:40,658 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 20:23:40,660 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-21 20:23:40,661 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-21 20:23:40,662 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:23:40,663 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 20:23:40,664 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-21 20:23:46,966 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:23:46,969 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-21 20:23:46,970 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 20:23:46,970 - app.services.ai_parser - INFO - 
2025-11-21 20:23:46,972 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:23:46,973 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:23:46,975 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:23:46,976 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-21 20:23:46,976 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 20:23:46,976 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-21 20:23:46,977 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-21 20:23:46,977 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-21 20:23:46,977 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-21 20:23:46,977 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:23:46,978 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 20:23:46,979 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 20:23:46,980 - app.services.ai_parser - INFO - 
2025-11-21 20:23:46,980 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 20:23:46,980 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-21 20:23:46,981 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-21 20:23:46,981 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-21 20:23:46,982 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 20:23:46,982 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 20:23:46,982 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:23:46,984 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: c6bfe9d49a3b40f19fe8ff9b11c8c304.pdf â†’ 6920ca529ea8f053657b3e6c
2025-11-21 20:23:46,984 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920ca529ea8f053657b3e6c
2025-11-21 20:23:46,988 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 6920ca529ea8f053657b3e6d (464206 bytes)
2025-11-21 20:23:46,989 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 6920ca529ea8f053657b3e6d
2025-11-21 20:23:46,990 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:23:46,991 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-21 20:23:46,992 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:23:46,992 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-21 20:23:46,993 - app.api.routes - INFO - ======================================================================
2025-11-21 20:23:46,993 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 20:23:46,993 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763756591_f905cb815527
2025-11-21 20:23:46,994 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-21 20:23:46,994 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 20:23:46,995 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-21 20:23:46,997 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-21 20:23:46,997 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 20:23:46,997 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 20:23:46,998 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 20:23:46,998 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 20:23:46,998 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 20:23:46,999 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 20:23:47,000 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 20:23:47,001 - app.services.mongodb_service_enhanced - INFO -    Summary: 1,093 bytes
2025-11-21 20:23:47,001 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-21 20:23:47,001 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-21 20:23:47,001 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-21 20:23:47,002 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 15,122 bytes
2025-11-21 20:23:47,002 - app.services.mongodb_service_enhanced - INFO -    Total document: 34,049 bytes
2025-11-21 20:23:47,002 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 20:23:47,003 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-21 20:23:47,003 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 20:23:47,004 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:23:47,006 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 20:23:47,012 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763756591_f905cb815527
2025-11-21 20:23:47,013 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6920ca53b757af6a8efab055
2025-11-21 20:23:47,016 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 20:23:47,017 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 20:23:47,017 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 20:23:47,018 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 20:23:47,018 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 20:23:47,018 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 20:23:47,018 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 20:23:47,019 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-21 20:23:47,019 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 20:23:47,020 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 20:23:47,020 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 20:23:47,021 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 20:23:47,023 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 20:23:47,024 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 20:23:47,026 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:23:47,028 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6920ca53b757af6a8efab055
2025-11-21 20:23:47,028 - app.api.routes - INFO -    Database: insurance_comparison
2025-11-21 20:23:47,028 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 20:23:47,029 - app.api.routes - INFO -    Comparison ID: cmp_1763756591_f905cb815527
2025-11-21 20:23:47,034 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 6920c66c9cae7cc174116244
2025-11-21 20:23:47,034 - app.api.routes - INFO - âœ… Recorded comparison usage for user 6920c66c9cae7cc174116244
2025-11-21 20:23:47,035 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:23:47,036 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 20:23:47,036 - app.api.routes - INFO - ======================================================================
2025-11-21 20:23:47,037 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763756591_f905cb815527
2025-11-21 20:23:47,041 - app.api.routes - INFO - ðŸ‘¤ User ID: 6920c66c9cae7cc174116244
2025-11-21 20:23:47,043 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-21 20:23:47,044 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-21 20:23:47,045 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 6920c66c9cae7cc174116244
2025-11-21 20:23:47,046 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:23:47,046 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:23:47,049 - app.services.user_subscription_service - INFO - âœ… Found user: muneebalianwar69 (anwar202@gmail.com)
2025-11-21 20:23:47,053 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 249
2025-11-21 20:23:47,054 - app.api.routes - INFO - ======================================================================

2025-11-21 20:23:47,056 - app.services.progress_tracker - INFO - âœ… Job completed: job_724d3569b9ac â†’ comparison_id: cmp_1763756591_f905cb815527
2025-11-21 20:23:47,060 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 35.86s
2025-11-21 20:25:17,050 - main - INFO - ðŸ“¥ GET /docs
2025-11-21 20:25:17,051 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-21 20:25:17,149 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-21 20:25:17,161 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-21 20:31:21,082 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-21 20:31:21,086 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 20:38:01,764 - main - INFO - 
2025-11-21 20:38:01,765 - main - INFO - ================================================================================
2025-11-21 20:38:01,766 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:38:01,769 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:01,769 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:38:01,770 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:01,771 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:38:01,771 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:38:01,772 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:38:01,781 - main - INFO -   âœ… Cleaned up 16 temporary files
2025-11-21 20:38:01,781 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:38:01,781 - main - INFO - ================================================================================
2025-11-21 20:38:01,782 - main - INFO - 
2025-11-21 20:38:05,251 - main - INFO - 
2025-11-21 20:38:05,251 - main - INFO - ================================================================================
2025-11-21 20:38:05,251 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:38:05,252 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:38:05,252 - main - INFO - ================================================================================
2025-11-21 20:38:05,252 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:38:05,252 - main - INFO -   Upload Directory: uploads
2025-11-21 20:38:05,253 - main - INFO -   Max File Size: 20MB
2025-11-21 20:38:05,253 - main - INFO - ================================================================================
2025-11-21 20:38:05,253 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:38:05,253 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:38:05,254 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:38:05,295 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:38:05,304 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:38:05,305 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:38:05,305 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:38:05,305 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:38:05,306 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:38:05,306 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:05,307 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:38:05,338 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:38:05,340 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:38:05,342 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'users']
2025-11-21 20:38:05,347 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:38:05,348 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:38:05,348 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:38:05,349 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:05,349 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:38:05,383 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:38:05,383 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:38:05,383 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:38:05,383 - main - INFO - 
2025-11-21 20:38:05,384 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:38:05,384 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:38:05,384 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:38:05,384 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:38:05,384 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:38:05,385 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:38:05,385 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:38:05,385 - main - INFO - 
2025-11-21 20:38:05,385 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:38:05,385 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:38:05,386 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:38:05,386 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:38:05,386 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:38:05,386 - main - INFO - 
2025-11-21 20:38:05,386 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:38:05,386 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:38:05,387 - main - INFO -        - No manual section generation
2025-11-21 20:38:05,387 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:38:05,387 - main - INFO - 
2025-11-21 20:38:05,387 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:38:05,387 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:38:05,387 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:38:05,387 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:38:05,388 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:38:05,388 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:38:05,388 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:38:05,388 - main - INFO - 
2025-11-21 20:38:05,388 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:38:05,388 - main - INFO -      Main:
2025-11-21 20:38:05,389 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:38:05,389 - main - INFO - 
2025-11-21 20:38:05,389 - main - INFO -      Retrieval:
2025-11-21 20:38:05,389 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:38:05,390 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:38:05,390 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:38:05,390 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:38:05,390 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:38:05,390 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:38:05,391 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:38:05,391 - main - INFO - 
2025-11-21 20:38:05,391 - main - INFO -      Management:
2025-11-21 20:38:05,391 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:38:05,391 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:38:05,392 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:38:05,392 - main - INFO - 
2025-11-21 20:38:05,392 - main - INFO -      Documents (MongoDB):
2025-11-21 20:38:05,392 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:38:05,393 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:38:05,393 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:38:05,394 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:38:05,394 - main - INFO - 
2025-11-21 20:38:05,395 - main - INFO -      Diagnostics & Health:
2025-11-21 20:38:05,395 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:38:05,395 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:38:05,395 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:38:05,395 - main - INFO - 
2025-11-21 20:38:05,396 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:38:05,396 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:38:05,396 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:38:05,396 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:38:05,396 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:38:05,397 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:38:05,397 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:38:05,397 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:38:05,397 - main - INFO - 
2025-11-21 20:38:05,397 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:38:05,398 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:38:05,398 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:38:05,398 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:38:05,398 - main - INFO -      4. No re-upload needed!
2025-11-21 20:38:05,398 - main - INFO - 
2025-11-21 20:38:05,399 - main - INFO - ================================================================================
2025-11-21 20:38:05,399 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:38:05,399 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:38:05,399 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:38:05,400 - main - INFO - ================================================================================
2025-11-21 20:38:05,400 - main - INFO - 
2025-11-21 20:38:05,400 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:38:11,491 - main - INFO - 
2025-11-21 20:38:11,491 - main - INFO - ================================================================================
2025-11-21 20:38:11,492 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:38:11,492 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:11,493 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:38:11,493 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:11,494 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:38:11,494 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:38:11,494 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:38:11,495 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:38:11,495 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:38:11,495 - main - INFO - ================================================================================
2025-11-21 20:38:11,495 - main - INFO - 
2025-11-21 20:38:14,897 - main - INFO - 
2025-11-21 20:38:14,898 - main - INFO - ================================================================================
2025-11-21 20:38:14,898 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:38:14,899 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:38:14,899 - main - INFO - ================================================================================
2025-11-21 20:38:14,899 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:38:14,900 - main - INFO -   Upload Directory: uploads
2025-11-21 20:38:14,900 - main - INFO -   Max File Size: 20MB
2025-11-21 20:38:14,900 - main - INFO - ================================================================================
2025-11-21 20:38:14,901 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:38:14,902 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:38:14,903 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:38:14,937 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:38:14,946 - app.services.mongodb_service_enhanced - ERROR - âš ï¸  Error creating indexes: db already exists with different case already have: [hakemAI] trying to create [HAKEMAI], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [hakemAI] trying to create [HAKEMAI]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-11-21 20:38:14,946 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:38:14,947 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:38:14,947 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:38:14,947 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:38:14,947 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:14,948 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:38:14,983 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:38:14,985 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:38:14,986 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'users']
2025-11-21 20:38:14,988 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:38:14,988 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:38:14,989 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:38:14,990 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:14,990 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:38:15,001 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:38:15,001 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:38:15,001 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:38:15,001 - main - INFO - 
2025-11-21 20:38:15,002 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:38:15,002 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:38:15,002 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:38:15,002 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:38:15,002 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:38:15,003 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:38:15,003 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:38:15,003 - main - INFO - 
2025-11-21 20:38:15,003 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:38:15,003 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:38:15,004 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:38:15,004 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:38:15,004 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:38:15,004 - main - INFO - 
2025-11-21 20:38:15,005 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:38:15,005 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:38:15,005 - main - INFO -        - No manual section generation
2025-11-21 20:38:15,005 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:38:15,006 - main - INFO - 
2025-11-21 20:38:15,006 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:38:15,006 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:38:15,007 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:38:15,007 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:38:15,007 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:38:15,007 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:38:15,007 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:38:15,008 - main - INFO - 
2025-11-21 20:38:15,008 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:38:15,008 - main - INFO -      Main:
2025-11-21 20:38:15,009 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:38:15,010 - main - INFO - 
2025-11-21 20:38:15,011 - main - INFO -      Retrieval:
2025-11-21 20:38:15,012 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:38:15,013 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:38:15,013 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:38:15,014 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:38:15,014 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:38:15,014 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:38:15,014 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:38:15,014 - main - INFO - 
2025-11-21 20:38:15,015 - main - INFO -      Management:
2025-11-21 20:38:15,015 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:38:15,015 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:38:15,015 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:38:15,015 - main - INFO - 
2025-11-21 20:38:15,016 - main - INFO -      Documents (MongoDB):
2025-11-21 20:38:15,016 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:38:15,016 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:38:15,016 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:38:15,016 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:38:15,017 - main - INFO - 
2025-11-21 20:38:15,017 - main - INFO -      Diagnostics & Health:
2025-11-21 20:38:15,017 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:38:15,017 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:38:15,017 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:38:15,017 - main - INFO - 
2025-11-21 20:38:15,018 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:38:15,018 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:38:15,018 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:38:15,018 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:38:15,018 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:38:15,019 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:38:15,019 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:38:15,019 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:38:15,019 - main - INFO - 
2025-11-21 20:38:15,019 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:38:15,020 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:38:15,020 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:38:15,020 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:38:15,020 - main - INFO -      4. No re-upload needed!
2025-11-21 20:38:15,020 - main - INFO - 
2025-11-21 20:38:15,021 - main - INFO - ================================================================================
2025-11-21 20:38:15,021 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:38:15,021 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:38:15,021 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:38:15,021 - main - INFO - ================================================================================
2025-11-21 20:38:15,022 - main - INFO - 
2025-11-21 20:38:15,022 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:38:18,578 - main - INFO - 
2025-11-21 20:38:18,579 - main - INFO - ================================================================================
2025-11-21 20:38:18,579 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:38:18,579 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:38:18,579 - main - INFO - ================================================================================
2025-11-21 20:38:18,579 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:38:18,580 - main - INFO -   Upload Directory: uploads
2025-11-21 20:38:18,580 - main - INFO -   Max File Size: 20MB
2025-11-21 20:38:18,580 - main - INFO - ================================================================================
2025-11-21 20:38:18,580 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:38:18,581 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:38:18,581 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:38:18,598 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:38:18,599 - app.services.mongodb_service_enhanced - ERROR - âš ï¸  Error creating indexes: db already exists with different case already have: [hakemAI] trying to create [HAKEMAI], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [hakemAI] trying to create [HAKEMAI]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-11-21 20:38:18,600 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:38:18,600 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:38:18,600 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:38:18,600 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:38:18,601 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:18,601 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:38:18,620 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:38:18,621 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:38:18,622 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'users']
2025-11-21 20:38:18,624 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:38:18,625 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:38:18,625 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:38:18,625 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:18,625 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:38:18,651 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:38:18,651 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:38:18,652 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:38:18,652 - main - INFO - 
2025-11-21 20:38:18,652 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:38:18,652 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:38:18,653 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:38:18,653 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:38:18,653 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:38:18,653 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:38:18,654 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:38:18,654 - main - INFO - 
2025-11-21 20:38:18,654 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:38:18,654 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:38:18,655 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:38:18,655 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:38:18,655 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:38:18,655 - main - INFO - 
2025-11-21 20:38:18,655 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:38:18,656 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:38:18,656 - main - INFO -        - No manual section generation
2025-11-21 20:38:18,656 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:38:18,656 - main - INFO - 
2025-11-21 20:38:18,657 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:38:18,657 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:38:18,657 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:38:18,658 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:38:18,658 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:38:18,658 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:38:18,659 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:38:18,660 - main - INFO - 
2025-11-21 20:38:18,661 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:38:18,662 - main - INFO -      Main:
2025-11-21 20:38:18,662 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:38:18,663 - main - INFO - 
2025-11-21 20:38:18,663 - main - INFO -      Retrieval:
2025-11-21 20:38:18,663 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:38:18,663 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:38:18,664 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:38:18,664 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:38:18,664 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:38:18,664 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:38:18,664 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:38:18,665 - main - INFO - 
2025-11-21 20:38:18,665 - main - INFO -      Management:
2025-11-21 20:38:18,665 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:38:18,665 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:38:18,665 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:38:18,666 - main - INFO - 
2025-11-21 20:38:18,666 - main - INFO -      Documents (MongoDB):
2025-11-21 20:38:18,666 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:38:18,666 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:38:18,666 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:38:18,666 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:38:18,667 - main - INFO - 
2025-11-21 20:38:18,667 - main - INFO -      Diagnostics & Health:
2025-11-21 20:38:18,667 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:38:18,667 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:38:18,667 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:38:18,668 - main - INFO - 
2025-11-21 20:38:18,668 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:38:18,668 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:38:18,668 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:38:18,668 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:38:18,669 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:38:18,669 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:38:18,669 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:38:18,669 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:38:18,669 - main - INFO - 
2025-11-21 20:38:18,669 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:38:18,670 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:38:18,670 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:38:18,670 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:38:18,670 - main - INFO -      4. No re-upload needed!
2025-11-21 20:38:18,670 - main - INFO - 
2025-11-21 20:38:18,670 - main - INFO - ================================================================================
2025-11-21 20:38:18,671 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:38:18,671 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:38:18,671 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:38:18,671 - main - INFO - ================================================================================
2025-11-21 20:38:18,671 - main - INFO - 
2025-11-21 20:38:18,672 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:38:18,934 - main - INFO - 
2025-11-21 20:38:18,934 - main - INFO - ================================================================================
2025-11-21 20:38:18,934 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:38:18,935 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:18,935 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:38:18,936 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:18,936 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:38:18,937 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:38:18,937 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:38:18,938 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:38:18,938 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:38:18,938 - main - INFO - ================================================================================
2025-11-21 20:38:18,938 - main - INFO - 
2025-11-21 20:38:21,969 - main - INFO - 
2025-11-21 20:38:21,969 - main - INFO - ================================================================================
2025-11-21 20:38:21,970 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:38:21,970 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:38:21,970 - main - INFO - ================================================================================
2025-11-21 20:38:21,970 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:38:21,970 - main - INFO -   Upload Directory: uploads
2025-11-21 20:38:21,971 - main - INFO -   Max File Size: 20MB
2025-11-21 20:38:21,971 - main - INFO - ================================================================================
2025-11-21 20:38:21,971 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:38:21,972 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:38:21,972 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:38:21,995 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:38:21,997 - app.services.mongodb_service_enhanced - ERROR - âš ï¸  Error creating indexes: db already exists with different case already have: [hakemAI] trying to create [HAKEMAI], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [hakemAI] trying to create [HAKEMAI]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-11-21 20:38:21,997 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:38:21,997 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:38:21,998 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:38:21,998 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:38:21,998 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:21,998 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:38:22,005 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:38:22,006 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:38:22,007 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'users']
2025-11-21 20:38:22,012 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:38:22,013 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:38:22,013 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:38:22,013 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:22,013 - app.services.user_documents_service - INFO -    Database: HAKEMAI
2025-11-21 20:38:22,048 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:38:22,048 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:38:22,049 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:38:22,049 - main - INFO - 
2025-11-21 20:38:22,050 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:38:22,050 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:38:22,051 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:38:22,051 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:38:22,051 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:38:22,052 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:38:22,052 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:38:22,052 - main - INFO - 
2025-11-21 20:38:22,052 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:38:22,053 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:38:22,053 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:38:22,053 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:38:22,053 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:38:22,053 - main - INFO - 
2025-11-21 20:38:22,054 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:38:22,054 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:38:22,054 - main - INFO -        - No manual section generation
2025-11-21 20:38:22,054 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:38:22,054 - main - INFO - 
2025-11-21 20:38:22,055 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:38:22,055 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:38:22,055 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:38:22,055 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:38:22,056 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:38:22,056 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:38:22,056 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:38:22,056 - main - INFO - 
2025-11-21 20:38:22,057 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:38:22,057 - main - INFO -      Main:
2025-11-21 20:38:22,057 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:38:22,057 - main - INFO - 
2025-11-21 20:38:22,058 - main - INFO -      Retrieval:
2025-11-21 20:38:22,058 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:38:22,058 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:38:22,058 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:38:22,058 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:38:22,059 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:38:22,059 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:38:22,059 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:38:22,060 - main - INFO - 
2025-11-21 20:38:22,060 - main - INFO -      Management:
2025-11-21 20:38:22,061 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:38:22,061 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:38:22,062 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:38:22,062 - main - INFO - 
2025-11-21 20:38:22,062 - main - INFO -      Documents (MongoDB):
2025-11-21 20:38:22,062 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:38:22,063 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:38:22,063 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:38:22,063 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:38:22,063 - main - INFO - 
2025-11-21 20:38:22,063 - main - INFO -      Diagnostics & Health:
2025-11-21 20:38:22,064 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:38:22,064 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:38:22,064 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:38:22,064 - main - INFO - 
2025-11-21 20:38:22,064 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:38:22,065 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:38:22,065 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:38:22,065 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:38:22,065 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:38:22,065 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:38:22,065 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:38:22,066 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:38:22,066 - main - INFO - 
2025-11-21 20:38:22,066 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:38:22,066 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:38:22,066 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:38:22,066 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:38:22,067 - main - INFO -      4. No re-upload needed!
2025-11-21 20:38:22,067 - main - INFO - 
2025-11-21 20:38:22,067 - main - INFO - ================================================================================
2025-11-21 20:38:22,067 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:38:22,067 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:38:22,067 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:38:22,067 - main - INFO - ================================================================================
2025-11-21 20:38:22,068 - main - INFO - 
2025-11-21 20:38:22,068 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:38:36,129 - main - INFO - 
2025-11-21 20:38:36,129 - main - INFO - ================================================================================
2025-11-21 20:38:36,129 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:38:36,130 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:36,130 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:38:36,131 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:38:36,131 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:38:36,132 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:38:36,132 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:38:36,133 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:38:36,133 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:38:36,133 - main - INFO - ================================================================================
2025-11-21 20:38:36,133 - main - INFO - 
2025-11-21 20:38:39,559 - main - INFO - 
2025-11-21 20:38:39,560 - main - INFO - ================================================================================
2025-11-21 20:38:39,560 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:38:39,561 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:38:39,561 - main - INFO - ================================================================================
2025-11-21 20:38:39,561 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:38:39,561 - main - INFO -   Upload Directory: uploads
2025-11-21 20:38:39,562 - main - INFO -   Max File Size: 20MB
2025-11-21 20:38:39,562 - main - INFO - ================================================================================
2025-11-21 20:38:39,562 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:38:39,563 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:38:39,563 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:38:39,583 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:38:39,584 - app.services.mongodb_service_enhanced - ERROR - âš ï¸  Error creating indexes: db already exists with different case already have: [hakemAI] trying to create [HAKEMAI], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [hakemAI] trying to create [HAKEMAI]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-11-21 20:38:39,584 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:38:39,584 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: HAKEMAI
2025-11-21 20:38:39,584 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:38:39,585 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:38:39,585 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:39,585 - app.services.user_subscription_service - INFO -    Database: HAKEMAI
2025-11-21 20:38:39,616 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:38:39,617 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:38:39,619 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'HAKEMAI': []
2025-11-21 20:38:39,619 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'HAKEMAI'
2025-11-21 20:38:39,619 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-21 20:38:39,620 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:38:39,620 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:38:39,620 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:38:39,621 - app.services.user_documents_service - INFO -    Database: HAKEMAI
2025-11-21 20:38:39,633 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:38:39,633 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:38:39,633 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:38:39,634 - main - INFO - 
2025-11-21 20:38:39,634 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:38:39,634 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:38:39,634 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:38:39,634 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:38:39,635 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:38:39,635 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:38:39,635 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:38:39,635 - main - INFO - 
2025-11-21 20:38:39,636 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:38:39,636 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:38:39,636 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:38:39,636 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:38:39,636 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:38:39,637 - main - INFO - 
2025-11-21 20:38:39,637 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:38:39,637 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:38:39,637 - main - INFO -        - No manual section generation
2025-11-21 20:38:39,637 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:38:39,637 - main - INFO - 
2025-11-21 20:38:39,638 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:38:39,638 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:38:39,638 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:38:39,638 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:38:39,638 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:38:39,638 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:38:39,639 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:38:39,639 - main - INFO - 
2025-11-21 20:38:39,640 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:38:39,640 - main - INFO -      Main:
2025-11-21 20:38:39,640 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:38:39,641 - main - INFO - 
2025-11-21 20:38:39,641 - main - INFO -      Retrieval:
2025-11-21 20:38:39,641 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:38:39,641 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:38:39,641 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:38:39,642 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:38:39,642 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:38:39,642 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:38:39,642 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:38:39,642 - main - INFO - 
2025-11-21 20:38:39,643 - main - INFO -      Management:
2025-11-21 20:38:39,643 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:38:39,643 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:38:39,644 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:38:39,644 - main - INFO - 
2025-11-21 20:38:39,644 - main - INFO -      Documents (MongoDB):
2025-11-21 20:38:39,644 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:38:39,645 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:38:39,645 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:38:39,645 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:38:39,645 - main - INFO - 
2025-11-21 20:38:39,645 - main - INFO -      Diagnostics & Health:
2025-11-21 20:38:39,646 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:38:39,646 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:38:39,646 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:38:39,646 - main - INFO - 
2025-11-21 20:38:39,647 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:38:39,647 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:38:39,647 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:38:39,647 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:38:39,648 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:38:39,648 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:38:39,648 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:38:39,648 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:38:39,648 - main - INFO - 
2025-11-21 20:38:39,649 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:38:39,649 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:38:39,649 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:38:39,649 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:38:39,649 - main - INFO -      4. No re-upload needed!
2025-11-21 20:38:39,650 - main - INFO - 
2025-11-21 20:38:39,650 - main - INFO - ================================================================================
2025-11-21 20:38:39,650 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:38:39,650 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:38:39,650 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:38:39,650 - main - INFO - ================================================================================
2025-11-21 20:38:39,651 - main - INFO - 
2025-11-21 20:38:39,651 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:39:36,214 - main - INFO - 
2025-11-21 20:39:36,214 - main - INFO - ================================================================================
2025-11-21 20:39:36,215 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:39:36,215 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:39:36,216 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:39:36,216 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:39:36,216 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:39:36,217 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:39:36,217 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:39:36,218 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:39:36,218 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:39:36,218 - main - INFO - ================================================================================
2025-11-21 20:39:36,218 - main - INFO - 
2025-11-21 20:39:39,114 - main - INFO - 
2025-11-21 20:39:39,114 - main - INFO - ================================================================================
2025-11-21 20:39:39,114 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:39:39,114 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:39:39,115 - main - INFO - ================================================================================
2025-11-21 20:39:39,115 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:39:39,115 - main - INFO -   Upload Directory: uploads
2025-11-21 20:39:39,115 - main - INFO -   Max File Size: 20MB
2025-11-21 20:39:39,115 - main - INFO - ================================================================================
2025-11-21 20:39:39,116 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:39:39,116 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:39:39,116 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:39:39,166 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:39:39,167 - app.services.mongodb_service_enhanced - ERROR - âš ï¸  Error creating indexes: db already exists with different case already have: [hakemAI] trying to create [HAKEMAI], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [hakemAI] trying to create [HAKEMAI]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-11-21 20:39:39,168 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:39:39,169 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: HAKEMAI
2025-11-21 20:39:39,169 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:39:39,169 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:39:39,169 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:39:39,170 - app.services.user_subscription_service - INFO -    Database: HAKEMAI
2025-11-21 20:39:39,199 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:39:39,200 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:39:39,202 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'HAKEMAI': []
2025-11-21 20:39:39,202 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'HAKEMAI'
2025-11-21 20:39:39,202 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-21 20:39:39,202 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:39:39,203 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:39:39,203 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:39:39,203 - app.services.user_documents_service - INFO -    Database: HAKEMAI
2025-11-21 20:39:39,211 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:39:39,211 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:39:39,212 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:39:39,212 - main - INFO - 
2025-11-21 20:39:39,212 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:39:39,212 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:39:39,213 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:39:39,213 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:39:39,213 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:39:39,213 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:39:39,213 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:39:39,214 - main - INFO - 
2025-11-21 20:39:39,214 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:39:39,214 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:39:39,214 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:39:39,215 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:39:39,215 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:39:39,215 - main - INFO - 
2025-11-21 20:39:39,215 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:39:39,215 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:39:39,216 - main - INFO -        - No manual section generation
2025-11-21 20:39:39,216 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:39:39,216 - main - INFO - 
2025-11-21 20:39:39,216 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:39:39,217 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:39:39,217 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:39:39,217 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:39:39,218 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:39:39,218 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:39:39,218 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:39:39,218 - main - INFO - 
2025-11-21 20:39:39,219 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:39:39,219 - main - INFO -      Main:
2025-11-21 20:39:39,219 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:39:39,219 - main - INFO - 
2025-11-21 20:39:39,220 - main - INFO -      Retrieval:
2025-11-21 20:39:39,220 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:39:39,220 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:39:39,220 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:39:39,221 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:39:39,221 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:39:39,221 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:39:39,221 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:39:39,222 - main - INFO - 
2025-11-21 20:39:39,222 - main - INFO -      Management:
2025-11-21 20:39:39,222 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:39:39,222 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:39:39,223 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:39:39,223 - main - INFO - 
2025-11-21 20:39:39,223 - main - INFO -      Documents (MongoDB):
2025-11-21 20:39:39,224 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:39:39,224 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:39:39,224 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:39:39,224 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:39:39,225 - main - INFO - 
2025-11-21 20:39:39,225 - main - INFO -      Diagnostics & Health:
2025-11-21 20:39:39,225 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:39:39,225 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:39:39,226 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:39:39,226 - main - INFO - 
2025-11-21 20:39:39,226 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:39:39,226 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:39:39,227 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:39:39,227 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:39:39,227 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:39:39,227 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:39:39,229 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:39:39,229 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:39:39,229 - main - INFO - 
2025-11-21 20:39:39,230 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:39:39,230 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:39:39,230 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:39:39,230 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:39:39,231 - main - INFO -      4. No re-upload needed!
2025-11-21 20:39:39,231 - main - INFO - 
2025-11-21 20:39:39,231 - main - INFO - ================================================================================
2025-11-21 20:39:39,231 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:39:39,231 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:39:39,232 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:39:39,232 - main - INFO - ================================================================================
2025-11-21 20:39:39,232 - main - INFO - 
2025-11-21 20:39:39,233 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:41:24,970 - main - INFO - 
2025-11-21 20:41:24,970 - main - INFO - ================================================================================
2025-11-21 20:41:24,971 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:41:24,972 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:41:24,972 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:41:24,973 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:41:24,973 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:41:24,974 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:41:24,974 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:41:24,975 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:41:24,975 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:41:24,975 - main - INFO - ================================================================================
2025-11-21 20:41:24,975 - main - INFO - 
2025-11-21 20:41:29,480 - main - INFO - 
2025-11-21 20:41:29,480 - main - INFO - ================================================================================
2025-11-21 20:41:29,481 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:41:29,481 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:41:29,481 - main - INFO - ================================================================================
2025-11-21 20:41:29,481 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:41:29,482 - main - INFO -   Upload Directory: uploads
2025-11-21 20:41:29,482 - main - INFO -   Max File Size: 20MB
2025-11-21 20:41:29,482 - main - INFO - ================================================================================
2025-11-21 20:41:29,482 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:41:29,483 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:41:29,483 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:41:29,513 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:41:29,515 - app.services.mongodb_service_enhanced - ERROR - âš ï¸  Error creating indexes: db already exists with different case already have: [hakemAI] trying to create [HAKEMAI], full error: {'ok': 0.0, 'errmsg': 'db already exists with different case already have: [hakemAI] trying to create [HAKEMAI]', 'code': 13297, 'codeName': 'DatabaseDifferCase'}
2025-11-21 20:41:29,515 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:41:29,516 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: HAKEMAI
2025-11-21 20:41:29,516 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:41:29,516 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:41:29,517 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:41:29,517 - app.services.user_subscription_service - INFO -    Database: HAKEMAI
2025-11-21 20:41:29,546 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:41:29,547 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:41:29,551 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'HAKEMAI': []
2025-11-21 20:41:29,551 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'HAKEMAI'
2025-11-21 20:41:29,552 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-21 20:41:29,552 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:41:29,552 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:41:29,552 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:41:29,553 - app.services.user_documents_service - INFO -    Database: HAKEMAI
2025-11-21 20:41:29,562 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:41:29,562 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:41:29,563 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:41:29,563 - main - INFO - 
2025-11-21 20:41:29,563 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:41:29,563 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:41:29,564 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:41:29,564 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:41:29,564 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:41:29,564 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:41:29,565 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:41:29,565 - main - INFO - 
2025-11-21 20:41:29,565 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:41:29,566 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:41:29,566 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:41:29,566 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:41:29,566 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:41:29,567 - main - INFO - 
2025-11-21 20:41:29,567 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:41:29,567 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:41:29,567 - main - INFO -        - No manual section generation
2025-11-21 20:41:29,568 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:41:29,568 - main - INFO - 
2025-11-21 20:41:29,568 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:41:29,568 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:41:29,568 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:41:29,568 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:41:29,569 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:41:29,569 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:41:29,569 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:41:29,569 - main - INFO - 
2025-11-21 20:41:29,569 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:41:29,569 - main - INFO -      Main:
2025-11-21 20:41:29,569 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:41:29,570 - main - INFO - 
2025-11-21 20:41:29,570 - main - INFO -      Retrieval:
2025-11-21 20:41:29,570 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:41:29,570 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:41:29,570 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:41:29,570 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:41:29,571 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:41:29,571 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:41:29,571 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:41:29,571 - main - INFO - 
2025-11-21 20:41:29,571 - main - INFO -      Management:
2025-11-21 20:41:29,571 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:41:29,571 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:41:29,572 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:41:29,572 - main - INFO - 
2025-11-21 20:41:29,572 - main - INFO -      Documents (MongoDB):
2025-11-21 20:41:29,572 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:41:29,572 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:41:29,572 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:41:29,573 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:41:29,573 - main - INFO - 
2025-11-21 20:41:29,573 - main - INFO -      Diagnostics & Health:
2025-11-21 20:41:29,574 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:41:29,574 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:41:29,574 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:41:29,574 - main - INFO - 
2025-11-21 20:41:29,574 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:41:29,574 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:41:29,575 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:41:29,575 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:41:29,575 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:41:29,575 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:41:29,575 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:41:29,576 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:41:29,576 - main - INFO - 
2025-11-21 20:41:29,576 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:41:29,576 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:41:29,577 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:41:29,577 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:41:29,577 - main - INFO -      4. No re-upload needed!
2025-11-21 20:41:29,578 - main - INFO - 
2025-11-21 20:41:29,578 - main - INFO - ================================================================================
2025-11-21 20:41:29,578 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:41:29,578 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:41:29,578 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:41:29,579 - main - INFO - ================================================================================
2025-11-21 20:41:29,579 - main - INFO - 
2025-11-21 20:41:29,579 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:44:41,025 - main - INFO - 
2025-11-21 20:44:41,026 - main - INFO - ================================================================================
2025-11-21 20:44:41,026 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:44:41,027 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:44:41,027 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:44:41,028 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:44:41,029 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:44:41,029 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:44:41,030 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:44:41,031 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:44:41,031 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:44:41,031 - main - INFO - ================================================================================
2025-11-21 20:44:41,031 - main - INFO - 
2025-11-21 20:44:44,484 - main - INFO - 
2025-11-21 20:44:44,485 - main - INFO - ================================================================================
2025-11-21 20:44:44,485 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:44:44,485 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:44:44,485 - main - INFO - ================================================================================
2025-11-21 20:44:44,486 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:44:44,486 - main - INFO -   Upload Directory: uploads
2025-11-21 20:44:44,486 - main - INFO -   Max File Size: 20MB
2025-11-21 20:44:44,486 - main - INFO - ================================================================================
2025-11-21 20:44:44,487 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:44:44,487 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:44:44,487 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:44:44,523 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:44:44,614 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:44:44,615 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:44:44,615 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: HAKEMAI
2025-11-21 20:44:44,615 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:44:44,616 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:44:44,616 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:44,616 - app.services.user_subscription_service - INFO -    Database: HAKEMAI
2025-11-21 20:44:44,646 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:44:44,648 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:44:44,649 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'HAKEMAI': []
2025-11-21 20:44:44,650 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'HAKEMAI'
2025-11-21 20:44:44,650 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-21 20:44:44,650 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:44:44,650 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:44:44,651 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:44,651 - app.services.user_documents_service - INFO -    Database: HAKEMAI
2025-11-21 20:44:44,676 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:44:44,676 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:44:44,677 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:44:44,677 - main - INFO - 
2025-11-21 20:44:44,677 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:44:44,677 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:44:44,677 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:44:44,678 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:44:44,678 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:44:44,678 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:44:44,678 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:44:44,679 - main - INFO - 
2025-11-21 20:44:44,679 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:44:44,679 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:44:44,680 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:44:44,680 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:44:44,680 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:44:44,680 - main - INFO - 
2025-11-21 20:44:44,681 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:44:44,681 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:44:44,681 - main - INFO -        - No manual section generation
2025-11-21 20:44:44,681 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:44:44,681 - main - INFO - 
2025-11-21 20:44:44,682 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:44:44,682 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:44:44,682 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:44:44,682 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:44:44,682 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:44:44,683 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:44:44,683 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:44:44,683 - main - INFO - 
2025-11-21 20:44:44,683 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:44:44,683 - main - INFO -      Main:
2025-11-21 20:44:44,683 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:44:44,684 - main - INFO - 
2025-11-21 20:44:44,684 - main - INFO -      Retrieval:
2025-11-21 20:44:44,684 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:44:44,684 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:44:44,684 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:44:44,684 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:44:44,684 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:44:44,685 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:44:44,685 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:44:44,685 - main - INFO - 
2025-11-21 20:44:44,685 - main - INFO -      Management:
2025-11-21 20:44:44,685 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:44:44,685 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:44:44,685 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:44:44,686 - main - INFO - 
2025-11-21 20:44:44,686 - main - INFO -      Documents (MongoDB):
2025-11-21 20:44:44,686 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:44:44,686 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:44:44,686 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:44:44,686 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:44:44,686 - main - INFO - 
2025-11-21 20:44:44,687 - main - INFO -      Diagnostics & Health:
2025-11-21 20:44:44,687 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:44:44,687 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:44:44,687 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:44:44,687 - main - INFO - 
2025-11-21 20:44:44,687 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:44:44,687 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:44:44,688 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:44:44,688 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:44:44,688 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:44:44,688 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:44:44,688 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:44:44,688 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:44:44,689 - main - INFO - 
2025-11-21 20:44:44,689 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:44:44,689 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:44:44,689 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:44:44,689 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:44:44,690 - main - INFO -      4. No re-upload needed!
2025-11-21 20:44:44,690 - main - INFO - 
2025-11-21 20:44:44,690 - main - INFO - ================================================================================
2025-11-21 20:44:44,690 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:44:44,691 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:44:44,691 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:44:44,691 - main - INFO - ================================================================================
2025-11-21 20:44:44,691 - main - INFO - 
2025-11-21 20:44:44,692 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:44:48,037 - main - INFO - 
2025-11-21 20:44:48,037 - main - INFO - ================================================================================
2025-11-21 20:44:48,037 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:44:48,037 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:44:48,038 - main - INFO - ================================================================================
2025-11-21 20:44:48,038 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:44:48,038 - main - INFO -   Upload Directory: uploads
2025-11-21 20:44:48,038 - main - INFO -   Max File Size: 20MB
2025-11-21 20:44:48,038 - main - INFO - ================================================================================
2025-11-21 20:44:48,039 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:44:48,039 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:44:48,040 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:44:48,064 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:44:48,068 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:44:48,068 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:44:48,069 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: HAKEMAI
2025-11-21 20:44:48,069 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:44:48,069 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:44:48,069 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:48,070 - app.services.user_subscription_service - INFO -    Database: HAKEMAI
2025-11-21 20:44:48,080 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:44:48,081 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:44:48,082 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'HAKEMAI': []
2025-11-21 20:44:48,082 - app.services.user_subscription_service - WARNING - âš ï¸  'users' collection not found in database 'HAKEMAI'
2025-11-21 20:44:48,083 - app.services.user_subscription_service - WARNING -    Available collections: []
2025-11-21 20:44:48,083 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:44:48,083 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:44:48,083 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:48,084 - app.services.user_documents_service - INFO -    Database: HAKEMAI
2025-11-21 20:44:48,116 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:44:48,116 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:44:48,117 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:44:48,117 - main - INFO - 
2025-11-21 20:44:48,117 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:44:48,118 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:44:48,118 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:44:48,119 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:44:48,119 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:44:48,119 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:44:48,120 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:44:48,120 - main - INFO - 
2025-11-21 20:44:48,121 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:44:48,121 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:44:48,121 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:44:48,122 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:44:48,122 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:44:48,122 - main - INFO - 
2025-11-21 20:44:48,123 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:44:48,123 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:44:48,123 - main - INFO -        - No manual section generation
2025-11-21 20:44:48,124 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:44:48,124 - main - INFO - 
2025-11-21 20:44:48,124 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:44:48,124 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:44:48,125 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:44:48,125 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:44:48,125 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:44:48,125 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:44:48,125 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:44:48,126 - main - INFO - 
2025-11-21 20:44:48,126 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:44:48,126 - main - INFO -      Main:
2025-11-21 20:44:48,127 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:44:48,128 - main - INFO - 
2025-11-21 20:44:48,128 - main - INFO -      Retrieval:
2025-11-21 20:44:48,129 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:44:48,129 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:44:48,129 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:44:48,130 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:44:48,130 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:44:48,130 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:44:48,130 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:44:48,131 - main - INFO - 
2025-11-21 20:44:48,131 - main - INFO -      Management:
2025-11-21 20:44:48,131 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:44:48,131 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:44:48,131 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:44:48,132 - main - INFO - 
2025-11-21 20:44:48,132 - main - INFO -      Documents (MongoDB):
2025-11-21 20:44:48,132 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:44:48,132 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:44:48,132 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:44:48,133 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:44:48,133 - main - INFO - 
2025-11-21 20:44:48,133 - main - INFO -      Diagnostics & Health:
2025-11-21 20:44:48,133 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:44:48,133 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:44:48,133 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:44:48,133 - main - INFO - 
2025-11-21 20:44:48,134 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:44:48,134 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:44:48,134 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:44:48,134 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:44:48,134 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:44:48,134 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:44:48,134 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:44:48,135 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:44:48,135 - main - INFO - 
2025-11-21 20:44:48,135 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:44:48,135 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:44:48,135 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:44:48,135 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:44:48,135 - main - INFO -      4. No re-upload needed!
2025-11-21 20:44:48,136 - main - INFO - 
2025-11-21 20:44:48,136 - main - INFO - ================================================================================
2025-11-21 20:44:48,136 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:44:48,136 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:44:48,136 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:44:48,136 - main - INFO - ================================================================================
2025-11-21 20:44:48,136 - main - INFO - 
2025-11-21 20:44:48,137 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:44:49,160 - main - INFO - 
2025-11-21 20:44:49,161 - main - INFO - ================================================================================
2025-11-21 20:44:49,161 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:44:49,165 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:44:49,166 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:44:49,168 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:44:49,169 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:44:49,171 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:44:49,171 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:44:49,173 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:44:49,173 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:44:49,174 - main - INFO - ================================================================================
2025-11-21 20:44:49,175 - main - INFO - 
2025-11-21 20:44:52,461 - main - INFO - 
2025-11-21 20:44:52,461 - main - INFO - ================================================================================
2025-11-21 20:44:52,461 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:44:52,462 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:44:52,462 - main - INFO - ================================================================================
2025-11-21 20:44:52,462 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:44:52,463 - main - INFO -   Upload Directory: uploads
2025-11-21 20:44:52,463 - main - INFO -   Max File Size: 20MB
2025-11-21 20:44:52,463 - main - INFO - ================================================================================
2025-11-21 20:44:52,464 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:44:52,464 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:44:52,464 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:44:52,481 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:44:52,486 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:44:52,486 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:44:52,486 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:44:52,486 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:44:52,487 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:44:52,487 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:52,487 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:44:52,495 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:44:52,496 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:44:52,497 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-21 20:44:52,499 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:44:52,499 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:44:52,499 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:44:52,500 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:52,500 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:44:52,507 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:44:52,508 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:44:52,508 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:44:52,508 - main - INFO - 
2025-11-21 20:44:52,508 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:44:52,508 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:44:52,509 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:44:52,509 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:44:52,509 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:44:52,509 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:44:52,509 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:44:52,509 - main - INFO - 
2025-11-21 20:44:52,510 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:44:52,510 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:44:52,510 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:44:52,511 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:44:52,511 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:44:52,511 - main - INFO - 
2025-11-21 20:44:52,511 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:44:52,512 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:44:52,512 - main - INFO -        - No manual section generation
2025-11-21 20:44:52,512 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:44:52,512 - main - INFO - 
2025-11-21 20:44:52,512 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:44:52,513 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:44:52,513 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:44:52,513 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:44:52,513 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:44:52,513 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:44:52,514 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:44:52,514 - main - INFO - 
2025-11-21 20:44:52,514 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:44:52,514 - main - INFO -      Main:
2025-11-21 20:44:52,514 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:44:52,515 - main - INFO - 
2025-11-21 20:44:52,515 - main - INFO -      Retrieval:
2025-11-21 20:44:52,515 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:44:52,515 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:44:52,515 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:44:52,515 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:44:52,516 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:44:52,516 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:44:52,516 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:44:52,516 - main - INFO - 
2025-11-21 20:44:52,516 - main - INFO -      Management:
2025-11-21 20:44:52,516 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:44:52,517 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:44:52,517 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:44:52,517 - main - INFO - 
2025-11-21 20:44:52,517 - main - INFO -      Documents (MongoDB):
2025-11-21 20:44:52,517 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:44:52,517 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:44:52,517 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:44:52,518 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:44:52,518 - main - INFO - 
2025-11-21 20:44:52,518 - main - INFO -      Diagnostics & Health:
2025-11-21 20:44:52,518 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:44:52,518 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:44:52,518 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:44:52,519 - main - INFO - 
2025-11-21 20:44:52,519 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:44:52,519 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:44:52,519 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:44:52,519 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:44:52,519 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:44:52,519 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:44:52,520 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:44:52,520 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:44:52,520 - main - INFO - 
2025-11-21 20:44:52,520 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:44:52,520 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:44:52,520 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:44:52,520 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:44:52,521 - main - INFO -      4. No re-upload needed!
2025-11-21 20:44:52,521 - main - INFO - 
2025-11-21 20:44:52,521 - main - INFO - ================================================================================
2025-11-21 20:44:52,521 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:44:52,521 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:44:52,521 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:44:52,521 - main - INFO - ================================================================================
2025-11-21 20:44:52,522 - main - INFO - 
2025-11-21 20:44:52,522 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:44:55,477 - main - INFO - 
2025-11-21 20:44:55,478 - main - INFO - ================================================================================
2025-11-21 20:44:55,478 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:44:55,478 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:44:55,478 - main - INFO - ================================================================================
2025-11-21 20:44:55,478 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:44:55,479 - main - INFO -   Upload Directory: uploads
2025-11-21 20:44:55,479 - main - INFO -   Max File Size: 20MB
2025-11-21 20:44:55,479 - main - INFO - ================================================================================
2025-11-21 20:44:55,479 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:44:55,480 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:44:55,480 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:44:55,500 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:44:55,504 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:44:55,504 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:44:55,505 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:44:55,505 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:44:55,505 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:44:55,505 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:55,506 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:44:55,534 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:44:55,535 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:44:55,536 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-21 20:44:55,537 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:44:55,538 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:44:55,538 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:44:55,538 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:44:55,538 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:44:55,566 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:44:55,566 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:44:55,566 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:44:55,566 - main - INFO - 
2025-11-21 20:44:55,567 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:44:55,567 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:44:55,567 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:44:55,567 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:44:55,567 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:44:55,568 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:44:55,568 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:44:55,568 - main - INFO - 
2025-11-21 20:44:55,568 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:44:55,568 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:44:55,569 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:44:55,569 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:44:55,569 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:44:55,569 - main - INFO - 
2025-11-21 20:44:55,569 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:44:55,570 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:44:55,570 - main - INFO -        - No manual section generation
2025-11-21 20:44:55,570 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:44:55,570 - main - INFO - 
2025-11-21 20:44:55,570 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:44:55,571 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:44:55,571 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:44:55,571 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:44:55,571 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:44:55,571 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:44:55,572 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:44:55,572 - main - INFO - 
2025-11-21 20:44:55,572 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:44:55,572 - main - INFO -      Main:
2025-11-21 20:44:55,573 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:44:55,574 - main - INFO - 
2025-11-21 20:44:55,575 - main - INFO -      Retrieval:
2025-11-21 20:44:55,576 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:44:55,576 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:44:55,577 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:44:55,577 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:44:55,577 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:44:55,577 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:44:55,577 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:44:55,578 - main - INFO - 
2025-11-21 20:44:55,578 - main - INFO -      Management:
2025-11-21 20:44:55,578 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:44:55,579 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:44:55,579 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:44:55,579 - main - INFO - 
2025-11-21 20:44:55,579 - main - INFO -      Documents (MongoDB):
2025-11-21 20:44:55,580 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:44:55,580 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:44:55,580 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:44:55,580 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:44:55,580 - main - INFO - 
2025-11-21 20:44:55,581 - main - INFO -      Diagnostics & Health:
2025-11-21 20:44:55,581 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:44:55,581 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:44:55,581 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:44:55,582 - main - INFO - 
2025-11-21 20:44:55,582 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:44:55,582 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:44:55,582 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:44:55,582 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:44:55,583 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:44:55,583 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:44:55,583 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:44:55,583 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:44:55,583 - main - INFO - 
2025-11-21 20:44:55,584 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:44:55,584 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:44:55,584 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:44:55,584 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:44:55,584 - main - INFO -      4. No re-upload needed!
2025-11-21 20:44:55,584 - main - INFO - 
2025-11-21 20:44:55,585 - main - INFO - ================================================================================
2025-11-21 20:44:55,585 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:44:55,585 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:44:55,585 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:44:55,585 - main - INFO - ================================================================================
2025-11-21 20:44:55,585 - main - INFO - 
2025-11-21 20:44:55,586 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:45:16,482 - main - INFO - 
2025-11-21 20:45:16,482 - main - INFO - ================================================================================
2025-11-21 20:45:16,482 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:45:16,484 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:45:16,484 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:45:16,486 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:45:16,486 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:45:16,488 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:45:16,488 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:45:16,489 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:45:16,490 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:45:16,490 - main - INFO - ================================================================================
2025-11-21 20:45:16,490 - main - INFO - 
2025-11-21 20:45:19,105 - main - INFO - 
2025-11-21 20:45:19,106 - main - INFO - ================================================================================
2025-11-21 20:45:19,106 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:45:19,106 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:45:19,107 - main - INFO - ================================================================================
2025-11-21 20:45:19,107 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:45:19,108 - main - INFO -   Upload Directory: uploads
2025-11-21 20:45:19,108 - main - INFO -   Max File Size: 20MB
2025-11-21 20:45:19,108 - main - INFO - ================================================================================
2025-11-21 20:45:19,109 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:45:19,109 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:45:19,109 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:45:19,129 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:45:19,134 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:45:19,134 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:45:19,134 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:45:19,134 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:45:19,134 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:45:19,135 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:45:19,135 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:45:19,148 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:45:19,149 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:45:19,151 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-21 20:45:19,152 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:45:19,153 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:45:19,153 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:45:19,153 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:45:19,153 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:45:19,160 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:45:19,161 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:45:19,161 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:45:19,161 - main - INFO - 
2025-11-21 20:45:19,161 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:45:19,162 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:45:19,162 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:45:19,162 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:45:19,162 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:45:19,162 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:45:19,162 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:45:19,163 - main - INFO - 
2025-11-21 20:45:19,163 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:45:19,163 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:45:19,163 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:45:19,163 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:45:19,164 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:45:19,164 - main - INFO - 
2025-11-21 20:45:19,164 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:45:19,164 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:45:19,164 - main - INFO -        - No manual section generation
2025-11-21 20:45:19,164 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:45:19,165 - main - INFO - 
2025-11-21 20:45:19,165 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:45:19,165 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:45:19,165 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:45:19,166 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:45:19,166 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:45:19,166 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:45:19,166 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:45:19,166 - main - INFO - 
2025-11-21 20:45:19,166 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:45:19,167 - main - INFO -      Main:
2025-11-21 20:45:19,167 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:45:19,167 - main - INFO - 
2025-11-21 20:45:19,167 - main - INFO -      Retrieval:
2025-11-21 20:45:19,167 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:45:19,168 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:45:19,168 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:45:19,168 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:45:19,168 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:45:19,168 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:45:19,168 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:45:19,169 - main - INFO - 
2025-11-21 20:45:19,169 - main - INFO -      Management:
2025-11-21 20:45:19,169 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:45:19,169 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:45:19,169 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:45:19,169 - main - INFO - 
2025-11-21 20:45:19,170 - main - INFO -      Documents (MongoDB):
2025-11-21 20:45:19,170 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:45:19,170 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:45:19,170 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:45:19,170 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:45:19,170 - main - INFO - 
2025-11-21 20:45:19,171 - main - INFO -      Diagnostics & Health:
2025-11-21 20:45:19,171 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:45:19,171 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:45:19,171 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:45:19,171 - main - INFO - 
2025-11-21 20:45:19,171 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:45:19,171 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:45:19,172 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:45:19,172 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:45:19,172 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:45:19,172 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:45:19,172 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:45:19,173 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:45:19,173 - main - INFO - 
2025-11-21 20:45:19,173 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:45:19,173 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:45:19,173 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:45:19,173 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:45:19,173 - main - INFO -      4. No re-upload needed!
2025-11-21 20:45:19,174 - main - INFO - 
2025-11-21 20:45:19,174 - main - INFO - ================================================================================
2025-11-21 20:45:19,174 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:45:19,174 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:45:19,174 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:45:19,174 - main - INFO - ================================================================================
2025-11-21 20:45:19,175 - main - INFO - 
2025-11-21 20:45:19,175 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:47:40,921 - main - INFO - 
2025-11-21 20:47:40,922 - main - INFO - ================================================================================
2025-11-21 20:47:40,922 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-21 20:47:40,923 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:47:40,923 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-21 20:47:40,924 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-21 20:47:40,924 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-21 20:47:40,925 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-21 20:47:40,926 - main - INFO -   âœ… User Documents Service connection closed
2025-11-21 20:47:40,926 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-21 20:47:40,926 - main - INFO -   âœ… Application stopped successfully
2025-11-21 20:47:40,927 - main - INFO - ================================================================================
2025-11-21 20:47:40,927 - main - INFO - 
2025-11-21 20:47:45,384 - main - INFO - 
2025-11-21 20:47:45,384 - main - INFO - ================================================================================
2025-11-21 20:47:45,384 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 20:47:45,385 - main - INFO -   Production-Ready Complete Integration
2025-11-21 20:47:45,385 - main - INFO - ================================================================================
2025-11-21 20:47:45,385 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 20:47:45,386 - main - INFO -   Upload Directory: uploads
2025-11-21 20:47:45,386 - main - INFO -   Max File Size: 20MB
2025-11-21 20:47:45,386 - main - INFO - ================================================================================
2025-11-21 20:47:45,387 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 20:47:45,387 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 20:47:45,387 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 20:47:45,406 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 20:47:45,411 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 20:47:45,411 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 20:47:45,412 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 20:47:45,412 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 20:47:45,412 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 20:47:45,412 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:47:45,413 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 20:47:45,438 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 20:47:45,439 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 20:47:45,442 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-21 20:47:45,443 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 4 documents
2025-11-21 20:47:45,444 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 20:47:45,444 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 20:47:45,445 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 20:47:45,445 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 20:47:45,462 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 20:47:45,462 - main - INFO -   âœ… User Documents Service connected
2025-11-21 20:47:45,463 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 20:47:45,463 - main - INFO - 
2025-11-21 20:47:45,463 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 20:47:45,463 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 20:47:45,463 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 20:47:45,464 - main - INFO -        - Separates warranties from extensions
2025-11-21 20:47:45,464 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 20:47:45,464 - main - INFO -        - Correct deductible tier detection
2025-11-21 20:47:45,464 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 20:47:45,465 - main - INFO - 
2025-11-21 20:47:45,465 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 20:47:45,465 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 20:47:45,466 - main - INFO -        - Identifies unique items per provider
2025-11-21 20:47:45,466 - main - INFO -        - Transparent scoring methodology
2025-11-21 20:47:45,466 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 20:47:45,467 - main - INFO - 
2025-11-21 20:47:45,467 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 20:47:45,468 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 20:47:45,468 - main - INFO -        - No manual section generation
2025-11-21 20:47:45,469 - main - INFO -        - Complete MongoDB integration
2025-11-21 20:47:45,469 - main - INFO - 
2025-11-21 20:47:45,470 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 20:47:45,470 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 20:47:45,470 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 20:47:45,470 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 20:47:45,470 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 20:47:45,471 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 20:47:45,471 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 20:47:45,471 - main - INFO - 
2025-11-21 20:47:45,471 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 20:47:45,471 - main - INFO -      Main:
2025-11-21 20:47:45,472 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 20:47:45,472 - main - INFO - 
2025-11-21 20:47:45,472 - main - INFO -      Retrieval:
2025-11-21 20:47:45,472 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 20:47:45,472 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 20:47:45,473 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 20:47:45,473 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 20:47:45,473 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 20:47:45,474 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 20:47:45,474 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 20:47:45,475 - main - INFO - 
2025-11-21 20:47:45,475 - main - INFO -      Management:
2025-11-21 20:47:45,475 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 20:47:45,475 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 20:47:45,476 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 20:47:45,476 - main - INFO - 
2025-11-21 20:47:45,476 - main - INFO -      Documents (MongoDB):
2025-11-21 20:47:45,476 - main - INFO -        GET  /api/documents                All documents
2025-11-21 20:47:45,476 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 20:47:45,477 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 20:47:45,477 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 20:47:45,477 - main - INFO - 
2025-11-21 20:47:45,477 - main - INFO -      Diagnostics & Health:
2025-11-21 20:47:45,478 - main - INFO -        GET  /api/health                   System health
2025-11-21 20:47:45,478 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 20:47:45,478 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 20:47:45,478 - main - INFO - 
2025-11-21 20:47:45,478 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 20:47:45,479 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 20:47:45,479 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 20:47:45,479 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 20:47:45,479 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 20:47:45,480 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 20:47:45,480 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 20:47:45,480 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 20:47:45,480 - main - INFO - 
2025-11-21 20:47:45,481 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 20:47:45,481 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 20:47:45,481 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 20:47:45,481 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 20:47:45,481 - main - INFO -      4. No re-upload needed!
2025-11-21 20:47:45,482 - main - INFO - 
2025-11-21 20:47:45,482 - main - INFO - ================================================================================
2025-11-21 20:47:45,482 - main - INFO -   âœ… Application started successfully!
2025-11-21 20:47:45,482 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 20:47:45,482 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 20:47:45,483 - main - INFO - ================================================================================
2025-11-21 20:47:45,483 - main - INFO - 
2025-11-21 20:47:45,483 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-21 20:53:11,185 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 20:53:11,187 - main - INFO - ðŸ“¥ OPTIONS /api/my-documents
2025-11-21 20:53:11,187 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 20:53:11,188 - main - INFO - ðŸ“¤ OPTIONS /api/my-documents - 200 - 0.00s
2025-11-21 20:53:11,190 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 20:53:11,194 - app.services.user_documents_service - INFO - ðŸ“‹ Found 0 documents for user 6920d09a39168a304198400f
2025-11-21 20:53:11,195 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 20:53:11,197 - main - INFO - ðŸ“¥ GET /api/my-documents
2025-11-21 20:53:11,199 - app.services.user_documents_service - INFO - ðŸ“‹ Found 0 documents for user 6920d09a39168a304198400f
2025-11-21 20:53:11,199 - main - INFO - ðŸ“¤ GET /api/my-documents - 200 - 0.00s
2025-11-21 20:53:37,346 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-21 20:53:37,346 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-21 20:53:37,349 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-21 20:53:37,355 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 6920d09a39168a304198400f
2025-11-21 20:53:37,355 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 6920d09a39168a304198400f
2025-11-21 20:53:37,356 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:53:37,356 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:53:37,358 - app.services.user_subscription_service - INFO - âœ… Found user: muneeb (muneeb2005@gmail.com)
2025-11-21 20:53:37,360 - app.api.routes - INFO - âœ… User 6920d09a39168a304198400f can perform comparison
2025-11-21 20:53:37,360 - app.api.routes - INFO -    - Remaining comparisons: 250
2025-11-21 20:53:37,360 - app.api.routes - INFO -    - Quotes per case: 3
2025-11-21 20:53:37,361 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-21 20:53:37,361 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763758417_4e7dff799ec8
2025-11-21 20:53:37,362 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_aef625e60717 (2 files)
2025-11-21 20:53:37,362 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_aef625e60717
2025-11-21 20:53:37,363 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:53:37,363 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:53:37,363 - app.api.routes - INFO - ======================================================================
2025-11-21 20:53:37,365 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 6b2e68e18cd54566a7320b4a497a5e75.pdf (464206 bytes)
2025-11-21 20:53:37,366 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:53:37,367 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6b2e68e18cd54566a7320b4a497a5e75.pdf
2025-11-21 20:53:37,368 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:53:37,412 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-21 20:53:37,434 - app.api.routes - INFO - ======================================================================
2025-11-21 20:53:37,461 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 83714f1d10a349e5ada89730a22a1c88.pdf (175401 bytes)
2025-11-21 20:53:37,477 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-21 20:53:37,477 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-21 20:53:37,478 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\83714f1d10a349e5ada89730a22a1c88.pdf
2025-11-21 20:53:37,478 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:53:37,478 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:53:37,527 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-21 20:53:37,539 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-21 20:53:37,540 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-21 20:53:37,542 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 20:53:37,543 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 20:53:37,544 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-21 20:53:37,726 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-21 20:53:37,727 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 20:53:38,231 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-21 20:53:38,231 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-21 20:53:38,232 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-21 20:53:38,233 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-21 20:53:38,233 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-21 20:53:38,233 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-21 20:53:38,233 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-21 20:53:38,316 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-21 20:53:38,316 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-21 20:53:57,510 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:53:57,525 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 20:53:57,526 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 20:53:57,526 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 20:53:57,527 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-21 20:53:57,527 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:53:57,528 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-21 20:53:57,535 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-21 20:53:57,535 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-21 20:53:57,536 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 20:54:03,108 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:54:03,113 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 20:54:03,114 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 20:54:03,114 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-21 20:54:03,114 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-21 20:54:03,115 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:54:03,115 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 20:54:03,116 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-21 20:54:09,213 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:54:09,220 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-21 20:54:09,221 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 20:54:09,222 - app.services.ai_parser - INFO - 
2025-11-21 20:54:09,223 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:54:09,224 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:54:09,225 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:54:09,225 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-21 20:54:09,226 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-21 20:54:09,227 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-21 20:54:09,232 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-21 20:54:09,233 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-21 20:54:09,233 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-21 20:54:09,250 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-21 20:54:09,262 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 20:54:09,264 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 20:54:09,265 - app.services.ai_parser - INFO - 
2025-11-21 20:54:09,266 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 20:54:09,267 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-21 20:54:09,268 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-21 20:54:09,268 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-21 20:54:09,268 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 20:54:09,269 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 20:54:09,269 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:54:09,271 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6b2e68e18cd54566a7320b4a497a5e75.pdf â†’ 6920d171d26da686bf43b152
2025-11-21 20:54:09,300 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920d171d26da686bf43b152
2025-11-21 20:54:09,305 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 6920d171d26da686bf43b153 (464206 bytes)
2025-11-21 20:54:09,326 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 6920d171d26da686bf43b153
2025-11-21 20:54:09,327 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-21 20:54:35,048 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:54:35,049 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-21 20:54:35,050 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-21 20:54:35,050 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-21 20:54:35,050 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-21 20:54:41,107 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:54:41,121 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-21 20:54:41,121 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-21 20:54:41,121 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-21 20:54:41,122 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-21 20:54:41,122 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 20:54:41,122 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 20:54:41,122 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-21 20:54:41,123 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-21 20:54:41,123 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-21 20:54:41,123 - app.services.ai_parser - INFO - ðŸ“Š Counts: 37 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-21 20:54:47,527 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:54:47,533 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-21 20:54:47,534 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-21 20:54:47,534 - app.services.ai_parser - INFO - 
2025-11-21 20:54:47,535 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:54:47,536 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-21 20:54:47,537 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:54:47,537 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-21 20:54:47,538 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-21 20:54:47,539 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-21 20:54:47,539 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-21 20:54:47,540 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-21 20:54:47,541 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-21 20:54:47,541 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-21 20:54:47,542 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-21 20:54:47,543 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-21 20:54:47,543 - app.services.ai_parser - INFO - 
2025-11-21 20:54:47,544 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-21 20:54:47,545 - app.services.ai_parser - INFO -    âœ“ Benefits: 37
2025-11-21 20:54:47,545 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-21 20:54:47,546 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-21 20:54:47,547 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-21 20:54:47,547 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-21 20:54:47,547 - app.services.ai_parser - INFO - ======================================================================
2025-11-21 20:54:47,549 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 83714f1d10a349e5ada89730a22a1c88.pdf â†’ 6920d197d26da686bf43b154
2025-11-21 20:54:47,549 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6920d197d26da686bf43b154
2025-11-21 20:54:47,553 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 6920d197d26da686bf43b155 (175401 bytes)
2025-11-21 20:54:47,554 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 6920d197d26da686bf43b155
2025-11-21 20:54:47,554 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-21 20:54:47,554 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-21 20:54:47,554 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:54:47,555 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-21 20:54:47,555 - app.api.routes - INFO - ======================================================================
2025-11-21 20:54:47,555 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-21 20:54:47,555 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-21 20:54:47,555 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-21 20:54:47,556 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 20:54:47,556 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-21 20:54:47,556 - app.services.ai_ranker - INFO - ================================================================================
2025-11-21 20:54:47,556 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 20:54:47,557 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-21 20:54:47,557 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 20:54:47,558 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 20:54:47,558 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:54:47,558 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 20:54:47,559 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 20:54:47,559 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-21 20:54:47,560 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 20:54:47,560 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 20:54:47,560 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 20:54:47,560 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 20:54:47,561 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "Minimization of losses": "SR 250,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Industries Seepage, Pollution and
2025-11-21 20:54:47,563 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 20:54:47,563 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-21 20:54:47,564 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-21 20:54:47,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 20:54:47,564 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 20:54:47,565 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 20:54:47,565 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 20:54:47,566 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 20:54:47,567 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 20:54:47,567 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 20:54:47,568 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 20:54:47,568 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 20:54:47,568 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 20:54:47,569 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 20:54:47,569 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 20:54:47,569 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 20:54:47,569 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-21 20:54:47,570 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 20:54:47,570 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-21 20:54:47,570 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-21 20:54:47,570 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-21 20:54:47,571 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 20:54:47,571 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-21 20:54:47,571 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-21 20:54:47,571 - app.services.ai_ranker - INFO - 
============================================================
2025-11-21 20:54:47,571 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-21 20:54:47,572 - app.services.ai_ranker - INFO - ============================================================
2025-11-21 20:54:47,572 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-21 20:54:47,572 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:54:47,572 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-21 20:54:47,572 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-21 20:54:47,573 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-21 20:54:47,573 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-21 20:54:47,573 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-21 20:54:47,573 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-21 20:54:47,574 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-21 20:54:47,575 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_t
2025-11-21 20:54:47,578 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 20:54:47,579 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-21 20:54:47,579 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-21 20:54:47,579 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-21 20:54:47,580 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-21 20:54:47,580 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-21 20:54:47,580 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-21 20:54:47,580 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-21 20:54:47,581 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-21 20:54:47,581 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-21 20:54:47,581 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-21 20:54:47,582 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-21 20:54:47,582 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-21 20:54:47,583 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-21 20:54:47,583 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-21 20:54:47,584 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-21 20:54:47,585 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-21 20:54:47,585 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-21 20:54:47,586 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-21 20:54:47,586 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-21 20:54:47,586 - app.services.ai_ranker - INFO -    Warranties: 10
2025-11-21 20:54:47,586 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-21 20:54:47,587 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-21 20:54:47,587 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-21 20:54:47,587 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-21 20:54:47,788 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 4
2025-11-21 20:54:47,788 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 20:54:47,788 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 20:54:47,789 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-21 20:54:47,789 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 20:54:47,789 - app.services.ai_ranker - INFO -       â€¢ Bookkeeping warrantee
2025-11-21 20:54:47,790 - app.services.ai_ranker - INFO -       â€¢ Hazardous good warranty
2025-11-21 20:54:47,790 - app.services.ai_ranker - INFO -       â€¢ Warranted no workshop operations on insured premises
2025-11-21 20:54:47,790 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-21 20:54:47,999 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 3
2025-11-21 20:54:47,999 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-21 20:54:47,999 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-21 20:54:47,999 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-21 20:54:48,000 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-21 20:54:48,000 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-21 20:54:48,000 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-21 20:54:48,000 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-21 20:54:48,000 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-21 20:54:48,001 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-21 20:54:48,001 - app.services.ai_ranker - INFO - ================================================================================

2025-11-21 20:54:48,001 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=86.52
2025-11-21 20:54:48,002 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=83.92
2025-11-21 20:54:48,002 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-21 20:54:48,002 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-21 20:54:56,960 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-21 20:54:56,967 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-21 20:54:56,968 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-21 20:54:56,969 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-21 20:54:56,971 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-21 20:54:56,971 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-21 20:54:56,972 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763758417_4e7dff799ec8
2025-11-21 20:54:56,973 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-21 20:54:56,973 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-21 20:54:56,974 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-21 20:54:56,975 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-21 20:54:56,976 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 20:54:56,976 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 20:54:56,977 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 20:54:56,978 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 20:54:56,979 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 20:54:56,979 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 20:54:56,980 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-21 20:54:56,981 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-21 20:54:56,982 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-21 20:54:56,983 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-21 20:54:56,983 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-21 20:54:56,984 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-21 20:54:56,985 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-21 20:54:56,990 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-21 20:54:56,990 - app.services.mongodb_service_enhanced - INFO -    Summary: 2,916 bytes
2025-11-21 20:54:56,991 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 20,504 bytes
2025-11-21 20:54:56,991 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,510 bytes
2025-11-21 20:54:56,991 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,452 bytes
2025-11-21 20:54:56,992 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 33,099 bytes
2025-11-21 20:54:56,992 - app.services.mongodb_service_enhanced - INFO -    Total document: 140,181 bytes
2025-11-21 20:54:56,993 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-21 20:54:56,993 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-21 20:54:56,994 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-21 20:54:56,994 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-21 20:54:56,995 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-21 20:54:56,995 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-21 20:54:56,995 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-21 20:54:56,996 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-21 20:54:56,996 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-21 20:54:56,996 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-21 20:54:56,997 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-21 20:54:56,997 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-21 20:54:56,997 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-21 20:54:56,998 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-21 20:54:56,998 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-21 20:54:56,998 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-21 20:54:56,999 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-21 20:54:56,999 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 20:54:57,000 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:54:57,001 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-21 20:54:57,004 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763758417_4e7dff799ec8
2025-11-21 20:54:57,005 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6920d1a1b757af6a8efab056
2025-11-21 20:54:57,007 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-21 20:54:57,008 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-21 20:54:57,008 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-21 20:54:57,009 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-21 20:54:57,009 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-21 20:54:57,009 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-21 20:54:57,010 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-21 20:54:57,010 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-21 20:54:57,010 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-21 20:54:57,011 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-21 20:54:57,011 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-21 20:54:57,011 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-21 20:54:57,011 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-21 20:54:57,012 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-21 20:54:57,012 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-21 20:54:57,012 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-21 20:54:57,012 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-21 20:54:57,013 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-21 20:54:57,013 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-21 20:54:57,013 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6920d1a1b757af6a8efab056
2025-11-21 20:54:57,013 - app.api.routes - INFO -    Database: hakemAI
2025-11-21 20:54:57,014 - app.api.routes - INFO -    Collection: comparisons
2025-11-21 20:54:57,014 - app.api.routes - INFO -    Comparison ID: cmp_1763758417_4e7dff799ec8
2025-11-21 20:54:57,018 - app.services.user_subscription_service - INFO - âœ… Recorded comparison usage for user 6920d09a39168a304198400f
2025-11-21 20:54:57,018 - app.api.routes - INFO - âœ… Recorded comparison usage for user 6920d09a39168a304198400f
2025-11-21 20:54:57,018 - app.api.routes - INFO - 
======================================================================
2025-11-21 20:54:57,019 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-21 20:54:57,019 - app.api.routes - INFO - ======================================================================
2025-11-21 20:54:57,019 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763758417_4e7dff799ec8
2025-11-21 20:54:57,019 - app.api.routes - INFO - ðŸ‘¤ User ID: 6920d09a39168a304198400f
2025-11-21 20:54:57,019 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-21 20:54:57,020 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-21 20:54:57,020 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 6920d09a39168a304198400f
2025-11-21 20:54:57,020 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-21 20:54:57,020 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-21 20:54:57,021 - app.services.user_subscription_service - INFO - âœ… Found user: muneeb (muneeb2005@gmail.com)
2025-11-21 20:54:57,022 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: 249
2025-11-21 20:54:57,022 - app.api.routes - INFO - ======================================================================

2025-11-21 20:54:57,023 - app.services.progress_tracker - INFO - âœ… Job completed: job_aef625e60717 â†’ comparison_id: cmp_1763758417_4e7dff799ec8
2025-11-21 20:54:57,024 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 79.68s
2025-11-21 21:02:45,501 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-21 21:02:45,502 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-21 21:16:16,982 - main - INFO - 
2025-11-21 21:16:16,982 - main - INFO - ================================================================================
2025-11-21 21:16:16,982 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-21 21:16:16,982 - main - INFO -   Production-Ready Complete Integration
2025-11-21 21:16:16,983 - main - INFO - ================================================================================
2025-11-21 21:16:16,983 - main - INFO -   AI Model: gpt-4o-mini
2025-11-21 21:16:16,983 - main - INFO -   Upload Directory: uploads
2025-11-21 21:16:16,983 - main - INFO -   Max File Size: 20MB
2025-11-21 21:16:16,983 - main - INFO - ================================================================================
2025-11-21 21:16:16,984 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-21 21:16:16,984 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-21 21:16:16,984 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-21 21:16:17,006 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-21 21:16:17,017 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-21 21:16:17,018 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-21 21:16:17,018 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-21 21:16:17,018 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-21 21:16:17,019 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-21 21:16:17,019 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 21:16:17,019 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-21 21:16:17,030 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-21 21:16:17,031 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-21 21:16:17,032 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-21 21:16:17,034 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 5 documents
2025-11-21 21:16:17,034 - main - INFO -   âœ… User Subscription Service connected
2025-11-21 21:16:17,035 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-21 21:16:17,035 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-21 21:16:17,035 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-21 21:16:17,045 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-21 21:16:17,045 - main - INFO -   âœ… User Documents Service connected
2025-11-21 21:16:17,046 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-21 21:16:17,046 - main - INFO - 
2025-11-21 21:16:17,046 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-21 21:16:17,046 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-21 21:16:17,047 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-21 21:16:17,047 - main - INFO -        - Separates warranties from extensions
2025-11-21 21:16:17,047 - main - INFO -        - Extracts subjectivities & operational details
2025-11-21 21:16:17,047 - main - INFO -        - Correct deductible tier detection
2025-11-21 21:16:17,047 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-21 21:16:17,048 - main - INFO - 
2025-11-21 21:16:17,048 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-21 21:16:17,048 - main - INFO -        - Generates ALL sections comprehensively
2025-11-21 21:16:17,048 - main - INFO -        - Identifies unique items per provider
2025-11-21 21:16:17,048 - main - INFO -        - Transparent scoring methodology
2025-11-21 21:16:17,048 - main - INFO -        - Uses full _extended_data from parser
2025-11-21 21:16:17,049 - main - INFO - 
2025-11-21 21:16:17,049 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-21 21:16:17,049 - main - INFO -        - Single endpoint auto-populates everything
2025-11-21 21:16:17,049 - main - INFO -        - No manual section generation
2025-11-21 21:16:17,049 - main - INFO -        - Complete MongoDB integration
2025-11-21 21:16:17,049 - main - INFO - 
2025-11-21 21:16:17,050 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-21 21:16:17,050 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-21 21:16:17,050 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-21 21:16:17,050 - main - INFO -      âœ… Subjectivities: Now included
2025-11-21 21:16:17,050 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-21 21:16:17,050 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-21 21:16:17,050 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-21 21:16:17,051 - main - INFO - 
2025-11-21 21:16:17,051 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-21 21:16:17,051 - main - INFO -      Main:
2025-11-21 21:16:17,051 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-21 21:16:17,051 - main - INFO - 
2025-11-21 21:16:17,051 - main - INFO -      Retrieval:
2025-11-21 21:16:17,052 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-21 21:16:17,052 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-21 21:16:17,052 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-21 21:16:17,052 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-21 21:16:17,052 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-21 21:16:17,052 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-21 21:16:17,053 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-21 21:16:17,053 - main - INFO - 
2025-11-21 21:16:17,053 - main - INFO -      Management:
2025-11-21 21:16:17,053 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-21 21:16:17,053 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-21 21:16:17,053 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-21 21:16:17,053 - main - INFO - 
2025-11-21 21:16:17,054 - main - INFO -      Documents (MongoDB):
2025-11-21 21:16:17,054 - main - INFO -        GET  /api/documents                All documents
2025-11-21 21:16:17,054 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-21 21:16:17,054 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-21 21:16:17,054 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-21 21:16:17,054 - main - INFO - 
2025-11-21 21:16:17,054 - main - INFO -      Diagnostics & Health:
2025-11-21 21:16:17,055 - main - INFO -        GET  /api/health                   System health
2025-11-21 21:16:17,055 - main - INFO -        GET  /api/status                   Detailed status
2025-11-21 21:16:17,055 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-21 21:16:17,055 - main - INFO - 
2025-11-21 21:16:17,055 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-21 21:16:17,055 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-21 21:16:17,056 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-21 21:16:17,056 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-21 21:16:17,056 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-21 21:16:17,056 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-21 21:16:17,056 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-21 21:16:17,056 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-21 21:16:17,056 - main - INFO - 
2025-11-21 21:16:17,057 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-21 21:16:17,057 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-21 21:16:17,057 - main - INFO -      2. Receive comparison_id + complete data
2025-11-21 21:16:17,057 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-21 21:16:17,057 - main - INFO -      4. No re-upload needed!
2025-11-21 21:16:17,058 - main - INFO - 
2025-11-21 21:16:17,058 - main - INFO - ================================================================================
2025-11-21 21:16:17,058 - main - INFO -   âœ… Application started successfully!
2025-11-21 21:16:17,058 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-21 21:16:17,058 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-21 21:16:17,059 - main - INFO - ================================================================================
2025-11-21 21:16:17,059 - main - INFO - 
2025-11-21 21:16:17,059 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 14:33:40,643 - main - INFO - 
2025-11-24 14:33:40,644 - main - INFO - ================================================================================
2025-11-24 14:33:40,644 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 14:33:40,644 - main - INFO -   Production-Ready Complete Integration
2025-11-24 14:33:40,644 - main - INFO - ================================================================================
2025-11-24 14:33:40,645 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 14:33:40,645 - main - INFO -   Upload Directory: uploads
2025-11-24 14:33:40,645 - main - INFO -   Max File Size: 20MB
2025-11-24 14:33:40,646 - main - INFO - ================================================================================
2025-11-24 14:33:40,646 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 14:33:40,647 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 14:33:40,647 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 14:33:41,004 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 14:33:41,009 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 14:33:41,009 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 14:33:41,009 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 14:33:41,010 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 14:33:41,010 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 14:33:41,010 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 14:33:41,010 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 14:33:41,021 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 14:33:41,023 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 14:33:41,024 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 14:33:41,026 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 5 documents
2025-11-24 14:33:41,026 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 14:33:41,027 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 14:33:41,027 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 14:33:41,027 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 14:33:41,034 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 14:33:41,035 - main - INFO -   âœ… User Documents Service connected
2025-11-24 14:33:41,035 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 14:33:41,035 - main - INFO - 
2025-11-24 14:33:41,035 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 14:33:41,036 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 14:33:41,036 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 14:33:41,036 - main - INFO -        - Separates warranties from extensions
2025-11-24 14:33:41,036 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 14:33:41,036 - main - INFO -        - Correct deductible tier detection
2025-11-24 14:33:41,036 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 14:33:41,037 - main - INFO - 
2025-11-24 14:33:41,037 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 14:33:41,037 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 14:33:41,037 - main - INFO -        - Identifies unique items per provider
2025-11-24 14:33:41,037 - main - INFO -        - Transparent scoring methodology
2025-11-24 14:33:41,037 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 14:33:41,038 - main - INFO - 
2025-11-24 14:33:41,038 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 14:33:41,038 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 14:33:41,038 - main - INFO -        - No manual section generation
2025-11-24 14:33:41,039 - main - INFO -        - Complete MongoDB integration
2025-11-24 14:33:41,039 - main - INFO - 
2025-11-24 14:33:41,039 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 14:33:41,039 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 14:33:41,039 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 14:33:41,040 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 14:33:41,040 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 14:33:41,040 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 14:33:41,040 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 14:33:41,040 - main - INFO - 
2025-11-24 14:33:41,040 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 14:33:41,041 - main - INFO -      Main:
2025-11-24 14:33:41,041 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 14:33:41,041 - main - INFO - 
2025-11-24 14:33:41,041 - main - INFO -      Retrieval:
2025-11-24 14:33:41,042 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 14:33:41,042 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 14:33:41,042 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 14:33:41,042 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 14:33:41,043 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 14:33:41,043 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 14:33:41,044 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 14:33:41,044 - main - INFO - 
2025-11-24 14:33:41,045 - main - INFO -      Management:
2025-11-24 14:33:41,045 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 14:33:41,046 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 14:33:41,046 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 14:33:41,046 - main - INFO - 
2025-11-24 14:33:41,046 - main - INFO -      Documents (MongoDB):
2025-11-24 14:33:41,046 - main - INFO -        GET  /api/documents                All documents
2025-11-24 14:33:41,047 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 14:33:41,047 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 14:33:41,047 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 14:33:41,047 - main - INFO - 
2025-11-24 14:33:41,047 - main - INFO -      Diagnostics & Health:
2025-11-24 14:33:41,047 - main - INFO -        GET  /api/health                   System health
2025-11-24 14:33:41,048 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 14:33:41,048 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 14:33:41,048 - main - INFO - 
2025-11-24 14:33:41,048 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 14:33:41,048 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 14:33:41,049 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 14:33:41,049 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 14:33:41,049 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 14:33:41,049 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 14:33:41,050 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 14:33:41,050 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 14:33:41,050 - main - INFO - 
2025-11-24 14:33:41,050 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 14:33:41,051 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 14:33:41,051 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 14:33:41,051 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 14:33:41,051 - main - INFO -      4. No re-upload needed!
2025-11-24 14:33:41,052 - main - INFO - 
2025-11-24 14:33:41,052 - main - INFO - ================================================================================
2025-11-24 14:33:41,052 - main - INFO -   âœ… Application started successfully!
2025-11-24 14:33:41,052 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 14:33:41,053 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 14:33:41,053 - main - INFO - ================================================================================
2025-11-24 14:33:41,053 - main - INFO - 
2025-11-24 14:33:41,054 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 14:36:53,481 - main - INFO - ðŸ“¥ OPTIONS /api/compare-quotes
2025-11-24 14:36:53,483 - main - INFO - ðŸ“¤ OPTIONS /api/compare-quotes - 200 - 0.00s
2025-11-24 14:36:53,487 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-24 14:36:53,493 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 69246d39cef2eda144750f02
2025-11-24 14:36:53,493 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 69246d39cef2eda144750f02
2025-11-24 14:36:53,494 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 14:36:53,494 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 14:36:53,498 - app.services.user_subscription_service - INFO - âœ… Found user: ali (ali@gmail.com)
2025-11-24 14:36:53,502 - app.api.routes - INFO - âœ… User 69246d39cef2eda144750f02 can perform comparison
2025-11-24 14:36:53,502 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-24 14:36:53,502 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-24 14:36:53,503 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-24 14:36:53,503 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763995013_cbcfaec36362
2025-11-24 14:36:53,504 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_ae7f017e67a0 (1 files)
2025-11-24 14:36:53,504 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_ae7f017e67a0
2025-11-24 14:36:53,504 - app.api.routes - INFO - 
======================================================================
2025-11-24 14:36:53,505 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 14:36:53,506 - app.api.routes - INFO - ======================================================================
2025-11-24 14:36:53,508 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ ed77fe80e40f4401aba38d730460e66c.pdf (464206 bytes)
2025-11-24 14:36:53,509 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 14:36:53,509 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\ed77fe80e40f4401aba38d730460e66c.pdf
2025-11-24 14:36:53,683 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-24 14:36:53,684 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 14:36:53,684 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 14:36:53,685 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-24 14:36:53,686 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-24 14:36:53,687 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 14:36:53,687 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 14:36:53,687 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-24 14:36:53,869 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-24 14:36:53,870 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 14:37:28,515 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:37:28,526 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 14:37:28,526 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 14:37:28,527 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 14:37:28,527 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-24 14:37:28,528 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 14:37:28,528 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-24 14:37:28,536 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-24 14:37:28,537 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-24 14:37:28,538 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 14:37:35,674 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:37:35,685 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 14:37:35,686 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 14:37:35,686 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-24 14:37:35,687 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-24 14:37:35,687 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 14:37:35,687 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 14:37:35,687 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-24 14:37:42,308 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 14:37:42,319 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 14:37:42,319 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 14:37:42,320 - app.services.ai_parser - INFO - 
2025-11-24 14:37:42,321 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 14:37:42,321 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 14:37:42,321 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 14:37:42,321 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-24 14:37:42,322 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 14:37:42,322 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-24 14:37:42,322 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-24 14:37:42,322 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 14:37:42,322 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 14:37:42,323 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 14:37:42,323 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 14:37:42,323 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 14:37:42,323 - app.services.ai_parser - INFO - 
2025-11-24 14:37:42,323 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 14:37:42,324 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-24 14:37:42,324 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-24 14:37:42,324 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-24 14:37:42,324 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 14:37:42,325 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 14:37:42,325 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 14:37:42,326 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: ed77fe80e40f4401aba38d730460e66c.pdf â†’ 69246db69b63c194bee3ad3a
2025-11-24 14:37:42,327 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69246db69b63c194bee3ad3a
2025-11-24 14:37:42,332 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69246db69b63c194bee3ad3b (464206 bytes)
2025-11-24 14:37:42,332 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69246db69b63c194bee3ad3b
2025-11-24 14:37:42,332 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 14:37:42,333 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-24 14:37:42,333 - app.api.routes - INFO - 
======================================================================
2025-11-24 14:37:42,333 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-24 14:37:42,333 - app.api.routes - INFO - ======================================================================
2025-11-24 14:37:42,334 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-24 14:37:42,334 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763995013_cbcfaec36362
2025-11-24 14:37:42,334 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-24 14:37:42,334 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-24 14:37:42,335 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-24 14:37:42,335 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-24 14:37:42,335 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 14:37:42,335 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 14:37:42,336 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 14:37:42,336 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 14:37:42,336 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 14:37:42,336 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 14:37:42,338 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-24 14:37:42,338 - app.services.mongodb_service_enhanced - INFO -    Summary: 1,108 bytes
2025-11-24 14:37:42,339 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-24 14:37:42,339 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-24 14:37:42,339 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-24 14:37:42,339 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,696 bytes
2025-11-24 14:37:42,339 - app.services.mongodb_service_enhanced - INFO -    Total document: 33,227 bytes
2025-11-24 14:37:42,340 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-24 14:37:42,340 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-24 14:37:42,340 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 14:37:42,341 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 14:37:42,341 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-24 14:37:42,346 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763995013_cbcfaec36362
2025-11-24 14:37:42,348 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69246db6b757af6a8efab057
2025-11-24 14:37:42,351 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-24 14:37:42,351 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-24 14:37:42,352 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-24 14:37:42,352 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-24 14:37:42,352 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-24 14:37:42,352 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-24 14:37:42,353 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-24 14:37:42,353 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-24 14:37:42,353 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 14:37:42,354 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-24 14:37:42,355 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-24 14:37:42,356 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-24 14:37:42,358 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-24 14:37:42,358 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-24 14:37:42,359 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 14:37:42,359 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69246db6b757af6a8efab057
2025-11-24 14:37:42,359 - app.api.routes - INFO -    Database: hakemAI
2025-11-24 14:37:42,359 - app.api.routes - INFO -    Collection: comparisons
2025-11-24 14:37:42,360 - app.api.routes - INFO -    Comparison ID: cmp_1763995013_cbcfaec36362
2025-11-24 14:37:42,361 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 69246d39cef2eda144750f02
2025-11-24 14:37:42,362 - app.api.routes - INFO - âœ… Recorded comparison usage for user 69246d39cef2eda144750f02
2025-11-24 14:37:42,362 - app.api.routes - INFO - 
======================================================================
2025-11-24 14:37:42,362 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-24 14:37:42,363 - app.api.routes - INFO - ======================================================================
2025-11-24 14:37:42,363 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763995013_cbcfaec36362
2025-11-24 14:37:42,363 - app.api.routes - INFO - ðŸ‘¤ User ID: 69246d39cef2eda144750f02
2025-11-24 14:37:42,363 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-24 14:37:42,364 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-24 14:37:42,364 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 69246d39cef2eda144750f02
2025-11-24 14:37:42,364 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 14:37:42,364 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 14:37:42,366 - app.services.user_subscription_service - INFO - âœ… Found user: ali (ali@gmail.com)
2025-11-24 14:37:42,369 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-24 14:37:42,371 - app.api.routes - INFO - ======================================================================

2025-11-24 14:37:42,371 - app.services.progress_tracker - INFO - âœ… Job completed: job_ae7f017e67a0 â†’ comparison_id: cmp_1763995013_cbcfaec36362
2025-11-24 14:37:42,373 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 48.89s
2025-11-24 14:43:41,071 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-24 14:43:41,071 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-24 15:34:47,732 - main - INFO - 
2025-11-24 15:34:47,732 - main - INFO - ================================================================================
2025-11-24 15:34:47,732 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:34:47,733 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:34:47,733 - main - INFO - ================================================================================
2025-11-24 15:34:47,733 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:34:47,733 - main - INFO -   Upload Directory: uploads
2025-11-24 15:34:47,733 - main - INFO -   Max File Size: 20MB
2025-11-24 15:34:47,733 - main - INFO - ================================================================================
2025-11-24 15:34:47,734 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:34:47,734 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:34:47,734 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:34:47,752 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:34:47,757 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:34:47,757 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:34:47,758 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:34:47,758 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:34:47,759 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:34:47,759 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:34:47,759 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:34:47,767 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:34:47,768 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:34:47,771 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:34:47,775 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:34:47,776 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:34:47,776 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:34:47,776 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:34:47,777 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:34:47,809 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:34:47,809 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:34:47,809 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:34:47,809 - main - INFO - 
2025-11-24 15:34:47,810 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:34:47,810 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:34:47,810 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:34:47,810 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:34:47,810 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:34:47,811 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:34:47,811 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:34:47,811 - main - INFO - 
2025-11-24 15:34:47,811 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:34:47,811 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:34:47,812 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:34:47,812 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:34:47,812 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:34:47,812 - main - INFO - 
2025-11-24 15:34:47,812 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:34:47,812 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:34:47,812 - main - INFO -        - No manual section generation
2025-11-24 15:34:47,813 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:34:47,813 - main - INFO - 
2025-11-24 15:34:47,813 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:34:47,813 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:34:47,813 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:34:47,813 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:34:47,814 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:34:47,814 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:34:47,814 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:34:47,814 - main - INFO - 
2025-11-24 15:34:47,814 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:34:47,814 - main - INFO -      Main:
2025-11-24 15:34:47,815 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:34:47,815 - main - INFO - 
2025-11-24 15:34:47,815 - main - INFO -      Retrieval:
2025-11-24 15:34:47,815 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:34:47,816 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:34:47,816 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:34:47,816 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:34:47,816 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:34:47,816 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:34:47,817 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:34:47,817 - main - INFO - 
2025-11-24 15:34:47,817 - main - INFO -      Management:
2025-11-24 15:34:47,817 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:34:47,818 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:34:47,818 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:34:47,818 - main - INFO - 
2025-11-24 15:34:47,818 - main - INFO -      Documents (MongoDB):
2025-11-24 15:34:47,818 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:34:47,819 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:34:47,819 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:34:47,820 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:34:47,822 - main - INFO - 
2025-11-24 15:34:47,822 - main - INFO -      Diagnostics & Health:
2025-11-24 15:34:47,823 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:34:47,823 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:34:47,824 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:34:47,824 - main - INFO - 
2025-11-24 15:34:47,824 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:34:47,825 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:34:47,825 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:34:47,825 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:34:47,825 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:34:47,826 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:34:47,826 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:34:47,826 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:34:47,826 - main - INFO - 
2025-11-24 15:34:47,827 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:34:47,827 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:34:47,827 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:34:47,827 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:34:47,827 - main - INFO -      4. No re-upload needed!
2025-11-24 15:34:47,827 - main - INFO - 
2025-11-24 15:34:47,828 - main - INFO - ================================================================================
2025-11-24 15:34:47,828 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:34:47,828 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:34:47,828 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:34:47,828 - main - INFO - ================================================================================
2025-11-24 15:34:47,829 - main - INFO - 
2025-11-24 15:34:47,829 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:35:01,051 - main - INFO - ðŸ“¥ GET /docs
2025-11-24 15:35:01,052 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-24 15:35:01,358 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-24 15:35:01,382 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.02s
2025-11-24 15:35:16,298 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-24 15:35:16,302 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-24 15:35:16,302 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:35:16,303 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:35:16,303 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:35:16,307 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:35:16,308 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-24 15:35:16,309 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-24 15:35:16,309 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-24 15:35:16,309 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-24 15:35:16,309 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763998516_9d3e08938cf4
2025-11-24 15:35:16,309 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_4d7dc4f8eb91 (1 files)
2025-11-24 15:35:16,310 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_4d7dc4f8eb91
2025-11-24 15:35:16,310 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:35:16,310 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:35:16,310 - app.api.routes - INFO - ======================================================================
2025-11-24 15:35:16,311 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 6dab721b9c064d16931703f1101d5fb1.pdf (464206 bytes)
2025-11-24 15:35:16,312 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:35:16,312 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6dab721b9c064d16931703f1101d5fb1.pdf
2025-11-24 15:35:16,362 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-24 15:35:16,363 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:35:16,363 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:35:16,363 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-24 15:35:16,364 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-24 15:35:16,364 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:35:16,364 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:35:16,365 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-24 15:35:16,527 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-24 15:35:16,527 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:35:30,562 - main - INFO - 
2025-11-24 15:35:30,563 - main - INFO - ================================================================================
2025-11-24 15:35:30,564 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:35:30,566 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:35:30,567 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:35:30,569 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:35:30,570 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:35:30,572 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:35:30,573 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:35:30,578 - main - INFO -   âœ… Cleaned up 4 temporary files
2025-11-24 15:35:30,579 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:35:30,579 - main - INFO - ================================================================================
2025-11-24 15:35:30,580 - main - INFO - 
2025-11-24 15:35:37,082 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:35:37,086 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:35:37,087 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:35:37,087 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:35:37,087 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-24 15:35:37,088 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:35:37,088 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-24 15:35:37,091 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-24 15:35:37,091 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-24 15:35:37,092 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:35:44,623 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:35:44,627 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:35:44,628 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:35:44,629 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-24 15:35:44,629 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-24 15:35:44,630 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:35:44,631 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:35:44,631 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-24 15:35:50,758 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:35:50,761 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:35:50,762 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:35:50,762 - app.services.ai_parser - INFO - 
2025-11-24 15:35:50,763 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:35:50,764 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:35:50,765 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:35:50,765 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-24 15:35:50,766 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:35:50,767 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-24 15:35:50,767 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-24 15:35:50,768 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:35:50,769 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 15:35:50,769 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:35:50,770 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:35:50,771 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:35:50,772 - app.services.ai_parser - INFO - 
2025-11-24 15:35:50,772 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:35:50,773 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-24 15:35:50,774 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-24 15:35:50,774 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-24 15:35:50,775 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:35:50,776 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:35:50,777 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:35:50,780 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6dab721b9c064d16931703f1101d5fb1.pdf â†’ 69247b569b63c194bee3ad3c
2025-11-24 15:35:50,781 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247b569b63c194bee3ad3c
2025-11-24 15:35:50,790 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247b569b63c194bee3ad3d (464206 bytes)
2025-11-24 15:35:50,790 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247b569b63c194bee3ad3d
2025-11-24 15:35:50,790 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:35:50,791 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-24 15:35:50,791 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:35:50,792 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-24 15:35:50,792 - app.api.routes - INFO - ======================================================================
2025-11-24 15:35:50,793 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-24 15:35:50,793 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763998516_9d3e08938cf4
2025-11-24 15:35:50,793 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-24 15:35:50,794 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-24 15:35:50,794 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-24 15:35:50,795 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-24 15:35:50,795 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 15:35:50,795 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 15:35:50,795 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 15:35:50,796 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 15:35:50,796 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 15:35:50,796 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 15:35:50,797 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-24 15:35:50,797 - app.services.mongodb_service_enhanced - INFO -    Summary: 1,022 bytes
2025-11-24 15:35:50,798 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-24 15:35:50,798 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-24 15:35:50,798 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-24 15:35:50,798 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 14,346 bytes
2025-11-24 15:35:50,799 - app.services.mongodb_service_enhanced - INFO -    Total document: 32,355 bytes
2025-11-24 15:35:50,799 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-24 15:35:50,799 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-24 15:35:50,800 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:35:50,801 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:35:50,802 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-24 15:35:50,804 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763998516_9d3e08938cf4
2025-11-24 15:35:50,804 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69247b56b757af6a8efab058
2025-11-24 15:35:50,807 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-24 15:35:50,807 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-24 15:35:50,807 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-24 15:35:50,808 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-24 15:35:50,808 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-24 15:35:50,808 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-24 15:35:50,808 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-24 15:35:50,808 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-24 15:35:50,809 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:35:50,809 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-24 15:35:50,809 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-24 15:35:50,810 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-24 15:35:50,810 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-24 15:35:50,810 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-24 15:35:50,810 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:35:50,811 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69247b56b757af6a8efab058
2025-11-24 15:35:50,811 - app.api.routes - INFO -    Database: hakemAI
2025-11-24 15:35:50,811 - app.api.routes - INFO -    Collection: comparisons
2025-11-24 15:35:50,812 - app.api.routes - INFO -    Comparison ID: cmp_1763998516_9d3e08938cf4
2025-11-24 15:35:50,813 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-24 15:35:50,813 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-24 15:35:50,813 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:35:50,813 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-24 15:35:50,814 - app.api.routes - INFO - ======================================================================
2025-11-24 15:35:50,814 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763998516_9d3e08938cf4
2025-11-24 15:35:50,814 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-24 15:35:50,814 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-24 15:35:50,815 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-24 15:35:50,815 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:35:50,815 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:35:50,816 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:35:50,817 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:35:50,821 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-24 15:35:50,821 - app.api.routes - INFO - ======================================================================

2025-11-24 15:35:50,822 - app.services.progress_tracker - INFO - âœ… Job completed: job_4d7dc4f8eb91 â†’ comparison_id: cmp_1763998516_9d3e08938cf4
2025-11-24 15:35:50,823 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 34.52s
2025-11-24 15:36:36,108 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_single_20251124153550/pdf
2025-11-24 15:36:36,109 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_single_20251124153550
2025-11-24 15:36:36,113 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_single_20251124153550/pdf - 404 - 0.01s
2025-11-24 15:39:57,359 - main - INFO - 
2025-11-24 15:39:57,359 - main - INFO - ================================================================================
2025-11-24 15:39:57,359 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:39:57,360 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:39:57,360 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:39:57,364 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:39:57,365 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:39:57,366 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:39:57,366 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:39:57,367 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:39:57,367 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:39:57,367 - main - INFO - ================================================================================
2025-11-24 15:39:57,367 - main - INFO - 
2025-11-24 15:40:00,520 - main - INFO - 
2025-11-24 15:40:00,521 - main - INFO - ================================================================================
2025-11-24 15:40:00,521 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:00,522 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:00,523 - main - INFO - ================================================================================
2025-11-24 15:40:00,523 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:00,524 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:00,524 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:00,524 - main - INFO - ================================================================================
2025-11-24 15:40:00,525 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:00,525 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:00,526 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:00,546 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:00,551 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:00,551 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:00,552 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:00,552 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:00,552 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:00,552 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:00,553 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:00,578 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:00,580 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:00,581 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:00,584 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:00,584 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:00,584 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:00,585 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:00,585 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:00,621 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:00,621 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:00,621 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:00,622 - main - INFO - 
2025-11-24 15:40:00,622 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:00,623 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:00,623 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:00,623 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:00,624 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:00,624 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:00,624 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:00,625 - main - INFO - 
2025-11-24 15:40:00,625 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:00,625 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:00,625 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:00,625 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:00,626 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:00,626 - main - INFO - 
2025-11-24 15:40:00,626 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:00,626 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:00,627 - main - INFO -        - No manual section generation
2025-11-24 15:40:00,627 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:00,627 - main - INFO - 
2025-11-24 15:40:00,627 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:00,627 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:00,628 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:00,628 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:00,628 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:00,628 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:00,628 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:00,629 - main - INFO - 
2025-11-24 15:40:00,629 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:00,629 - main - INFO -      Main:
2025-11-24 15:40:00,629 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:00,629 - main - INFO - 
2025-11-24 15:40:00,630 - main - INFO -      Retrieval:
2025-11-24 15:40:00,630 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:00,630 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:00,630 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:00,631 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:00,631 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:00,631 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:00,631 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:00,631 - main - INFO - 
2025-11-24 15:40:00,631 - main - INFO -      Management:
2025-11-24 15:40:00,632 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:00,632 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:00,632 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:00,632 - main - INFO - 
2025-11-24 15:40:00,632 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:00,632 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:00,633 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:00,633 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:00,633 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:00,633 - main - INFO - 
2025-11-24 15:40:00,633 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:00,633 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:00,633 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:00,634 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:00,634 - main - INFO - 
2025-11-24 15:40:00,634 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:00,634 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:00,634 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:00,635 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:00,635 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:00,635 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:00,635 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:00,635 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:00,635 - main - INFO - 
2025-11-24 15:40:00,636 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:00,636 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:00,636 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:00,636 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:00,636 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:00,636 - main - INFO - 
2025-11-24 15:40:00,636 - main - INFO - ================================================================================
2025-11-24 15:40:00,637 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:00,637 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:00,637 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:00,637 - main - INFO - ================================================================================
2025-11-24 15:40:00,637 - main - INFO - 
2025-11-24 15:40:00,638 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:40:04,611 - main - INFO - 
2025-11-24 15:40:04,611 - main - INFO - ================================================================================
2025-11-24 15:40:04,611 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:40:04,612 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:04,612 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:40:04,613 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:04,613 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:40:04,614 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:40:04,614 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:40:04,614 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:40:04,614 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:40:04,615 - main - INFO - ================================================================================
2025-11-24 15:40:04,615 - main - INFO - 
2025-11-24 15:40:08,240 - main - INFO - 
2025-11-24 15:40:08,240 - main - INFO - ================================================================================
2025-11-24 15:40:08,240 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:08,241 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:08,241 - main - INFO - ================================================================================
2025-11-24 15:40:08,241 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:08,242 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:08,242 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:08,242 - main - INFO - ================================================================================
2025-11-24 15:40:08,244 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:08,245 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:08,246 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:08,266 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:08,270 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:08,271 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:08,271 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:08,271 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:08,272 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:08,272 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:08,272 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:08,282 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:08,283 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:08,284 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:08,285 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:08,286 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:08,286 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:08,286 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:08,286 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:08,297 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:08,297 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:08,297 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:08,297 - main - INFO - 
2025-11-24 15:40:08,297 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:08,298 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:08,298 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:08,298 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:08,298 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:08,298 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:08,299 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:08,299 - main - INFO - 
2025-11-24 15:40:08,299 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:08,299 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:08,299 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:08,300 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:08,300 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:08,300 - main - INFO - 
2025-11-24 15:40:08,300 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:08,300 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:08,300 - main - INFO -        - No manual section generation
2025-11-24 15:40:08,301 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:08,301 - main - INFO - 
2025-11-24 15:40:08,301 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:08,301 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:08,301 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:08,302 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:08,302 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:08,302 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:08,302 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:08,302 - main - INFO - 
2025-11-24 15:40:08,302 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:08,303 - main - INFO -      Main:
2025-11-24 15:40:08,303 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:08,303 - main - INFO - 
2025-11-24 15:40:08,303 - main - INFO -      Retrieval:
2025-11-24 15:40:08,303 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:08,304 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:08,304 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:08,304 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:08,304 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:08,304 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:08,304 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:08,304 - main - INFO - 
2025-11-24 15:40:08,305 - main - INFO -      Management:
2025-11-24 15:40:08,305 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:08,305 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:08,305 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:08,306 - main - INFO - 
2025-11-24 15:40:08,306 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:08,306 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:08,306 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:08,306 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:08,306 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:08,306 - main - INFO - 
2025-11-24 15:40:08,307 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:08,307 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:08,307 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:08,307 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:08,308 - main - INFO - 
2025-11-24 15:40:08,308 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:08,308 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:08,309 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:08,309 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:08,310 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:08,311 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:08,312 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:08,312 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:08,313 - main - INFO - 
2025-11-24 15:40:08,313 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:08,313 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:08,313 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:08,313 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:08,314 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:08,314 - main - INFO - 
2025-11-24 15:40:08,314 - main - INFO - ================================================================================
2025-11-24 15:40:08,314 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:08,314 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:08,314 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:08,315 - main - INFO - ================================================================================
2025-11-24 15:40:08,315 - main - INFO - 
2025-11-24 15:40:08,315 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:40:11,398 - main - INFO - 
2025-11-24 15:40:11,398 - main - INFO - ================================================================================
2025-11-24 15:40:11,398 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:11,399 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:11,399 - main - INFO - ================================================================================
2025-11-24 15:40:11,399 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:11,399 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:11,400 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:11,400 - main - INFO - ================================================================================
2025-11-24 15:40:11,400 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:11,400 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:11,401 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:11,417 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:11,421 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:11,421 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:11,422 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:11,422 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:11,422 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:11,422 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:11,423 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:11,430 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:11,431 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:11,432 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:11,433 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:11,433 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:11,434 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:11,434 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:11,434 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:11,440 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:11,441 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:11,441 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:11,441 - main - INFO - 
2025-11-24 15:40:11,442 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:11,442 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:11,442 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:11,443 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:11,443 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:11,443 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:11,443 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:11,444 - main - INFO - 
2025-11-24 15:40:11,444 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:11,444 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:11,444 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:11,445 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:11,445 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:11,445 - main - INFO - 
2025-11-24 15:40:11,445 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:11,445 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:11,446 - main - INFO -        - No manual section generation
2025-11-24 15:40:11,446 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:11,446 - main - INFO - 
2025-11-24 15:40:11,446 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:11,446 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:11,447 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:11,447 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:11,447 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:11,447 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:11,448 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:11,448 - main - INFO - 
2025-11-24 15:40:11,448 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:11,448 - main - INFO -      Main:
2025-11-24 15:40:11,449 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:11,449 - main - INFO - 
2025-11-24 15:40:11,449 - main - INFO -      Retrieval:
2025-11-24 15:40:11,449 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:11,450 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:11,450 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:11,450 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:11,450 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:11,450 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:11,450 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:11,451 - main - INFO - 
2025-11-24 15:40:11,451 - main - INFO -      Management:
2025-11-24 15:40:11,451 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:11,451 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:11,452 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:11,452 - main - INFO - 
2025-11-24 15:40:11,453 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:11,453 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:11,453 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:11,454 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:11,454 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:11,454 - main - INFO - 
2025-11-24 15:40:11,455 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:11,455 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:11,455 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:11,455 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:11,455 - main - INFO - 
2025-11-24 15:40:11,456 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:11,456 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:11,456 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:11,456 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:11,456 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:11,457 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:11,457 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:11,457 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:11,457 - main - INFO - 
2025-11-24 15:40:11,457 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:11,458 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:11,458 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:11,458 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:11,458 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:11,458 - main - INFO - 
2025-11-24 15:40:11,458 - main - INFO - ================================================================================
2025-11-24 15:40:11,459 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:11,459 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:11,459 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:11,459 - main - INFO - ================================================================================
2025-11-24 15:40:11,459 - main - INFO - 
2025-11-24 15:40:11,460 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:40:16,848 - main - INFO - 
2025-11-24 15:40:16,848 - main - INFO - ================================================================================
2025-11-24 15:40:16,849 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:40:16,850 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:16,850 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:40:16,851 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:16,851 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:40:16,852 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:40:16,852 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:40:16,853 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:40:16,853 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:40:16,853 - main - INFO - ================================================================================
2025-11-24 15:40:16,853 - main - INFO - 
2025-11-24 15:40:20,029 - main - INFO - 
2025-11-24 15:40:20,029 - main - INFO - ================================================================================
2025-11-24 15:40:20,030 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:20,030 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:20,030 - main - INFO - ================================================================================
2025-11-24 15:40:20,030 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:20,030 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:20,031 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:20,031 - main - INFO - ================================================================================
2025-11-24 15:40:20,031 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:20,031 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:20,032 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:20,053 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:20,061 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:20,061 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:20,061 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:20,061 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:20,062 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:20,062 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:20,062 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:20,068 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:20,070 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:20,075 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:20,077 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:20,078 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:20,078 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:20,078 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:20,078 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:20,085 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:20,086 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:20,086 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:20,086 - main - INFO - 
2025-11-24 15:40:20,087 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:20,087 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:20,087 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:20,088 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:20,088 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:20,088 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:20,089 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:20,089 - main - INFO - 
2025-11-24 15:40:20,090 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:20,091 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:20,092 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:20,092 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:20,092 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:20,093 - main - INFO - 
2025-11-24 15:40:20,093 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:20,093 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:20,093 - main - INFO -        - No manual section generation
2025-11-24 15:40:20,094 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:20,094 - main - INFO - 
2025-11-24 15:40:20,094 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:20,094 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:20,094 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:20,095 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:20,095 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:20,095 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:20,095 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:20,095 - main - INFO - 
2025-11-24 15:40:20,095 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:20,096 - main - INFO -      Main:
2025-11-24 15:40:20,096 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:20,096 - main - INFO - 
2025-11-24 15:40:20,096 - main - INFO -      Retrieval:
2025-11-24 15:40:20,096 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:20,096 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:20,096 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:20,097 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:20,097 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:20,097 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:20,097 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:20,097 - main - INFO - 
2025-11-24 15:40:20,098 - main - INFO -      Management:
2025-11-24 15:40:20,098 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:20,098 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:20,098 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:20,098 - main - INFO - 
2025-11-24 15:40:20,098 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:20,098 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:20,099 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:20,099 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:20,099 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:20,099 - main - INFO - 
2025-11-24 15:40:20,100 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:20,100 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:20,100 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:20,100 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:20,100 - main - INFO - 
2025-11-24 15:40:20,101 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:20,101 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:20,101 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:20,101 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:20,101 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:20,102 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:20,102 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:20,102 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:20,103 - main - INFO - 
2025-11-24 15:40:20,103 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:20,103 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:20,103 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:20,103 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:20,104 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:20,104 - main - INFO - 
2025-11-24 15:40:20,104 - main - INFO - ================================================================================
2025-11-24 15:40:20,104 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:20,104 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:20,105 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:20,106 - main - INFO - ================================================================================
2025-11-24 15:40:20,106 - main - INFO - 
2025-11-24 15:40:20,107 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:40:23,964 - main - INFO - 
2025-11-24 15:40:23,964 - main - INFO - ================================================================================
2025-11-24 15:40:23,964 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:40:23,965 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:23,966 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:40:23,966 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:23,967 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:40:23,967 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:40:23,968 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:40:23,968 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:40:23,969 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:40:23,969 - main - INFO - ================================================================================
2025-11-24 15:40:23,969 - main - INFO - 
2025-11-24 15:40:27,312 - main - INFO - 
2025-11-24 15:40:27,312 - main - INFO - ================================================================================
2025-11-24 15:40:27,313 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:27,313 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:27,313 - main - INFO - ================================================================================
2025-11-24 15:40:27,313 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:27,313 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:27,314 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:27,314 - main - INFO - ================================================================================
2025-11-24 15:40:27,314 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:27,314 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:27,315 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:27,338 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:27,345 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:27,345 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:27,346 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:27,346 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:27,346 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:27,346 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:27,347 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:27,358 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:27,359 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:27,360 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:27,363 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:27,363 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:27,363 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:27,364 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:27,364 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:27,371 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:27,373 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:27,373 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:27,374 - main - INFO - 
2025-11-24 15:40:27,374 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:27,374 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:27,374 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:27,375 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:27,375 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:27,375 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:27,375 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:27,376 - main - INFO - 
2025-11-24 15:40:27,376 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:27,376 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:27,376 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:27,376 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:27,377 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:27,377 - main - INFO - 
2025-11-24 15:40:27,377 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:27,377 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:27,377 - main - INFO -        - No manual section generation
2025-11-24 15:40:27,377 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:27,378 - main - INFO - 
2025-11-24 15:40:27,378 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:27,378 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:27,378 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:27,378 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:27,378 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:27,379 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:27,379 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:27,379 - main - INFO - 
2025-11-24 15:40:27,379 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:27,379 - main - INFO -      Main:
2025-11-24 15:40:27,379 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:27,380 - main - INFO - 
2025-11-24 15:40:27,380 - main - INFO -      Retrieval:
2025-11-24 15:40:27,380 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:27,380 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:27,380 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:27,380 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:27,381 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:27,381 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:27,381 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:27,381 - main - INFO - 
2025-11-24 15:40:27,381 - main - INFO -      Management:
2025-11-24 15:40:27,381 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:27,382 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:27,382 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:27,382 - main - INFO - 
2025-11-24 15:40:27,382 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:27,382 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:27,382 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:27,383 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:27,383 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:27,383 - main - INFO - 
2025-11-24 15:40:27,383 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:27,384 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:27,384 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:27,384 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:27,384 - main - INFO - 
2025-11-24 15:40:27,384 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:27,384 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:27,385 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:27,385 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:27,385 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:27,385 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:27,385 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:27,385 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:27,386 - main - INFO - 
2025-11-24 15:40:27,386 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:27,386 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:27,386 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:27,386 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:27,386 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:27,387 - main - INFO - 
2025-11-24 15:40:27,387 - main - INFO - ================================================================================
2025-11-24 15:40:27,387 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:27,387 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:27,387 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:27,387 - main - INFO - ================================================================================
2025-11-24 15:40:27,388 - main - INFO - 
2025-11-24 15:40:27,388 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:40:41,174 - main - INFO - 
2025-11-24 15:40:41,174 - main - INFO - ================================================================================
2025-11-24 15:40:41,174 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:40:41,176 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:41,177 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:40:41,178 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:40:41,178 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:40:41,179 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:40:41,179 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:40:41,180 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:40:41,180 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:40:41,180 - main - INFO - ================================================================================
2025-11-24 15:40:41,180 - main - INFO - 
2025-11-24 15:40:44,412 - main - INFO - 
2025-11-24 15:40:44,412 - main - INFO - ================================================================================
2025-11-24 15:40:44,413 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:44,413 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:44,413 - main - INFO - ================================================================================
2025-11-24 15:40:44,413 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:44,413 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:44,414 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:44,414 - main - INFO - ================================================================================
2025-11-24 15:40:44,414 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:44,414 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:44,415 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:44,449 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:44,458 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:44,458 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:44,459 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:44,459 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:44,460 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:44,460 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:44,461 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:44,468 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:44,469 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:44,470 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:44,474 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:44,474 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:44,475 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:44,475 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:44,475 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:44,498 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:44,498 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:44,498 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:44,499 - main - INFO - 
2025-11-24 15:40:44,499 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:44,499 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:44,500 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:44,500 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:44,500 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:44,501 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:44,501 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:44,501 - main - INFO - 
2025-11-24 15:40:44,501 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:44,501 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:44,502 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:44,502 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:44,502 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:44,502 - main - INFO - 
2025-11-24 15:40:44,502 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:44,503 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:44,503 - main - INFO -        - No manual section generation
2025-11-24 15:40:44,503 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:44,503 - main - INFO - 
2025-11-24 15:40:44,503 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:44,503 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:44,503 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:44,504 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:44,504 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:44,504 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:44,504 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:44,505 - main - INFO - 
2025-11-24 15:40:44,505 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:44,506 - main - INFO -      Main:
2025-11-24 15:40:44,506 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:44,507 - main - INFO - 
2025-11-24 15:40:44,507 - main - INFO -      Retrieval:
2025-11-24 15:40:44,508 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:44,508 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:44,508 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:44,509 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:44,509 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:44,509 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:44,509 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:44,510 - main - INFO - 
2025-11-24 15:40:44,510 - main - INFO -      Management:
2025-11-24 15:40:44,510 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:44,511 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:44,511 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:44,512 - main - INFO - 
2025-11-24 15:40:44,512 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:44,512 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:44,513 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:44,513 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:44,513 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:44,513 - main - INFO - 
2025-11-24 15:40:44,514 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:44,514 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:44,514 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:44,514 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:44,514 - main - INFO - 
2025-11-24 15:40:44,515 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:44,515 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:44,515 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:44,515 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:44,515 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:44,516 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:44,516 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:44,516 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:44,516 - main - INFO - 
2025-11-24 15:40:44,516 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:44,517 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:44,517 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:44,517 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:44,517 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:44,518 - main - INFO - 
2025-11-24 15:40:44,518 - main - INFO - ================================================================================
2025-11-24 15:40:44,518 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:44,518 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:44,518 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:44,518 - main - INFO - ================================================================================
2025-11-24 15:40:44,519 - main - INFO - 
2025-11-24 15:40:44,519 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:40:47,816 - main - INFO - 
2025-11-24 15:40:47,817 - main - INFO - ================================================================================
2025-11-24 15:40:47,817 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:40:47,817 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:40:47,817 - main - INFO - ================================================================================
2025-11-24 15:40:47,818 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:40:47,818 - main - INFO -   Upload Directory: uploads
2025-11-24 15:40:47,818 - main - INFO -   Max File Size: 20MB
2025-11-24 15:40:47,818 - main - INFO - ================================================================================
2025-11-24 15:40:47,819 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:40:47,819 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:40:47,819 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:40:47,865 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:40:47,871 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:40:47,871 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:40:47,871 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:40:47,872 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:40:47,873 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:40:47,874 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:47,874 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:40:47,899 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:40:47,901 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:40:47,902 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:40:47,904 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:40:47,904 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:40:47,904 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:40:47,905 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:40:47,905 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:40:47,929 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:40:47,930 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:40:47,930 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:40:47,930 - main - INFO - 
2025-11-24 15:40:47,931 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:40:47,931 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:40:47,931 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:40:47,932 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:40:47,932 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:40:47,932 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:40:47,932 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:40:47,933 - main - INFO - 
2025-11-24 15:40:47,933 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:40:47,933 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:40:47,934 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:40:47,934 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:40:47,934 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:40:47,935 - main - INFO - 
2025-11-24 15:40:47,935 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:40:47,935 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:40:47,936 - main - INFO -        - No manual section generation
2025-11-24 15:40:47,936 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:40:47,936 - main - INFO - 
2025-11-24 15:40:47,936 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:40:47,937 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:40:47,937 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:40:47,937 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:40:47,937 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:40:47,938 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:40:47,938 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:40:47,938 - main - INFO - 
2025-11-24 15:40:47,938 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:40:47,939 - main - INFO -      Main:
2025-11-24 15:40:47,939 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:40:47,939 - main - INFO - 
2025-11-24 15:40:47,939 - main - INFO -      Retrieval:
2025-11-24 15:40:47,939 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:40:47,940 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:40:47,940 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:40:47,940 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:40:47,940 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:40:47,940 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:40:47,940 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:40:47,941 - main - INFO - 
2025-11-24 15:40:47,941 - main - INFO -      Management:
2025-11-24 15:40:47,941 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:40:47,941 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:40:47,941 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:40:47,941 - main - INFO - 
2025-11-24 15:40:47,941 - main - INFO -      Documents (MongoDB):
2025-11-24 15:40:47,942 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:40:47,942 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:40:47,942 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:40:47,942 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:40:47,942 - main - INFO - 
2025-11-24 15:40:47,942 - main - INFO -      Diagnostics & Health:
2025-11-24 15:40:47,942 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:40:47,943 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:40:47,943 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:40:47,943 - main - INFO - 
2025-11-24 15:40:47,943 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:40:47,943 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:40:47,943 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:40:47,943 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:40:47,944 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:40:47,944 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:40:47,944 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:40:47,944 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:40:47,944 - main - INFO - 
2025-11-24 15:40:47,944 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:40:47,944 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:40:47,945 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:40:47,945 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:40:47,945 - main - INFO -      4. No re-upload needed!
2025-11-24 15:40:47,945 - main - INFO - 
2025-11-24 15:40:47,945 - main - INFO - ================================================================================
2025-11-24 15:40:47,945 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:40:47,945 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:40:47,946 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:40:47,946 - main - INFO - ================================================================================
2025-11-24 15:40:47,946 - main - INFO - 
2025-11-24 15:40:47,946 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:41:06,000 - main - INFO - 
2025-11-24 15:41:06,001 - main - INFO - ================================================================================
2025-11-24 15:41:06,001 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:41:06,002 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:41:06,003 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:41:06,004 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:41:06,005 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:41:06,007 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:41:06,008 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:41:06,009 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:41:06,009 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:41:06,009 - main - INFO - ================================================================================
2025-11-24 15:41:06,010 - main - INFO - 
2025-11-24 15:41:08,842 - main - INFO - 
2025-11-24 15:41:08,842 - main - INFO - ================================================================================
2025-11-24 15:41:08,843 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:41:08,843 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:41:08,843 - main - INFO - ================================================================================
2025-11-24 15:41:08,843 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:41:08,844 - main - INFO -   Upload Directory: uploads
2025-11-24 15:41:08,844 - main - INFO -   Max File Size: 20MB
2025-11-24 15:41:08,844 - main - INFO - ================================================================================
2025-11-24 15:41:08,845 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:41:08,845 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:41:08,845 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:41:08,865 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:41:08,870 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:41:08,870 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:41:08,871 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:41:08,871 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:41:08,871 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:41:08,871 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:41:08,871 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:41:08,880 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:41:08,881 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:41:08,883 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:41:08,884 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:41:08,884 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:41:08,885 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:41:08,885 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:41:08,885 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:41:08,894 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:41:08,894 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:41:08,894 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:41:08,895 - main - INFO - 
2025-11-24 15:41:08,895 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:41:08,895 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:41:08,895 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:41:08,895 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:41:08,896 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:41:08,896 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:41:08,896 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:41:08,896 - main - INFO - 
2025-11-24 15:41:08,896 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:41:08,896 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:41:08,897 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:41:08,897 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:41:08,897 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:41:08,897 - main - INFO - 
2025-11-24 15:41:08,897 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:41:08,897 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:41:08,898 - main - INFO -        - No manual section generation
2025-11-24 15:41:08,898 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:41:08,898 - main - INFO - 
2025-11-24 15:41:08,898 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:41:08,899 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:41:08,899 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:41:08,899 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:41:08,899 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:41:08,899 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:41:08,899 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:41:08,900 - main - INFO - 
2025-11-24 15:41:08,900 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:41:08,900 - main - INFO -      Main:
2025-11-24 15:41:08,900 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:41:08,900 - main - INFO - 
2025-11-24 15:41:08,900 - main - INFO -      Retrieval:
2025-11-24 15:41:08,901 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:41:08,901 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:41:08,901 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:41:08,901 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:41:08,901 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:41:08,901 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:41:08,902 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:41:08,902 - main - INFO - 
2025-11-24 15:41:08,902 - main - INFO -      Management:
2025-11-24 15:41:08,902 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:41:08,902 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:41:08,902 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:41:08,902 - main - INFO - 
2025-11-24 15:41:08,903 - main - INFO -      Documents (MongoDB):
2025-11-24 15:41:08,903 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:41:08,903 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:41:08,903 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:41:08,903 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:41:08,903 - main - INFO - 
2025-11-24 15:41:08,903 - main - INFO -      Diagnostics & Health:
2025-11-24 15:41:08,904 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:41:08,904 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:41:08,904 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:41:08,904 - main - INFO - 
2025-11-24 15:41:08,904 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:41:08,905 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:41:08,905 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:41:08,906 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:41:08,907 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:41:08,907 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:41:08,907 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:41:08,908 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:41:08,908 - main - INFO - 
2025-11-24 15:41:08,908 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:41:08,909 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:41:08,909 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:41:08,910 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:41:08,910 - main - INFO -      4. No re-upload needed!
2025-11-24 15:41:08,910 - main - INFO - 
2025-11-24 15:41:08,910 - main - INFO - ================================================================================
2025-11-24 15:41:08,910 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:41:08,911 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:41:08,911 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:41:08,911 - main - INFO - ================================================================================
2025-11-24 15:41:08,911 - main - INFO - 
2025-11-24 15:41:08,912 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:41:33,054 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-24 15:41:33,058 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-24 15:41:33,059 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:41:33,059 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:41:33,059 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:41:33,060 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:41:33,062 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-24 15:41:33,062 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-24 15:41:33,062 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-24 15:41:33,062 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-24 15:41:33,063 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763998893_4a742344d4c9
2025-11-24 15:41:33,063 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_5e51ff3c0c7f (2 files)
2025-11-24 15:41:33,063 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_5e51ff3c0c7f
2025-11-24 15:41:33,063 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:41:33,064 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:41:33,064 - app.api.routes - INFO - ======================================================================
2025-11-24 15:41:33,065 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 929f995e1d424975824506b3eb0ebf4b.pdf (464206 bytes)
2025-11-24 15:41:33,065 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:41:33,066 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\929f995e1d424975824506b3eb0ebf4b.pdf
2025-11-24 15:41:33,066 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:41:33,087 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:41:33,107 - app.api.routes - INFO - ======================================================================
2025-11-24 15:41:33,139 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 1734abe8bbab4daa8aaffd1669de5e41.pdf (175401 bytes)
2025-11-24 15:41:33,141 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-24 15:41:33,142 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:41:33,142 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\1734abe8bbab4daa8aaffd1669de5e41.pdf
2025-11-24 15:41:33,143 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:41:33,143 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:41:33,161 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-24 15:41:33,172 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-24 15:41:33,187 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:41:33,201 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:41:33,202 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-24 15:41:33,202 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-24 15:41:33,362 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-24 15:41:33,362 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:41:33,779 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:41:33,779 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:41:33,780 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-24 15:41:33,780 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-24 15:41:33,780 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:41:33,780 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:41:33,781 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-24 15:41:33,859 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-24 15:41:33,859 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:42:06,273 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:42:06,293 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:42:06,293 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:42:06,294 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:42:06,295 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-24 15:42:06,295 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:42:06,296 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-24 15:42:06,304 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-24 15:42:06,305 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-24 15:42:06,305 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:42:14,577 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:42:14,580 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:42:14,581 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:42:14,582 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-24 15:42:14,583 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.28 Ã— Rate: 0.38â€° (Per Mille)
2025-11-24 15:42:14,584 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:42:14,585 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:42:14,585 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-24 15:42:20,330 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:42:20,336 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:42:20,336 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:42:20,337 - app.services.ai_parser - INFO - 
2025-11-24 15:42:20,337 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:42:20,337 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:42:20,338 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:42:20,338 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-24 15:42:20,338 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:42:20,339 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-24 15:42:20,339 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-24 15:42:20,339 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:42:20,340 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 15:42:20,340 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:42:20,341 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:42:20,341 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:42:20,341 - app.services.ai_parser - INFO - 
2025-11-24 15:42:20,342 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:42:20,342 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-24 15:42:20,342 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-24 15:42:20,343 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-24 15:42:20,343 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:42:20,344 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:42:20,345 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:42:20,348 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 929f995e1d424975824506b3eb0ebf4b.pdf â†’ 69247cdc4b1acf3cf1155e4e
2025-11-24 15:42:20,348 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247cdc4b1acf3cf1155e4e
2025-11-24 15:42:20,351 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247cdc4b1acf3cf1155e4f (464206 bytes)
2025-11-24 15:42:20,352 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247cdc4b1acf3cf1155e4f
2025-11-24 15:42:20,352 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:42:48,033 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:42:48,279 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:42:48,279 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:42:48,280 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:42:48,280 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:42:54,947 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:42:54,955 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:42:54,956 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:42:54,957 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-24 15:42:54,957 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-24 15:42:54,958 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:42:54,959 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:42:54,959 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:42:54,961 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-24 15:42:54,961 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:42:54,962 - app.services.ai_parser - INFO - ðŸ“Š Counts: 26 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-24 15:43:00,817 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:00,834 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:43:00,835 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:43:00,836 - app.services.ai_parser - INFO - 
2025-11-24 15:43:00,837 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:43:00,837 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:43:00,838 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:43:00,839 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-24 15:43:00,840 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:43:00,841 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-24 15:43:00,841 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-24 15:43:00,842 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:43:00,843 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-24 15:43:00,844 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-24 15:43:00,844 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:43:00,845 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:43:00,846 - app.services.ai_parser - INFO - 
2025-11-24 15:43:00,847 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:43:00,847 - app.services.ai_parser - INFO -    âœ“ Benefits: 26
2025-11-24 15:43:00,848 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-24 15:43:00,849 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-24 15:43:00,849 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:43:00,850 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:43:00,851 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:43:00,854 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 1734abe8bbab4daa8aaffd1669de5e41.pdf â†’ 69247d044b1acf3cf1155e50
2025-11-24 15:43:00,855 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247d044b1acf3cf1155e50
2025-11-24 15:43:00,859 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247d044b1acf3cf1155e51 (175401 bytes)
2025-11-24 15:43:00,860 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247d044b1acf3cf1155e51
2025-11-24 15:43:00,861 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:43:00,861 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-24 15:43:00,862 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:43:00,863 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-24 15:43:00,863 - app.api.routes - INFO - ======================================================================
2025-11-24 15:43:00,864 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-24 15:43:00,864 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-24 15:43:00,865 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-24 15:43:00,865 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-24 15:43:00,866 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-24 15:43:00,866 - app.services.ai_ranker - INFO - ================================================================================
2025-11-24 15:43:00,867 - app.services.ai_ranker - INFO - 
============================================================
2025-11-24 15:43:00,867 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-24 15:43:00,867 - app.services.ai_ranker - INFO - ============================================================
2025-11-24 15:43:00,868 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-24 15:43:00,868 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:43:00,869 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-24 15:43:00,869 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-24 15:43:00,870 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-24 15:43:00,870 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-24 15:43:00,871 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-24 15:43:00,871 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-24 15:43:00,872 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-24 15:43:00,872 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.28,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "burglary_clause": "Limited to SR 5,000,000 in aggregate and subject to violence/forcible entry and/or exit",
    "Minimization of losses": 
2025-11-24 15:43:00,875 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:43:00,876 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-24 15:43:00,876 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-24 15:43:00,877 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-24 15:43:00,877 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-24 15:43:00,877 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-24 15:43:00,878 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-24 15:43:00,878 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-24 15:43:00,878 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-24 15:43:00,879 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-24 15:43:00,879 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-24 15:43:00,879 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-24 15:43:00,879 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-24 15:43:00,880 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-24 15:43:00,880 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-24 15:43:00,880 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-24 15:43:00,880 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-24 15:43:00,880 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:43:00,881 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-24 15:43:00,881 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-24 15:43:00,881 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-24 15:43:00,881 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-24 15:43:00,881 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-24 15:43:00,882 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-24 15:43:00,882 - app.services.ai_ranker - INFO - 
============================================================
2025-11-24 15:43:00,882 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-24 15:43:00,882 - app.services.ai_ranker - INFO - ============================================================
2025-11-24 15:43:00,882 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-24 15:43:00,883 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:43:00,883 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-24 15:43:00,883 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-24 15:43:00,883 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-24 15:43:00,883 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-24 15:43:00,884 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-24 15:43:00,884 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-24 15:43:00,884 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-24 15:43:00,884 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount minimum SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount minimum SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount minimum SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount minimum SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_in
2025-11-24 15:43:00,887 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:43:00,888 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-24 15:43:00,889 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-24 15:43:00,889 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-24 15:43:00,890 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-24 15:43:00,890 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-24 15:43:00,890 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-24 15:43:00,891 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-24 15:43:00,891 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-24 15:43:00,891 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-24 15:43:00,891 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-24 15:43:00,891 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-24 15:43:00,892 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-24 15:43:00,892 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-24 15:43:00,892 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-24 15:43:00,892 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-24 15:43:00,892 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-24 15:43:00,893 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:43:00,893 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-24 15:43:00,893 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-24 15:43:00,893 - app.services.ai_ranker - INFO -    Warranties: 10
2025-11-24 15:43:00,894 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-24 15:43:00,894 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-24 15:43:00,894 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-24 15:43:00,894 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-24 15:43:01,071 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 4
2025-11-24 15:43:01,071 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-24 15:43:01,072 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-24 15:43:01,072 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-24 15:43:01,072 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-24 15:43:01,072 - app.services.ai_ranker - INFO -       â€¢ Bookkeeping warrantee
2025-11-24 15:43:01,073 - app.services.ai_ranker - INFO -       â€¢ Hazardous good warranty
2025-11-24 15:43:01,073 - app.services.ai_ranker - INFO -       â€¢ Warranted no workshop operations on insured premises
2025-11-24 15:43:01,073 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-24 15:43:01,277 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 3
2025-11-24 15:43:01,277 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-24 15:43:01,278 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-24 15:43:01,278 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-24 15:43:01,278 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-24 15:43:01,278 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-24 15:43:01,279 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-24 15:43:01,279 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-24 15:43:01,279 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-24 15:43:01,279 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-24 15:43:01,280 - app.services.ai_ranker - INFO - ================================================================================

2025-11-24 15:43:01,280 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=86.52
2025-11-24 15:43:01,280 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=83.92
2025-11-24 15:43:01,281 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-24 15:43:01,281 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-24 15:43:10,848 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:43:10,852 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-24 15:43:10,853 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-24 15:43:10,854 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-24 15:43:10,856 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-24 15:43:10,856 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-24 15:43:10,857 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763998893_4a742344d4c9
2025-11-24 15:43:10,858 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-24 15:43:10,858 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-24 15:43:10,859 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-24 15:43:10,860 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-24 15:43:10,861 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 15:43:10,861 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 15:43:10,862 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 15:43:10,863 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 15:43:10,863 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 15:43:10,864 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 15:43:10,865 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-24 15:43:10,865 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 15:43:10,866 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 15:43:10,867 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 15:43:10,867 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 15:43:10,868 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 15:43:10,869 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 15:43:10,873 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-24 15:43:10,873 - app.services.mongodb_service_enhanced - INFO -    Summary: 2,942 bytes
2025-11-24 15:43:10,874 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 20,451 bytes
2025-11-24 15:43:10,874 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,542 bytes
2025-11-24 15:43:10,875 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,452 bytes
2025-11-24 15:43:10,875 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 33,026 bytes
2025-11-24 15:43:10,876 - app.services.mongodb_service_enhanced - INFO -    Total document: 140,097 bytes
2025-11-24 15:43:10,876 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-24 15:43:10,876 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-24 15:43:10,877 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-24 15:43:10,877 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-24 15:43:10,877 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-24 15:43:10,878 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-24 15:43:10,878 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-24 15:43:10,879 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-24 15:43:10,879 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-24 15:43:10,879 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-24 15:43:10,880 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-24 15:43:10,880 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-24 15:43:10,881 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-24 15:43:10,881 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-24 15:43:10,882 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-24 15:43:10,882 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-24 15:43:10,882 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-24 15:43:10,883 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:43:10,884 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:43:10,885 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-24 15:43:10,890 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763998893_4a742344d4c9
2025-11-24 15:43:10,890 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69247d0eb757af6a8efab059
2025-11-24 15:43:10,893 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-24 15:43:10,893 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-24 15:43:10,893 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-24 15:43:10,893 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-24 15:43:10,894 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-24 15:43:10,894 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-24 15:43:10,894 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-24 15:43:10,894 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-24 15:43:10,895 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-24 15:43:10,895 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-24 15:43:10,895 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-24 15:43:10,895 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-24 15:43:10,896 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:43:10,896 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-24 15:43:10,896 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-24 15:43:10,896 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-24 15:43:10,897 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-24 15:43:10,897 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-24 15:43:10,897 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:43:10,897 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69247d0eb757af6a8efab059
2025-11-24 15:43:10,897 - app.api.routes - INFO -    Database: hakemAI
2025-11-24 15:43:10,898 - app.api.routes - INFO -    Collection: comparisons
2025-11-24 15:43:10,898 - app.api.routes - INFO -    Comparison ID: cmp_1763998893_4a742344d4c9
2025-11-24 15:43:10,899 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-24 15:43:10,899 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-24 15:43:10,899 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:43:10,899 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-24 15:43:10,900 - app.api.routes - INFO - ======================================================================
2025-11-24 15:43:10,900 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763998893_4a742344d4c9
2025-11-24 15:43:10,900 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-24 15:43:10,900 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-24 15:43:10,900 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-24 15:43:10,900 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:43:10,901 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:43:10,901 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:43:10,902 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:43:10,903 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-24 15:43:10,903 - app.api.routes - INFO - ======================================================================

2025-11-24 15:43:10,904 - app.services.progress_tracker - INFO - âœ… Job completed: job_5e51ff3c0c7f â†’ comparison_id: cmp_1763998893_4a742344d4c9
2025-11-24 15:43:10,905 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 97.85s
2025-11-24 15:43:35,224 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_20251124154310/pdf
2025-11-24 15:43:35,226 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_20251124154310
2025-11-24 15:43:35,228 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_20251124154310/pdf - 404 - 0.00s
2025-11-24 15:44:43,009 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1763998893_4a742344d4c9/pdf
2025-11-24 15:44:43,010 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1763998893_4a742344d4c9
2025-11-24 15:44:43,013 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1763998893_4a742344d4c9
2025-11-24 15:44:43,014 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-24 15:44:43,014 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-24 15:44:43,014 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-24 15:44:43,015 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-24 15:44:43,016 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-24 15:44:43,016 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-24 15:44:43,021 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-24 15:44:43,021 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-24 15:44:43,023 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-24 15:44:43,023 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-24 15:44:43,024 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-24 15:44:43,025 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-24 15:44:43,027 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-24 15:44:43,247 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1763998893_4a742344d4c9
2025-11-24 15:44:43,247 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1763998893_4a742344d4c9_20251124_154443.pdf (135646 bytes)
2025-11-24 15:44:43,248 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1763998893_4a742344d4c9/pdf - 200 - 0.24s
2025-11-24 15:45:20,005 - main - INFO - 
2025-11-24 15:45:20,006 - main - INFO - ================================================================================
2025-11-24 15:45:20,007 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:45:20,009 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:45:20,010 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:45:20,012 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:45:20,013 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:45:20,015 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:45:20,016 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:45:20,019 - main - INFO -   âœ… Cleaned up 2 temporary files
2025-11-24 15:45:20,020 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:45:20,021 - main - INFO - ================================================================================
2025-11-24 15:45:20,021 - main - INFO - 
2025-11-24 15:45:23,504 - main - INFO - 
2025-11-24 15:45:23,504 - main - INFO - ================================================================================
2025-11-24 15:45:23,505 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:45:23,505 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:45:23,505 - main - INFO - ================================================================================
2025-11-24 15:45:23,505 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:45:23,506 - main - INFO -   Upload Directory: uploads
2025-11-24 15:45:23,506 - main - INFO -   Max File Size: 20MB
2025-11-24 15:45:23,506 - main - INFO - ================================================================================
2025-11-24 15:45:23,507 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:45:23,509 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:45:23,510 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:45:23,564 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:45:23,570 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:45:23,570 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:45:23,571 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:45:23,571 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:45:23,571 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:45:23,572 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:45:23,572 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:45:23,606 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:45:23,607 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:45:23,609 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:45:23,611 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:45:23,611 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:45:23,612 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:45:23,613 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:45:23,614 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:45:23,639 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:45:23,639 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:45:23,639 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:45:23,640 - main - INFO - 
2025-11-24 15:45:23,640 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:45:23,640 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:45:23,640 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:45:23,640 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:45:23,640 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:45:23,641 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:45:23,641 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:45:23,641 - main - INFO - 
2025-11-24 15:45:23,641 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:45:23,641 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:45:23,641 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:45:23,642 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:45:23,642 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:45:23,642 - main - INFO - 
2025-11-24 15:45:23,642 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:45:23,642 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:45:23,643 - main - INFO -        - No manual section generation
2025-11-24 15:45:23,643 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:45:23,643 - main - INFO - 
2025-11-24 15:45:23,643 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:45:23,643 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:45:23,643 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:45:23,644 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:45:23,644 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:45:23,644 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:45:23,644 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:45:23,644 - main - INFO - 
2025-11-24 15:45:23,645 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:45:23,645 - main - INFO -      Main:
2025-11-24 15:45:23,645 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:45:23,645 - main - INFO - 
2025-11-24 15:45:23,646 - main - INFO -      Retrieval:
2025-11-24 15:45:23,646 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:45:23,646 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:45:23,646 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:45:23,646 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:45:23,647 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:45:23,647 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:45:23,647 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:45:23,647 - main - INFO - 
2025-11-24 15:45:23,647 - main - INFO -      Management:
2025-11-24 15:45:23,648 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:45:23,648 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:45:23,648 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:45:23,649 - main - INFO - 
2025-11-24 15:45:23,649 - main - INFO -      Documents (MongoDB):
2025-11-24 15:45:23,650 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:45:23,650 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:45:23,651 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:45:23,651 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:45:23,651 - main - INFO - 
2025-11-24 15:45:23,651 - main - INFO -      Diagnostics & Health:
2025-11-24 15:45:23,651 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:45:23,652 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:45:23,652 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:45:23,652 - main - INFO - 
2025-11-24 15:45:23,652 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:45:23,652 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:45:23,653 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:45:23,653 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:45:23,653 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:45:23,653 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:45:23,653 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:45:23,654 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:45:23,654 - main - INFO - 
2025-11-24 15:45:23,654 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:45:23,654 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:45:23,654 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:45:23,654 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:45:23,655 - main - INFO -      4. No re-upload needed!
2025-11-24 15:45:23,655 - main - INFO - 
2025-11-24 15:45:23,655 - main - INFO - ================================================================================
2025-11-24 15:45:23,655 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:45:23,655 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:45:23,656 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:45:23,656 - main - INFO - ================================================================================
2025-11-24 15:45:23,656 - main - INFO - 
2025-11-24 15:45:23,656 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:45:27,696 - main - INFO - 
2025-11-24 15:45:27,696 - main - INFO - ================================================================================
2025-11-24 15:45:27,696 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:45:27,697 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:45:27,697 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:45:27,698 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:45:27,698 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:45:27,699 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:45:27,699 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:45:27,700 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:45:27,700 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:45:27,700 - main - INFO - ================================================================================
2025-11-24 15:45:27,701 - main - INFO - 
2025-11-24 15:45:30,904 - main - INFO - 
2025-11-24 15:45:30,905 - main - INFO - ================================================================================
2025-11-24 15:45:30,905 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:45:30,905 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:45:30,906 - main - INFO - ================================================================================
2025-11-24 15:45:30,906 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:45:30,906 - main - INFO -   Upload Directory: uploads
2025-11-24 15:45:30,906 - main - INFO -   Max File Size: 20MB
2025-11-24 15:45:30,907 - main - INFO - ================================================================================
2025-11-24 15:45:30,907 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:45:30,908 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:45:30,908 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:45:30,949 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:45:30,956 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:45:30,956 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:45:30,957 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:45:30,957 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:45:30,957 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:45:30,958 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:45:30,958 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:45:30,968 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:45:30,969 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:45:30,970 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:45:30,971 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:45:30,972 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:45:30,972 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:45:30,972 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:45:30,973 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:45:30,982 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:45:30,982 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:45:30,983 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:45:30,983 - main - INFO - 
2025-11-24 15:45:30,983 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:45:30,983 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:45:30,984 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:45:30,984 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:45:30,984 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:45:30,984 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:45:30,984 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:45:30,985 - main - INFO - 
2025-11-24 15:45:30,985 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:45:30,985 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:45:30,985 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:45:30,985 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:45:30,985 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:45:30,986 - main - INFO - 
2025-11-24 15:45:30,986 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:45:30,986 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:45:30,986 - main - INFO -        - No manual section generation
2025-11-24 15:45:30,986 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:45:30,986 - main - INFO - 
2025-11-24 15:45:30,987 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:45:30,987 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:45:30,987 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:45:30,987 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:45:30,987 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:45:30,987 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:45:30,987 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:45:30,988 - main - INFO - 
2025-11-24 15:45:30,988 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:45:30,988 - main - INFO -      Main:
2025-11-24 15:45:30,988 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:45:30,988 - main - INFO - 
2025-11-24 15:45:30,988 - main - INFO -      Retrieval:
2025-11-24 15:45:30,989 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:45:30,989 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:45:30,989 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:45:30,989 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:45:30,989 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:45:30,990 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:45:30,990 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:45:30,990 - main - INFO - 
2025-11-24 15:45:30,990 - main - INFO -      Management:
2025-11-24 15:45:30,990 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:45:30,991 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:45:30,991 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:45:30,991 - main - INFO - 
2025-11-24 15:45:30,991 - main - INFO -      Documents (MongoDB):
2025-11-24 15:45:30,991 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:45:30,992 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:45:30,992 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:45:30,993 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:45:30,994 - main - INFO - 
2025-11-24 15:45:30,995 - main - INFO -      Diagnostics & Health:
2025-11-24 15:45:30,996 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:45:30,996 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:45:30,996 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:45:30,996 - main - INFO - 
2025-11-24 15:45:30,997 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:45:30,997 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:45:30,997 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:45:30,997 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:45:30,997 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:45:30,998 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:45:30,998 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:45:30,998 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:45:30,998 - main - INFO - 
2025-11-24 15:45:30,998 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:45:30,998 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:45:30,999 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:45:30,999 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:45:30,999 - main - INFO -      4. No re-upload needed!
2025-11-24 15:45:30,999 - main - INFO - 
2025-11-24 15:45:30,999 - main - INFO - ================================================================================
2025-11-24 15:45:30,999 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:45:31,000 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:45:31,000 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:45:31,000 - main - INFO - ================================================================================
2025-11-24 15:45:31,000 - main - INFO - 
2025-11-24 15:45:31,000 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:46:37,596 - main - INFO - 
2025-11-24 15:46:37,596 - main - INFO - ================================================================================
2025-11-24 15:46:37,596 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:46:37,598 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:46:37,598 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:46:37,599 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:46:37,599 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:46:37,600 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:46:37,600 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:46:37,601 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:46:37,601 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:46:37,601 - main - INFO - ================================================================================
2025-11-24 15:46:37,601 - main - INFO - 
2025-11-24 15:46:40,549 - main - INFO - 
2025-11-24 15:46:40,549 - main - INFO - ================================================================================
2025-11-24 15:46:40,550 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:46:40,550 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:46:40,550 - main - INFO - ================================================================================
2025-11-24 15:46:40,551 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:46:40,551 - main - INFO -   Upload Directory: uploads
2025-11-24 15:46:40,551 - main - INFO -   Max File Size: 20MB
2025-11-24 15:46:40,551 - main - INFO - ================================================================================
2025-11-24 15:46:40,552 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:46:40,552 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:46:40,552 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:46:40,586 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:46:40,592 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:46:40,592 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:46:40,592 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:46:40,592 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:46:40,593 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:46:40,593 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:46:40,593 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:46:40,619 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:46:40,620 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:46:40,622 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:46:40,625 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:46:40,626 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:46:40,626 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:46:40,626 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:46:40,626 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:46:40,635 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:46:40,636 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:46:40,636 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:46:40,636 - main - INFO - 
2025-11-24 15:46:40,636 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:46:40,637 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:46:40,637 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:46:40,637 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:46:40,637 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:46:40,637 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:46:40,638 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:46:40,638 - main - INFO - 
2025-11-24 15:46:40,638 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:46:40,638 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:46:40,639 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:46:40,639 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:46:40,639 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:46:40,640 - main - INFO - 
2025-11-24 15:46:40,640 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:46:40,640 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:46:40,641 - main - INFO -        - No manual section generation
2025-11-24 15:46:40,641 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:46:40,641 - main - INFO - 
2025-11-24 15:46:40,641 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:46:40,642 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:46:40,642 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:46:40,642 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:46:40,642 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:46:40,642 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:46:40,643 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:46:40,643 - main - INFO - 
2025-11-24 15:46:40,643 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:46:40,643 - main - INFO -      Main:
2025-11-24 15:46:40,643 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:46:40,643 - main - INFO - 
2025-11-24 15:46:40,644 - main - INFO -      Retrieval:
2025-11-24 15:46:40,644 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:46:40,644 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:46:40,644 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:46:40,644 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:46:40,644 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:46:40,645 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:46:40,645 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:46:40,645 - main - INFO - 
2025-11-24 15:46:40,645 - main - INFO -      Management:
2025-11-24 15:46:40,646 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:46:40,646 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:46:40,646 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:46:40,646 - main - INFO - 
2025-11-24 15:46:40,647 - main - INFO -      Documents (MongoDB):
2025-11-24 15:46:40,647 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:46:40,647 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:46:40,647 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:46:40,647 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:46:40,647 - main - INFO - 
2025-11-24 15:46:40,648 - main - INFO -      Diagnostics & Health:
2025-11-24 15:46:40,648 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:46:40,648 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:46:40,648 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:46:40,648 - main - INFO - 
2025-11-24 15:46:40,649 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:46:40,649 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:46:40,649 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:46:40,649 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:46:40,650 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:46:40,650 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:46:40,651 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:46:40,651 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:46:40,652 - main - INFO - 
2025-11-24 15:46:40,652 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:46:40,652 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:46:40,652 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:46:40,653 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:46:40,653 - main - INFO -      4. No re-upload needed!
2025-11-24 15:46:40,653 - main - INFO - 
2025-11-24 15:46:40,653 - main - INFO - ================================================================================
2025-11-24 15:46:40,653 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:46:40,653 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:46:40,654 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:46:40,654 - main - INFO - ================================================================================
2025-11-24 15:46:40,654 - main - INFO - 
2025-11-24 15:46:40,654 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:46:47,326 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-24 15:46:47,332 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-24 15:46:47,332 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:46:47,332 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:46:47,333 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:46:47,334 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:46:47,335 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-24 15:46:47,335 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-24 15:46:47,335 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-24 15:46:47,335 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-24 15:46:47,336 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763999207_753abd2765c0
2025-11-24 15:46:47,336 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_cfca51b8b1df (2 files)
2025-11-24 15:46:47,336 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_cfca51b8b1df
2025-11-24 15:46:47,336 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:46:47,337 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:46:47,337 - app.api.routes - INFO - ======================================================================
2025-11-24 15:46:47,338 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 9ce6c1cfac104eaeb970aa7efcd01b4f.pdf (464206 bytes)
2025-11-24 15:46:47,339 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:46:47,340 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\9ce6c1cfac104eaeb970aa7efcd01b4f.pdf
2025-11-24 15:46:47,340 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:46:47,341 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:46:47,380 - app.api.routes - INFO - ======================================================================
2025-11-24 15:46:47,381 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ d309eb9a8e5a47df9df4d8fc81a90bcb.pdf (175401 bytes)
2025-11-24 15:46:47,402 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:46:47,410 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-24 15:46:47,411 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\d309eb9a8e5a47df9df4d8fc81a90bcb.pdf
2025-11-24 15:46:47,411 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:46:47,412 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:46:47,435 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-24 15:46:47,451 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-24 15:46:47,459 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:46:47,459 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-24 15:46:47,460 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:46:47,461 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-24 15:46:47,615 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-24 15:46:47,615 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:46:47,962 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:46:47,963 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:46:47,963 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-24 15:46:47,963 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-24 15:46:47,964 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:46:47,964 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:46:47,964 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-24 15:46:48,043 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-24 15:46:48,043 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:47:14,378 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:14,390 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:47:14,390 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:47:14,391 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:47:14,391 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-24 15:47:14,391 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:47:14,391 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-24 15:47:14,396 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-24 15:47:14,397 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-24 15:47:14,397 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:47:23,628 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:23,638 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:47:23,639 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:47:23,640 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-24 15:47:23,640 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-24 15:47:23,641 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:47:23,642 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:47:23,643 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-24 15:47:29,175 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:29,184 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:47:29,184 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:47:29,185 - app.services.ai_parser - INFO - 
2025-11-24 15:47:29,186 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:47:29,187 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:47:29,187 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:47:29,188 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-24 15:47:29,189 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:47:29,189 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-24 15:47:29,190 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-24 15:47:29,191 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:47:29,191 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 15:47:29,192 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:47:29,193 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:47:29,194 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:47:29,194 - app.services.ai_parser - INFO - 
2025-11-24 15:47:29,194 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:47:29,194 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-24 15:47:29,195 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-24 15:47:29,195 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-24 15:47:29,195 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:47:29,195 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:47:29,196 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:47:29,199 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 9ce6c1cfac104eaeb970aa7efcd01b4f.pdf â†’ 69247e11f8f8da55ef543191
2025-11-24 15:47:29,199 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247e11f8f8da55ef543191
2025-11-24 15:47:29,203 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247e11f8f8da55ef543192 (464206 bytes)
2025-11-24 15:47:29,203 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247e11f8f8da55ef543192
2025-11-24 15:47:29,204 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:47:31,034 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:31,041 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:47:31,041 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:47:31,041 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:47:31,041 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-24 15:47:31,045 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 60 benefits from patterns
2025-11-24 15:47:31,045 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 57 total
2025-11-24 15:47:31,046 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:47:38,339 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:38,344 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:47:38,345 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:47:38,345 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-24 15:47:38,346 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-24 15:47:38,347 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:47:38,347 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:47:38,348 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:47:38,349 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000/- | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000/-
2025-11-24 15:47:38,350 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:47:38,350 - app.services.ai_parser - INFO - ðŸ“Š Counts: 57 benefits, 29 exclusions, 8 warranties, 5 extensions
2025-11-24 15:47:44,910 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:44,911 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:47:44,912 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:47:44,912 - app.services.ai_parser - INFO - 
2025-11-24 15:47:44,912 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:47:44,912 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:47:44,913 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:47:44,913 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-24 15:47:44,913 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:47:44,913 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-24 15:47:44,914 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-24 15:47:44,914 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:47:44,914 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 15:47:44,914 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000/- | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000/-
2025-11-24 15:47:44,914 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:47:44,915 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:47:44,915 - app.services.ai_parser - INFO - 
2025-11-24 15:47:44,915 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:47:44,915 - app.services.ai_parser - INFO -    âœ“ Benefits: 57
2025-11-24 15:47:44,915 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-24 15:47:44,915 - app.services.ai_parser - INFO -    âœ“ Warranties: 8
2025-11-24 15:47:44,916 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:47:44,916 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:47:44,916 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:47:44,917 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: d309eb9a8e5a47df9df4d8fc81a90bcb.pdf â†’ 69247e20f8f8da55ef543193
2025-11-24 15:47:44,917 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247e20f8f8da55ef543193
2025-11-24 15:47:44,919 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247e20f8f8da55ef543194 (175401 bytes)
2025-11-24 15:47:44,919 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247e20f8f8da55ef543194
2025-11-24 15:47:44,919 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:47:44,920 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-24 15:47:44,920 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:47:44,920 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-24 15:47:44,920 - app.api.routes - INFO - ======================================================================
2025-11-24 15:47:44,920 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-24 15:47:44,921 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-24 15:47:44,921 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-24 15:47:44,921 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-24 15:47:44,921 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-24 15:47:44,922 - app.services.ai_ranker - INFO - ================================================================================
2025-11-24 15:47:44,922 - app.services.ai_ranker - INFO - 
============================================================
2025-11-24 15:47:44,922 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-24 15:47:44,922 - app.services.ai_ranker - INFO - ============================================================
2025-11-24 15:47:44,922 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-24 15:47:44,923 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:47:44,923 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-24 15:47:44,923 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-24 15:47:44,923 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-24 15:47:44,924 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-24 15:47:44,924 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-24 15:47:44,924 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-24 15:47:44,924 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-24 15:47:44,924 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.0,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "burglary_clause": "Limited to SR 5,000,000 in aggregate and subject to violence/forcible entry and/or exit",
    "Minimization of losses": "
2025-11-24 15:47:44,925 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:47:44,926 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-24 15:47:44,926 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-24 15:47:44,926 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-24 15:47:44,926 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-24 15:47:44,927 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-24 15:47:44,927 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-24 15:47:44,927 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-24 15:47:44,927 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-24 15:47:44,927 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-24 15:47:44,927 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-24 15:47:44,928 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-24 15:47:44,928 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-24 15:47:44,928 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-24 15:47:44,928 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-24 15:47:44,928 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-24 15:47:44,929 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-24 15:47:44,929 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:47:44,929 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-24 15:47:44,929 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-24 15:47:44,930 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-24 15:47:44,930 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-24 15:47:44,930 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-24 15:47:44,930 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-24 15:47:44,930 - app.services.ai_ranker - INFO - 
============================================================
2025-11-24 15:47:44,931 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-24 15:47:44,931 - app.services.ai_ranker - INFO - ============================================================
2025-11-24 15:47:44,931 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-24 15:47:44,931 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:47:44,932 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-24 15:47:44,932 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-24 15:47:44,933 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-24 15:47:44,933 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-24 15:47:44,934 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-24 15:47:44,934 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-24 15:47:44,935 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-24 15:47:44,935 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306/-",
    "business_interruption": "SR 650,000,000/-",
    "total_sum_insured_numeric": 1564652306.0,
    "total_sum_insured": "SR 1,564,652,306/-"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount minimum SR 50,000/-",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount minimum SR 100,000/-",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount minimum SR 500,000/-",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount minimum SR 1,000,000/-",
        "applies_to": "material_damage"
      }
    ],

2025-11-24 15:47:44,938 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:47:44,938 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-24 15:47:44,938 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-24 15:47:44,939 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-24 15:47:44,939 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-24 15:47:44,939 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-24 15:47:44,940 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-24 15:47:44,940 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-24 15:47:44,941 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-24 15:47:44,941 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-24 15:47:44,941 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-24 15:47:44,942 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-24 15:47:44,942 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-24 15:47:44,942 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-24 15:47:44,942 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-24 15:47:44,943 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-24 15:47:44,943 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-24 15:47:44,943 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:47:44,943 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-24 15:47:44,943 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-24 15:47:44,944 - app.services.ai_ranker - INFO -    Warranties: 8
2025-11-24 15:47:44,944 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-24 15:47:44,944 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-24 15:47:44,944 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-24 15:47:44,944 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-24 15:47:45,126 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 5
2025-11-24 15:47:45,126 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-24 15:47:45,127 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-24 15:47:45,127 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-24 15:47:45,127 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-24 15:47:45,128 - app.services.ai_ranker - INFO -       â€¢ Bookkeeping warrantee
2025-11-24 15:47:45,128 - app.services.ai_ranker - INFO -       â€¢ Hazardous good warranty
2025-11-24 15:47:45,128 - app.services.ai_ranker - INFO -       â€¢ Warranted no workshop operations on insured premises
2025-11-24 15:47:45,128 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-24 15:47:45,309 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-24 15:47:45,309 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-24 15:47:45,310 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-24 15:47:45,310 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-24 15:47:45,310 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-24 15:47:45,310 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-24 15:47:45,311 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-24 15:47:45,311 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-24 15:47:45,311 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-24 15:47:45,311 - app.services.ai_ranker - INFO - ================================================================================

2025-11-24 15:47:45,312 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=86.52
2025-11-24 15:47:45,312 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=84.54
2025-11-24 15:47:45,312 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-24 15:47:45,313 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-24 15:47:55,201 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:47:55,207 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-24 15:47:55,208 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-24 15:47:55,208 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-24 15:47:55,210 - app.api.routes - ERROR - âŒ Unexpected error: name 'comparison_id' is not defined
2025-11-24 15:47:55,211 - app.api.routes - ERROR - name 'comparison_id' is not defined
Traceback (most recent call last):
  File "C:\Users\Admin\Downloads\AI-Module\app\api\routes.py", line 385, in compare_insurance_quotes
    comparison_result = await quote_ranker.rank_and_compare_quotes(extracted_models, comparison_id=comparison_id)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\Downloads\AI-Module\app\services\ai_ranker.py", line 1945, in rank_and_compare_quotes
    return await rank_and_compare_quotes(quotes, weights, comparison_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\Downloads\AI-Module\app\services\ai_ranker.py", line 1373, in rank_and_compare_quotes
    comparison_response = _build_comprehensive_comparison(
        quotes=quotes,
    ...<2 lines>...
        quote_data_for_ai=quote_data_for_ai
    )
  File "C:\Users\Admin\Downloads\AI-Module\app\services\ai_ranker.py", line 1818, in _build_comprehensive_comparison
    'comparison_id': comparison_id,  # Use the passed comparison_id
                     ^^^^^^^^^^^^^
NameError: name 'comparison_id' is not defined. Did you mean: 'comparison_matrix'?
2025-11-24 15:47:55,224 - app.services.progress_tracker - ERROR - âŒ Job failed: job_cfca51b8b1df - name 'comparison_id' is not defined
2025-11-24 15:47:55,225 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 500 - 67.90s
2025-11-24 15:48:32,906 - main - INFO - 
2025-11-24 15:48:32,906 - main - INFO - ================================================================================
2025-11-24 15:48:32,906 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:48:32,907 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:48:32,908 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:48:32,909 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:48:32,909 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:48:32,910 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:48:32,910 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:48:32,912 - main - INFO -   âœ… Cleaned up 2 temporary files
2025-11-24 15:48:32,913 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:48:32,913 - main - INFO - ================================================================================
2025-11-24 15:48:32,913 - main - INFO - 
2025-11-24 15:48:38,135 - main - INFO - 
2025-11-24 15:48:38,135 - main - INFO - ================================================================================
2025-11-24 15:48:38,135 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:48:38,136 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:48:38,136 - main - INFO - ================================================================================
2025-11-24 15:48:38,136 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:48:38,136 - main - INFO -   Upload Directory: uploads
2025-11-24 15:48:38,136 - main - INFO -   Max File Size: 20MB
2025-11-24 15:48:38,136 - main - INFO - ================================================================================
2025-11-24 15:48:38,137 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:48:38,137 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:48:38,137 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:48:38,167 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:48:38,179 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:48:38,180 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:48:38,180 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:48:38,181 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:48:38,181 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:48:38,181 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:48:38,181 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:48:38,192 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:48:38,195 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:48:38,197 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:48:38,199 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:48:38,200 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:48:38,200 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:48:38,200 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:48:38,201 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:48:38,212 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:48:38,213 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:48:38,213 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:48:38,213 - main - INFO - 
2025-11-24 15:48:38,214 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:48:38,214 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:48:38,214 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:48:38,214 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:48:38,215 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:48:38,215 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:48:38,215 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:48:38,216 - main - INFO - 
2025-11-24 15:48:38,216 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:48:38,216 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:48:38,216 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:48:38,216 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:48:38,217 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:48:38,217 - main - INFO - 
2025-11-24 15:48:38,217 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:48:38,217 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:48:38,217 - main - INFO -        - No manual section generation
2025-11-24 15:48:38,218 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:48:38,218 - main - INFO - 
2025-11-24 15:48:38,218 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:48:38,218 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:48:38,218 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:48:38,219 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:48:38,219 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:48:38,219 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:48:38,219 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:48:38,219 - main - INFO - 
2025-11-24 15:48:38,220 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:48:38,220 - main - INFO -      Main:
2025-11-24 15:48:38,220 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:48:38,220 - main - INFO - 
2025-11-24 15:48:38,220 - main - INFO -      Retrieval:
2025-11-24 15:48:38,220 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:48:38,221 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:48:38,221 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:48:38,221 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:48:38,221 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:48:38,222 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:48:38,222 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:48:38,223 - main - INFO - 
2025-11-24 15:48:38,224 - main - INFO -      Management:
2025-11-24 15:48:38,225 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:48:38,225 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:48:38,226 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:48:38,226 - main - INFO - 
2025-11-24 15:48:38,227 - main - INFO -      Documents (MongoDB):
2025-11-24 15:48:38,227 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:48:38,228 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:48:38,228 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:48:38,228 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:48:38,229 - main - INFO - 
2025-11-24 15:48:38,229 - main - INFO -      Diagnostics & Health:
2025-11-24 15:48:38,229 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:48:38,229 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:48:38,229 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:48:38,230 - main - INFO - 
2025-11-24 15:48:38,230 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:48:38,230 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:48:38,230 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:48:38,231 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:48:38,231 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:48:38,231 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:48:38,232 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:48:38,232 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:48:38,232 - main - INFO - 
2025-11-24 15:48:38,232 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:48:38,232 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:48:38,233 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:48:38,233 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:48:38,233 - main - INFO -      4. No re-upload needed!
2025-11-24 15:48:38,233 - main - INFO - 
2025-11-24 15:48:38,233 - main - INFO - ================================================================================
2025-11-24 15:48:38,233 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:48:38,234 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:48:38,234 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:48:38,234 - main - INFO - ================================================================================
2025-11-24 15:48:38,234 - main - INFO - 
2025-11-24 15:48:38,234 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:48:41,442 - main - INFO - 
2025-11-24 15:48:41,443 - main - INFO - ================================================================================
2025-11-24 15:48:41,443 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:48:41,443 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:48:41,443 - main - INFO - ================================================================================
2025-11-24 15:48:41,444 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:48:41,444 - main - INFO -   Upload Directory: uploads
2025-11-24 15:48:41,444 - main - INFO -   Max File Size: 20MB
2025-11-24 15:48:41,444 - main - INFO - ================================================================================
2025-11-24 15:48:41,445 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:48:41,445 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:48:41,445 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:48:41,486 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:48:41,494 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:48:41,494 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:48:41,495 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:48:41,495 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:48:41,495 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:48:41,496 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:48:41,496 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:48:41,503 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:48:41,504 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:48:41,507 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:48:41,509 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:48:41,510 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:48:41,510 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:48:41,510 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:48:41,510 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:48:41,518 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:48:41,518 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:48:41,518 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:48:41,518 - main - INFO - 
2025-11-24 15:48:41,519 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:48:41,519 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:48:41,519 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:48:41,519 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:48:41,520 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:48:41,520 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:48:41,520 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:48:41,520 - main - INFO - 
2025-11-24 15:48:41,520 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:48:41,520 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:48:41,521 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:48:41,521 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:48:41,521 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:48:41,521 - main - INFO - 
2025-11-24 15:48:41,521 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:48:41,522 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:48:41,522 - main - INFO -        - No manual section generation
2025-11-24 15:48:41,522 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:48:41,523 - main - INFO - 
2025-11-24 15:48:41,523 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:48:41,523 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:48:41,524 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:48:41,524 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:48:41,524 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:48:41,524 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:48:41,525 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:48:41,525 - main - INFO - 
2025-11-24 15:48:41,525 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:48:41,525 - main - INFO -      Main:
2025-11-24 15:48:41,525 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:48:41,525 - main - INFO - 
2025-11-24 15:48:41,526 - main - INFO -      Retrieval:
2025-11-24 15:48:41,526 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:48:41,526 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:48:41,526 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:48:41,526 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:48:41,526 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:48:41,527 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:48:41,527 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:48:41,527 - main - INFO - 
2025-11-24 15:48:41,527 - main - INFO -      Management:
2025-11-24 15:48:41,527 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:48:41,528 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:48:41,528 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:48:41,528 - main - INFO - 
2025-11-24 15:48:41,528 - main - INFO -      Documents (MongoDB):
2025-11-24 15:48:41,528 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:48:41,529 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:48:41,529 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:48:41,529 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:48:41,529 - main - INFO - 
2025-11-24 15:48:41,529 - main - INFO -      Diagnostics & Health:
2025-11-24 15:48:41,530 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:48:41,530 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:48:41,530 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:48:41,530 - main - INFO - 
2025-11-24 15:48:41,530 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:48:41,531 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:48:41,531 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:48:41,531 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:48:41,531 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:48:41,531 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:48:41,532 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:48:41,532 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:48:41,532 - main - INFO - 
2025-11-24 15:48:41,532 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:48:41,532 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:48:41,532 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:48:41,533 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:48:41,533 - main - INFO -      4. No re-upload needed!
2025-11-24 15:48:41,533 - main - INFO - 
2025-11-24 15:48:41,533 - main - INFO - ================================================================================
2025-11-24 15:48:41,533 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:48:41,533 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:48:41,534 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:48:41,534 - main - INFO - ================================================================================
2025-11-24 15:48:41,534 - main - INFO - 
2025-11-24 15:48:41,534 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:49:03,197 - main - INFO - 
2025-11-24 15:49:03,197 - main - INFO - ================================================================================
2025-11-24 15:49:03,197 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:49:03,198 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:49:03,199 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:49:03,200 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:49:03,200 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:49:03,201 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:49:03,201 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:49:03,202 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-24 15:49:03,202 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:49:03,203 - main - INFO - ================================================================================
2025-11-24 15:49:03,203 - main - INFO - 
2025-11-24 15:49:06,081 - main - INFO - 
2025-11-24 15:49:06,081 - main - INFO - ================================================================================
2025-11-24 15:49:06,081 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:49:06,082 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:49:06,082 - main - INFO - ================================================================================
2025-11-24 15:49:06,082 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:49:06,082 - main - INFO -   Upload Directory: uploads
2025-11-24 15:49:06,083 - main - INFO -   Max File Size: 20MB
2025-11-24 15:49:06,083 - main - INFO - ================================================================================
2025-11-24 15:49:06,083 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:49:06,084 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:49:06,084 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:49:06,131 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:49:06,136 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:49:06,136 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:49:06,136 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:49:06,136 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:49:06,136 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:49:06,137 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:49:06,137 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:49:06,147 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:49:06,148 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:49:06,149 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:49:06,151 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:49:06,151 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:49:06,151 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:49:06,152 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:49:06,152 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:49:06,181 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:49:06,182 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:49:06,182 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:49:06,182 - main - INFO - 
2025-11-24 15:49:06,182 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:49:06,183 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:49:06,183 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:49:06,183 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:49:06,183 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:49:06,183 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:49:06,183 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:49:06,184 - main - INFO - 
2025-11-24 15:49:06,184 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:49:06,184 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:49:06,184 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:49:06,184 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:49:06,184 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:49:06,185 - main - INFO - 
2025-11-24 15:49:06,185 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:49:06,185 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:49:06,185 - main - INFO -        - No manual section generation
2025-11-24 15:49:06,185 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:49:06,185 - main - INFO - 
2025-11-24 15:49:06,186 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:49:06,186 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:49:06,186 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:49:06,186 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:49:06,186 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:49:06,186 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:49:06,187 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:49:06,187 - main - INFO - 
2025-11-24 15:49:06,187 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:49:06,187 - main - INFO -      Main:
2025-11-24 15:49:06,187 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:49:06,188 - main - INFO - 
2025-11-24 15:49:06,188 - main - INFO -      Retrieval:
2025-11-24 15:49:06,188 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:49:06,188 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:49:06,188 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:49:06,189 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:49:06,189 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:49:06,189 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:49:06,189 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:49:06,189 - main - INFO - 
2025-11-24 15:49:06,190 - main - INFO -      Management:
2025-11-24 15:49:06,190 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:49:06,190 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:49:06,190 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:49:06,190 - main - INFO - 
2025-11-24 15:49:06,190 - main - INFO -      Documents (MongoDB):
2025-11-24 15:49:06,191 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:49:06,191 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:49:06,191 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:49:06,191 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:49:06,191 - main - INFO - 
2025-11-24 15:49:06,192 - main - INFO -      Diagnostics & Health:
2025-11-24 15:49:06,192 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:49:06,192 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:49:06,192 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:49:06,192 - main - INFO - 
2025-11-24 15:49:06,192 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:49:06,193 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:49:06,193 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:49:06,193 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:49:06,193 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:49:06,194 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:49:06,194 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:49:06,195 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:49:06,195 - main - INFO - 
2025-11-24 15:49:06,196 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:49:06,196 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:49:06,197 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:49:06,197 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:49:06,197 - main - INFO -      4. No re-upload needed!
2025-11-24 15:49:06,197 - main - INFO - 
2025-11-24 15:49:06,198 - main - INFO - ================================================================================
2025-11-24 15:49:06,198 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:49:06,198 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:49:06,198 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:49:06,199 - main - INFO - ================================================================================
2025-11-24 15:49:06,199 - main - INFO - 
2025-11-24 15:49:06,199 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 15:49:07,988 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-24 15:49:07,992 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-24 15:49:07,993 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:49:07,993 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:49:07,993 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:49:07,994 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:49:07,995 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-24 15:49:07,996 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-24 15:49:07,996 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-24 15:49:07,996 - app.api.routes - INFO -    - Files uploaded: 2
2025-11-24 15:49:07,996 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763999347_4bf80d6cd506
2025-11-24 15:49:07,996 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_1527615f7b7f (2 files)
2025-11-24 15:49:07,997 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_1527615f7b7f
2025-11-24 15:49:07,997 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:49:07,997 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:49:07,997 - app.api.routes - INFO - ======================================================================
2025-11-24 15:49:07,998 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 283031e7a4224e2e8c23d334d8e63771.pdf (464206 bytes)
2025-11-24 15:49:07,999 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:49:07,999 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\283031e7a4224e2e8c23d334d8e63771.pdf
2025-11-24 15:49:07,999 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:49:08,000 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:49:08,038 - app.api.routes - INFO - ======================================================================
2025-11-24 15:49:08,067 - app.services.pdf_extractor - INFO - Successfully extracted 14935 characters from 7 pages
2025-11-24 15:49:08,067 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ a99fe62af39c4d6bb12c3ea77fb463aa.pdf (175401 bytes)
2025-11-24 15:49:08,068 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:49:08,068 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a99fe62af39c4d6bb12c3ea77fb463aa.pdf
2025-11-24 15:49:08,068 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:49:08,069 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:49:08,104 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Tawuniya (pattern: \btawuniya\b)
2025-11-24 15:49:08,123 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-24 15:49:08,124 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Tawuniya
2025-11-24 15:49:08,124 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:49:08,125 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:49:08,125 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-24 15:49:08,279 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-24 15:49:08,280 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:49:08,591 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:49:08,591 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:49:08,591 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-24 15:49:08,592 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-24 15:49:08,592 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:49:08,592 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:49:08,593 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-24 15:49:08,678 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-24 15:49:08,678 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:49:35,252 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:49:35,263 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:49:35,263 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:49:35,264 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:49:35,264 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-24 15:49:35,265 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:49:35,265 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-24 15:49:35,270 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 45 benefits from patterns
2025-11-24 15:49:35,271 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 44 total
2025-11-24 15:49:35,271 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:49:48,216 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:49:48,218 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:49:48,218 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:49:48,219 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.38â€° (Per Mille)' â†’ '0.38â€°'
2025-11-24 15:49:48,219 - app.services.ai_parser - INFO - ðŸ’° Calculated: 594567.88 from SI: 1564652306.0 Ã— Rate: 0.38â€° (Per Mille)
2025-11-24 15:49:48,220 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:49:48,220 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:49:48,221 - app.services.ai_parser - INFO - ðŸ“Š Counts: 44 benefits, 24 exclusions, 13 warranties, 5 extensions
2025-11-24 15:49:53,873 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:49:53,875 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:49:53,875 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:49:53,876 - app.services.ai_parser - INFO - 
2025-11-24 15:49:53,876 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:49:53,876 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:49:53,877 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:49:53,877 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Tawuniya
2025-11-24 15:49:53,878 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s.  Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan
2025-11-24 15:49:53,878 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 594,567.87
2025-11-24 15:49:53,878 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.38â€°
2025-11-24 15:49:53,879 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:49:53,879 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 15:49:53,879 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000
2025-11-24 15:49:53,880 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:49:53,880 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:49:53,880 - app.services.ai_parser - INFO - 
2025-11-24 15:49:53,880 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:49:53,880 - app.services.ai_parser - INFO -    âœ“ Benefits: 44
2025-11-24 15:49:53,881 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-24 15:49:53,881 - app.services.ai_parser - INFO -    âœ“ Warranties: 13
2025-11-24 15:49:53,881 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:49:53,881 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:49:53,881 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:49:53,883 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 283031e7a4224e2e8c23d334d8e63771.pdf â†’ 69247ea133405eb2c83667f9
2025-11-24 15:49:53,883 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247ea133405eb2c83667f9
2025-11-24 15:49:53,886 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247ea133405eb2c83667fa (464206 bytes)
2025-11-24 15:49:53,886 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Tawuniya (1).pdf â†’ 69247ea133405eb2c83667fa
2025-11-24 15:49:53,886 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Tawuniya (1).pdf
2025-11-24 15:50:14,406 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:50:14,411 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:50:14,411 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:50:14,412 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:50:14,413 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:50:21,665 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:50:21,668 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:50:21,669 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:50:21,670 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-24 15:50:21,670 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-24 15:50:21,671 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:50:21,672 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:50:21,672 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:50:21,673 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-24 15:50:21,674 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:50:21,675 - app.services.ai_parser - INFO - ðŸ“Š Counts: 16 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-24 15:50:28,799 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:50:28,808 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-24 15:50:28,809 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:50:28,809 - app.services.ai_parser - INFO - 
2025-11-24 15:50:28,809 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:50:28,809 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:50:28,809 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:50:28,810 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-24 15:50:28,810 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:50:28,810 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-24 15:50:28,810 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-24 15:50:28,811 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-24 15:50:28,811 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-24 15:50:28,811 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-24 15:50:28,811 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:50:28,811 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:50:28,812 - app.services.ai_parser - INFO - 
2025-11-24 15:50:28,812 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:50:28,812 - app.services.ai_parser - INFO -    âœ“ Benefits: 16
2025-11-24 15:50:28,812 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-24 15:50:28,812 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-24 15:50:28,812 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:50:28,813 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:50:28,813 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:50:28,814 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a99fe62af39c4d6bb12c3ea77fb463aa.pdf â†’ 69247ec433405eb2c83667fb
2025-11-24 15:50:28,814 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247ec433405eb2c83667fb
2025-11-24 15:50:28,816 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247ec433405eb2c83667fc (175401 bytes)
2025-11-24 15:50:28,816 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247ec433405eb2c83667fc
2025-11-24 15:50:28,816 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:50:28,816 - app.api.routes - INFO - 
âœ… Successfully extracted 2 quotes
2025-11-24 15:50:28,816 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:50:28,817 - app.api.routes - INFO - ðŸ”€ Generating comparison for 2 quotes
2025-11-24 15:50:28,817 - app.api.routes - INFO - ======================================================================
2025-11-24 15:50:28,817 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 2 quotes
2025-11-24 15:50:28,817 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-24 15:50:28,817 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-24 15:50:28,817 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-24 15:50:28,818 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-24 15:50:28,818 - app.services.ai_ranker - INFO - ================================================================================
2025-11-24 15:50:28,818 - app.services.ai_ranker - INFO - 
============================================================
2025-11-24 15:50:28,818 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Tawuniya
2025-11-24 15:50:28,818 - app.services.ai_ranker - INFO - ============================================================
2025-11-24 15:50:28,818 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-24 15:50:28,819 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:50:28,819 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-24 15:50:28,819 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-24 15:50:28,819 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-24 15:50:28,819 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-24 15:50:28,820 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-24 15:50:28,820 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-24 15:50:28,820 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-24 15:50:28,820 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306.0,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: 5% of claim amount, minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claim amount, minimum SR 1,500,000",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SR 2,500,000 any one occurrence & in aggregate",
    "srcc_malicious_damage": "Limited to 25% of the location sum insured",
    "Minimization of losses": "SR 250,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Industries Seepage, Pollution and 
2025-11-24 15:50:28,821 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:50:28,822 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-24 15:50:28,822 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-24 15:50:28,822 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-24 15:50:28,822 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-24 15:50:28,822 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-24 15:50:28,823 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-24 15:50:28,823 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-24 15:50:28,823 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-24 15:50:28,823 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-24 15:50:28,823 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-24 15:50:28,823 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-24 15:50:28,824 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-24 15:50:28,824 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-24 15:50:28,824 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-24 15:50:28,824 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-24 15:50:28,824 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-24 15:50:28,824 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:50:28,825 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Tawuniya
2025-11-24 15:50:28,825 - app.services.ai_ranker - INFO - 
ðŸ“Š Tawuniya:
2025-11-24 15:50:28,825 - app.services.ai_ranker - INFO -    Warranties: 13
2025-11-24 15:50:28,825 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-24 15:50:28,825 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-24 15:50:28,825 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-24 15:50:28,826 - app.services.ai_ranker - INFO - 
============================================================
2025-11-24 15:50:28,826 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-24 15:50:28,826 - app.services.ai_ranker - INFO - ============================================================
2025-11-24 15:50:28,826 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-24 15:50:28,826 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:50:28,827 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-24 15:50:28,827 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-24 15:50:28,827 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-24 15:50:28,827 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-24 15:50:28,827 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-24 15:50:28,827 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-24 15:50:28,828 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-24 15:50:28,828 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_t
2025-11-24 15:50:28,829 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:50:28,829 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-24 15:50:28,830 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-24 15:50:28,830 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-24 15:50:28,830 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-24 15:50:28,830 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-24 15:50:28,830 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-24 15:50:28,831 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-24 15:50:28,831 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-24 15:50:28,832 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-24 15:50:28,832 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-24 15:50:28,832 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-24 15:50:28,833 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-24 15:50:28,833 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-24 15:50:28,833 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-24 15:50:28,833 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-24 15:50:28,833 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-24 15:50:28,834 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-24 15:50:28,834 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-24 15:50:28,834 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-24 15:50:28,835 - app.services.ai_ranker - INFO -    Warranties: 10
2025-11-24 15:50:28,835 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-24 15:50:28,835 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-24 15:50:28,835 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-24 15:50:28,836 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Tawuniya
2025-11-24 15:50:29,027 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 4
2025-11-24 15:50:29,028 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-24 15:50:29,028 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-24 15:50:29,028 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-24 15:50:29,029 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-24 15:50:29,029 - app.services.ai_ranker - INFO -       â€¢ (W16) Bookkeeping warrantee
2025-11-24 15:50:29,029 - app.services.ai_ranker - INFO -       â€¢ (W22) Hazardous good warranty
2025-11-24 15:50:29,029 - app.services.ai_ranker - INFO -       â€¢ (W28) warranted no workshop operations on insured premises
2025-11-24 15:50:29,029 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-24 15:50:29,229 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 3
2025-11-24 15:50:29,230 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-24 15:50:29,230 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-24 15:50:29,230 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-24 15:50:29,231 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-24 15:50:29,231 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-24 15:50:29,231 - app.services.ai_ranker - INFO -       â€¢ Premium Payment Warranty 100% at inception
2025-11-24 15:50:29,231 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-24 15:50:29,231 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-24 15:50:29,232 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-24 15:50:29,232 - app.services.ai_ranker - INFO - ================================================================================

2025-11-24 15:50:29,232 - app.services.ai_ranker - INFO - ðŸ“Š Tawuniya: Hakim Score=96.0 (Premium), Weighted Score=86.52
2025-11-24 15:50:29,233 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=83.92
2025-11-24 15:50:29,233 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-24 15:50:29,233 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-24 15:50:39,897 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:50:39,908 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-24 15:50:39,910 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-24 15:50:39,911 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-24 15:50:39,912 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-24 15:50:39,912 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-24 15:50:39,912 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:39,913 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 2
2025-11-24 15:50:39,913 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-24 15:50:39,913 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 2
2025-11-24 15:50:39,913 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Tawuniya
2025-11-24 15:50:39,914 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 15:50:39,914 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 15:50:39,914 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 15:50:39,914 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 15:50:39,914 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Chubb Arabia
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 15:50:39,915 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 15:50:39,916 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 15:50:39,917 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-24 15:50:39,917 - app.services.mongodb_service_enhanced - INFO -    Summary: 2,941 bytes
2025-11-24 15:50:39,917 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 20,597 bytes
2025-11-24 15:50:39,918 - app.services.mongodb_service_enhanced - INFO -    Data table: 9,565 bytes
2025-11-24 15:50:39,918 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,452 bytes
2025-11-24 15:50:39,918 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 29,721 bytes
2025-11-24 15:50:39,918 - app.services.mongodb_service_enhanced - INFO -    Total document: 133,784 bytes
2025-11-24 15:50:39,918 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       premium: 2 items
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       rate: 2 items
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       score: 2 items
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 2 items
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       deductible: 2 items
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       coverage: 2 items
2025-11-24 15:50:39,919 - app.services.mongodb_service_enhanced - INFO -       benefits: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       exclusions: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       warranties: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       conditions: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 2 items
2025-11-24 15:50:39,920 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 2 items
2025-11-24 15:50:39,921 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-24 15:50:39,921 - app.services.mongodb_service_enhanced - INFO -       - Count: 2
2025-11-24 15:50:39,921 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:50:39,921 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:50:39,922 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-24 15:50:39,925 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:39,925 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69247ecfb757af6a8efab05a
2025-11-24 15:50:39,928 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-24 15:50:39,928 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-24 15:50:39,928 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-24 15:50:39,928 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-24 15:50:39,929 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-24 15:50:39,929 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-24 15:50:39,929 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-24 15:50:39,929 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 2
2025-11-24 15:50:39,929 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-24 15:50:39,930 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 2
2025-11-24 15:50:39,930 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-24 15:50:39,930 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 2
2025-11-24 15:50:39,930 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:50:39,931 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-24 15:50:39,931 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-24 15:50:39,931 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-24 15:50:39,931 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-24 15:50:39,932 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-24 15:50:39,932 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:50:39,932 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69247ecfb757af6a8efab05a
2025-11-24 15:50:39,932 - app.api.routes - INFO -    Database: hakemAI
2025-11-24 15:50:39,933 - app.api.routes - INFO -    Collection: comparisons
2025-11-24 15:50:39,933 - app.api.routes - INFO -    Comparison ID: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:39,934 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-24 15:50:39,934 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-24 15:50:39,935 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:50:39,935 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-24 15:50:39,935 - app.api.routes - INFO - ======================================================================
2025-11-24 15:50:39,935 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:39,935 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-24 15:50:39,935 - app.api.routes - INFO - ðŸ“„ Files Processed: 2/2
2025-11-24 15:50:39,936 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 2 PDFs + 1 comparison
2025-11-24 15:50:39,936 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:50:39,936 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:50:39,936 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:50:39,937 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:50:39,938 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-24 15:50:39,938 - app.api.routes - INFO - ======================================================================

2025-11-24 15:50:39,938 - app.services.progress_tracker - INFO - âœ… Job completed: job_1527615f7b7f â†’ comparison_id: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:39,940 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 91.95s
2025-11-24 15:50:56,525 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1763999347_4bf80d6cd506/pdf
2025-11-24 15:50:56,526 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:56,528 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:56,528 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-24 15:50:56,529 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-24 15:50:56,530 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-24 15:50:56,530 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-24 15:50:56,532 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-24 15:50:56,533 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-24 15:50:56,537 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-24 15:50:56,537 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-24 15:50:56,539 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-24 15:50:56,539 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-24 15:50:56,541 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-24 15:50:56,541 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-24 15:50:56,543 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-24 15:50:56,675 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1763999347_4bf80d6cd506
2025-11-24 15:50:56,676 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1763999347_4bf80d6cd506_20251124_155056.pdf (135699 bytes)
2025-11-24 15:50:56,676 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1763999347_4bf80d6cd506/pdf - 200 - 0.15s
2025-11-24 15:51:49,754 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-24 15:51:49,758 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-24 15:51:49,763 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:51:49,763 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:51:49,764 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:51:49,766 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:51:49,767 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-24 15:51:49,768 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-24 15:51:49,768 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-24 15:51:49,768 - app.api.routes - INFO -    - Files uploaded: 1
2025-11-24 15:51:49,769 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1763999509_d7bdb0d9803c
2025-11-24 15:51:49,769 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_fc3d2a90d78c (1 files)
2025-11-24 15:51:49,769 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_fc3d2a90d78c
2025-11-24 15:51:49,770 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:51:49,771 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:51:49,771 - app.api.routes - INFO - ======================================================================
2025-11-24 15:51:49,772 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ e8d4953333f94518949ebc2f5bc969de.pdf (175401 bytes)
2025-11-24 15:51:49,796 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:51:49,798 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e8d4953333f94518949ebc2f5bc969de.pdf
2025-11-24 15:51:49,892 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-24 15:51:49,892 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:51:49,893 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:51:49,893 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-24 15:51:49,893 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-24 15:51:49,893 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:51:49,893 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-24 15:51:49,894 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-24 15:51:49,969 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-24 15:51:49,969 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-24 15:52:41,053 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:52:41,058 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-24 15:52:41,058 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-24 15:52:41,059 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-24 15:52:41,059 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-24 15:52:41,062 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 60 benefits from patterns
2025-11-24 15:52:41,062 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 57 total
2025-11-24 15:52:41,063 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-24 15:52:48,516 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:52:48,523 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-24 15:52:48,524 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-24 15:52:48,524 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-24 15:52:48,525 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-24 15:52:48,526 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:52:48,526 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:52:48,526 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-24 15:52:48,527 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-24 15:52:48,528 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-24 15:52:48,528 - app.services.ai_parser - INFO - ðŸ“Š Counts: 57 benefits, 29 exclusions, 8 warranties, 5 extensions
2025-11-24 15:52:56,343 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-24 15:52:56,347 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-24 15:52:56,347 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-24 15:52:56,348 - app.services.ai_parser - INFO - 
2025-11-24 15:52:56,349 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:52:56,350 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:52:56,350 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:52:56,351 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-24 15:52:56,352 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-24 15:52:56,353 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-24 15:52:56,353 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-24 15:52:56,354 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-24 15:52:56,355 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-24 15:52:56,356 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-24 15:52:56,357 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-24 15:52:56,357 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-24 15:52:56,358 - app.services.ai_parser - INFO - 
2025-11-24 15:52:56,359 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-24 15:52:56,360 - app.services.ai_parser - INFO -    âœ“ Benefits: 57
2025-11-24 15:52:56,360 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-24 15:52:56,361 - app.services.ai_parser - INFO -    âœ“ Warranties: 8
2025-11-24 15:52:56,362 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-24 15:52:56,362 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-24 15:52:56,363 - app.services.ai_parser - INFO - ======================================================================
2025-11-24 15:52:56,366 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e8d4953333f94518949ebc2f5bc969de.pdf â†’ 69247f5833405eb2c83667fd
2025-11-24 15:52:56,367 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69247f5833405eb2c83667fd
2025-11-24 15:52:56,370 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247f5833405eb2c83667fe (175401 bytes)
2025-11-24 15:52:56,370 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69247f5833405eb2c83667fe
2025-11-24 15:52:56,371 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-24 15:52:56,372 - app.api.routes - INFO - 
âœ… Successfully extracted 1 quotes
2025-11-24 15:52:56,372 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:52:56,373 - app.api.routes - INFO - ðŸ”€ Generating comparison for 1 quotes
2025-11-24 15:52:56,373 - app.api.routes - INFO - ======================================================================
2025-11-24 15:52:56,374 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-24 15:52:56,374 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1763999509_d7bdb0d9803c
2025-11-24 15:52:56,374 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 1
2025-11-24 15:52:56,375 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-24 15:52:56,375 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 1
2025-11-24 15:52:56,376 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Chubb Arabia
2025-11-24 15:52:56,376 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-24 15:52:56,376 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-24 15:52:56,377 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-24 15:52:56,377 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-24 15:52:56,377 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-24 15:52:56,378 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-24 15:52:56,379 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-24 15:52:56,379 - app.services.mongodb_service_enhanced - INFO -    Summary: 1,121 bytes
2025-11-24 15:52:56,380 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 60 bytes
2025-11-24 15:52:56,380 - app.services.mongodb_service_enhanced - INFO -    Data table: 44 bytes
2025-11-24 15:52:56,380 - app.services.mongodb_service_enhanced - INFO -    Analytics: 48 bytes
2025-11-24 15:52:56,381 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 17,015 bytes
2025-11-24 15:52:56,381 - app.services.mongodb_service_enhanced - INFO -    Total document: 37,893 bytes
2025-11-24 15:52:56,381 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-24 15:52:56,382 - app.services.mongodb_service_enhanced - INFO -       - Count: 1
2025-11-24 15:52:56,383 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:52:56,385 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:52:56,386 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-24 15:52:56,388 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1763999509_d7bdb0d9803c
2025-11-24 15:52:56,389 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69247f58b757af6a8efab05b
2025-11-24 15:52:56,391 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-24 15:52:56,391 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-24 15:52:56,392 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-24 15:52:56,392 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-24 15:52:56,392 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-24 15:52:56,392 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-24 15:52:56,393 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-24 15:52:56,393 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 1
2025-11-24 15:52:56,393 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-24 15:52:56,393 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-24 15:52:56,394 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-24 15:52:56,394 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-24 15:52:56,394 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-24 15:52:56,394 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-24 15:52:56,395 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-24 15:52:56,395 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69247f58b757af6a8efab05b
2025-11-24 15:52:56,395 - app.api.routes - INFO -    Database: hakemAI
2025-11-24 15:52:56,395 - app.api.routes - INFO -    Collection: comparisons
2025-11-24 15:52:56,396 - app.api.routes - INFO -    Comparison ID: cmp_1763999509_d7bdb0d9803c
2025-11-24 15:52:56,397 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-24 15:52:56,397 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-24 15:52:56,398 - app.api.routes - INFO - 
======================================================================
2025-11-24 15:52:56,398 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-24 15:52:56,399 - app.api.routes - INFO - ======================================================================
2025-11-24 15:52:56,400 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1763999509_d7bdb0d9803c
2025-11-24 15:52:56,401 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-24 15:52:56,401 - app.api.routes - INFO - ðŸ“„ Files Processed: 1/1
2025-11-24 15:52:56,402 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 1 PDFs + 1 comparison
2025-11-24 15:52:56,402 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-24 15:52:56,402 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-24 15:52:56,403 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-24 15:52:56,404 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-24 15:52:56,405 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-24 15:52:56,405 - app.api.routes - INFO - ======================================================================

2025-11-24 15:52:56,405 - app.services.progress_tracker - INFO - âœ… Job completed: job_fc3d2a90d78c â†’ comparison_id: cmp_1763999509_d7bdb0d9803c
2025-11-24 15:52:56,407 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 66.65s
2025-11-24 15:56:55,148 - main - INFO - 
2025-11-24 15:56:55,148 - main - INFO - ================================================================================
2025-11-24 15:56:55,149 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-24 15:56:55,150 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:56:55,151 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-24 15:56:55,152 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-24 15:56:55,153 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-24 15:56:55,154 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-24 15:56:55,154 - main - INFO -   âœ… User Documents Service connection closed
2025-11-24 15:56:55,156 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-24 15:56:55,157 - main - INFO -   âœ… Application stopped successfully
2025-11-24 15:56:55,157 - main - INFO - ================================================================================
2025-11-24 15:56:55,158 - main - INFO - 
2025-11-24 15:56:57,616 - main - INFO - 
2025-11-24 15:56:57,617 - main - INFO - ================================================================================
2025-11-24 15:56:57,617 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-24 15:56:57,617 - main - INFO -   Production-Ready Complete Integration
2025-11-24 15:56:57,617 - main - INFO - ================================================================================
2025-11-24 15:56:57,618 - main - INFO -   AI Model: gpt-4o-mini
2025-11-24 15:56:57,618 - main - INFO -   Upload Directory: uploads
2025-11-24 15:56:57,618 - main - INFO -   Max File Size: 20MB
2025-11-24 15:56:57,618 - main - INFO - ================================================================================
2025-11-24 15:56:57,619 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-24 15:56:57,619 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-24 15:56:57,619 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-24 15:56:57,637 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-24 15:56:57,644 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-24 15:56:57,644 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-24 15:56:57,645 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-24 15:56:57,645 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-24 15:56:57,645 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-24 15:56:57,645 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:56:57,646 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-24 15:56:57,656 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-24 15:56:57,659 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-24 15:56:57,661 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-24 15:56:57,662 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-24 15:56:57,663 - main - INFO -   âœ… User Subscription Service connected
2025-11-24 15:56:57,663 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-24 15:56:57,663 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-24 15:56:57,664 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-24 15:56:57,671 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-24 15:56:57,671 - main - INFO -   âœ… User Documents Service connected
2025-11-24 15:56:57,671 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-24 15:56:57,671 - main - INFO - 
2025-11-24 15:56:57,672 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-24 15:56:57,672 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-24 15:56:57,672 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-24 15:56:57,672 - main - INFO -        - Separates warranties from extensions
2025-11-24 15:56:57,673 - main - INFO -        - Extracts subjectivities & operational details
2025-11-24 15:56:57,673 - main - INFO -        - Correct deductible tier detection
2025-11-24 15:56:57,673 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-24 15:56:57,674 - main - INFO - 
2025-11-24 15:56:57,674 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-24 15:56:57,674 - main - INFO -        - Generates ALL sections comprehensively
2025-11-24 15:56:57,675 - main - INFO -        - Identifies unique items per provider
2025-11-24 15:56:57,675 - main - INFO -        - Transparent scoring methodology
2025-11-24 15:56:57,675 - main - INFO -        - Uses full _extended_data from parser
2025-11-24 15:56:57,675 - main - INFO - 
2025-11-24 15:56:57,676 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-24 15:56:57,676 - main - INFO -        - Single endpoint auto-populates everything
2025-11-24 15:56:57,676 - main - INFO -        - No manual section generation
2025-11-24 15:56:57,677 - main - INFO -        - Complete MongoDB integration
2025-11-24 15:56:57,677 - main - INFO - 
2025-11-24 15:56:57,677 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-24 15:56:57,677 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-24 15:56:57,678 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-24 15:56:57,678 - main - INFO -      âœ… Subjectivities: Now included
2025-11-24 15:56:57,678 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-24 15:56:57,678 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-24 15:56:57,679 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-24 15:56:57,679 - main - INFO - 
2025-11-24 15:56:57,679 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-24 15:56:57,679 - main - INFO -      Main:
2025-11-24 15:56:57,680 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-24 15:56:57,680 - main - INFO - 
2025-11-24 15:56:57,680 - main - INFO -      Retrieval:
2025-11-24 15:56:57,681 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-24 15:56:57,681 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-24 15:56:57,682 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-24 15:56:57,683 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-24 15:56:57,684 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-24 15:56:57,684 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-24 15:56:57,684 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-24 15:56:57,685 - main - INFO - 
2025-11-24 15:56:57,685 - main - INFO -      Management:
2025-11-24 15:56:57,685 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-24 15:56:57,685 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-24 15:56:57,685 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-24 15:56:57,685 - main - INFO - 
2025-11-24 15:56:57,686 - main - INFO -      Documents (MongoDB):
2025-11-24 15:56:57,686 - main - INFO -        GET  /api/documents                All documents
2025-11-24 15:56:57,686 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-24 15:56:57,686 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-24 15:56:57,686 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-24 15:56:57,687 - main - INFO - 
2025-11-24 15:56:57,687 - main - INFO -      Diagnostics & Health:
2025-11-24 15:56:57,687 - main - INFO -        GET  /api/health                   System health
2025-11-24 15:56:57,687 - main - INFO -        GET  /api/status                   Detailed status
2025-11-24 15:56:57,687 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-24 15:56:57,688 - main - INFO - 
2025-11-24 15:56:57,688 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-24 15:56:57,688 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-24 15:56:57,688 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-24 15:56:57,688 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-24 15:56:57,689 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-24 15:56:57,689 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-24 15:56:57,689 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-24 15:56:57,689 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-24 15:56:57,690 - main - INFO - 
2025-11-24 15:56:57,690 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-24 15:56:57,691 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-24 15:56:57,691 - main - INFO -      2. Receive comparison_id + complete data
2025-11-24 15:56:57,691 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-24 15:56:57,691 - main - INFO -      4. No re-upload needed!
2025-11-24 15:56:57,692 - main - INFO - 
2025-11-24 15:56:57,692 - main - INFO - ================================================================================
2025-11-24 15:56:57,692 - main - INFO -   âœ… Application started successfully!
2025-11-24 15:56:57,692 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-24 15:56:57,692 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-24 15:56:57,693 - main - INFO - ================================================================================
2025-11-24 15:56:57,693 - main - INFO - 
2025-11-24 15:56:57,693 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-24 18:45:24,503 - main - INFO - ðŸ“¥ GET /api/comparison/6920d1a1b757af6a8efab056/pdf
2025-11-24 18:45:24,510 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: 6920d1a1b757af6a8efab056
2025-11-24 18:45:24,520 - main - INFO - ðŸ“¤ GET /api/comparison/6920d1a1b757af6a8efab056/pdf - 404 - 0.02s
2025-11-24 18:45:38,715 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1763758417_4e7dff799ec8/pdf
2025-11-24 18:45:38,716 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1763758417_4e7dff799ec8
2025-11-24 18:45:38,719 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1763758417_4e7dff799ec8
2025-11-24 18:45:38,719 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-24 18:45:38,724 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-24 18:45:38,726 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-24 18:45:38,726 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-24 18:45:38,728 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-24 18:45:38,729 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-24 18:45:38,746 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-24 18:45:38,746 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-24 18:45:38,747 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-24 18:45:38,747 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-24 18:45:38,748 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-24 18:45:38,748 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-24 18:45:38,751 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-24 18:45:38,883 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1763758417_4e7dff799ec8
2025-11-24 18:45:38,884 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1763758417_4e7dff799ec8_20251124_184538.pdf (135657 bytes)
2025-11-24 18:45:38,885 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1763758417_4e7dff799ec8/pdf - 200 - 0.17s
2025-11-25 15:37:59,653 - main - INFO - 
2025-11-25 15:37:59,654 - main - INFO - ================================================================================
2025-11-25 15:37:59,654 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-25 15:37:59,654 - main - INFO -   Production-Ready Complete Integration
2025-11-25 15:37:59,654 - main - INFO - ================================================================================
2025-11-25 15:37:59,655 - main - INFO -   AI Model: gpt-4o-mini
2025-11-25 15:37:59,655 - main - INFO -   Upload Directory: uploads
2025-11-25 15:37:59,655 - main - INFO -   Max File Size: 20MB
2025-11-25 15:37:59,655 - main - INFO - ================================================================================
2025-11-25 15:37:59,656 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-25 15:37:59,656 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-25 15:37:59,656 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-25 15:37:59,910 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-25 15:37:59,915 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-25 15:37:59,916 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-25 15:37:59,916 - app.services.user_subscription_service - WARNING - âš ï¸  No database name specified, using default: hakemAI
2025-11-25 15:37:59,917 - app.services.user_subscription_service - WARNING -    If this is wrong, set MONGODB_DATABASE environment variable
2025-11-25 15:37:59,917 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-25 15:37:59,917 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017
2025-11-25 15:37:59,918 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-25 15:37:59,933 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-25 15:37:59,940 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-25 15:37:59,944 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-25 15:37:59,947 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-25 15:37:59,948 - main - INFO -   âœ… User Subscription Service connected
2025-11-25 15:37:59,948 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-25 15:37:59,948 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017
2025-11-25 15:37:59,949 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-25 15:37:59,971 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-25 15:37:59,972 - main - INFO -   âœ… User Documents Service connected
2025-11-25 15:37:59,972 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-25 15:37:59,974 - main - INFO - 
2025-11-25 15:37:59,975 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-25 15:37:59,975 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-25 15:37:59,976 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-25 15:37:59,977 - main - INFO -        - Separates warranties from extensions
2025-11-25 15:37:59,977 - main - INFO -        - Extracts subjectivities & operational details
2025-11-25 15:37:59,978 - main - INFO -        - Correct deductible tier detection
2025-11-25 15:37:59,978 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-25 15:37:59,979 - main - INFO - 
2025-11-25 15:37:59,979 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-25 15:37:59,979 - main - INFO -        - Generates ALL sections comprehensively
2025-11-25 15:37:59,980 - main - INFO -        - Identifies unique items per provider
2025-11-25 15:37:59,980 - main - INFO -        - Transparent scoring methodology
2025-11-25 15:37:59,980 - main - INFO -        - Uses full _extended_data from parser
2025-11-25 15:37:59,981 - main - INFO - 
2025-11-25 15:37:59,981 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-25 15:37:59,981 - main - INFO -        - Single endpoint auto-populates everything
2025-11-25 15:37:59,981 - main - INFO -        - No manual section generation
2025-11-25 15:37:59,982 - main - INFO -        - Complete MongoDB integration
2025-11-25 15:37:59,982 - main - INFO - 
2025-11-25 15:37:59,982 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-25 15:37:59,982 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-25 15:37:59,983 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-25 15:37:59,983 - main - INFO -      âœ… Subjectivities: Now included
2025-11-25 15:37:59,983 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-25 15:37:59,983 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-25 15:37:59,984 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-25 15:37:59,984 - main - INFO - 
2025-11-25 15:37:59,984 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-25 15:37:59,984 - main - INFO -      Main:
2025-11-25 15:37:59,985 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-25 15:37:59,985 - main - INFO - 
2025-11-25 15:37:59,985 - main - INFO -      Retrieval:
2025-11-25 15:37:59,986 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-25 15:37:59,986 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-25 15:37:59,986 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-25 15:37:59,987 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-25 15:37:59,987 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-25 15:37:59,988 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-25 15:37:59,988 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-25 15:37:59,988 - main - INFO - 
2025-11-25 15:37:59,989 - main - INFO -      Management:
2025-11-25 15:37:59,991 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-25 15:37:59,993 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-25 15:37:59,994 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-25 15:37:59,994 - main - INFO - 
2025-11-25 15:37:59,995 - main - INFO -      Documents (MongoDB):
2025-11-25 15:37:59,995 - main - INFO -        GET  /api/documents                All documents
2025-11-25 15:37:59,996 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-25 15:37:59,996 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-25 15:37:59,996 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-25 15:37:59,996 - main - INFO - 
2025-11-25 15:37:59,996 - main - INFO -      Diagnostics & Health:
2025-11-25 15:37:59,997 - main - INFO -        GET  /api/health                   System health
2025-11-25 15:37:59,997 - main - INFO -        GET  /api/status                   Detailed status
2025-11-25 15:37:59,997 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-25 15:37:59,997 - main - INFO - 
2025-11-25 15:37:59,998 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-25 15:37:59,998 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-25 15:37:59,998 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-25 15:37:59,998 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-25 15:37:59,998 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-25 15:37:59,999 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-25 15:37:59,999 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-25 15:37:59,999 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-25 15:38:00,000 - main - INFO - 
2025-11-25 15:38:00,000 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-25 15:38:00,000 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-25 15:38:00,001 - main - INFO -      2. Receive comparison_id + complete data
2025-11-25 15:38:00,001 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-25 15:38:00,001 - main - INFO -      4. No re-upload needed!
2025-11-25 15:38:00,001 - main - INFO - 
2025-11-25 15:38:00,002 - main - INFO - ================================================================================
2025-11-25 15:38:00,002 - main - INFO -   âœ… Application started successfully!
2025-11-25 15:38:00,002 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-25 15:38:00,003 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-25 15:38:00,003 - main - INFO - ================================================================================
2025-11-25 15:38:00,003 - main - INFO - 
2025-11-25 15:38:00,004 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-25 15:38:01,779 - main - INFO - ðŸ“¥ GET /docs
2025-11-25 15:38:01,780 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-25 15:38:01,950 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-25 15:38:01,960 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-25 17:26:01,838 - main - INFO - 
2025-11-25 17:26:01,840 - main - INFO - ================================================================================
2025-11-25 17:26:01,840 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-25 17:26:01,845 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-25 17:26:01,845 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-25 17:26:01,846 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-25 17:26:01,847 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-25 17:26:01,848 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-25 17:26:01,848 - main - INFO -   âœ… User Documents Service connection closed
2025-11-25 17:26:01,849 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-25 17:26:01,849 - main - INFO -   âœ… Application stopped successfully
2025-11-25 17:26:01,849 - main - INFO - ================================================================================
2025-11-25 17:26:01,849 - main - INFO - 
2025-11-25 17:26:05,774 - main - INFO - 
2025-11-25 17:26:05,775 - main - INFO - ================================================================================
2025-11-25 17:26:05,775 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-25 17:26:05,775 - main - INFO -   Production-Ready Complete Integration
2025-11-25 17:26:05,776 - main - INFO - ================================================================================
2025-11-25 17:26:05,776 - main - INFO -   AI Model: gpt-4o-mini
2025-11-25 17:26:05,776 - main - INFO -   Upload Directory: uploads
2025-11-25 17:26:05,776 - main - INFO -   Max File Size: 20MB
2025-11-25 17:26:05,777 - main - INFO - ================================================================================
2025-11-25 17:26:05,777 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-25 17:26:05,777 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-25 17:26:05,777 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-25 17:26:05,830 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-25 17:26:05,845 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-25 17:26:05,846 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-25 17:26:05,847 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-25 17:26:05,848 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-25 17:26:05,848 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-25 17:26:05,866 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-25 17:26:05,868 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-25 17:26:05,871 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-25 17:26:05,878 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-25 17:26:05,879 - main - INFO -   âœ… User Subscription Service connected
2025-11-25 17:26:05,879 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-25 17:26:05,880 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-25 17:26:05,880 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-25 17:26:05,894 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-25 17:26:05,895 - main - INFO -   âœ… User Documents Service connected
2025-11-25 17:26:05,895 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-25 17:26:05,895 - main - INFO - 
2025-11-25 17:26:05,896 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-25 17:26:05,896 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-25 17:26:05,896 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-25 17:26:05,896 - main - INFO -        - Separates warranties from extensions
2025-11-25 17:26:05,897 - main - INFO -        - Extracts subjectivities & operational details
2025-11-25 17:26:05,897 - main - INFO -        - Correct deductible tier detection
2025-11-25 17:26:05,897 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-25 17:26:05,898 - main - INFO - 
2025-11-25 17:26:05,898 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-25 17:26:05,898 - main - INFO -        - Generates ALL sections comprehensively
2025-11-25 17:26:05,898 - main - INFO -        - Identifies unique items per provider
2025-11-25 17:26:05,899 - main - INFO -        - Transparent scoring methodology
2025-11-25 17:26:05,899 - main - INFO -        - Uses full _extended_data from parser
2025-11-25 17:26:05,899 - main - INFO - 
2025-11-25 17:26:05,899 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-25 17:26:05,900 - main - INFO -        - Single endpoint auto-populates everything
2025-11-25 17:26:05,900 - main - INFO -        - No manual section generation
2025-11-25 17:26:05,900 - main - INFO -        - Complete MongoDB integration
2025-11-25 17:26:05,900 - main - INFO - 
2025-11-25 17:26:05,900 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-25 17:26:05,901 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-25 17:26:05,901 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-25 17:26:05,901 - main - INFO -      âœ… Subjectivities: Now included
2025-11-25 17:26:05,901 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-25 17:26:05,902 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-25 17:26:05,902 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-25 17:26:05,902 - main - INFO - 
2025-11-25 17:26:05,902 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-25 17:26:05,903 - main - INFO -      Main:
2025-11-25 17:26:05,903 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-25 17:26:05,903 - main - INFO - 
2025-11-25 17:26:05,904 - main - INFO -      Retrieval:
2025-11-25 17:26:05,904 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-25 17:26:05,904 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-25 17:26:05,905 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-25 17:26:05,905 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-25 17:26:05,906 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-25 17:26:05,907 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-25 17:26:05,908 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-25 17:26:05,909 - main - INFO - 
2025-11-25 17:26:05,910 - main - INFO -      Management:
2025-11-25 17:26:05,910 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-25 17:26:05,910 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-25 17:26:05,911 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-25 17:26:05,911 - main - INFO - 
2025-11-25 17:26:05,911 - main - INFO -      Documents (MongoDB):
2025-11-25 17:26:05,911 - main - INFO -        GET  /api/documents                All documents
2025-11-25 17:26:05,912 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-25 17:26:05,912 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-25 17:26:05,912 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-25 17:26:05,912 - main - INFO - 
2025-11-25 17:26:05,912 - main - INFO -      Diagnostics & Health:
2025-11-25 17:26:05,913 - main - INFO -        GET  /api/health                   System health
2025-11-25 17:26:05,913 - main - INFO -        GET  /api/status                   Detailed status
2025-11-25 17:26:05,913 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-25 17:26:05,913 - main - INFO - 
2025-11-25 17:26:05,913 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-25 17:26:05,914 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-25 17:26:05,914 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-25 17:26:05,914 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-25 17:26:05,914 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-25 17:26:05,915 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-25 17:26:05,915 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-25 17:26:05,915 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-25 17:26:05,915 - main - INFO - 
2025-11-25 17:26:05,916 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-25 17:26:05,916 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-25 17:26:05,916 - main - INFO -      2. Receive comparison_id + complete data
2025-11-25 17:26:05,916 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-25 17:26:05,916 - main - INFO -      4. No re-upload needed!
2025-11-25 17:26:05,917 - main - INFO - 
2025-11-25 17:26:05,917 - main - INFO - ================================================================================
2025-11-25 17:26:05,917 - main - INFO -   âœ… Application started successfully!
2025-11-25 17:26:05,917 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-25 17:26:05,917 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-25 17:26:05,918 - main - INFO - ================================================================================
2025-11-25 17:26:05,918 - main - INFO - 
2025-11-25 17:26:05,918 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-25 17:26:09,555 - main - INFO - 
2025-11-25 17:26:09,555 - main - INFO - ================================================================================
2025-11-25 17:26:09,556 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-25 17:26:09,556 - main - INFO -   Production-Ready Complete Integration
2025-11-25 17:26:09,556 - main - INFO - ================================================================================
2025-11-25 17:26:09,556 - main - INFO -   AI Model: gpt-4o-mini
2025-11-25 17:26:09,556 - main - INFO -   Upload Directory: uploads
2025-11-25 17:26:09,557 - main - INFO -   Max File Size: 20MB
2025-11-25 17:26:09,557 - main - INFO - ================================================================================
2025-11-25 17:26:09,557 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-25 17:26:09,558 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-25 17:26:09,558 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-25 17:26:09,592 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-25 17:26:09,597 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-25 17:26:09,598 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-25 17:26:09,598 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-25 17:26:09,598 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-25 17:26:09,598 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-25 17:26:09,608 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-25 17:26:09,610 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-25 17:26:09,612 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-25 17:26:09,614 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-25 17:26:09,615 - main - INFO -   âœ… User Subscription Service connected
2025-11-25 17:26:09,615 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-25 17:26:09,615 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-25 17:26:09,616 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-25 17:26:09,624 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-25 17:26:09,624 - main - INFO -   âœ… User Documents Service connected
2025-11-25 17:26:09,625 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-25 17:26:09,625 - main - INFO - 
2025-11-25 17:26:09,625 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-25 17:26:09,626 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-25 17:26:09,626 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-25 17:26:09,626 - main - INFO -        - Separates warranties from extensions
2025-11-25 17:26:09,626 - main - INFO -        - Extracts subjectivities & operational details
2025-11-25 17:26:09,627 - main - INFO -        - Correct deductible tier detection
2025-11-25 17:26:09,627 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-25 17:26:09,627 - main - INFO - 
2025-11-25 17:26:09,627 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-25 17:26:09,627 - main - INFO -        - Generates ALL sections comprehensively
2025-11-25 17:26:09,628 - main - INFO -        - Identifies unique items per provider
2025-11-25 17:26:09,628 - main - INFO -        - Transparent scoring methodology
2025-11-25 17:26:09,628 - main - INFO -        - Uses full _extended_data from parser
2025-11-25 17:26:09,628 - main - INFO - 
2025-11-25 17:26:09,629 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-25 17:26:09,629 - main - INFO -        - Single endpoint auto-populates everything
2025-11-25 17:26:09,629 - main - INFO -        - No manual section generation
2025-11-25 17:26:09,629 - main - INFO -        - Complete MongoDB integration
2025-11-25 17:26:09,630 - main - INFO - 
2025-11-25 17:26:09,630 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-25 17:26:09,630 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-25 17:26:09,630 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-25 17:26:09,630 - main - INFO -      âœ… Subjectivities: Now included
2025-11-25 17:26:09,630 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-25 17:26:09,631 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-25 17:26:09,631 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-25 17:26:09,631 - main - INFO - 
2025-11-25 17:26:09,631 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-25 17:26:09,631 - main - INFO -      Main:
2025-11-25 17:26:09,632 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-25 17:26:09,632 - main - INFO - 
2025-11-25 17:26:09,632 - main - INFO -      Retrieval:
2025-11-25 17:26:09,632 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-25 17:26:09,632 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-25 17:26:09,632 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-25 17:26:09,633 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-25 17:26:09,633 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-25 17:26:09,633 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-25 17:26:09,633 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-25 17:26:09,633 - main - INFO - 
2025-11-25 17:26:09,634 - main - INFO -      Management:
2025-11-25 17:26:09,634 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-25 17:26:09,634 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-25 17:26:09,634 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-25 17:26:09,634 - main - INFO - 
2025-11-25 17:26:09,634 - main - INFO -      Documents (MongoDB):
2025-11-25 17:26:09,635 - main - INFO -        GET  /api/documents                All documents
2025-11-25 17:26:09,635 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-25 17:26:09,635 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-25 17:26:09,635 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-25 17:26:09,636 - main - INFO - 
2025-11-25 17:26:09,636 - main - INFO -      Diagnostics & Health:
2025-11-25 17:26:09,637 - main - INFO -        GET  /api/health                   System health
2025-11-25 17:26:09,637 - main - INFO -        GET  /api/status                   Detailed status
2025-11-25 17:26:09,637 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-25 17:26:09,638 - main - INFO - 
2025-11-25 17:26:09,638 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-25 17:26:09,638 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-25 17:26:09,638 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-25 17:26:09,638 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-25 17:26:09,639 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-25 17:26:09,639 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-25 17:26:09,639 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-25 17:26:09,639 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-25 17:26:09,639 - main - INFO - 
2025-11-25 17:26:09,640 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-25 17:26:09,640 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-25 17:26:09,640 - main - INFO -      2. Receive comparison_id + complete data
2025-11-25 17:26:09,640 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-25 17:26:09,640 - main - INFO -      4. No re-upload needed!
2025-11-25 17:26:09,641 - main - INFO - 
2025-11-25 17:26:09,641 - main - INFO - ================================================================================
2025-11-25 17:26:09,641 - main - INFO -   âœ… Application started successfully!
2025-11-25 17:26:09,641 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-25 17:26:09,641 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-25 17:26:09,642 - main - INFO - ================================================================================
2025-11-25 17:26:09,642 - main - INFO - 
2025-11-25 17:26:09,642 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-25 17:26:41,959 - main - INFO - 
2025-11-25 17:26:41,960 - main - INFO - ================================================================================
2025-11-25 17:26:41,960 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-25 17:26:41,961 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-25 17:26:41,980 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-25 17:26:41,996 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-25 17:26:41,997 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-25 17:26:41,999 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-25 17:26:42,000 - main - INFO -   âœ… User Documents Service connection closed
2025-11-25 17:26:42,001 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-25 17:26:42,001 - main - INFO -   âœ… Application stopped successfully
2025-11-25 17:26:42,015 - main - INFO - ================================================================================
2025-11-25 17:26:42,016 - main - INFO - 
2025-11-25 17:26:44,369 - main - INFO - 
2025-11-25 17:26:44,369 - main - INFO - ================================================================================
2025-11-25 17:26:44,370 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-25 17:26:44,370 - main - INFO -   Production-Ready Complete Integration
2025-11-25 17:26:44,370 - main - INFO - ================================================================================
2025-11-25 17:26:44,370 - main - INFO -   AI Model: gpt-4o-mini
2025-11-25 17:26:44,371 - main - INFO -   Upload Directory: uploads
2025-11-25 17:26:44,371 - main - INFO -   Max File Size: 20MB
2025-11-25 17:26:44,371 - main - INFO - ================================================================================
2025-11-25 17:26:44,372 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-25 17:26:44,372 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-25 17:26:44,372 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-25 17:26:44,404 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-25 17:26:44,417 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-25 17:26:44,417 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-25 17:26:44,417 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-25 17:26:44,418 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-25 17:26:44,418 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-25 17:26:44,451 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-25 17:26:44,453 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-25 17:26:44,455 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-25 17:26:44,458 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-25 17:26:44,459 - main - INFO -   âœ… User Subscription Service connected
2025-11-25 17:26:44,459 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-25 17:26:44,460 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-25 17:26:44,460 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-25 17:26:44,497 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-25 17:26:44,497 - main - INFO -   âœ… User Documents Service connected
2025-11-25 17:26:44,497 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-25 17:26:44,498 - main - INFO - 
2025-11-25 17:26:44,498 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-25 17:26:44,498 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-25 17:26:44,498 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-25 17:26:44,499 - main - INFO -        - Separates warranties from extensions
2025-11-25 17:26:44,499 - main - INFO -        - Extracts subjectivities & operational details
2025-11-25 17:26:44,499 - main - INFO -        - Correct deductible tier detection
2025-11-25 17:26:44,499 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-25 17:26:44,499 - main - INFO - 
2025-11-25 17:26:44,499 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-25 17:26:44,500 - main - INFO -        - Generates ALL sections comprehensively
2025-11-25 17:26:44,500 - main - INFO -        - Identifies unique items per provider
2025-11-25 17:26:44,500 - main - INFO -        - Transparent scoring methodology
2025-11-25 17:26:44,500 - main - INFO -        - Uses full _extended_data from parser
2025-11-25 17:26:44,500 - main - INFO - 
2025-11-25 17:26:44,500 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-25 17:26:44,501 - main - INFO -        - Single endpoint auto-populates everything
2025-11-25 17:26:44,501 - main - INFO -        - No manual section generation
2025-11-25 17:26:44,501 - main - INFO -        - Complete MongoDB integration
2025-11-25 17:26:44,501 - main - INFO - 
2025-11-25 17:26:44,501 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-25 17:26:44,501 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-25 17:26:44,502 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-25 17:26:44,503 - main - INFO -      âœ… Subjectivities: Now included
2025-11-25 17:26:44,503 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-25 17:26:44,504 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-25 17:26:44,504 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-25 17:26:44,504 - main - INFO - 
2025-11-25 17:26:44,505 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-25 17:26:44,505 - main - INFO -      Main:
2025-11-25 17:26:44,505 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-25 17:26:44,505 - main - INFO - 
2025-11-25 17:26:44,506 - main - INFO -      Retrieval:
2025-11-25 17:26:44,506 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-25 17:26:44,506 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-25 17:26:44,506 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-25 17:26:44,506 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-25 17:26:44,506 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-25 17:26:44,507 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-25 17:26:44,507 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-25 17:26:44,507 - main - INFO - 
2025-11-25 17:26:44,507 - main - INFO -      Management:
2025-11-25 17:26:44,507 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-25 17:26:44,507 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-25 17:26:44,508 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-25 17:26:44,508 - main - INFO - 
2025-11-25 17:26:44,508 - main - INFO -      Documents (MongoDB):
2025-11-25 17:26:44,508 - main - INFO -        GET  /api/documents                All documents
2025-11-25 17:26:44,508 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-25 17:26:44,509 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-25 17:26:44,509 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-25 17:26:44,509 - main - INFO - 
2025-11-25 17:26:44,509 - main - INFO -      Diagnostics & Health:
2025-11-25 17:26:44,509 - main - INFO -        GET  /api/health                   System health
2025-11-25 17:26:44,509 - main - INFO -        GET  /api/status                   Detailed status
2025-11-25 17:26:44,510 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-25 17:26:44,510 - main - INFO - 
2025-11-25 17:26:44,510 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-25 17:26:44,510 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-25 17:26:44,510 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-25 17:26:44,510 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-25 17:26:44,511 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-25 17:26:44,511 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-25 17:26:44,511 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-25 17:26:44,511 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-25 17:26:44,511 - main - INFO - 
2025-11-25 17:26:44,511 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-25 17:26:44,512 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-25 17:26:44,512 - main - INFO -      2. Receive comparison_id + complete data
2025-11-25 17:26:44,512 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-25 17:26:44,512 - main - INFO -      4. No re-upload needed!
2025-11-25 17:26:44,512 - main - INFO - 
2025-11-25 17:26:44,512 - main - INFO - ================================================================================
2025-11-25 17:26:44,513 - main - INFO -   âœ… Application started successfully!
2025-11-25 17:26:44,513 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-25 17:26:44,513 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-25 17:26:44,513 - main - INFO - ================================================================================
2025-11-25 17:26:44,513 - main - INFO - 
2025-11-25 17:26:44,514 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:11:48,377 - main - INFO - 
2025-11-26 16:11:48,379 - main - INFO - ================================================================================
2025-11-26 16:11:48,380 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:11:48,391 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:11:48,392 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:11:48,415 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:11:48,416 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:11:48,431 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:11:48,432 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:11:48,436 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:11:48,436 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:11:48,436 - main - INFO - ================================================================================
2025-11-26 16:11:48,437 - main - INFO - 
2025-11-26 16:15:08,448 - main - INFO - 
2025-11-26 16:15:08,448 - main - INFO - ================================================================================
2025-11-26 16:15:08,449 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:15:08,449 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:15:08,449 - main - INFO - ================================================================================
2025-11-26 16:15:08,449 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:15:08,449 - main - INFO -   Upload Directory: uploads
2025-11-26 16:15:08,450 - main - INFO -   Max File Size: 20MB
2025-11-26 16:15:08,450 - main - INFO - ================================================================================
2025-11-26 16:15:08,451 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:15:08,451 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:15:08,451 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:15:08,832 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:15:08,841 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:15:08,841 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:15:08,842 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:15:08,842 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:15:08,843 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:15:08,867 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:15:08,875 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakem-ai-backend', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:15:08,882 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:15:09,004 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:15:09,004 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:15:09,005 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:15:09,005 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:15:09,005 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:15:09,055 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:15:09,055 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:15:09,056 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:15:09,056 - main - INFO - 
2025-11-26 16:15:09,056 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:15:09,056 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:15:09,057 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:15:09,057 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:15:09,057 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:15:09,057 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:15:09,057 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:15:09,058 - main - INFO - 
2025-11-26 16:15:09,058 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:15:09,058 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:15:09,058 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:15:09,059 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:15:09,059 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:15:09,059 - main - INFO - 
2025-11-26 16:15:09,059 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:15:09,059 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:15:09,060 - main - INFO -        - No manual section generation
2025-11-26 16:15:09,060 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:15:09,060 - main - INFO - 
2025-11-26 16:15:09,060 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:15:09,061 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:15:09,061 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:15:09,062 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:15:09,063 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:15:09,064 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:15:09,064 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:15:09,064 - main - INFO - 
2025-11-26 16:15:09,065 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:15:09,065 - main - INFO -      Main:
2025-11-26 16:15:09,065 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:15:09,065 - main - INFO - 
2025-11-26 16:15:09,065 - main - INFO -      Retrieval:
2025-11-26 16:15:09,066 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:15:09,066 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:15:09,066 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:15:09,066 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:15:09,067 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:15:09,067 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:15:09,067 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:15:09,067 - main - INFO - 
2025-11-26 16:15:09,068 - main - INFO -      Management:
2025-11-26 16:15:09,068 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:15:09,068 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:15:09,068 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:15:09,068 - main - INFO - 
2025-11-26 16:15:09,069 - main - INFO -      Documents (MongoDB):
2025-11-26 16:15:09,069 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:15:09,069 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:15:09,069 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:15:09,069 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:15:09,069 - main - INFO - 
2025-11-26 16:15:09,070 - main - INFO -      Diagnostics & Health:
2025-11-26 16:15:09,070 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:15:09,070 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:15:09,070 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:15:09,071 - main - INFO - 
2025-11-26 16:15:09,071 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:15:09,071 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:15:09,071 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:15:09,072 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:15:09,072 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:15:09,072 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:15:09,072 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:15:09,073 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:15:09,073 - main - INFO - 
2025-11-26 16:15:09,073 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:15:09,073 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:15:09,074 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:15:09,074 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:15:09,074 - main - INFO -      4. No re-upload needed!
2025-11-26 16:15:09,074 - main - INFO - 
2025-11-26 16:15:09,074 - main - INFO - ================================================================================
2025-11-26 16:15:09,075 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:15:09,075 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:15:09,075 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:15:09,075 - main - INFO - ================================================================================
2025-11-26 16:15:09,076 - main - INFO - 
2025-11-26 16:15:09,076 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:16:55,968 - main - INFO - ðŸ“¥ GET /docs
2025-11-26 16:16:55,969 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-26 16:16:56,178 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-26 16:16:56,204 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.03s
2025-11-26 16:17:11,599 - main - INFO - ðŸ“¥ GET /docs
2025-11-26 16:17:11,600 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-26 16:17:11,899 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-26 16:17:11,901 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.00s
2025-11-26 16:19:44,036 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 16:19:44,075 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 16:19:44,075 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 16:19:44,076 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 16:19:44,076 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 16:19:44,082 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 16:19:44,084 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 16:19:44,085 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 16:19:44,085 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 16:19:44,085 - app.api.routes - INFO -    - Files uploaded: 8
2025-11-26 16:19:44,086 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764173984_b0c0468f4033
2025-11-26 16:19:44,086 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_59baa67e94b1 (8 files)
2025-11-26 16:19:44,087 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_59baa67e94b1
2025-11-26 16:19:44,087 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,088 - app.api.routes - INFO - ðŸ“„ Processing: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:44,088 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,091 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,091 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:19:44,092 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,094 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 980a6cb70ea246b4a5665c88ec585d53.pdf (213039 bytes)
2025-11-26 16:19:44,095 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:19:44,097 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\980a6cb70ea246b4a5665c88ec585d53.pdf
2025-11-26 16:19:44,098 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,101 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:19:44,145 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,217 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 8abddb2dd39542c8a1a8108e2e1eb690.pdf (241116 bytes)
2025-11-26 16:19:44,218 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:19:44,218 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\8abddb2dd39542c8a1a8108e2e1eb690.pdf
2025-11-26 16:19:44,218 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,234 - app.services.pdf_extractor - INFO - Successfully extracted 12221 characters from 6 pages
2025-11-26 16:19:44,270 - app.api.routes - INFO - ðŸ“„ Processing: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:19:44,282 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,282 - app.services.pdf_extractor - INFO - Successfully extracted 13483 characters from 6 pages
2025-11-26 16:19:44,284 - app.api.routes - INFO - ðŸ’¾ Saved file: QU CAR Al Sharif Contracting 4400021356.pdf â†’ c2cbaed258984c97aff7ac29ee6ecf16.pdf (843321 bytes)
2025-11-26 16:19:44,285 - app.api.routes - INFO - ðŸ“– Extracting text from: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:19:44,285 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,285 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\c2cbaed258984c97aff7ac29ee6ecf16.pdf
2025-11-26 16:19:44,285 - app.api.routes - INFO - ðŸ“„ Processing: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:19:44,286 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,336 - app.services.pdf_extractor - INFO - Successfully extracted 7736 characters from 4 pages
2025-11-26 16:19:44,336 - app.api.routes - INFO - ðŸ’¾ Saved file: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 49894ab006984d5a8f62614b00a8a066.pdf (290798 bytes)
2025-11-26 16:19:44,338 - app.api.routes - INFO - ðŸ“– Extracting text from: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:19:44,339 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,339 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\49894ab006984d5a8f62614b00a8a066.pdf
2025-11-26 16:19:44,339 - app.api.routes - INFO - ðŸ“„ Processing: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:44,353 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,378 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,386 - app.services.pdf_extractor - INFO - Successfully extracted 15546 characters from 7 pages
2025-11-26 16:19:44,386 - app.api.routes - INFO - ðŸ“„ Processing: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:19:44,388 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,390 - app.api.routes - INFO - ðŸ’¾ Saved file: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 4e4087622e03425aa1a5342385a4fe6e.pdf (309991 bytes)
2025-11-26 16:19:44,390 - app.api.routes - INFO - ðŸ“– Extracting text from: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:19:44,391 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:19:44,391 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\4e4087622e03425aa1a5342385a4fe6e.pdf
2025-11-26 16:19:44,391 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:19:44,426 - app.api.routes - INFO - ======================================================================
2025-11-26 16:19:44,433 - app.services.pdf_extractor - INFO - Successfully extracted 12679 characters from 5 pages
2025-11-26 16:19:44,434 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ bf155300f830463eaa24c6eb9e9326d0.pdf (175401 bytes)
2025-11-26 16:19:44,435 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:19:44,435 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\bf155300f830463eaa24c6eb9e9326d0.pdf
2025-11-26 16:19:44,436 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:19:44,459 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:19:44,502 - app.services.ai_parser - INFO - âœ… Detected insurer from pattern: agree to provide Liva Insurance Company with any 
information that it requires for issuing an insurance (pattern: ([A-Za-z\s&]+(?:Insurance|Group|Assurance))\s+(?:Wording|Policy))
2025-11-26 16:19:44,510 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-26 16:19:44,511 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): agree to provide Liva Insurance Company with any 
information that it requires for issuing an insurance
2025-11-26 16:19:44,512 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:19:44,512 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:44,512 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:19:44,586 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:19:44,586 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:45,259 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:19:45,260 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:19:45,289 - app.services.ai_parser - INFO - âœ… Detected insurer from pattern: agree to provide Liva Insurance Company with any 
information that it requires for issuing an insurance (pattern: ([A-Za-z\s&]+(?:Insurance|Group|Assurance))\s+(?:Wording|Policy))
2025-11-26 16:19:45,291 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): agree to provide Liva Insurance Company with any 
information that it requires for issuing an insurance
2025-11-26 16:19:45,291 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:19:45,291 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:45,292 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:19:45,381 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:19:45,381 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:45,382 - app.api.routes - INFO - ðŸ¤– Parsing with AI: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:19:45,383 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:19:45,405 - app.services.ai_parser - INFO - âœ… Detected insurer from pattern: or on behalf of 
Gulf Union Alahlia Cooperative Insurance Company (pattern: ([A-Za-z\s&]+Insurance Company))
2025-11-26 16:19:45,405 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): or on behalf of 
Gulf Union Alahlia Cooperative Insurance Company
2025-11-26 16:19:45,406 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 16:19:45,406 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:45,406 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:19:45,472 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:19:45,472 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:45,473 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:19:45,473 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:19:45,502 - app.services.ai_parser - INFO - âœ… Detected insurer from pattern: information that it requires for issuing an insurance (pattern: ([A-Za-z\s&]+(?:Insurance|Group|Assurance))\s+(?:Wording|Policy))
2025-11-26 16:19:45,505 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): information that it requires for issuing an insurance
2025-11-26 16:19:45,507 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:19:45,508 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:45,508 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:19:45,588 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:19:45,589 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:45,590 - app.api.routes - INFO - ðŸ¤– Parsing with AI: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:19:45,590 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:19:45,591 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Wataniya Insurance
2025-11-26 16:19:45,591 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Wataniya Insurance
2025-11-26 16:19:45,591 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 16:19:45,592 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:45,592 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:19:45,665 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 16:19:45,665 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:45,666 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:19:45,667 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:19:45,667 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-26 16:19:45,667 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-26 16:19:45,668 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 16:19:45,668 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:45,668 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-26 16:19:45,743 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-26 16:19:45,744 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:45,765 - app.api.routes - INFO - ðŸ’¾ Saved file: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ eaebbfa81aea45d98ef6e1245905b745.pdf (2510488 bytes)
2025-11-26 16:19:45,766 - app.api.routes - INFO - ðŸ“– Extracting text from: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:45,766 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\eaebbfa81aea45d98ef6e1245905b745.pdf
2025-11-26 16:19:45,829 - app.services.pdf_extractor - INFO - Successfully extracted 17529 characters from 6 pages
2025-11-26 16:19:45,829 - app.api.routes - INFO - ðŸ’¾ Saved file: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 828585da34f24332b4abb80d33a4e48f.pdf (2137120 bytes)
2025-11-26 16:19:45,829 - app.api.routes - INFO - ðŸ“– Extracting text from: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:45,830 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\828585da34f24332b4abb80d33a4e48f.pdf
2025-11-26 16:19:45,880 - app.services.pdf_extractor - INFO - Successfully extracted 11585 characters from 4 pages
2025-11-26 16:19:45,882 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:45,882 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:45,943 - app.services.ai_parser - INFO - âœ… Detected insurer from pattern: OPERATIVE INSURANCE COMPANY (pattern: ([A-Za-z\s&]+Insurance Company))
2025-11-26 16:19:45,944 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): OPERATIVE INSURANCE COMPANY
2025-11-26 16:19:45,944 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:19:45,944 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:45,945 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:19:46,051 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 16:19:46,051 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:19:46,053 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:46,053 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:19:46,088 - app.services.ai_parser - INFO - âœ… Detected insurer from pattern: OPERATIVE INSURANCE COMPANY (pattern: ([A-Za-z\s&]+Insurance Company))
2025-11-26 16:19:46,090 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): OPERATIVE INSURANCE COMPANY
2025-11-26 16:19:46,092 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:19:46,093 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:19:46,093 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:19:46,157 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-26 16:19:46,158 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:20:02,981 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:02,991 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:02,991 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:02,992 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:02,992 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-26 16:20:02,994 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: s as per Sama and /or most favorable terms
2025-11-26 16:20:02,994 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:20:02,999 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 23 benefits from patterns
2025-11-26 16:20:03,000 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 23 total
2025-11-26 16:20:03,000 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:08,690 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:08,701 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:08,702 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:08,702 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.1â€°' â†’ '1.1â€°'
2025-11-26 16:20:08,703 - app.services.ai_parser - INFO - ðŸ’° Calculated: 609853.20 from SI: 554412000.0 Ã— Rate: 1.1â€°
2025-11-26 16:20:08,703 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: s as per Sama and /or most favorable terms
2025-11-26 16:20:08,703 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:08,704 - app.services.ai_parser - INFO - ðŸ“Š Counts: 23 benefits, 29 exclusions, 6 warranties, 0 extensions
2025-11-26 16:20:14,896 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:14,897 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:20:14,897 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:14,897 - app.services.ai_parser - INFO - 
2025-11-26 16:20:14,898 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:14,898 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:20:14,898 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:14,898 - app.services.ai_parser - INFO - ðŸ¢ Insurer: or on behalf of Gulf Union Alahlia Cooperative Insurance Company
2025-11-26 16:20:14,898 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 16:20:14,899 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 609,853.20
2025-11-26 16:20:14,899 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.1â€°
2025-11-26 16:20:14,899 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:20:14,899 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.0/100
2025-11-26 16:20:14,899 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: s as per Sama and /or most favorable terms
2025-11-26 16:20:14,900 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:20:14,900 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:20:14,900 - app.services.ai_parser - INFO - 
2025-11-26 16:20:14,900 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:14,900 - app.services.ai_parser - INFO -    âœ“ Benefits: 23
2025-11-26 16:20:14,900 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 16:20:14,901 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 16:20:14,901 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:20:14,901 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:20:14,901 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:14,908 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: c2cbaed258984c97aff7ac29ee6ecf16.pdf â†’ 692728be867c0e914db28505
2025-11-26 16:20:14,909 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728be867c0e914db28505
2025-11-26 16:20:14,914 - app.services.user_documents_service - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 692728be867c0e914db28506 (843321 bytes)
2025-11-26 16:20:14,914 - app.api.routes - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 692728be867c0e914db28506
2025-11-26 16:20:14,915 - app.api.routes - INFO - âœ… Successfully processed: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:20:15,142 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:15,145 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:15,146 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:15,146 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:15,146 - app.services.ai_parser - WARNING - âš ï¸ Only 2 benefits, using fallback...
2025-11-26 16:20:15,148 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 16:20:15,149 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 8 total
2025-11-26 16:20:15,149 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:16,129 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:16,141 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:16,141 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:16,141 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:16,141 - app.services.ai_parser - WARNING - âš ï¸ Only 3 benefits, using fallback...
2025-11-26 16:20:16,144 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 16:20:16,144 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 9 total
2025-11-26 16:20:16,145 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:22,581 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:22,584 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:22,585 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:22,585 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium' â†’ 'FLAT Premium'
2025-11-26 16:20:22,586 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SAR 10,000
2025-11-26 16:20:22,587 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:22,587 - app.services.ai_parser - INFO - ðŸ“Š Counts: 8 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 16:20:23,703 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:23,705 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:23,705 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:23,705 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium, SAR 1,000 Per Project' â†’ 'FLAT Premium'
2025-11-26 16:20:23,706 - app.services.ai_parser - INFO - ðŸ’° Calculated: 4000000.00 from SI: 4000000.0 Ã— Rate: Flat Premium, SAR 1,000 Per Project
2025-11-26 16:20:23,706 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SAR 10,000
2025-11-26 16:20:23,706 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:23,707 - app.services.ai_parser - INFO - ðŸ“Š Counts: 9 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 16:20:24,491 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:24,529 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:24,530 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:24,531 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:24,532 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:20:24,537 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 16 benefits from patterns
2025-11-26 16:20:24,537 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 15 total
2025-11-26 16:20:24,537 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:28,075 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:28,082 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:20:28,082 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:28,082 - app.services.ai_parser - INFO - 
2025-11-26 16:20:28,083 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:28,083 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:20:28,083 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:28,083 - app.services.ai_parser - INFO - ðŸ¢ Insurer: agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:20:28,084 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:20:28,084 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,500.00
2025-11-26 16:20:28,084 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 16:20:28,084 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:20:28,085 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.7/100
2025-11-26 16:20:28,085 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SAR 10,000
2025-11-26 16:20:28,085 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:20:28,085 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:20:28,085 - app.services.ai_parser - INFO - 
2025-11-26 16:20:28,086 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:28,086 - app.services.ai_parser - INFO -    âœ“ Benefits: 8
2025-11-26 16:20:28,086 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 16:20:28,086 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:20:28,086 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:20:28,086 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:20:28,087 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:28,088 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 980a6cb70ea246b4a5665c88ec585d53.pdf â†’ 692728cc867c0e914db28507
2025-11-26 16:20:28,088 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728cc867c0e914db28507
2025-11-26 16:20:28,090 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 692728cc867c0e914db28508 (213039 bytes)
2025-11-26 16:20:28,091 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 692728cc867c0e914db28508
2025-11-26 16:20:28,091 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:20:28,582 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:28,586 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:28,587 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:28,588 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:28,589 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:28,775 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:28,778 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 75.0
2025-11-26 16:20:28,779 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:28,780 - app.services.ai_parser - INFO - 
2025-11-26 16:20:28,780 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:28,781 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:20:28,782 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:28,783 - app.services.ai_parser - INFO - ðŸ¢ Insurer: agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:20:28,784 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:20:28,784 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 20,000.00
2025-11-26 16:20:28,785 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 16:20:28,786 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 75.0/100
2025-11-26 16:20:28,787 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-26 16:20:28,787 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SAR 10,000
2025-11-26 16:20:28,788 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:20:28,789 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:20:28,789 - app.services.ai_parser - INFO - 
2025-11-26 16:20:28,790 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:28,791 - app.services.ai_parser - INFO -    âœ“ Benefits: 9
2025-11-26 16:20:28,791 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 16:20:28,792 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:20:28,792 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:20:28,793 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:20:28,793 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:28,796 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 8abddb2dd39542c8a1a8108e2e1eb690.pdf â†’ 692728cc867c0e914db28509
2025-11-26 16:20:28,797 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728cc867c0e914db28509
2025-11-26 16:20:28,800 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 692728cc867c0e914db2850a (241116 bytes)
2025-11-26 16:20:28,800 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 692728cc867c0e914db2850a
2025-11-26 16:20:28,801 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:20:29,967 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:29,971 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:29,971 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:29,971 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:29,972 - app.services.ai_parser - WARNING - âš ï¸ Only 7 benefits, using fallback...
2025-11-26 16:20:29,976 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 20 benefits from patterns
2025-11-26 16:20:29,976 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 25 total
2025-11-26 16:20:29,976 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:31,554 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:31,556 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:31,556 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:31,556 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 2,250/- (Flat) + 15% VAT' â†’ '2%'
2025-11-26 16:20:31,557 - app.services.ai_parser - INFO - ðŸ’° Calculated: 3208500.00 from SI: 142600.0 Ã— Rate: SR 2,250/- (Flat) + 15% VAT
2025-11-26 16:20:31,557 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR 50,000 for natural perils except flood
2025-11-26 16:20:31,557 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:31,558 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 65 exclusions, 20 warranties, 0 extensions
2025-11-26 16:20:34,041 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:34,048 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:34,049 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:34,049 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:34,049 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:20:34,052 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 37 benefits from patterns
2025-11-26 16:20:34,052 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 34 total
2025-11-26 16:20:34,052 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:34,964 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:34,969 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:34,969 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:34,969 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 18,000/- + Plus VAT 15%' â†’ '18%'
2025-11-26 16:20:34,970 - app.services.ai_parser - INFO - ðŸ’° Calculated: 720000000.00 from SI: 4000000.0 Ã— Rate: SR 18,000/- + Plus VAT 15%
2025-11-26 16:20:34,970 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SR 50,000
2025-11-26 16:20:34,970 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:34,970 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 64 exclusions, 19 warranties, 0 extensions
2025-11-26 16:20:35,804 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:35,808 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:35,814 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:35,818 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.00â€° (Per Mille)' â†’ '1.00â€°'
2025-11-26 16:20:35,818 - app.services.ai_parser - INFO - ðŸ’° Calculated: 365000.00 from SI: 365000000.0 Ã— Rate: 1.00â€° (Per Mille)
2025-11-26 16:20:35,819 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000 | BI: Nil
2025-11-26 16:20:35,819 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:35,819 - app.services.ai_parser - INFO - ðŸ“Š Counts: 25 benefits, 27 exclusions, 5 warranties, 21 extensions
2025-11-26 16:20:36,498 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:36,503 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:20:36,504 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:36,504 - app.services.ai_parser - INFO - 
2025-11-26 16:20:36,505 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:36,505 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:20:36,506 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:36,506 - app.services.ai_parser - INFO - ðŸ¢ Insurer: OPERATIVE INSURANCE COMPANY
2025-11-26 16:20:36,506 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:20:36,507 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,250.00
2025-11-26 16:20:36,507 - app.services.ai_parser - INFO - ðŸ“Š Rate: 2%
2025-11-26 16:20:36,508 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:20:36,508 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.3/100
2025-11-26 16:20:36,508 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR 50,000 for natural perils except flood
2025-11-26 16:20:36,509 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:20:36,509 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:20:36,509 - app.services.ai_parser - INFO - 
2025-11-26 16:20:36,510 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:36,510 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-26 16:20:36,510 - app.services.ai_parser - INFO -    âœ“ Exclusions: 65
2025-11-26 16:20:36,511 - app.services.ai_parser - INFO -    âœ“ Warranties: 20
2025-11-26 16:20:36,511 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:20:36,512 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:20:36,512 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:36,514 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 828585da34f24332b4abb80d33a4e48f.pdf â†’ 692728d4867c0e914db2850b
2025-11-26 16:20:36,514 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728d4867c0e914db2850b
2025-11-26 16:20:36,531 - app.services.user_documents_service - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 692728d4867c0e914db2850c (2137120 bytes)
2025-11-26 16:20:36,532 - app.api.routes - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 692728d4867c0e914db2850c
2025-11-26 16:20:36,532 - app.api.routes - INFO - âœ… Successfully processed: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:20:37,347 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:37,353 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:37,353 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:37,354 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.95%o on total sum insured of SAR 350,328,000/-' â†’ '0.95â€°'
2025-11-26 16:20:37,354 - app.services.ai_parser - INFO - ðŸ’° Calculated: 332811.60 from SI: 350328000.0 Ã— Rate: 0.95%o on total sum insured of SAR 350,328,000/-
2025-11-26 16:20:37,354 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 1,000,000 | Nat Cat: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 16:20:37,355 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:37,355 - app.services.ai_parser - INFO - ðŸ“Š Counts: 34 benefits, 42 exclusions, 6 warranties, 0 extensions
2025-11-26 16:20:40,303 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:40,304 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:20:40,305 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:40,305 - app.services.ai_parser - INFO - 
2025-11-26 16:20:40,306 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:40,306 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:20:40,306 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:40,307 - app.services.ai_parser - INFO - ðŸ¢ Insurer: OPERATIVE INSURANCE COMPANY
2025-11-26 16:20:40,307 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:20:40,307 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 18,000.00
2025-11-26 16:20:40,308 - app.services.ai_parser - INFO - ðŸ“Š Rate: 18%
2025-11-26 16:20:40,308 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:20:40,308 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.3/100
2025-11-26 16:20:40,308 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SR 50,000
2025-11-26 16:20:40,309 - app.services.ai_parser - INFO - â° Validity: Quotation period not specified
2025-11-26 16:20:40,309 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 16:20:40,309 - app.services.ai_parser - INFO - 
2025-11-26 16:20:40,309 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:40,309 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-26 16:20:40,310 - app.services.ai_parser - INFO -    âœ“ Exclusions: 64
2025-11-26 16:20:40,310 - app.services.ai_parser - INFO -    âœ“ Warranties: 19
2025-11-26 16:20:40,310 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:20:40,310 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 5
2025-11-26 16:20:40,310 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:40,311 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: eaebbfa81aea45d98ef6e1245905b745.pdf â†’ 692728d8867c0e914db2850d
2025-11-26 16:20:40,312 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728d8867c0e914db2850d
2025-11-26 16:20:40,328 - app.services.user_documents_service - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 692728d8867c0e914db2850e (2510488 bytes)
2025-11-26 16:20:40,328 - app.api.routes - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 692728d8867c0e914db2850e
2025-11-26 16:20:40,329 - app.api.routes - INFO - âœ… Successfully processed: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:20:42,149 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:42,164 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:20:42,165 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:42,165 - app.services.ai_parser - INFO - 
2025-11-26 16:20:42,166 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:42,167 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:20:42,168 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:42,169 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Wataniya Insurance
2025-11-26 16:20:42,169 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 16:20:42,169 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 365,000.00
2025-11-26 16:20:42,169 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.00â€°
2025-11-26 16:20:42,170 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:20:42,170 - app.services.ai_parser - INFO - ðŸ“ Quality: 94.0/100
2025-11-26 16:20:42,170 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000 | BI: Nil
2025-11-26 16:20:42,170 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:20:42,171 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:20:42,171 - app.services.ai_parser - INFO - 
2025-11-26 16:20:42,171 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:42,171 - app.services.ai_parser - INFO -    âœ“ Benefits: 25
2025-11-26 16:20:42,171 - app.services.ai_parser - INFO -    âœ“ Exclusions: 27
2025-11-26 16:20:42,172 - app.services.ai_parser - INFO -    âœ“ Warranties: 5
2025-11-26 16:20:42,172 - app.services.ai_parser - INFO -    âœ“ Extensions: 21
2025-11-26 16:20:42,172 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:20:42,172 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:42,174 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 4e4087622e03425aa1a5342385a4fe6e.pdf â†’ 692728da867c0e914db2850f
2025-11-26 16:20:42,174 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728da867c0e914db2850f
2025-11-26 16:20:42,180 - app.services.user_documents_service - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 692728da867c0e914db28510 (309991 bytes)
2025-11-26 16:20:42,181 - app.api.routes - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 692728da867c0e914db28510
2025-11-26 16:20:42,181 - app.api.routes - INFO - âœ… Successfully processed: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:20:44,328 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:44,340 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:20:44,340 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:20:44,340 - app.services.ai_parser - INFO - 
2025-11-26 16:20:44,340 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:44,341 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:20:44,341 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:44,341 - app.services.ai_parser - INFO - ðŸ¢ Insurer: information that it requires for issuing an insurance
2025-11-26 16:20:44,342 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:20:44,342 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 322,811.60
2025-11-26 16:20:44,342 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.95â€°
2025-11-26 16:20:44,342 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:20:44,343 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.3/100
2025-11-26 16:20:44,343 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 1,000,000 | Nat Cat: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 16:20:44,343 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:20:44,343 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 16:20:44,343 - app.services.ai_parser - INFO - 
2025-11-26 16:20:44,344 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:20:44,344 - app.services.ai_parser - INFO -    âœ“ Benefits: 34
2025-11-26 16:20:44,344 - app.services.ai_parser - INFO -    âœ“ Exclusions: 42
2025-11-26 16:20:44,344 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 16:20:44,344 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:20:44,345 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 0
2025-11-26 16:20:44,345 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:20:44,346 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 49894ab006984d5a8f62614b00a8a066.pdf â†’ 692728dc867c0e914db28511
2025-11-26 16:20:44,346 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728dc867c0e914db28511
2025-11-26 16:20:44,348 - app.services.user_documents_service - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 692728dc867c0e914db28512 (290798 bytes)
2025-11-26 16:20:44,348 - app.api.routes - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 692728dc867c0e914db28512
2025-11-26 16:20:44,349 - app.api.routes - INFO - âœ… Successfully processed: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:20:50,183 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:50,429 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:20:50,429 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:20:50,430 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:20:50,430 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:20:56,884 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:20:56,886 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:20:56,886 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:20:56,886 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-26 16:20:56,886 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-26 16:20:56,886 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:20:56,887 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:20:56,887 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:20:56,887 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 16:20:56,887 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:20:56,887 - app.services.ai_parser - INFO - ðŸ“Š Counts: 37 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-26 16:21:03,499 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:21:03,501 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:21:03,502 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:21:03,502 - app.services.ai_parser - INFO - 
2025-11-26 16:21:03,503 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:21:03,503 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:21:03,504 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:21:03,504 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-26 16:21:03,504 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 16:21:03,505 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-26 16:21:03,505 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-26 16:21:03,506 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:21:03,506 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-26 16:21:03,506 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 16:21:03,506 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:21:03,506 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:21:03,507 - app.services.ai_parser - INFO - 
2025-11-26 16:21:03,507 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:21:03,507 - app.services.ai_parser - INFO -    âœ“ Benefits: 37
2025-11-26 16:21:03,507 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 16:21:03,507 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-26 16:21:03,508 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-26 16:21:03,508 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:21:03,508 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:21:03,509 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: bf155300f830463eaa24c6eb9e9326d0.pdf â†’ 692728ef867c0e914db28513
2025-11-26 16:21:03,509 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692728ef867c0e914db28513
2025-11-26 16:21:03,511 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 692728ef867c0e914db28514 (175401 bytes)
2025-11-26 16:21:03,511 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 692728ef867c0e914db28514
2025-11-26 16:21:03,511 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:21:03,511 - app.api.routes - INFO - 
âœ… Successfully extracted 8 quotes
2025-11-26 16:21:03,512 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:21:03,512 - app.api.routes - INFO - ðŸ”€ Generating comparison for 8 quotes
2025-11-26 16:21:03,512 - app.api.routes - INFO - ======================================================================
2025-11-26 16:21:03,512 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 8 quotes
2025-11-26 16:21:03,512 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 16:21:03,513 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 16:21:03,513 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 16:21:03,513 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 16:21:03,513 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 16:21:03,513 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,514 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: or on behalf of Gulf Union Alahlia Cooperative Insurance Company
2025-11-26 16:21:03,514 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,514 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,514 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,514 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,514 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,515 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:21:03,515 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,515 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,515 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,516 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,516 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 544,412,000",
    "business_interruption": "SAR 10,000,000",
    "total_sum_insured_numeric": 554412000,
    "total_sum_insured": "SR 554,412,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "1% of the claim amount applied, subject to a minimum of SR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "1% of the claim amount applied, subject to a minimum of SR 1,000,000 for all natural catastrophe risks",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "10% of Claim amount, subject to minimum excess of SAR 10,000/- Each and Every Loss",
        "applies_to": "Third Party Liability"
      },
      {
        "range": "SAR 10,000/- Each and Every Loss in respect of Third-Party Property Damage",
        "appl
2025-11-26 16:21:03,517 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,518 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:21:03,518 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:21:03,518 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,519 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,519 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,519 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,519 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,519 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,520 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,520 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,521 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,522 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,522 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,523 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,523 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,523 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:21:03,524 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,524 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for or on behalf of Gulf Union Alahlia Cooperative Insurance Company
2025-11-26 16:21:03,524 - app.services.ai_ranker - INFO - 
ðŸ“Š or on behalf of Gulf Union Alahlia Cooperative Insurance Company:
2025-11-26 16:21:03,524 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 16:21:03,525 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:21:03,525 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 16:21:03,525 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:21:03,525 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,525 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:21:03,525 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,526 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,526 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,526 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,526 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,526 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:21:03,527 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,527 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,527 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,527 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,527 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 200,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 200000,
    "total_sum_insured": "SAR 200,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1%, min SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1%, min SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "Claims Preparation Clause": "SR 10,000"
  },
  "exclusions_complete": {
    "all_exclusions_list": [
      "Cyber Loss Absolute Exclusion Clause - IUA 09-081 17.05.2019",
      "Communicable Disease Exclusion \u2013 LMA 5394",
      "War and Cyber Operation Exclusion Number 
2025-11-26 16:21:03,529 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,529 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:21:03,529 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:21:03,529 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,529 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,530 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,530 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,530 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,530 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,530 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,531 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,531 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,532 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,532 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,532 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,532 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,533 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:21:03,533 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,533 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:21:03,533 - app.services.ai_ranker - INFO - 
ðŸ“Š agree to provide Liva Insurance Company with any information that it requires for issuing an insurance:
2025-11-26 16:21:03,534 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:21:03,534 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:21:03,534 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 16:21:03,534 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:21:03,534 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,535 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:21:03,535 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,535 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,536 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,536 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,536 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,536 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:21:03,537 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,537 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,537 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,537 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,537 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 4,000,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SAR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1%, min SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1%, min SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and SAR 200,000 in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and SAR 200,000 in the aggregate",
    "debris_removal": "SAR 10,000 any one occurrence and SAR 100,000 in the aggregate"
2025-11-26 16:21:03,539 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,540 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:21:03,541 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:21:03,541 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,542 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,543 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,544 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,544 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:21:03,545 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,545 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:21:03,545 - app.services.ai_ranker - INFO - 
ðŸ“Š agree to provide Liva Insurance Company with any information that it requires for issuing an insurance:
2025-11-26 16:21:03,545 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:21:03,545 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:21:03,546 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 16:21:03,546 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:21:03,546 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,546 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: OPERATIVE INSURANCE COMPANY
2025-11-26 16:21:03,546 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,547 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,547 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,547 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,548 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,548 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:21:03,549 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,549 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,549 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,549 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,550 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 142,600/-",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 142600,
    "total_sum_insured": "SR 142,600"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all",
        "deductible": "1% of the claim amount subject to minimum of SR 50,000 for natural perils except flood",
        "applies_to": "material_damage"
      },
      {
        "range": "all",
        "deductible": "1% of the claim amount subject to minimum of SR 25,000 for other than natural perils",
        "applies_to": "material_damage"
      },
      {
        "range": "all",
        "deductible": "10% of the claim amount subject to minimum of SR 25,000 for flood",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      
2025-11-26 16:21:03,552 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,553 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:21:03,553 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:21:03,554 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,554 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,554 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,555 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,555 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,556 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,557 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,558 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,558 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,558 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,559 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,559 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:21:03,559 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,559 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for OPERATIVE INSURANCE COMPANY
2025-11-26 16:21:03,560 - app.services.ai_ranker - INFO - 
ðŸ“Š OPERATIVE INSURANCE COMPANY:
2025-11-26 16:21:03,560 - app.services.ai_ranker - INFO -    Warranties: 20
2025-11-26 16:21:03,560 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:21:03,560 - app.services.ai_ranker - INFO -    Exclusions: 65
2025-11-26 16:21:03,560 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:21:03,561 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,561 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: OPERATIVE INSURANCE COMPANY
2025-11-26 16:21:03,561 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,561 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,562 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,562 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,562 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,563 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer', 'National Address', 'VAT Certificate'], 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing'], 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy', 'Copy of the project contingency plans', 'Copy of any agreement imposing specific insurance or risk management criteria', 'Copy of any clauses in the works contract or tender documentation specifying types of insurance required']}
2025-11-26 16:21:03,564 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,565 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,565 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,566 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,566 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 4,000,000",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all natural perils",
        "deductible": "1%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "other than natural perils",
        "deductible": "1%, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "flood",
        "deductible": "10%, min SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "all natural perils",
      "deductible": "1%, min SR 50,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier"
2025-11-26 16:21:03,568 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 16:21:03,568 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing']
2025-11-26 16:21:03,569 - app.services.ai_ranker - INFO -    âœ… Found 6 items in key 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy']
2025-11-26 16:21:03,569 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,569 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,570 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,570 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,570 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,571 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,571 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,571 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,572 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,572 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,572 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,573 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,573 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,573 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 14
2025-11-26 16:21:03,574 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 16:21:03,574 - app.services.ai_ranker - INFO -    âœ… Extracted 14 subjectivities for OPERATIVE INSURANCE COMPANY
2025-11-26 16:21:03,574 - app.services.ai_ranker - INFO - 
ðŸ“Š OPERATIVE INSURANCE COMPANY:
2025-11-26 16:21:03,574 - app.services.ai_ranker - INFO -    Warranties: 19
2025-11-26 16:21:03,575 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:21:03,575 - app.services.ai_ranker - INFO -    Exclusions: 64
2025-11-26 16:21:03,575 - app.services.ai_ranker - INFO -    Subjectivities: 14
2025-11-26 16:21:03,575 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,576 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Wataniya Insurance
2025-11-26 16:21:03,576 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,576 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,576 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,577 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,577 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,577 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:21:03,578 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,578 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,578 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,579 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,579 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 365,000,000.00",
    "business_interruption": "SAR 10,000,000 Combined Single Limit",
    "total_sum_insured_numeric": 365000000,
    "total_sum_insured": "SAR 365,000,000.00"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All losses including Natural Catastrophe Risks",
        "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "Bodily injury",
        "deductible": "Nil",
        "applies_to": "third_party_liability"
      },
      {
        "range": "Property Damage",
        "deductible": "SAR 25,000 for each and every loss",
        "applies_to": "third_party_liability"
      },
      {
        "range": "Underground Facilities",
        "deductible": "25% of cla
2025-11-26 16:21:03,582 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,583 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:21:03,584 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:21:03,585 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,586 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,587 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,587 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,587 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,588 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,588 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,588 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,589 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,589 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,589 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,589 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,590 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,590 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:21:03,590 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,591 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Wataniya Insurance
2025-11-26 16:21:03,591 - app.services.ai_ranker - INFO - 
ðŸ“Š Wataniya Insurance:
2025-11-26 16:21:03,591 - app.services.ai_ranker - INFO -    Warranties: 5
2025-11-26 16:21:03,592 - app.services.ai_ranker - INFO -    Extensions: 21
2025-11-26 16:21:03,592 - app.services.ai_ranker - INFO -    Exclusions: 27
2025-11-26 16:21:03,592 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:21:03,592 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,593 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: information that it requires for issuing an insurance
2025-11-26 16:21:03,593 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,593 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,593 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,594 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,594 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,594 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': [], 'conditions_precedent': ['No deterioration in loss record'], 'documentation_required': []}
2025-11-26 16:21:03,595 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,595 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,595 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,595 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,596 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 350,328,000",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 350328000,
    "total_sum_insured": "SAR 350,328,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Other",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000"
      }
    ],
    "applicable_md_tier": {
      "range": "NATCAT",
      "deductible": "1% of the loss amount minimum SAR 1,000,000",
      "applies_to": "material_damage"
   
2025-11-26 16:21:03,602 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-26 16:21:03,602 - app.services.ai_ranker - INFO -    âœ… Found 1 items in key 'conditions_precedent': ['No deterioration in loss record']
2025-11-26 16:21:03,602 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-26 16:21:03,603 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,604 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,604 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,605 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,606 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,607 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,608 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,608 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,608 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,609 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,609 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,609 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,609 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,610 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 1
2025-11-26 16:21:03,610 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['No deterioration in loss record']
2025-11-26 16:21:03,610 - app.services.ai_ranker - INFO -    âœ… Extracted 1 subjectivities for information that it requires for issuing an insurance
2025-11-26 16:21:03,610 - app.services.ai_ranker - INFO - 
ðŸ“Š information that it requires for issuing an insurance:
2025-11-26 16:21:03,611 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 16:21:03,611 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:21:03,611 - app.services.ai_ranker - INFO -    Exclusions: 42
2025-11-26 16:21:03,611 - app.services.ai_ranker - INFO -    Subjectivities: 1
2025-11-26 16:21:03,611 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:21:03,612 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-26 16:21:03,612 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:21:03,612 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:21:03,612 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:03,613 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:21:03,613 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:21:03,613 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:21:03,614 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:21:03,615 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:21:03,616 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:21:03,616 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:21:03,617 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_t
2025-11-26 16:21:03,621 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,621 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:21:03,621 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:21:03,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:21:03,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:21:03,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:21:03,622 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:21:03,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:21:03,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,623 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:21:03,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:21:03,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:21:03,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:21:03,624 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:21:03,625 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:21:03,625 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:21:03,625 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:21:03,625 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:21:03,626 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-26 16:21:03,626 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-26 16:21:03,627 - app.services.ai_ranker - INFO -    Warranties: 10
2025-11-26 16:21:03,627 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-26 16:21:03,627 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 16:21:03,627 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:21:03,628 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: or on behalf of Gulf Union Alahlia Cooperative Insurance Company
2025-11-26 16:21:04,728 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 16:21:04,729 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:21:04,729 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:21:04,729 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:21:04,729 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:21:05,700 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 4
2025-11-26 16:21:05,700 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:21:05,700 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 0
2025-11-26 16:21:05,701 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:21:05,701 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:21:05,701 - app.services.ai_ranker - INFO -       â€¢ Warranted that the site is protected, fenced and necessary warning signs are ins...
2025-11-26 16:21:05,701 - app.services.ai_ranker - INFO -       â€¢ Warranted that the Insured takes all necessary precautions and actions to avoid ...
2025-11-26 16:21:05,702 - app.services.ai_ranker - INFO -       â€¢ Warranted unfinished open trenches are covered with metallic or wooden frames
2025-11-26 16:21:05,702 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: OPERATIVE INSURANCE COMPANY
2025-11-26 16:21:07,611 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 10
2025-11-26 16:21:07,611 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:21:07,611 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:21:07,612 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-26 16:21:07,612 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:21:07,612 - app.services.ai_ranker - INFO -       â€¢ Warranted that third party claims are not covered
2025-11-26 16:21:07,612 - app.services.ai_ranker - INFO -       â€¢ Warranted that professional & expert operator to perform duties
2025-11-26 16:21:07,613 - app.services.ai_ranker - INFO -       â€¢ Warranted heavy lifting should be carried out by competent and skilled manpower
2025-11-26 16:21:07,613 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Wataniya Insurance
2025-11-26 16:21:08,450 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 16:21:08,450 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 10
2025-11-26 16:21:08,451 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:21:08,451 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:21:08,451 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:21:08,451 - app.services.ai_ranker - INFO -       â€¢ Warranted that Reasonable Precautions to be taken during the project period
2025-11-26 16:21:08,452 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: information that it requires for issuing an insurance
2025-11-26 16:21:08,949 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 16:21:08,949 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:21:08,949 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 2
2025-11-26 16:21:08,949 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:21:08,950 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:21:08,950 - app.services.ai_ranker - INFO -       â€¢ Tandem Lift Provision Warranty
2025-11-26 16:21:08,950 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-26 16:21:09,770 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 3
2025-11-26 16:21:09,770 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 5
2025-11-26 16:21:09,771 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 9
2025-11-26 16:21:09,771 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:21:09,771 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:21:09,771 - app.services.ai_ranker - INFO -       â€¢ Stillage Warranty â€“ 15 cm
2025-11-26 16:21:09,772 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-26 16:21:09,772 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-26 16:21:09,772 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 16:21:09,772 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 16:21:09,773 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 16:21:09,773 - app.services.ai_ranker - INFO - ðŸ“Š or on behalf of Gulf Union Alahlia Cooperative Insurance Company: Hakim Score=75.0 (Standard), Weighted Score=67.82
2025-11-26 16:21:09,773 - app.services.ai_ranker - INFO - ðŸ“Š agree to provide Liva Insurance Company with any information that it requires for issuing an insurance: Hakim Score=75.0 (Standard), Weighted Score=65.68
2025-11-26 16:21:09,774 - app.services.ai_ranker - INFO - ðŸ“Š agree to provide Liva Insurance Company with any information that it requires for issuing an insurance: Hakim Score=75.0 (Standard), Weighted Score=60.85
2025-11-26 16:21:09,774 - app.services.ai_ranker - INFO - ðŸ“Š OPERATIVE INSURANCE COMPANY: Hakim Score=75.0 (Standard), Weighted Score=72.75
2025-11-26 16:21:09,774 - app.services.ai_ranker - INFO - ðŸ“Š OPERATIVE INSURANCE COMPANY: Hakim Score=75.0 (Standard), Weighted Score=65.00
2025-11-26 16:21:09,775 - app.services.ai_ranker - INFO - ðŸ“Š Wataniya Insurance: Hakim Score=88.0 (Strong), Weighted Score=76.32
2025-11-26 16:21:09,775 - app.services.ai_ranker - INFO - ðŸ“Š information that it requires for issuing an insurance: Hakim Score=75.0 (Standard), Weighted Score=69.15
2025-11-26 16:21:09,775 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=74.20
2025-11-26 16:21:09,775 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 16:21:09,776 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 16:21:20,036 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:21:20,040 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 16:21:20,040 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 16:21:20,041 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 16:21:20,042 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 16:21:20,042 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 16:21:20,042 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764173984_b0c0468f4033
2025-11-26 16:21:20,043 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 8
2025-11-26 16:21:20,043 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 16:21:20,043 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 8
2025-11-26 16:21:20,043 - app.services.mongodb_service_enhanced - INFO -    Quote 1: or on behalf of Gulf Union Alahlia Cooperative Insurance Company
2025-11-26 16:21:20,043 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 16:21:20,044 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 16:21:20,044 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 16:21:20,044 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 16:21:20,044 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 16:21:20,044 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 16:21:20,045 - app.services.mongodb_service_enhanced - INFO -    Quote 2: agree to provide Liva Insurance Company with any information that it requires for issuing an insurance
2025-11-26 16:21:20,045 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 16:21:20,045 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 16:21:20,045 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 16:21:20,045 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 16:21:20,046 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 16:21:20,046 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 16:21:20,052 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 16:21:20,052 - app.services.mongodb_service_enhanced - INFO -    Summary: 13,281 bytes
2025-11-26 16:21:20,052 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 87,051 bytes
2025-11-26 16:21:20,052 - app.services.mongodb_service_enhanced - INFO -    Data table: 37,420 bytes
2025-11-26 16:21:20,053 - app.services.mongodb_service_enhanced - INFO -    Analytics: 4,317 bytes
2025-11-26 16:21:20,053 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 119,186 bytes
2025-11-26 16:21:20,053 - app.services.mongodb_service_enhanced - INFO -    Total document: 553,517 bytes
2025-11-26 16:21:20,053 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 16:21:20,053 - app.services.mongodb_service_enhanced - INFO -       premium: 8 items
2025-11-26 16:21:20,054 - app.services.mongodb_service_enhanced - INFO -       rate: 8 items
2025-11-26 16:21:20,054 - app.services.mongodb_service_enhanced - INFO -       score: 8 items
2025-11-26 16:21:20,054 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 8 items
2025-11-26 16:21:20,054 - app.services.mongodb_service_enhanced - INFO -       deductible: 8 items
2025-11-26 16:21:20,054 - app.services.mongodb_service_enhanced - INFO -       coverage: 8 items
2025-11-26 16:21:20,055 - app.services.mongodb_service_enhanced - INFO -       benefits: 8 items
2025-11-26 16:21:20,055 - app.services.mongodb_service_enhanced - INFO -       exclusions: 8 items
2025-11-26 16:21:20,055 - app.services.mongodb_service_enhanced - INFO -       warranties: 8 items
2025-11-26 16:21:20,055 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 8 items
2025-11-26 16:21:20,056 - app.services.mongodb_service_enhanced - INFO -       conditions: 8 items
2025-11-26 16:21:20,056 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 8 items
2025-11-26 16:21:20,056 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 8 items
2025-11-26 16:21:20,056 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 8 items
2025-11-26 16:21:20,056 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 16:21:20,057 - app.services.mongodb_service_enhanced - INFO -       - Count: 8
2025-11-26 16:21:20,057 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 16:21:20,057 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:20,058 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 16:21:20,076 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764173984_b0c0468f4033
2025-11-26 16:21:20,077 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69272900b757af6a8efab05c
2025-11-26 16:21:20,085 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 16:21:20,085 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 16:21:20,086 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 16:21:20,086 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 16:21:20,086 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 16:21:20,086 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 16:21:20,086 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 16:21:20,087 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 8
2025-11-26 16:21:20,087 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 16:21:20,087 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 8
2025-11-26 16:21:20,087 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 16:21:20,088 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 8
2025-11-26 16:21:20,088 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 16:21:20,088 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 16:21:20,089 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 16:21:20,089 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 16:21:20,089 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 16:21:20,089 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 16:21:20,089 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:21:20,090 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69272900b757af6a8efab05c
2025-11-26 16:21:20,090 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 16:21:20,090 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 16:21:20,090 - app.api.routes - INFO -    Comparison ID: cmp_1764173984_b0c0468f4033
2025-11-26 16:21:20,092 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 16:21:20,093 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 16:21:20,093 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:21:20,093 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 16:21:20,094 - app.api.routes - INFO - ======================================================================
2025-11-26 16:21:20,094 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764173984_b0c0468f4033
2025-11-26 16:21:20,094 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 16:21:20,095 - app.api.routes - INFO - ðŸ“„ Files Processed: 8/8
2025-11-26 16:21:20,095 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 8 PDFs + 1 comparison
2025-11-26 16:21:20,095 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 16:21:20,096 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 16:21:20,096 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 16:21:20,099 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 16:21:20,100 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 16:21:20,101 - app.api.routes - INFO - ======================================================================

2025-11-26 16:21:20,101 - app.services.progress_tracker - INFO - âœ… Job completed: job_59baa67e94b1 â†’ comparison_id: cmp_1764173984_b0c0468f4033
2025-11-26 16:21:20,106 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 96.07s
2025-11-26 16:30:09,104 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-26 16:30:09,104 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-26 16:32:40,943 - main - INFO - 
2025-11-26 16:32:40,944 - main - INFO - ================================================================================
2025-11-26 16:32:40,944 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:32:40,945 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:32:40,946 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:32:40,947 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:32:40,948 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:32:40,950 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:32:40,950 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:32:40,954 - main - INFO -   âœ… Cleaned up 8 temporary files
2025-11-26 16:32:40,955 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:32:40,955 - main - INFO - ================================================================================
2025-11-26 16:32:40,955 - main - INFO - 
2025-11-26 16:32:45,663 - main - INFO - 
2025-11-26 16:32:45,663 - main - INFO - ================================================================================
2025-11-26 16:32:45,663 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:32:45,664 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:32:45,664 - main - INFO - ================================================================================
2025-11-26 16:32:45,664 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:32:45,665 - main - INFO -   Upload Directory: uploads
2025-11-26 16:32:45,665 - main - INFO -   Max File Size: 20MB
2025-11-26 16:32:45,665 - main - INFO - ================================================================================
2025-11-26 16:32:45,666 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:32:45,666 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:32:45,666 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:32:45,693 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:32:45,699 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:32:45,699 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:32:45,699 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:32:45,700 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:32:45,701 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:32:45,710 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:32:45,712 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:32:45,713 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:32:45,716 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:32:45,716 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:32:45,717 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:32:45,717 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:32:45,718 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:32:45,750 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:32:45,751 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:32:45,752 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:32:45,753 - main - INFO - 
2025-11-26 16:32:45,753 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:32:45,754 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:32:45,755 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:32:45,756 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:32:45,757 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:32:45,758 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:32:45,758 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:32:45,759 - main - INFO - 
2025-11-26 16:32:45,760 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:32:45,760 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:32:45,761 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:32:45,761 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:32:45,762 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:32:45,762 - main - INFO - 
2025-11-26 16:32:45,763 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:32:45,763 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:32:45,764 - main - INFO -        - No manual section generation
2025-11-26 16:32:45,765 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:32:45,766 - main - INFO - 
2025-11-26 16:32:45,766 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:32:45,767 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:32:45,768 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:32:45,769 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:32:45,770 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:32:45,770 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:32:45,771 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:32:45,771 - main - INFO - 
2025-11-26 16:32:45,772 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:32:45,772 - main - INFO -      Main:
2025-11-26 16:32:45,773 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:32:45,774 - main - INFO - 
2025-11-26 16:32:45,775 - main - INFO -      Retrieval:
2025-11-26 16:32:45,775 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:32:45,776 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:32:45,776 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:32:45,777 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:32:45,777 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:32:45,778 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:32:45,778 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:32:45,778 - main - INFO - 
2025-11-26 16:32:45,779 - main - INFO -      Management:
2025-11-26 16:32:45,779 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:32:45,780 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:32:45,780 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:32:45,781 - main - INFO - 
2025-11-26 16:32:45,781 - main - INFO -      Documents (MongoDB):
2025-11-26 16:32:45,782 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:32:45,782 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:32:45,783 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:32:45,783 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:32:45,784 - main - INFO - 
2025-11-26 16:32:45,784 - main - INFO -      Diagnostics & Health:
2025-11-26 16:32:45,785 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:32:45,786 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:32:45,787 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:32:45,787 - main - INFO - 
2025-11-26 16:32:45,788 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:32:45,790 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:32:45,790 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:32:45,791 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:32:45,791 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:32:45,791 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:32:45,792 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:32:45,792 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:32:45,792 - main - INFO - 
2025-11-26 16:32:45,792 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:32:45,793 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:32:45,793 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:32:45,793 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:32:45,793 - main - INFO -      4. No re-upload needed!
2025-11-26 16:32:45,794 - main - INFO - 
2025-11-26 16:32:45,794 - main - INFO - ================================================================================
2025-11-26 16:32:45,794 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:32:45,795 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:32:45,795 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:32:45,795 - main - INFO - ================================================================================
2025-11-26 16:32:45,795 - main - INFO - 
2025-11-26 16:32:45,796 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:32:51,545 - main - INFO - 
2025-11-26 16:32:51,555 - main - INFO - ================================================================================
2025-11-26 16:32:51,591 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:32:51,606 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:32:51,626 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:32:51,648 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:32:51,651 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:32:51,654 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:32:51,655 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:32:51,657 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:32:51,659 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:32:51,660 - main - INFO - ================================================================================
2025-11-26 16:32:51,661 - main - INFO - 
2025-11-26 16:32:55,760 - main - INFO - 
2025-11-26 16:32:55,761 - main - INFO - ================================================================================
2025-11-26 16:32:55,761 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:32:55,761 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:32:55,761 - main - INFO - ================================================================================
2025-11-26 16:32:55,762 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:32:55,762 - main - INFO -   Upload Directory: uploads
2025-11-26 16:32:55,762 - main - INFO -   Max File Size: 20MB
2025-11-26 16:32:55,762 - main - INFO - ================================================================================
2025-11-26 16:32:55,763 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:32:55,763 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:32:55,763 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:32:55,779 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:32:55,784 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:32:55,785 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:32:55,785 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:32:55,785 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:32:55,786 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:32:55,819 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:32:55,822 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:32:55,826 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:32:55,830 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:32:55,830 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:32:55,831 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:32:55,831 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:32:55,832 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:32:55,863 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:32:55,864 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:32:55,864 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:32:55,865 - main - INFO - 
2025-11-26 16:32:55,866 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:32:55,866 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:32:55,867 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:32:55,867 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:32:55,867 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:32:55,867 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:32:55,868 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:32:55,868 - main - INFO - 
2025-11-26 16:32:55,868 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:32:55,868 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:32:55,868 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:32:55,869 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:32:55,869 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:32:55,869 - main - INFO - 
2025-11-26 16:32:55,869 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:32:55,869 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:32:55,870 - main - INFO -        - No manual section generation
2025-11-26 16:32:55,870 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:32:55,870 - main - INFO - 
2025-11-26 16:32:55,870 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:32:55,871 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:32:55,871 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:32:55,871 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:32:55,871 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:32:55,871 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:32:55,872 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:32:55,872 - main - INFO - 
2025-11-26 16:32:55,872 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:32:55,872 - main - INFO -      Main:
2025-11-26 16:32:55,872 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:32:55,873 - main - INFO - 
2025-11-26 16:32:55,873 - main - INFO -      Retrieval:
2025-11-26 16:32:55,873 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:32:55,873 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:32:55,874 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:32:55,874 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:32:55,875 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:32:55,875 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:32:55,875 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:32:55,875 - main - INFO - 
2025-11-26 16:32:55,875 - main - INFO -      Management:
2025-11-26 16:32:55,876 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:32:55,876 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:32:55,876 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:32:55,876 - main - INFO - 
2025-11-26 16:32:55,876 - main - INFO -      Documents (MongoDB):
2025-11-26 16:32:55,877 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:32:55,877 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:32:55,877 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:32:55,877 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:32:55,877 - main - INFO - 
2025-11-26 16:32:55,878 - main - INFO -      Diagnostics & Health:
2025-11-26 16:32:55,878 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:32:55,878 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:32:55,878 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:32:55,878 - main - INFO - 
2025-11-26 16:32:55,878 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:32:55,879 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:32:55,879 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:32:55,879 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:32:55,879 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:32:55,879 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:32:55,879 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:32:55,880 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:32:55,880 - main - INFO - 
2025-11-26 16:32:55,880 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:32:55,880 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:32:55,880 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:32:55,881 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:32:55,881 - main - INFO -      4. No re-upload needed!
2025-11-26 16:32:55,882 - main - INFO - 
2025-11-26 16:32:55,882 - main - INFO - ================================================================================
2025-11-26 16:32:55,883 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:32:55,883 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:32:55,883 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:32:55,884 - main - INFO - ================================================================================
2025-11-26 16:32:55,884 - main - INFO - 
2025-11-26 16:32:55,884 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:33:01,096 - main - INFO - 
2025-11-26 16:33:01,120 - main - INFO - ================================================================================
2025-11-26 16:33:01,175 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:33:01,192 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:01,192 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:33:01,193 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:01,194 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:33:01,194 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:33:01,195 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:33:01,196 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:33:01,196 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:33:01,196 - main - INFO - ================================================================================
2025-11-26 16:33:01,196 - main - INFO - 
2025-11-26 16:33:04,944 - main - INFO - 
2025-11-26 16:33:04,944 - main - INFO - ================================================================================
2025-11-26 16:33:04,944 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:33:04,945 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:33:04,945 - main - INFO - ================================================================================
2025-11-26 16:33:04,945 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:33:04,945 - main - INFO -   Upload Directory: uploads
2025-11-26 16:33:04,945 - main - INFO -   Max File Size: 20MB
2025-11-26 16:33:04,946 - main - INFO - ================================================================================
2025-11-26 16:33:04,946 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:33:04,946 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:33:04,946 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:33:04,982 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:33:04,990 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:33:04,991 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:33:04,991 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:33:04,992 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:04,992 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:33:05,003 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:33:05,004 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:33:05,005 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:33:05,007 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:33:05,008 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:33:05,008 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:33:05,008 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:05,008 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:33:05,044 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:33:05,045 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:33:05,045 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:33:05,045 - main - INFO - 
2025-11-26 16:33:05,045 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:33:05,045 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:33:05,046 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:33:05,046 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:33:05,046 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:33:05,046 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:33:05,046 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:33:05,047 - main - INFO - 
2025-11-26 16:33:05,047 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:33:05,047 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:33:05,047 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:33:05,047 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:33:05,048 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:33:05,048 - main - INFO - 
2025-11-26 16:33:05,048 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:33:05,048 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:33:05,049 - main - INFO -        - No manual section generation
2025-11-26 16:33:05,049 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:33:05,049 - main - INFO - 
2025-11-26 16:33:05,049 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:33:05,050 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:33:05,050 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:33:05,050 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:33:05,050 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:33:05,050 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:33:05,050 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:33:05,050 - main - INFO - 
2025-11-26 16:33:05,051 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:33:05,051 - main - INFO -      Main:
2025-11-26 16:33:05,051 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:33:05,051 - main - INFO - 
2025-11-26 16:33:05,051 - main - INFO -      Retrieval:
2025-11-26 16:33:05,051 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:33:05,051 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:33:05,052 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:33:05,052 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:33:05,052 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:33:05,052 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:33:05,052 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:33:05,052 - main - INFO - 
2025-11-26 16:33:05,052 - main - INFO -      Management:
2025-11-26 16:33:05,053 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:33:05,053 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:33:05,053 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:33:05,053 - main - INFO - 
2025-11-26 16:33:05,053 - main - INFO -      Documents (MongoDB):
2025-11-26 16:33:05,053 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:33:05,053 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:33:05,054 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:33:05,054 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:33:05,054 - main - INFO - 
2025-11-26 16:33:05,054 - main - INFO -      Diagnostics & Health:
2025-11-26 16:33:05,054 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:33:05,054 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:33:05,055 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:33:05,055 - main - INFO - 
2025-11-26 16:33:05,055 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:33:05,055 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:33:05,055 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:33:05,055 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:33:05,056 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:33:05,056 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:33:05,056 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:33:05,056 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:33:05,056 - main - INFO - 
2025-11-26 16:33:05,056 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:33:05,057 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:33:05,057 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:33:05,057 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:33:05,057 - main - INFO -      4. No re-upload needed!
2025-11-26 16:33:05,057 - main - INFO - 
2025-11-26 16:33:05,057 - main - INFO - ================================================================================
2025-11-26 16:33:05,058 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:33:05,058 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:33:05,058 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:33:05,058 - main - INFO - ================================================================================
2025-11-26 16:33:05,058 - main - INFO - 
2025-11-26 16:33:05,058 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:33:09,157 - main - INFO - 
2025-11-26 16:33:09,158 - main - INFO - ================================================================================
2025-11-26 16:33:09,158 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:33:09,159 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:09,159 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:33:09,160 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:09,161 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:33:09,161 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:33:09,162 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:33:09,162 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:33:09,163 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:33:09,163 - main - INFO - ================================================================================
2025-11-26 16:33:09,163 - main - INFO - 
2025-11-26 16:33:12,480 - main - INFO - 
2025-11-26 16:33:12,480 - main - INFO - ================================================================================
2025-11-26 16:33:12,480 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:33:12,480 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:33:12,481 - main - INFO - ================================================================================
2025-11-26 16:33:12,481 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:33:12,481 - main - INFO -   Upload Directory: uploads
2025-11-26 16:33:12,481 - main - INFO -   Max File Size: 20MB
2025-11-26 16:33:12,482 - main - INFO - ================================================================================
2025-11-26 16:33:12,482 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:33:12,483 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:33:12,483 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:33:12,518 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:33:12,525 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:33:12,526 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:33:12,526 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:33:12,526 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:12,527 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:33:12,539 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:33:12,541 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:33:12,543 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:33:12,544 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:33:12,544 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:33:12,545 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:33:12,545 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:12,545 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:33:12,557 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:33:12,558 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:33:12,558 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:33:12,558 - main - INFO - 
2025-11-26 16:33:12,558 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:33:12,559 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:33:12,559 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:33:12,559 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:33:12,559 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:33:12,560 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:33:12,560 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:33:12,560 - main - INFO - 
2025-11-26 16:33:12,560 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:33:12,560 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:33:12,561 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:33:12,561 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:33:12,561 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:33:12,561 - main - INFO - 
2025-11-26 16:33:12,561 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:33:12,562 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:33:12,562 - main - INFO -        - No manual section generation
2025-11-26 16:33:12,562 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:33:12,562 - main - INFO - 
2025-11-26 16:33:12,562 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:33:12,563 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:33:12,563 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:33:12,563 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:33:12,563 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:33:12,564 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:33:12,564 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:33:12,564 - main - INFO - 
2025-11-26 16:33:12,564 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:33:12,564 - main - INFO -      Main:
2025-11-26 16:33:12,565 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:33:12,565 - main - INFO - 
2025-11-26 16:33:12,566 - main - INFO -      Retrieval:
2025-11-26 16:33:12,566 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:33:12,567 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:33:12,567 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:33:12,567 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:33:12,567 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:33:12,568 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:33:12,568 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:33:12,569 - main - INFO - 
2025-11-26 16:33:12,569 - main - INFO -      Management:
2025-11-26 16:33:12,569 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:33:12,570 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:33:12,571 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:33:12,571 - main - INFO - 
2025-11-26 16:33:12,571 - main - INFO -      Documents (MongoDB):
2025-11-26 16:33:12,572 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:33:12,572 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:33:12,573 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:33:12,573 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:33:12,573 - main - INFO - 
2025-11-26 16:33:12,573 - main - INFO -      Diagnostics & Health:
2025-11-26 16:33:12,574 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:33:12,574 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:33:12,574 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:33:12,574 - main - INFO - 
2025-11-26 16:33:12,574 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:33:12,575 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:33:12,575 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:33:12,575 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:33:12,575 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:33:12,575 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:33:12,576 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:33:12,576 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:33:12,576 - main - INFO - 
2025-11-26 16:33:12,576 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:33:12,576 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:33:12,577 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:33:12,577 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:33:12,577 - main - INFO -      4. No re-upload needed!
2025-11-26 16:33:12,577 - main - INFO - 
2025-11-26 16:33:12,577 - main - INFO - ================================================================================
2025-11-26 16:33:12,578 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:33:12,578 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:33:12,578 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:33:12,579 - main - INFO - ================================================================================
2025-11-26 16:33:12,579 - main - INFO - 
2025-11-26 16:33:12,579 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:33:14,515 - main - INFO - 
2025-11-26 16:33:14,515 - main - INFO - ================================================================================
2025-11-26 16:33:14,516 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:33:14,517 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:14,517 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:33:14,518 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:14,518 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:33:14,519 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:33:14,520 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:33:14,520 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:33:14,520 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:33:14,521 - main - INFO - ================================================================================
2025-11-26 16:33:14,521 - main - INFO - 
2025-11-26 16:33:17,736 - main - INFO - 
2025-11-26 16:33:17,737 - main - INFO - ================================================================================
2025-11-26 16:33:17,737 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:33:17,737 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:33:17,738 - main - INFO - ================================================================================
2025-11-26 16:33:17,738 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:33:17,738 - main - INFO -   Upload Directory: uploads
2025-11-26 16:33:17,738 - main - INFO -   Max File Size: 20MB
2025-11-26 16:33:17,738 - main - INFO - ================================================================================
2025-11-26 16:33:17,739 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:33:17,739 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:33:17,739 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:33:17,775 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:33:17,826 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:33:17,826 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:33:17,827 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:33:17,827 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:17,827 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:33:17,908 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:33:17,909 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:33:17,910 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:33:17,912 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:33:17,912 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:33:17,912 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:33:17,913 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:17,913 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:33:17,924 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:33:17,925 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:33:17,925 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:33:17,925 - main - INFO - 
2025-11-26 16:33:17,926 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:33:17,926 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:33:17,926 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:33:17,926 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:33:17,927 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:33:17,927 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:33:17,927 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:33:17,927 - main - INFO - 
2025-11-26 16:33:17,927 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:33:17,927 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:33:17,928 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:33:17,928 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:33:17,928 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:33:17,928 - main - INFO - 
2025-11-26 16:33:17,928 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:33:17,928 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:33:17,929 - main - INFO -        - No manual section generation
2025-11-26 16:33:17,929 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:33:17,929 - main - INFO - 
2025-11-26 16:33:17,929 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:33:17,930 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:33:17,930 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:33:17,930 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:33:17,930 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:33:17,930 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:33:17,930 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:33:17,931 - main - INFO - 
2025-11-26 16:33:17,931 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:33:17,931 - main - INFO -      Main:
2025-11-26 16:33:17,932 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:33:17,932 - main - INFO - 
2025-11-26 16:33:17,932 - main - INFO -      Retrieval:
2025-11-26 16:33:17,932 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:33:17,933 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:33:17,933 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:33:17,933 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:33:17,933 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:33:17,933 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:33:17,934 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:33:17,934 - main - INFO - 
2025-11-26 16:33:17,934 - main - INFO -      Management:
2025-11-26 16:33:17,934 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:33:17,934 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:33:17,934 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:33:17,935 - main - INFO - 
2025-11-26 16:33:17,935 - main - INFO -      Documents (MongoDB):
2025-11-26 16:33:17,935 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:33:17,935 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:33:17,935 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:33:17,936 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:33:17,936 - main - INFO - 
2025-11-26 16:33:17,936 - main - INFO -      Diagnostics & Health:
2025-11-26 16:33:17,936 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:33:17,936 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:33:17,936 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:33:17,937 - main - INFO - 
2025-11-26 16:33:17,937 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:33:17,937 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:33:17,937 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:33:17,938 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:33:17,938 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:33:17,943 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:33:17,944 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:33:17,945 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:33:17,947 - main - INFO - 
2025-11-26 16:33:17,947 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:33:17,948 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:33:17,956 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:33:17,957 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:33:17,957 - main - INFO -      4. No re-upload needed!
2025-11-26 16:33:17,957 - main - INFO - 
2025-11-26 16:33:17,957 - main - INFO - ================================================================================
2025-11-26 16:33:17,958 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:33:17,958 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:33:17,959 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:33:17,959 - main - INFO - ================================================================================
2025-11-26 16:33:17,959 - main - INFO - 
2025-11-26 16:33:17,961 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:33:32,820 - main - INFO - 
2025-11-26 16:33:32,820 - main - INFO - ================================================================================
2025-11-26 16:33:32,820 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:33:32,821 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:32,822 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:33:32,823 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:33:32,823 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:33:32,824 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:33:32,825 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:33:32,825 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:33:32,825 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:33:32,825 - main - INFO - ================================================================================
2025-11-26 16:33:32,826 - main - INFO - 
2025-11-26 16:33:36,173 - main - INFO - 
2025-11-26 16:33:36,173 - main - INFO - ================================================================================
2025-11-26 16:33:36,173 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:33:36,174 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:33:36,174 - main - INFO - ================================================================================
2025-11-26 16:33:36,174 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:33:36,174 - main - INFO -   Upload Directory: uploads
2025-11-26 16:33:36,174 - main - INFO -   Max File Size: 20MB
2025-11-26 16:33:36,175 - main - INFO - ================================================================================
2025-11-26 16:33:36,175 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:33:36,175 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:33:36,175 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:33:36,192 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:33:36,197 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:33:36,197 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:33:36,197 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:33:36,198 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:36,198 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:33:36,205 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:33:36,206 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:33:36,208 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:33:36,212 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:33:36,213 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:33:36,213 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:33:36,213 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:33:36,213 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:33:36,237 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:33:36,237 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:33:36,238 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:33:36,238 - main - INFO - 
2025-11-26 16:33:36,238 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:33:36,238 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:33:36,238 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:33:36,239 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:33:36,239 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:33:36,239 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:33:36,239 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:33:36,239 - main - INFO - 
2025-11-26 16:33:36,240 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:33:36,240 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:33:36,240 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:33:36,240 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:33:36,240 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:33:36,240 - main - INFO - 
2025-11-26 16:33:36,241 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:33:36,241 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:33:36,241 - main - INFO -        - No manual section generation
2025-11-26 16:33:36,241 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:33:36,241 - main - INFO - 
2025-11-26 16:33:36,241 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:33:36,242 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:33:36,242 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:33:36,242 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:33:36,242 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:33:36,242 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:33:36,242 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:33:36,243 - main - INFO - 
2025-11-26 16:33:36,243 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:33:36,243 - main - INFO -      Main:
2025-11-26 16:33:36,243 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:33:36,243 - main - INFO - 
2025-11-26 16:33:36,244 - main - INFO -      Retrieval:
2025-11-26 16:33:36,244 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:33:36,244 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:33:36,244 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:33:36,244 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:33:36,245 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:33:36,245 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:33:36,245 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:33:36,245 - main - INFO - 
2025-11-26 16:33:36,245 - main - INFO -      Management:
2025-11-26 16:33:36,246 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:33:36,246 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:33:36,246 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:33:36,246 - main - INFO - 
2025-11-26 16:33:36,246 - main - INFO -      Documents (MongoDB):
2025-11-26 16:33:36,246 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:33:36,247 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:33:36,247 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:33:36,247 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:33:36,247 - main - INFO - 
2025-11-26 16:33:36,247 - main - INFO -      Diagnostics & Health:
2025-11-26 16:33:36,248 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:33:36,248 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:33:36,249 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:33:36,249 - main - INFO - 
2025-11-26 16:33:36,250 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:33:36,250 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:33:36,250 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:33:36,251 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:33:36,251 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:33:36,251 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:33:36,252 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:33:36,252 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:33:36,252 - main - INFO - 
2025-11-26 16:33:36,252 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:33:36,253 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:33:36,253 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:33:36,253 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:33:36,253 - main - INFO -      4. No re-upload needed!
2025-11-26 16:33:36,253 - main - INFO - 
2025-11-26 16:33:36,254 - main - INFO - ================================================================================
2025-11-26 16:33:36,254 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:33:36,254 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:33:36,254 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:33:36,254 - main - INFO - ================================================================================
2025-11-26 16:33:36,255 - main - INFO - 
2025-11-26 16:33:36,255 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:39:54,178 - main - INFO - 
2025-11-26 16:39:54,179 - main - INFO - ================================================================================
2025-11-26 16:39:54,179 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:39:54,180 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:39:54,180 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:39:54,182 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:39:54,182 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:39:54,184 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:39:54,184 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:39:54,185 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:39:54,185 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:39:54,186 - main - INFO - ================================================================================
2025-11-26 16:39:54,186 - main - INFO - 
2025-11-26 16:39:59,093 - main - INFO - 
2025-11-26 16:39:59,093 - main - INFO - ================================================================================
2025-11-26 16:39:59,093 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:39:59,094 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:39:59,094 - main - INFO - ================================================================================
2025-11-26 16:39:59,094 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:39:59,094 - main - INFO -   Upload Directory: uploads
2025-11-26 16:39:59,094 - main - INFO -   Max File Size: 20MB
2025-11-26 16:39:59,095 - main - INFO - ================================================================================
2025-11-26 16:39:59,095 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:39:59,095 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:39:59,096 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:39:59,123 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:39:59,127 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:39:59,128 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:39:59,128 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:39:59,128 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:39:59,128 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:39:59,140 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:39:59,141 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:39:59,142 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:39:59,144 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:39:59,144 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:39:59,144 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:39:59,144 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:39:59,145 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:39:59,156 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:39:59,156 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:39:59,157 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:39:59,157 - main - INFO - 
2025-11-26 16:39:59,157 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:39:59,157 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:39:59,157 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:39:59,158 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:39:59,158 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:39:59,158 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:39:59,158 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:39:59,158 - main - INFO - 
2025-11-26 16:39:59,158 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:39:59,159 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:39:59,159 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:39:59,159 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:39:59,159 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:39:59,159 - main - INFO - 
2025-11-26 16:39:59,159 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:39:59,160 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:39:59,160 - main - INFO -        - No manual section generation
2025-11-26 16:39:59,160 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:39:59,160 - main - INFO - 
2025-11-26 16:39:59,160 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:39:59,160 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:39:59,161 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:39:59,161 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:39:59,161 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:39:59,161 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:39:59,161 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:39:59,161 - main - INFO - 
2025-11-26 16:39:59,162 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:39:59,162 - main - INFO -      Main:
2025-11-26 16:39:59,162 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:39:59,162 - main - INFO - 
2025-11-26 16:39:59,162 - main - INFO -      Retrieval:
2025-11-26 16:39:59,162 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:39:59,163 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:39:59,163 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:39:59,163 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:39:59,163 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:39:59,163 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:39:59,163 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:39:59,163 - main - INFO - 
2025-11-26 16:39:59,164 - main - INFO -      Management:
2025-11-26 16:39:59,164 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:39:59,164 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:39:59,164 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:39:59,164 - main - INFO - 
2025-11-26 16:39:59,164 - main - INFO -      Documents (MongoDB):
2025-11-26 16:39:59,165 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:39:59,165 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:39:59,166 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:39:59,166 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:39:59,166 - main - INFO - 
2025-11-26 16:39:59,166 - main - INFO -      Diagnostics & Health:
2025-11-26 16:39:59,167 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:39:59,167 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:39:59,167 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:39:59,167 - main - INFO - 
2025-11-26 16:39:59,167 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:39:59,167 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:39:59,168 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:39:59,168 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:39:59,168 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:39:59,168 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:39:59,168 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:39:59,168 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:39:59,169 - main - INFO - 
2025-11-26 16:39:59,169 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:39:59,169 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:39:59,169 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:39:59,169 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:39:59,170 - main - INFO -      4. No re-upload needed!
2025-11-26 16:39:59,170 - main - INFO - 
2025-11-26 16:39:59,171 - main - INFO - ================================================================================
2025-11-26 16:39:59,171 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:39:59,171 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:39:59,171 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:39:59,172 - main - INFO - ================================================================================
2025-11-26 16:39:59,172 - main - INFO - 
2025-11-26 16:39:59,172 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:40:20,686 - main - INFO - 
2025-11-26 16:40:20,687 - main - INFO - ================================================================================
2025-11-26 16:40:20,688 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:40:20,689 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:40:20,690 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:40:20,691 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:40:20,691 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:40:20,692 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:40:20,692 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:40:20,693 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:40:20,693 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:40:20,693 - main - INFO - ================================================================================
2025-11-26 16:40:20,694 - main - INFO - 
2025-11-26 16:40:25,278 - main - INFO - 
2025-11-26 16:40:25,279 - main - INFO - ================================================================================
2025-11-26 16:40:25,279 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:40:25,279 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:40:25,279 - main - INFO - ================================================================================
2025-11-26 16:40:25,280 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:40:25,280 - main - INFO -   Upload Directory: uploads
2025-11-26 16:40:25,280 - main - INFO -   Max File Size: 20MB
2025-11-26 16:40:25,280 - main - INFO - ================================================================================
2025-11-26 16:40:25,280 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:40:25,281 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:40:25,281 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:40:25,308 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:40:25,312 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:40:25,313 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:40:25,313 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:40:25,313 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:40:25,313 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:40:25,325 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:40:25,326 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:40:25,327 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:40:25,329 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:40:25,329 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:40:25,329 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:40:25,329 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:40:25,330 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:40:25,341 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:40:25,341 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:40:25,341 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:40:25,341 - main - INFO - 
2025-11-26 16:40:25,341 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:40:25,342 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:40:25,342 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:40:25,342 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:40:25,342 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:40:25,342 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:40:25,343 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:40:25,343 - main - INFO - 
2025-11-26 16:40:25,343 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:40:25,343 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:40:25,343 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:40:25,344 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:40:25,344 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:40:25,344 - main - INFO - 
2025-11-26 16:40:25,344 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:40:25,344 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:40:25,344 - main - INFO -        - No manual section generation
2025-11-26 16:40:25,345 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:40:25,345 - main - INFO - 
2025-11-26 16:40:25,345 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:40:25,345 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:40:25,345 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:40:25,345 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:40:25,346 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:40:25,346 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:40:25,346 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:40:25,346 - main - INFO - 
2025-11-26 16:40:25,346 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:40:25,346 - main - INFO -      Main:
2025-11-26 16:40:25,346 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:40:25,347 - main - INFO - 
2025-11-26 16:40:25,347 - main - INFO -      Retrieval:
2025-11-26 16:40:25,347 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:40:25,347 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:40:25,347 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:40:25,347 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:40:25,348 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:40:25,348 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:40:25,348 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:40:25,349 - main - INFO - 
2025-11-26 16:40:25,349 - main - INFO -      Management:
2025-11-26 16:40:25,350 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:40:25,351 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:40:25,351 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:40:25,351 - main - INFO - 
2025-11-26 16:40:25,352 - main - INFO -      Documents (MongoDB):
2025-11-26 16:40:25,352 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:40:25,352 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:40:25,352 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:40:25,353 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:40:25,353 - main - INFO - 
2025-11-26 16:40:25,353 - main - INFO -      Diagnostics & Health:
2025-11-26 16:40:25,353 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:40:25,353 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:40:25,354 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:40:25,354 - main - INFO - 
2025-11-26 16:40:25,354 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:40:25,354 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:40:25,355 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:40:25,355 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:40:25,355 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:40:25,355 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:40:25,356 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:40:25,356 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:40:25,356 - main - INFO - 
2025-11-26 16:40:25,356 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:40:25,357 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:40:25,357 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:40:25,357 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:40:25,357 - main - INFO -      4. No re-upload needed!
2025-11-26 16:40:25,357 - main - INFO - 
2025-11-26 16:40:25,358 - main - INFO - ================================================================================
2025-11-26 16:40:25,358 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:40:25,358 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:40:25,358 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:40:25,358 - main - INFO - ================================================================================
2025-11-26 16:40:25,359 - main - INFO - 
2025-11-26 16:40:25,359 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:40:35,491 - main - INFO - 
2025-11-26 16:40:35,491 - main - INFO - ================================================================================
2025-11-26 16:40:35,492 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:40:35,492 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:40:35,493 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:40:35,494 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:40:35,494 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:40:35,495 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:40:35,495 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:40:35,496 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:40:35,496 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:40:35,496 - main - INFO - ================================================================================
2025-11-26 16:40:35,497 - main - INFO - 
2025-11-26 16:40:39,618 - main - INFO - 
2025-11-26 16:40:39,618 - main - INFO - ================================================================================
2025-11-26 16:40:39,618 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:40:39,619 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:40:39,619 - main - INFO - ================================================================================
2025-11-26 16:40:39,619 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:40:39,619 - main - INFO -   Upload Directory: uploads
2025-11-26 16:40:39,620 - main - INFO -   Max File Size: 20MB
2025-11-26 16:40:39,620 - main - INFO - ================================================================================
2025-11-26 16:40:39,621 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:40:39,621 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:40:39,621 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:40:39,639 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:40:39,644 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:40:39,644 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:40:39,644 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:40:39,644 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:40:39,644 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:40:39,669 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:40:39,671 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:40:39,673 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:40:39,677 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:40:39,678 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:40:39,678 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:40:39,679 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:40:39,680 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:40:39,692 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:40:39,693 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:40:39,694 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:40:39,695 - main - INFO - 
2025-11-26 16:40:39,695 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:40:39,695 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:40:39,696 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:40:39,696 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:40:39,696 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:40:39,696 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:40:39,696 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:40:39,697 - main - INFO - 
2025-11-26 16:40:39,697 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:40:39,697 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:40:39,697 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:40:39,698 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:40:39,698 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:40:39,698 - main - INFO - 
2025-11-26 16:40:39,698 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:40:39,699 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:40:39,699 - main - INFO -        - No manual section generation
2025-11-26 16:40:39,700 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:40:39,700 - main - INFO - 
2025-11-26 16:40:39,700 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:40:39,700 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:40:39,701 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:40:39,701 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:40:39,701 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:40:39,701 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:40:39,702 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:40:39,702 - main - INFO - 
2025-11-26 16:40:39,702 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:40:39,702 - main - INFO -      Main:
2025-11-26 16:40:39,702 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:40:39,703 - main - INFO - 
2025-11-26 16:40:39,703 - main - INFO -      Retrieval:
2025-11-26 16:40:39,703 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:40:39,703 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:40:39,703 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:40:39,704 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:40:39,704 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:40:39,704 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:40:39,704 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:40:39,705 - main - INFO - 
2025-11-26 16:40:39,705 - main - INFO -      Management:
2025-11-26 16:40:39,705 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:40:39,705 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:40:39,705 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:40:39,705 - main - INFO - 
2025-11-26 16:40:39,706 - main - INFO -      Documents (MongoDB):
2025-11-26 16:40:39,706 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:40:39,706 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:40:39,706 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:40:39,706 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:40:39,707 - main - INFO - 
2025-11-26 16:40:39,707 - main - INFO -      Diagnostics & Health:
2025-11-26 16:40:39,707 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:40:39,707 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:40:39,708 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:40:39,708 - main - INFO - 
2025-11-26 16:40:39,708 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:40:39,709 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:40:39,709 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:40:39,710 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:40:39,710 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:40:39,710 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:40:39,710 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:40:39,711 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:40:39,711 - main - INFO - 
2025-11-26 16:40:39,711 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:40:39,711 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:40:39,711 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:40:39,711 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:40:39,712 - main - INFO -      4. No re-upload needed!
2025-11-26 16:40:39,712 - main - INFO - 
2025-11-26 16:40:39,712 - main - INFO - ================================================================================
2025-11-26 16:40:39,712 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:40:39,712 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:40:39,712 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:40:39,713 - main - INFO - ================================================================================
2025-11-26 16:40:39,713 - main - INFO - 
2025-11-26 16:40:39,713 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:40:51,919 - main - INFO - 
2025-11-26 16:40:51,920 - main - INFO - ================================================================================
2025-11-26 16:40:51,920 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:40:51,921 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:40:51,922 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:40:51,922 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:40:51,923 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:40:51,924 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:40:51,924 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:40:51,925 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:40:51,925 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:40:51,925 - main - INFO - ================================================================================
2025-11-26 16:40:51,926 - main - INFO - 
2025-11-26 16:40:56,051 - main - INFO - 
2025-11-26 16:40:56,051 - main - INFO - ================================================================================
2025-11-26 16:40:56,051 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:40:56,052 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:40:56,052 - main - INFO - ================================================================================
2025-11-26 16:40:56,052 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:40:56,052 - main - INFO -   Upload Directory: uploads
2025-11-26 16:40:56,052 - main - INFO -   Max File Size: 20MB
2025-11-26 16:40:56,052 - main - INFO - ================================================================================
2025-11-26 16:40:56,053 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:40:56,053 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:40:56,053 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:40:56,078 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:40:56,085 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:40:56,086 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:40:56,086 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:40:56,086 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:40:56,087 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:40:56,096 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:40:56,097 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:40:56,100 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:40:56,102 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:40:56,102 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:40:56,103 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:40:56,103 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:40:56,103 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:40:56,113 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:40:56,113 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:40:56,113 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:40:56,113 - main - INFO - 
2025-11-26 16:40:56,114 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:40:56,114 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:40:56,114 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:40:56,115 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:40:56,115 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:40:56,116 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:40:56,116 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:40:56,117 - main - INFO - 
2025-11-26 16:40:56,117 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:40:56,117 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:40:56,117 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:40:56,118 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:40:56,118 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:40:56,118 - main - INFO - 
2025-11-26 16:40:56,118 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:40:56,118 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:40:56,119 - main - INFO -        - No manual section generation
2025-11-26 16:40:56,119 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:40:56,119 - main - INFO - 
2025-11-26 16:40:56,119 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:40:56,119 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:40:56,120 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:40:56,120 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:40:56,120 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:40:56,120 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:40:56,120 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:40:56,120 - main - INFO - 
2025-11-26 16:40:56,121 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:40:56,121 - main - INFO -      Main:
2025-11-26 16:40:56,121 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:40:56,121 - main - INFO - 
2025-11-26 16:40:56,122 - main - INFO -      Retrieval:
2025-11-26 16:40:56,122 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:40:56,122 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:40:56,122 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:40:56,123 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:40:56,123 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:40:56,123 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:40:56,123 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:40:56,124 - main - INFO - 
2025-11-26 16:40:56,124 - main - INFO -      Management:
2025-11-26 16:40:56,124 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:40:56,124 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:40:56,125 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:40:56,125 - main - INFO - 
2025-11-26 16:40:56,125 - main - INFO -      Documents (MongoDB):
2025-11-26 16:40:56,126 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:40:56,126 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:40:56,126 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:40:56,126 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:40:56,127 - main - INFO - 
2025-11-26 16:40:56,127 - main - INFO -      Diagnostics & Health:
2025-11-26 16:40:56,127 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:40:56,127 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:40:56,128 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:40:56,128 - main - INFO - 
2025-11-26 16:40:56,128 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:40:56,128 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:40:56,129 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:40:56,129 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:40:56,129 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:40:56,129 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:40:56,129 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:40:56,129 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:40:56,130 - main - INFO - 
2025-11-26 16:40:56,130 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:40:56,130 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:40:56,130 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:40:56,130 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:40:56,130 - main - INFO -      4. No re-upload needed!
2025-11-26 16:40:56,131 - main - INFO - 
2025-11-26 16:40:56,131 - main - INFO - ================================================================================
2025-11-26 16:40:56,131 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:40:56,131 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:40:56,131 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:40:56,132 - main - INFO - ================================================================================
2025-11-26 16:40:56,132 - main - INFO - 
2025-11-26 16:40:56,133 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:41:09,121 - main - INFO - 
2025-11-26 16:41:09,121 - main - INFO - ================================================================================
2025-11-26 16:41:09,122 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:41:09,123 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:41:09,124 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:41:09,125 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:41:09,126 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:41:09,127 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:41:09,128 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:41:09,128 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:41:09,128 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:41:09,128 - main - INFO - ================================================================================
2025-11-26 16:41:09,129 - main - INFO - 
2025-11-26 16:41:11,856 - main - INFO - 
2025-11-26 16:41:11,856 - main - INFO - ================================================================================
2025-11-26 16:41:11,856 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:41:11,856 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:41:11,857 - main - INFO - ================================================================================
2025-11-26 16:41:11,857 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:41:11,857 - main - INFO -   Upload Directory: uploads
2025-11-26 16:41:11,857 - main - INFO -   Max File Size: 20MB
2025-11-26 16:41:11,858 - main - INFO - ================================================================================
2025-11-26 16:41:11,858 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:41:11,858 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:41:11,859 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:41:11,875 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:41:11,879 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:41:11,880 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:41:11,880 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:41:11,880 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:41:11,880 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:41:11,887 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:41:11,888 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:41:11,889 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:41:11,892 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:41:11,893 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:41:11,894 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:41:11,894 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:41:11,894 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:41:11,909 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:41:11,909 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:41:11,910 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:41:11,910 - main - INFO - 
2025-11-26 16:41:11,910 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:41:11,910 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:41:11,911 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:41:11,911 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:41:11,911 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:41:11,911 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:41:11,912 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:41:11,912 - main - INFO - 
2025-11-26 16:41:11,912 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:41:11,912 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:41:11,912 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:41:11,913 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:41:11,913 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:41:11,913 - main - INFO - 
2025-11-26 16:41:11,913 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:41:11,913 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:41:11,914 - main - INFO -        - No manual section generation
2025-11-26 16:41:11,914 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:41:11,914 - main - INFO - 
2025-11-26 16:41:11,914 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:41:11,915 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:41:11,915 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:41:11,915 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:41:11,916 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:41:11,916 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:41:11,916 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:41:11,917 - main - INFO - 
2025-11-26 16:41:11,917 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:41:11,917 - main - INFO -      Main:
2025-11-26 16:41:11,917 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:41:11,918 - main - INFO - 
2025-11-26 16:41:11,918 - main - INFO -      Retrieval:
2025-11-26 16:41:11,918 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:41:11,918 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:41:11,918 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:41:11,918 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:41:11,919 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:41:11,919 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:41:11,919 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:41:11,919 - main - INFO - 
2025-11-26 16:41:11,920 - main - INFO -      Management:
2025-11-26 16:41:11,920 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:41:11,920 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:41:11,920 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:41:11,920 - main - INFO - 
2025-11-26 16:41:11,920 - main - INFO -      Documents (MongoDB):
2025-11-26 16:41:11,921 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:41:11,921 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:41:11,921 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:41:11,921 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:41:11,921 - main - INFO - 
2025-11-26 16:41:11,922 - main - INFO -      Diagnostics & Health:
2025-11-26 16:41:11,922 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:41:11,922 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:41:11,922 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:41:11,923 - main - INFO - 
2025-11-26 16:41:11,923 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:41:11,923 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:41:11,923 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:41:11,924 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:41:11,924 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:41:11,924 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:41:11,925 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:41:11,925 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:41:11,925 - main - INFO - 
2025-11-26 16:41:11,926 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:41:11,926 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:41:11,926 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:41:11,926 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:41:11,926 - main - INFO -      4. No re-upload needed!
2025-11-26 16:41:11,926 - main - INFO - 
2025-11-26 16:41:11,927 - main - INFO - ================================================================================
2025-11-26 16:41:11,927 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:41:11,927 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:41:11,927 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:41:11,927 - main - INFO - ================================================================================
2025-11-26 16:41:11,928 - main - INFO - 
2025-11-26 16:41:11,928 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:41:22,413 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 16:41:22,448 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 16:41:22,448 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 16:41:22,449 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 16:41:22,449 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 16:41:22,450 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 16:41:22,451 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 16:41:22,451 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 16:41:22,452 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 16:41:22,452 - app.api.routes - INFO -    - Files uploaded: 8
2025-11-26 16:41:22,452 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764175282_97beec7731a8
2025-11-26 16:41:22,452 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_c3256176ffca (8 files)
2025-11-26 16:41:22,453 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_c3256176ffca
2025-11-26 16:41:22,453 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,453 - app.api.routes - INFO - ðŸ“„ Processing: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:22,454 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,454 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,454 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:41:22,454 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,455 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 9bc6c4eb59ed41b994f57409f2015a6e.pdf (213039 bytes)
2025-11-26 16:41:22,455 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:41:22,456 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\9bc6c4eb59ed41b994f57409f2015a6e.pdf
2025-11-26 16:41:22,456 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,456 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:41:22,472 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,492 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ b67fa55c49de4a1da7612f923ef07a41.pdf (241116 bytes)
2025-11-26 16:41:22,492 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:41:22,507 - app.services.pdf_extractor - INFO - Successfully extracted 12221 characters from 6 pages
2025-11-26 16:41:22,507 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\b67fa55c49de4a1da7612f923ef07a41.pdf
2025-11-26 16:41:22,508 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,527 - app.api.routes - INFO - ðŸ“„ Processing: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:41:22,549 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,565 - app.services.pdf_extractor - INFO - Successfully extracted 13483 characters from 6 pages
2025-11-26 16:41:22,566 - app.api.routes - INFO - ðŸ’¾ Saved file: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 9d8927dc70974ba89cdcdf9e44c23061.pdf (843321 bytes)
2025-11-26 16:41:22,567 - app.api.routes - INFO - ðŸ“– Extracting text from: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:41:22,567 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,568 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\9d8927dc70974ba89cdcdf9e44c23061.pdf
2025-11-26 16:41:22,568 - app.api.routes - INFO - ðŸ“„ Processing: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:41:22,568 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,619 - app.services.pdf_extractor - INFO - Successfully extracted 7736 characters from 4 pages
2025-11-26 16:41:22,619 - app.api.routes - INFO - ðŸ’¾ Saved file: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 595cfbe549824a1a8aaf336e571e685e.pdf (290798 bytes)
2025-11-26 16:41:22,620 - app.api.routes - INFO - ðŸ“– Extracting text from: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:41:22,620 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,620 - app.api.routes - INFO - ðŸ“„ Processing: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:22,620 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,621 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,621 - app.api.routes - INFO - ðŸ“„ Processing: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:41:22,620 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\595cfbe549824a1a8aaf336e571e685e.pdf
2025-11-26 16:41:22,621 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,680 - app.services.pdf_extractor - INFO - Successfully extracted 15546 characters from 7 pages
2025-11-26 16:41:22,680 - app.api.routes - INFO - ðŸ’¾ Saved file: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 303c2bb4461845cfbcb48c52880afdf4.pdf (309991 bytes)
2025-11-26 16:41:22,682 - app.api.routes - INFO - ðŸ“– Extracting text from: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:41:22,683 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:41:22,683 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\303c2bb4461845cfbcb48c52880afdf4.pdf
2025-11-26 16:41:22,684 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:41:22,685 - app.api.routes - INFO - ======================================================================
2025-11-26 16:41:22,750 - app.services.pdf_extractor - INFO - Successfully extracted 12679 characters from 5 pages
2025-11-26 16:41:22,752 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ 57718a390ddf4a72a82466e4112be42c.pdf (175401 bytes)
2025-11-26 16:41:22,754 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:41:22,756 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\57718a390ddf4a72a82466e4112be42c.pdf
2025-11-26 16:41:22,758 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:41:22,801 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:41:22,825 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:41:22,831 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-26 16:41:22,834 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:41:22,837 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:41:22,837 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:22,838 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:41:22,923 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:41:22,924 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:23,475 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:41:23,475 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:41:23,476 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:41:23,477 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:41:23,477 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:41:23,477 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:23,478 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:41:23,579 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:41:23,579 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:23,580 - app.api.routes - INFO - ðŸ¤– Parsing with AI: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:41:23,580 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:41:23,582 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:41:23,583 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:41:23,583 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 16:41:23,584 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:23,584 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:41:23,644 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:41:23,645 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:23,646 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:41:23,646 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:41:23,647 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:41:23,648 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:41:23,648 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:41:23,649 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:23,649 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:41:23,730 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:41:23,730 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:23,731 - app.api.routes - INFO - ðŸ¤– Parsing with AI: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:41:23,731 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:41:23,732 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Wataniya Insurance
2025-11-26 16:41:23,732 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Wataniya Insurance
2025-11-26 16:41:23,732 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 16:41:23,732 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:23,733 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:41:23,807 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 16:41:23,808 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:23,810 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:41:23,810 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:41:23,810 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-26 16:41:23,811 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-26 16:41:23,811 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 16:41:23,811 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:23,811 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-26 16:41:23,888 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-26 16:41:23,889 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:23,912 - app.api.routes - INFO - ðŸ’¾ Saved file: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ c42a564c4fae432b8a7f5a435f2a742e.pdf (2137120 bytes)
2025-11-26 16:41:23,912 - app.api.routes - INFO - ðŸ“– Extracting text from: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:23,913 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\c42a564c4fae432b8a7f5a435f2a742e.pdf
2025-11-26 16:41:23,968 - app.services.pdf_extractor - INFO - Successfully extracted 11585 characters from 4 pages
2025-11-26 16:41:23,968 - app.api.routes - INFO - ðŸ’¾ Saved file: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 52c94134a86c4521940ac4337d26d1ef.pdf (2510488 bytes)
2025-11-26 16:41:23,969 - app.api.routes - INFO - ðŸ“– Extracting text from: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:23,971 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\52c94134a86c4521940ac4337d26d1ef.pdf
2025-11-26 16:41:23,972 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:24,014 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:24,039 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 16:41:24,041 - app.services.pdf_extractor - INFO - Successfully extracted 17529 characters from 6 pages
2025-11-26 16:41:24,041 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 16:41:24,041 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:41:24,042 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:24,042 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:41:24,116 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-26 16:41:24,117 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:24,121 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:24,121 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:41:24,123 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 16:41:24,123 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 16:41:24,124 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:41:24,124 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:41:24,125 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:41:24,239 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 16:41:24,239 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:41:51,830 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:41:51,839 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:41:51,839 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:41:51,840 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:41:51,840 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:41:56,258 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:41:56,266 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:41:56,267 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:41:56,267 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:41:56,268 - app.services.ai_parser - WARNING - âš ï¸ Only 5 benefits, using fallback...
2025-11-26 16:41:56,281 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 20 benefits from patterns
2025-11-26 16:41:56,282 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 23 total
2025-11-26 16:41:56,282 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:41:58,272 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:41:58,275 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:41:58,275 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:41:58,276 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:41:58,276 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:41:58,280 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 16:41:58,281 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 6 total
2025-11-26 16:41:58,281 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:41:58,566 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:41:58,568 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:41:58,568 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:41:58,568 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:41:58,569 - app.services.ai_parser - WARNING - âš ï¸ Only 4 benefits, using fallback...
2025-11-26 16:41:58,571 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 16:41:58,571 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 10 total
2025-11-26 16:41:58,571 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:41:58,690 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:41:58,701 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:41:58,701 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:41:58,701 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-26 16:41:58,702 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-26 16:41:58,702 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:41:58,702 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:41:58,703 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:41:58,703 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 16:41:58,703 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:41:58,704 - app.services.ai_parser - INFO - ðŸ“Š Counts: 10 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-26 16:41:58,780 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:41:58,783 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:41:58,783 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:41:58,783 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:41:58,783 - app.services.ai_parser - WARNING - âš ï¸ Only 3 benefits, using fallback...
2025-11-26 16:41:58,786 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 13 benefits from patterns
2025-11-26 16:41:58,786 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 16 total
2025-11-26 16:41:58,786 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:42:04,468 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:04,472 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:04,472 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:04,473 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.00â€° (Per Mille)' â†’ '1.00â€°'
2025-11-26 16:42:04,473 - app.services.ai_parser - INFO - ðŸ’° Calculated: 365000.00 from SI: 365000000.0 Ã— Rate: 1.00â€° (Per Mille)
2025-11-26 16:42:04,473 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount, min SAR 1,000,000
2025-11-26 16:42:04,473 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:04,474 - app.services.ai_parser - INFO - ðŸ“Š Counts: 23 benefits, 28 exclusions, 5 warranties, 8 extensions
2025-11-26 16:42:05,213 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:05,220 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:42:05,220 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:05,220 - app.services.ai_parser - INFO - 
2025-11-26 16:42:05,221 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:05,221 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:42:05,221 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:05,222 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-26 16:42:05,222 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 16:42:05,222 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 500,000.00
2025-11-26 16:42:05,222 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-26 16:42:05,222 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:42:05,223 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.0/100
2025-11-26 16:42:05,223 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 16:42:05,223 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:05,223 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:42:05,223 - app.services.ai_parser - INFO - 
2025-11-26 16:42:05,224 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:05,224 - app.services.ai_parser - INFO -    âœ“ Benefits: 10
2025-11-26 16:42:05,224 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 16:42:05,224 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:42:05,224 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-26 16:42:05,225 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:42:05,225 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:05,227 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 57718a390ddf4a72a82466e4112be42c.pdf â†’ 69272ddd145a1e75a97bb061
2025-11-26 16:42:05,227 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272ddd145a1e75a97bb061
2025-11-26 16:42:05,229 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69272ddd145a1e75a97bb062 (175401 bytes)
2025-11-26 16:42:05,229 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69272ddd145a1e75a97bb062
2025-11-26 16:42:05,230 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:42:06,755 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:06,758 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:06,759 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:06,760 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium' â†’ 'FLAT Premium'
2025-11-26 16:42:06,760 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SAR 10,000
2025-11-26 16:42:06,761 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:06,762 - app.services.ai_parser - INFO - ðŸ“Š Counts: 6 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 16:42:06,936 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:06,940 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:06,941 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:06,941 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium, SAR 1,000 Per Project' â†’ 'FLAT Premium'
2025-11-26 16:42:06,942 - app.services.ai_parser - INFO - ðŸ’° Calculated: 4000000.00 from SI: 4000000.0 Ã— Rate: Flat Premium, SAR 1,000 Per Project
2025-11-26 16:42:06,943 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SAR 10,000
2025-11-26 16:42:06,943 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:06,944 - app.services.ai_parser - INFO - ðŸ“Š Counts: 10 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 16:42:07,161 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:07,167 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:07,168 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:07,168 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 18,000/- + Plus VAT 15%' â†’ '18%'
2025-11-26 16:42:07,168 - app.services.ai_parser - INFO - ðŸ’° Calculated: 720000000.00 from SI: 4000000.0 Ã— Rate: SR 18,000/- + Plus VAT 15%
2025-11-26 16:42:07,169 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 16:42:07,169 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:07,169 - app.services.ai_parser - INFO - ðŸ“Š Counts: 16 benefits, 21 exclusions, 19 warranties, 0 extensions
2025-11-26 16:42:07,784 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:07,796 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:42:07,796 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:42:07,796 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:42:07,797 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:42:07,799 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 16 benefits from patterns
2025-11-26 16:42:07,799 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 15 total
2025-11-26 16:42:07,800 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:42:09,717 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:09,719 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:42:09,719 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:42:09,720 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:42:09,720 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:42:09,723 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 37 benefits from patterns
2025-11-26 16:42:09,723 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 34 total
2025-11-26 16:42:09,723 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:42:09,905 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:09,906 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:42:09,906 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:09,907 - app.services.ai_parser - INFO - 
2025-11-26 16:42:09,907 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:09,907 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:42:09,908 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:09,908 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Wataniya Insurance
2025-11-26 16:42:09,909 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 16:42:09,909 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 365,000.00
2025-11-26 16:42:09,909 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.00â€°
2025-11-26 16:42:09,910 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:42:09,910 - app.services.ai_parser - INFO - ðŸ“ Quality: 94.3/100
2025-11-26 16:42:09,910 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount, min SAR 1,000,000
2025-11-26 16:42:09,910 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:09,911 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:42:09,911 - app.services.ai_parser - INFO - 
2025-11-26 16:42:09,911 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:09,911 - app.services.ai_parser - INFO -    âœ“ Benefits: 23
2025-11-26 16:42:09,911 - app.services.ai_parser - INFO -    âœ“ Exclusions: 28
2025-11-26 16:42:09,912 - app.services.ai_parser - INFO -    âœ“ Warranties: 5
2025-11-26 16:42:09,912 - app.services.ai_parser - INFO -    âœ“ Extensions: 8
2025-11-26 16:42:09,912 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:42:09,912 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:09,913 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 303c2bb4461845cfbcb48c52880afdf4.pdf â†’ 69272de1145a1e75a97bb063
2025-11-26 16:42:09,914 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272de1145a1e75a97bb063
2025-11-26 16:42:09,916 - app.services.user_documents_service - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 69272de1145a1e75a97bb064 (309991 bytes)
2025-11-26 16:42:09,916 - app.api.routes - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 69272de1145a1e75a97bb064
2025-11-26 16:42:09,916 - app.api.routes - INFO - âœ… Successfully processed: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:42:11,862 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:11,865 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:42:11,865 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:42:11,866 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:42:11,866 - app.services.ai_parser - WARNING - âš ï¸ Only 3 warranties, using fallback...
2025-11-26 16:42:11,867 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 3 warranties from patterns
2025-11-26 16:42:11,867 - app.services.ai_parser - INFO - âœ… Enhanced warranties: 3 total
2025-11-26 16:42:11,868 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:42:12,742 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:12,748 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:42:12,749 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:12,750 - app.services.ai_parser - INFO - 
2025-11-26 16:42:12,751 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,752 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:42:12,753 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,753 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 16:42:12,754 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:42:12,755 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,500.00
2025-11-26 16:42:12,756 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 16:42:12,756 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:42:12,757 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.0/100
2025-11-26 16:42:12,757 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SAR 10,000
2025-11-26 16:42:12,757 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:12,758 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:42:12,759 - app.services.ai_parser - INFO - 
2025-11-26 16:42:12,759 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:12,760 - app.services.ai_parser - INFO -    âœ“ Benefits: 6
2025-11-26 16:42:12,760 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 16:42:12,761 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:42:12,761 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:42:12,762 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:42:12,762 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,765 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 9bc6c4eb59ed41b994f57409f2015a6e.pdf â†’ 69272de4145a1e75a97bb065
2025-11-26 16:42:12,765 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272de4145a1e75a97bb065
2025-11-26 16:42:12,768 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 69272de4145a1e75a97bb066 (213039 bytes)
2025-11-26 16:42:12,769 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 69272de4145a1e75a97bb066
2025-11-26 16:42:12,769 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:42:12,836 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:12,838 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:12,838 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:12,838 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.95%o on total sum insured of SAR 350,328,000/-' â†’ '0.95â€°'
2025-11-26 16:42:12,839 - app.services.ai_parser - INFO - ðŸ’° Calculated: 332811.60 from SI: 350328000.0 Ã— Rate: 0.95%o on total sum insured of SAR 350,328,000/-
2025-11-26 16:42:12,839 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 16:42:12,839 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:12,840 - app.services.ai_parser - INFO - ðŸ“Š Counts: 34 benefits, 42 exclusions, 6 warranties, 0 extensions
2025-11-26 16:42:12,911 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:12,913 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:42:12,913 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:12,913 - app.services.ai_parser - INFO - 
2025-11-26 16:42:12,914 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,914 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:42:12,914 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,915 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 16:42:12,915 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:42:12,915 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 18,000.00
2025-11-26 16:42:12,915 - app.services.ai_parser - INFO - ðŸ“Š Rate: 18%
2025-11-26 16:42:12,916 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:42:12,916 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.3/100
2025-11-26 16:42:12,916 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 16:42:12,917 - app.services.ai_parser - INFO - â° Validity: Quotation period as specified
2025-11-26 16:42:12,917 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 16:42:12,917 - app.services.ai_parser - INFO - 
2025-11-26 16:42:12,917 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:12,918 - app.services.ai_parser - INFO -    âœ“ Benefits: 16
2025-11-26 16:42:12,918 - app.services.ai_parser - INFO -    âœ“ Exclusions: 21
2025-11-26 16:42:12,918 - app.services.ai_parser - INFO -    âœ“ Warranties: 19
2025-11-26 16:42:12,919 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:42:12,919 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 5
2025-11-26 16:42:12,919 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,921 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 52c94134a86c4521940ac4337d26d1ef.pdf â†’ 69272de4145a1e75a97bb067
2025-11-26 16:42:12,921 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272de4145a1e75a97bb067
2025-11-26 16:42:12,934 - app.services.user_documents_service - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272de4145a1e75a97bb068 (2510488 bytes)
2025-11-26 16:42:12,935 - app.api.routes - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272de4145a1e75a97bb068
2025-11-26 16:42:12,936 - app.api.routes - INFO - âœ… Successfully processed: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:42:12,961 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:12,962 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 75.0
2025-11-26 16:42:12,962 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:12,962 - app.services.ai_parser - INFO - 
2025-11-26 16:42:12,963 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,963 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:42:12,963 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,963 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 16:42:12,964 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:42:12,964 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 20,000.00
2025-11-26 16:42:12,964 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 16:42:12,964 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 75.0/100
2025-11-26 16:42:12,965 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-26 16:42:12,965 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SAR 10,000
2025-11-26 16:42:12,966 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:12,966 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:42:12,966 - app.services.ai_parser - INFO - 
2025-11-26 16:42:12,967 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:12,967 - app.services.ai_parser - INFO -    âœ“ Benefits: 10
2025-11-26 16:42:12,968 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 16:42:12,968 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:42:12,968 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:42:12,968 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:42:12,969 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:12,971 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: b67fa55c49de4a1da7612f923ef07a41.pdf â†’ 69272de4145a1e75a97bb069
2025-11-26 16:42:12,971 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272de4145a1e75a97bb069
2025-11-26 16:42:12,974 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 69272de4145a1e75a97bb06a (241116 bytes)
2025-11-26 16:42:12,974 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 69272de4145a1e75a97bb06a
2025-11-26 16:42:12,975 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:42:13,922 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:13,925 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:13,925 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:13,926 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 2,250/- (Flat) + 15% VAT' â†’ '2%'
2025-11-26 16:42:13,926 - app.services.ai_parser - INFO - ðŸ’° Calculated: 3208500.00 from SI: 142600.0 Ã— Rate: SR 2,250/- (Flat) + 15% VAT
2025-11-26 16:42:13,926 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 16:42:13,927 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:13,927 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 65 exclusions, 20 warranties, 0 extensions
2025-11-26 16:42:17,329 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:17,331 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:42:17,331 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:17,332 - app.services.ai_parser - INFO - 
2025-11-26 16:42:17,332 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:17,332 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:42:17,333 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:17,333 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 16:42:17,333 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:42:17,334 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 322,811.60
2025-11-26 16:42:17,334 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.95â€°
2025-11-26 16:42:17,334 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:42:17,334 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.3/100
2025-11-26 16:42:17,335 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 16:42:17,335 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:17,335 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 16:42:17,335 - app.services.ai_parser - INFO - 
2025-11-26 16:42:17,335 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:17,336 - app.services.ai_parser - INFO -    âœ“ Benefits: 34
2025-11-26 16:42:17,336 - app.services.ai_parser - INFO -    âœ“ Exclusions: 42
2025-11-26 16:42:17,336 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 16:42:17,336 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:42:17,337 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 0
2025-11-26 16:42:17,337 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:17,338 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 595cfbe549824a1a8aaf336e571e685e.pdf â†’ 69272de9145a1e75a97bb06b
2025-11-26 16:42:17,338 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272de9145a1e75a97bb06b
2025-11-26 16:42:17,340 - app.services.user_documents_service - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69272de9145a1e75a97bb06c (290798 bytes)
2025-11-26 16:42:17,341 - app.api.routes - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69272de9145a1e75a97bb06c
2025-11-26 16:42:17,341 - app.api.routes - INFO - âœ… Successfully processed: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:42:18,084 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:18,090 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:42:18,091 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:42:18,092 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.1â€°' â†’ '1.1â€°'
2025-11-26 16:42:18,093 - app.services.ai_parser - INFO - ðŸ’° Calculated: 609853.20 from SI: 554412000.0 Ã— Rate: 1.1â€°
2025-11-26 16:42:18,094 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount | BI: 10%
2025-11-26 16:42:18,094 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:42:18,095 - app.services.ai_parser - INFO - ðŸ“Š Counts: 21 benefits, 29 exclusions, 3 warranties, 0 extensions
2025-11-26 16:42:21,077 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:21,082 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:42:21,082 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:21,083 - app.services.ai_parser - INFO - 
2025-11-26 16:42:21,083 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:21,083 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:42:21,083 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:21,084 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 16:42:21,084 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:42:21,084 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,250.00
2025-11-26 16:42:21,085 - app.services.ai_parser - INFO - ðŸ“Š Rate: 2%
2025-11-26 16:42:21,085 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:42:21,085 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.3/100
2025-11-26 16:42:21,085 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 16:42:21,086 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:21,086 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:42:21,086 - app.services.ai_parser - INFO - 
2025-11-26 16:42:21,086 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:21,086 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-26 16:42:21,087 - app.services.ai_parser - INFO -    âœ“ Exclusions: 65
2025-11-26 16:42:21,087 - app.services.ai_parser - INFO -    âœ“ Warranties: 20
2025-11-26 16:42:21,087 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:42:21,087 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:42:21,087 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:21,089 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: c42a564c4fae432b8a7f5a435f2a742e.pdf â†’ 69272ded145a1e75a97bb06d
2025-11-26 16:42:21,089 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272ded145a1e75a97bb06d
2025-11-26 16:42:21,097 - app.services.user_documents_service - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272ded145a1e75a97bb06e (2137120 bytes)
2025-11-26 16:42:21,098 - app.api.routes - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272ded145a1e75a97bb06e
2025-11-26 16:42:21,098 - app.api.routes - INFO - âœ… Successfully processed: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:42:24,005 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:24,006 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:42:24,006 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:42:24,006 - app.services.ai_parser - INFO - 
2025-11-26 16:42:24,007 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:24,007 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:42:24,007 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:24,007 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 16:42:24,008 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 16:42:24,008 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 609,853.20
2025-11-26 16:42:24,008 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.1â€°
2025-11-26 16:42:24,008 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:42:24,009 - app.services.ai_parser - INFO - ðŸ“ Quality: 94.0/100
2025-11-26 16:42:24,009 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount | BI: 10%
2025-11-26 16:42:24,009 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:42:24,009 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:42:24,010 - app.services.ai_parser - INFO - 
2025-11-26 16:42:24,010 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:42:24,010 - app.services.ai_parser - INFO -    âœ“ Benefits: 21
2025-11-26 16:42:24,010 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 16:42:24,010 - app.services.ai_parser - INFO -    âœ“ Warranties: 3
2025-11-26 16:42:24,011 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:42:24,011 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:42:24,011 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:42:24,013 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 9d8927dc70974ba89cdcdf9e44c23061.pdf â†’ 69272df0145a1e75a97bb06f
2025-11-26 16:42:24,013 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272df0145a1e75a97bb06f
2025-11-26 16:42:24,018 - app.services.user_documents_service - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 69272df0145a1e75a97bb070 (843321 bytes)
2025-11-26 16:42:24,019 - app.api.routes - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 69272df0145a1e75a97bb070
2025-11-26 16:42:24,019 - app.api.routes - INFO - âœ… Successfully processed: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:42:24,020 - app.api.routes - INFO - 
âœ… Successfully extracted 8 quotes
2025-11-26 16:42:24,020 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:42:24,020 - app.api.routes - INFO - ðŸ”€ Generating comparison for 8 quotes
2025-11-26 16:42:24,021 - app.api.routes - INFO - ======================================================================
2025-11-26 16:42:24,021 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 8 quotes
2025-11-26 16:42:24,021 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 16:42:24,022 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 16:42:24,022 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 16:42:24,022 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 16:42:24,022 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 16:42:24,023 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,023 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-26 16:42:24,024 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,025 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,026 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,027 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,027 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,027 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:42:24,028 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,028 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,028 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,028 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,029 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_t
2025-11-26 16:42:24,031 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,031 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:42:24,031 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:42:24,032 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,033 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,033 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,034 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,034 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,034 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,034 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,035 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,035 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,035 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,036 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,036 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,037 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,037 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:42:24,037 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,038 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-26 16:42:24,038 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-26 16:42:24,038 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:42:24,039 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-26 16:42:24,039 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 16:42:24,039 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:42:24,040 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,041 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Wataniya Insurance
2025-11-26 16:42:24,041 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,042 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,042 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,043 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,043 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,043 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:42:24,044 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,044 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,044 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,045 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,045 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 365,000,000.00",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 365000000,
    "total_sum_insured": "SAR 365,000,000.00"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All losses including Natural Catastrophe Risks",
        "deductible": "1% of the claim amount, min SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All losses including Natural Catastrophe Risks",
      "deductible": "1% of the claim amount, min SAR 1,000,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "N/A",
    "srcc_malicious_damage": "SAR 5,000,000",
   
2025-11-26 16:42:24,046 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,046 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:42:24,047 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:42:24,047 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,047 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,047 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,048 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,048 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,048 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,048 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,049 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,049 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,050 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,050 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,050 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,051 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,051 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:42:24,051 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,052 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Wataniya Insurance
2025-11-26 16:42:24,052 - app.services.ai_ranker - INFO - 
ðŸ“Š Wataniya Insurance:
2025-11-26 16:42:24,052 - app.services.ai_ranker - INFO -    Warranties: 5
2025-11-26 16:42:24,052 - app.services.ai_ranker - INFO -    Extensions: 8
2025-11-26 16:42:24,053 - app.services.ai_ranker - INFO -    Exclusions: 28
2025-11-26 16:42:24,053 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:42:24,053 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,053 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 16:42:24,053 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,054 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,054 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,054 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,054 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,055 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:42:24,055 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,055 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,056 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,056 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,057 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 200,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 200000,
    "total_sum_insured": "SAR 200,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1%, min SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1%, min SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and in the aggregate",
    "debris_removal": "SAR 10,000 any o
2025-11-26 16:42:24,059 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,059 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:42:24,060 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:42:24,060 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,060 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,060 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,060 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,061 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,061 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,061 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,062 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,062 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,062 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,063 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,063 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,063 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,063 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:42:24,063 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,064 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Rajhi Takaful
2025-11-26 16:42:24,064 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 16:42:24,064 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:42:24,064 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:42:24,064 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 16:42:24,065 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:42:24,065 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,065 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 16:42:24,065 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,066 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,066 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,067 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,067 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,067 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer', 'National Address', 'VAT Certificate'], 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing'], 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy', 'Copy of the project contingency plans', 'Copy of any agreement imposing specific insurance or risk management criteria', 'Copy of any clauses in the works contract or tender documentation specifying types of insurance required']}
2025-11-26 16:42:24,068 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,069 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,069 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,069 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,069 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 4,000,000",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "other than natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "flood",
        "deductible": "10% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "all natural perils",
2025-11-26 16:42:24,072 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 16:42:24,074 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing']
2025-11-26 16:42:24,076 - app.services.ai_ranker - INFO -    âœ… Found 6 items in key 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy']
2025-11-26 16:42:24,076 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,077 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,077 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,077 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,077 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,078 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,078 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,078 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,078 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,079 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,079 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,079 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,079 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,079 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 14
2025-11-26 16:42:24,080 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 16:42:24,080 - app.services.ai_ranker - INFO -    âœ… Extracted 14 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 16:42:24,080 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 16:42:24,080 - app.services.ai_ranker - INFO -    Warranties: 19
2025-11-26 16:42:24,080 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:42:24,080 - app.services.ai_ranker - INFO -    Exclusions: 21
2025-11-26 16:42:24,081 - app.services.ai_ranker - INFO -    Subjectivities: 14
2025-11-26 16:42:24,081 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,081 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 16:42:24,081 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,081 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,082 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,082 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,082 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,083 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:42:24,083 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,083 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,084 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,084 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,084 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 4,000,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SAR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1%, min SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1%, min SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and SAR 200,000 in the aggregate",
    "debris_removal": "SAR 10,000 any one occurrence and SAR 100,000 in the aggregate",
    "claims_preparation_clause": "SAR 25,000 any one occurrence and in the aggregate",
    "p
2025-11-26 16:42:24,086 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,086 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:42:24,087 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:42:24,087 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,087 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,088 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,088 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,088 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,089 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,089 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,090 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,090 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,091 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,091 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,091 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,092 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,092 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:42:24,092 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,092 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Rajhi Takaful
2025-11-26 16:42:24,093 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 16:42:24,093 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:42:24,093 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:42:24,093 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 16:42:24,093 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:42:24,093 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,094 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 16:42:24,094 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,094 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,094 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,094 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,094 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,095 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': [], 'conditions_precedent': ['No deterioration in loss record'], 'documentation_required': []}
2025-11-26 16:42:24,095 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,095 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,095 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,095 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,095 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 350,328,000",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 350328000,
    "total_sum_insured": "SAR 350,328,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Other losses",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "NATCAT",
      "deductible": "1% of the loss amount minimum SAR 1,000,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "Publi
2025-11-26 16:42:24,097 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-26 16:42:24,097 - app.services.ai_ranker - INFO -    âœ… Found 1 items in key 'conditions_precedent': ['No deterioration in loss record']
2025-11-26 16:42:24,097 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-26 16:42:24,098 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,098 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,098 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,098 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,098 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,099 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,099 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,099 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,100 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,100 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,100 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,101 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,101 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,101 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 1
2025-11-26 16:42:24,101 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['No deterioration in loss record']
2025-11-26 16:42:24,102 - app.services.ai_ranker - INFO -    âœ… Extracted 1 subjectivities for Al Rajhi Takaful
2025-11-26 16:42:24,102 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 16:42:24,102 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 16:42:24,102 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:42:24,103 - app.services.ai_ranker - INFO -    Exclusions: 42
2025-11-26 16:42:24,103 - app.services.ai_ranker - INFO -    Subjectivities: 1
2025-11-26 16:42:24,103 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,103 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 16:42:24,104 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,104 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,104 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,105 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,105 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,105 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:42:24,107 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,108 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,108 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,109 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,109 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 142,600/-",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 142600,
    "total_sum_insured": "SR 142,600"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Other than natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Flood",
        "deductible": "10% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All natural perils",
  
2025-11-26 16:42:24,111 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,111 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:42:24,112 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:42:24,112 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,112 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,112 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,112 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,112 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,113 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,113 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,113 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,113 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,113 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,114 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,114 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,114 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,114 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:42:24,114 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,115 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 16:42:24,115 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 16:42:24,115 - app.services.ai_ranker - INFO -    Warranties: 20
2025-11-26 16:42:24,115 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:42:24,115 - app.services.ai_ranker - INFO -    Exclusions: 65
2025-11-26 16:42:24,115 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:42:24,116 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:42:24,116 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 16:42:24,116 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:42:24,116 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:42:24,116 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:24,117 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:42:24,117 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:42:24,117 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:42:24,117 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:42:24,118 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:42:24,118 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:42:24,118 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:42:24,118 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 544,412,000",
    "business_interruption": "SAR 10,000,000",
    "total_sum_insured_numeric": 554412000,
    "total_sum_insured": "SR 554,412,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "1% of the claim amount applied, subject to a minimum of SR 1,000,000",
        "deductible": "1% of the claim amount",
        "applies_to": "material_damage"
      },
      {
        "range": "1% of the claim amount applied, subject to a minimum of SR 1,000,000 for all natural catastrophe risks",
        "deductible": "1% of the claim amount",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "10% of Claim amount, subject to minimum excess of SAR 10,000/- Each and Every Loss",
        "deductible": "10%",
        "applies_to": "Third Party Liability"

2025-11-26 16:42:24,121 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,121 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:42:24,121 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:42:24,122 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:42:24,122 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:42:24,122 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:42:24,122 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:42:24,122 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:42:24,123 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,123 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:42:24,123 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:42:24,123 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:42:24,124 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:42:24,124 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:42:24,124 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:42:24,124 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:42:24,124 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:42:24,125 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:42:24,125 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Rajhi Takaful
2025-11-26 16:42:24,125 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 16:42:24,125 - app.services.ai_ranker - INFO -    Warranties: 3
2025-11-26 16:42:24,125 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:42:24,126 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 16:42:24,126 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:42:24,126 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-26 16:42:24,680 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 4
2025-11-26 16:42:24,680 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 5
2025-11-26 16:42:24,681 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:42:24,681 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:42:24,681 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:42:24,681 - app.services.ai_ranker - INFO -       â€¢ Sprinklers Maintenance Warranty
2025-11-26 16:42:24,682 - app.services.ai_ranker - INFO -       â€¢ Warranted CCTV is installed and operational
2025-11-26 16:42:24,682 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities
2025-11-26 16:42:24,682 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Wataniya Insurance
2025-11-26 16:42:25,198 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 16:42:25,198 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 8
2025-11-26 16:42:25,198 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:42:25,198 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:42:25,199 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:42:25,199 - app.services.ai_ranker - INFO -       â€¢ Warranted that Reasonable Precautions to be taken during the project period
2025-11-26 16:42:25,199 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Rajhi Takaful
2025-11-26 16:42:25,792 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-26 16:42:25,793 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:42:25,793 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:42:25,793 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:42:25,793 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:42:25,794 - app.services.ai_ranker - INFO -       â€¢ Warranted adequate safety arrangements and signboards are put in proper manner a...
2025-11-26 16:42:25,794 - app.services.ai_ranker - INFO -       â€¢ Warranted night light signals should be installed within the work site.
2025-11-26 16:42:25,794 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Sagr Co-operative Insurance Company
2025-11-26 16:42:26,836 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 10
2025-11-26 16:42:26,836 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:42:26,836 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:42:26,837 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:42:26,837 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:42:26,837 - app.services.ai_ranker - INFO -       â€¢ Warranted that third party claims are not covered
2025-11-26 16:42:26,838 - app.services.ai_ranker - INFO -       â€¢ Warranted that professional & expert operator to perform duties
2025-11-26 16:42:26,838 - app.services.ai_ranker - INFO -       â€¢ Warranted heavy lifting should be carried out by competent and skilled manpower
2025-11-26 16:42:26,838 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 16:42:26,838 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 16:42:26,839 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 16:42:26,839 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=76.02
2025-11-26 16:42:26,839 - app.services.ai_ranker - INFO - ðŸ“Š Wataniya Insurance: Hakim Score=88.0 (Strong), Weighted Score=76.15
2025-11-26 16:42:26,840 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=65.18
2025-11-26 16:42:26,840 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=75.0 (Standard), Weighted Score=66.50
2025-11-26 16:42:26,841 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=63.35
2025-11-26 16:42:26,841 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=70.65
2025-11-26 16:42:26,841 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=75.0 (Standard), Weighted Score=72.75
2025-11-26 16:42:26,842 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=70.12
2025-11-26 16:42:26,842 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 16:42:26,842 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 16:42:37,193 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:42:37,195 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 16:42:37,195 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 16:42:37,195 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 16:42:37,196 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 16:42:37,197 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 16:42:37,197 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764175282_97beec7731a8
2025-11-26 16:42:37,197 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 8
2025-11-26 16:42:37,198 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 16:42:37,198 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 8
2025-11-26 16:42:37,198 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Chubb Arabia
2025-11-26 16:42:37,199 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 16:42:37,199 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 16:42:37,199 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 16:42:37,199 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 16:42:37,199 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 16:42:37,200 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 16:42:37,200 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Wataniya Insurance
2025-11-26 16:42:37,200 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 16:42:37,201 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 16:42:37,201 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 16:42:37,201 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 16:42:37,201 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 16:42:37,202 - app.services.mongodb_service_enhanced - INFO -       - All keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 16:42:37,206 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 16:42:37,207 - app.services.mongodb_service_enhanced - INFO -    Summary: 13,275 bytes
2025-11-26 16:42:37,207 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 78,712 bytes
2025-11-26 16:42:37,207 - app.services.mongodb_service_enhanced - INFO -    Data table: 33,711 bytes
2025-11-26 16:42:37,208 - app.services.mongodb_service_enhanced - INFO -    Analytics: 3,374 bytes
2025-11-26 16:42:37,208 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 110,656 bytes
2025-11-26 16:42:37,208 - app.services.mongodb_service_enhanced - INFO -    Total document: 504,148 bytes
2025-11-26 16:42:37,208 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 16:42:37,209 - app.services.mongodb_service_enhanced - INFO -       premium: 8 items
2025-11-26 16:42:37,209 - app.services.mongodb_service_enhanced - INFO -       rate: 8 items
2025-11-26 16:42:37,209 - app.services.mongodb_service_enhanced - INFO -       score: 8 items
2025-11-26 16:42:37,209 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 8 items
2025-11-26 16:42:37,210 - app.services.mongodb_service_enhanced - INFO -       deductible: 8 items
2025-11-26 16:42:37,210 - app.services.mongodb_service_enhanced - INFO -       coverage: 8 items
2025-11-26 16:42:37,210 - app.services.mongodb_service_enhanced - INFO -       benefits: 8 items
2025-11-26 16:42:37,210 - app.services.mongodb_service_enhanced - INFO -       exclusions: 8 items
2025-11-26 16:42:37,211 - app.services.mongodb_service_enhanced - INFO -       warranties: 8 items
2025-11-26 16:42:37,211 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 8 items
2025-11-26 16:42:37,211 - app.services.mongodb_service_enhanced - INFO -       conditions: 8 items
2025-11-26 16:42:37,211 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 8 items
2025-11-26 16:42:37,212 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 8 items
2025-11-26 16:42:37,212 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 8 items
2025-11-26 16:42:37,212 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 16:42:37,212 - app.services.mongodb_service_enhanced - INFO -       - Count: 8
2025-11-26 16:42:37,213 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 16:42:37,213 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:37,214 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 16:42:37,223 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764175282_97beec7731a8
2025-11-26 16:42:37,224 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69272dfdb757af6a8efab05d
2025-11-26 16:42:37,230 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 16:42:37,230 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 16:42:37,230 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 16:42:37,231 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 16:42:37,231 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 16:42:37,231 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 16:42:37,231 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 16:42:37,232 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 8
2025-11-26 16:42:37,232 - app.services.mongodb_service_enhanced - INFO -    - First row keys (30): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 16:42:37,233 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 8
2025-11-26 16:42:37,233 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 16:42:37,234 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 8
2025-11-26 16:42:37,234 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (24): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 16:42:37,235 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 16:42:37,235 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 16:42:37,235 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 16:42:37,235 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 16:42:37,236 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 16:42:37,236 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:42:37,236 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69272dfdb757af6a8efab05d
2025-11-26 16:42:37,237 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 16:42:37,237 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 16:42:37,237 - app.api.routes - INFO -    Comparison ID: cmp_1764175282_97beec7731a8
2025-11-26 16:42:37,239 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 16:42:37,240 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 16:42:37,242 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:42:37,243 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 16:42:37,244 - app.api.routes - INFO - ======================================================================
2025-11-26 16:42:37,244 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764175282_97beec7731a8
2025-11-26 16:42:37,244 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 16:42:37,245 - app.api.routes - INFO - ðŸ“„ Files Processed: 8/8
2025-11-26 16:42:37,245 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 8 PDFs + 1 comparison
2025-11-26 16:42:37,245 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 16:42:37,245 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 16:42:37,245 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 16:42:37,246 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 16:42:37,248 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 16:42:37,248 - app.api.routes - INFO - ======================================================================

2025-11-26 16:42:37,248 - app.services.progress_tracker - INFO - âœ… Job completed: job_c3256176ffca â†’ comparison_id: cmp_1764175282_97beec7731a8
2025-11-26 16:42:37,254 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 74.84s
2025-11-26 16:48:18,954 - main - INFO - 
2025-11-26 16:48:18,955 - main - INFO - ================================================================================
2025-11-26 16:48:18,965 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:48:18,974 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:48:18,975 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:48:18,977 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:48:18,977 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:48:18,979 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:48:18,979 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:48:18,983 - main - INFO -   âœ… Cleaned up 8 temporary files
2025-11-26 16:48:18,984 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:48:18,984 - main - INFO - ================================================================================
2025-11-26 16:48:18,985 - main - INFO - 
2025-11-26 16:48:23,780 - main - INFO - 
2025-11-26 16:48:23,781 - main - INFO - ================================================================================
2025-11-26 16:48:23,781 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:48:23,782 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:48:23,782 - main - INFO - ================================================================================
2025-11-26 16:48:23,782 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:48:23,783 - main - INFO -   Upload Directory: uploads
2025-11-26 16:48:23,783 - main - INFO -   Max File Size: 20MB
2025-11-26 16:48:23,783 - main - INFO - ================================================================================
2025-11-26 16:48:23,784 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:48:23,787 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:48:23,788 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:48:23,812 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:48:23,821 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:48:23,821 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:48:23,822 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:48:23,822 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:48:23,822 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:48:23,829 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:48:23,831 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:48:23,833 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:48:23,837 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:48:23,838 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:48:23,838 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:48:23,838 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:48:23,839 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:48:23,846 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:48:23,846 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:48:23,847 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:48:23,847 - main - INFO - 
2025-11-26 16:48:23,847 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:48:23,848 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:48:23,848 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:48:23,848 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:48:23,848 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:48:23,849 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:48:23,849 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:48:23,849 - main - INFO - 
2025-11-26 16:48:23,849 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:48:23,850 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:48:23,850 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:48:23,850 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:48:23,851 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:48:23,851 - main - INFO - 
2025-11-26 16:48:23,852 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:48:23,852 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:48:23,853 - main - INFO -        - No manual section generation
2025-11-26 16:48:23,853 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:48:23,853 - main - INFO - 
2025-11-26 16:48:23,854 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:48:23,854 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:48:23,854 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:48:23,854 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:48:23,854 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:48:23,855 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:48:23,855 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:48:23,855 - main - INFO - 
2025-11-26 16:48:23,855 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:48:23,856 - main - INFO -      Main:
2025-11-26 16:48:23,856 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:48:23,856 - main - INFO - 
2025-11-26 16:48:23,856 - main - INFO -      Retrieval:
2025-11-26 16:48:23,856 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:48:23,856 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:48:23,856 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:48:23,857 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:48:23,857 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:48:23,857 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:48:23,857 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:48:23,857 - main - INFO - 
2025-11-26 16:48:23,858 - main - INFO -      Management:
2025-11-26 16:48:23,858 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:48:23,858 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:48:23,858 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:48:23,858 - main - INFO - 
2025-11-26 16:48:23,858 - main - INFO -      Documents (MongoDB):
2025-11-26 16:48:23,859 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:48:23,859 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:48:23,859 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:48:23,859 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:48:23,859 - main - INFO - 
2025-11-26 16:48:23,860 - main - INFO -      Diagnostics & Health:
2025-11-26 16:48:23,860 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:48:23,860 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:48:23,860 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:48:23,861 - main - INFO - 
2025-11-26 16:48:23,861 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:48:23,861 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:48:23,861 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:48:23,862 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:48:23,862 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:48:23,862 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:48:23,862 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:48:23,862 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:48:23,863 - main - INFO - 
2025-11-26 16:48:23,863 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:48:23,863 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:48:23,863 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:48:23,863 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:48:23,864 - main - INFO -      4. No re-upload needed!
2025-11-26 16:48:23,865 - main - INFO - 
2025-11-26 16:48:23,866 - main - INFO - ================================================================================
2025-11-26 16:48:23,867 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:48:23,868 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:48:23,868 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:48:23,868 - main - INFO - ================================================================================
2025-11-26 16:48:23,869 - main - INFO - 
2025-11-26 16:48:23,869 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:48:35,195 - main - INFO - 
2025-11-26 16:48:35,195 - main - INFO - ================================================================================
2025-11-26 16:48:35,198 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:48:35,199 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:48:35,200 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:48:35,201 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:48:35,202 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:48:35,202 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:48:35,203 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:48:35,204 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:48:35,204 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:48:35,204 - main - INFO - ================================================================================
2025-11-26 16:48:35,205 - main - INFO - 
2025-11-26 16:48:39,722 - main - INFO - 
2025-11-26 16:48:39,722 - main - INFO - ================================================================================
2025-11-26 16:48:39,723 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:48:39,723 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:48:39,723 - main - INFO - ================================================================================
2025-11-26 16:48:39,723 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:48:39,724 - main - INFO -   Upload Directory: uploads
2025-11-26 16:48:39,724 - main - INFO -   Max File Size: 20MB
2025-11-26 16:48:39,725 - main - INFO - ================================================================================
2025-11-26 16:48:39,725 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:48:39,726 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:48:39,726 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:48:39,751 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:48:39,760 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:48:39,761 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:48:39,761 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:48:39,761 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:48:39,762 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:48:39,775 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:48:39,776 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:48:39,777 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:48:39,779 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:48:39,780 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:48:39,780 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:48:39,780 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:48:39,780 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:48:39,800 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:48:39,801 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:48:39,801 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:48:39,802 - main - INFO - 
2025-11-26 16:48:39,802 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:48:39,802 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:48:39,802 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:48:39,803 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:48:39,803 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:48:39,803 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:48:39,804 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:48:39,804 - main - INFO - 
2025-11-26 16:48:39,804 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:48:39,805 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:48:39,805 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:48:39,805 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:48:39,805 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:48:39,806 - main - INFO - 
2025-11-26 16:48:39,806 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:48:39,806 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:48:39,806 - main - INFO -        - No manual section generation
2025-11-26 16:48:39,807 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:48:39,807 - main - INFO - 
2025-11-26 16:48:39,807 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:48:39,807 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:48:39,807 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:48:39,808 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:48:39,808 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:48:39,808 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:48:39,808 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:48:39,809 - main - INFO - 
2025-11-26 16:48:39,809 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:48:39,809 - main - INFO -      Main:
2025-11-26 16:48:39,809 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:48:39,809 - main - INFO - 
2025-11-26 16:48:39,810 - main - INFO -      Retrieval:
2025-11-26 16:48:39,810 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:48:39,810 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:48:39,810 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:48:39,810 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:48:39,811 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:48:39,811 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:48:39,811 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:48:39,811 - main - INFO - 
2025-11-26 16:48:39,812 - main - INFO -      Management:
2025-11-26 16:48:39,812 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:48:39,812 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:48:39,812 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:48:39,812 - main - INFO - 
2025-11-26 16:48:39,812 - main - INFO -      Documents (MongoDB):
2025-11-26 16:48:39,813 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:48:39,813 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:48:39,813 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:48:39,813 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:48:39,813 - main - INFO - 
2025-11-26 16:48:39,814 - main - INFO -      Diagnostics & Health:
2025-11-26 16:48:39,814 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:48:39,814 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:48:39,814 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:48:39,814 - main - INFO - 
2025-11-26 16:48:39,814 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:48:39,815 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:48:39,815 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:48:39,815 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:48:39,816 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:48:39,816 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:48:39,816 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:48:39,817 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:48:39,818 - main - INFO - 
2025-11-26 16:48:39,818 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:48:39,818 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:48:39,818 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:48:39,819 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:48:39,819 - main - INFO -      4. No re-upload needed!
2025-11-26 16:48:39,819 - main - INFO - 
2025-11-26 16:48:39,819 - main - INFO - ================================================================================
2025-11-26 16:48:39,819 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:48:39,820 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:48:39,820 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:48:39,820 - main - INFO - ================================================================================
2025-11-26 16:48:39,820 - main - INFO - 
2025-11-26 16:48:39,821 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:48:53,774 - main - INFO - 
2025-11-26 16:48:53,775 - main - INFO - ================================================================================
2025-11-26 16:48:53,775 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:48:53,776 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:48:53,776 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:48:53,777 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:48:53,777 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:48:53,778 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:48:53,778 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:48:53,779 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:48:53,779 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:48:53,779 - main - INFO - ================================================================================
2025-11-26 16:48:53,779 - main - INFO - 
2025-11-26 16:48:57,809 - main - INFO - 
2025-11-26 16:48:57,809 - main - INFO - ================================================================================
2025-11-26 16:48:57,810 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:48:57,810 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:48:57,810 - main - INFO - ================================================================================
2025-11-26 16:48:57,810 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:48:57,810 - main - INFO -   Upload Directory: uploads
2025-11-26 16:48:57,810 - main - INFO -   Max File Size: 20MB
2025-11-26 16:48:57,811 - main - INFO - ================================================================================
2025-11-26 16:48:57,811 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:48:57,811 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:48:57,812 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:48:57,852 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:48:57,863 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:48:57,863 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:48:57,864 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:48:57,864 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:48:57,864 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:48:57,908 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:48:57,909 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:48:57,910 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:48:57,911 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:48:57,912 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:48:57,912 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:48:57,912 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:48:57,912 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:48:57,921 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:48:57,922 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:48:57,923 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:48:57,923 - main - INFO - 
2025-11-26 16:48:57,923 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:48:57,923 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:48:57,924 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:48:57,924 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:48:57,924 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:48:57,924 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:48:57,925 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:48:57,925 - main - INFO - 
2025-11-26 16:48:57,925 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:48:57,925 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:48:57,925 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:48:57,926 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:48:57,926 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:48:57,926 - main - INFO - 
2025-11-26 16:48:57,926 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:48:57,926 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:48:57,926 - main - INFO -        - No manual section generation
2025-11-26 16:48:57,927 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:48:57,927 - main - INFO - 
2025-11-26 16:48:57,927 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:48:57,927 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:48:57,927 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:48:57,928 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:48:57,928 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:48:57,928 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:48:57,928 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:48:57,928 - main - INFO - 
2025-11-26 16:48:57,928 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:48:57,929 - main - INFO -      Main:
2025-11-26 16:48:57,929 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:48:57,929 - main - INFO - 
2025-11-26 16:48:57,929 - main - INFO -      Retrieval:
2025-11-26 16:48:57,929 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:48:57,929 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:48:57,929 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:48:57,930 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:48:57,930 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:48:57,930 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:48:57,930 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:48:57,930 - main - INFO - 
2025-11-26 16:48:57,930 - main - INFO -      Management:
2025-11-26 16:48:57,930 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:48:57,931 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:48:57,931 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:48:57,931 - main - INFO - 
2025-11-26 16:48:57,931 - main - INFO -      Documents (MongoDB):
2025-11-26 16:48:57,931 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:48:57,931 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:48:57,931 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:48:57,932 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:48:57,932 - main - INFO - 
2025-11-26 16:48:57,932 - main - INFO -      Diagnostics & Health:
2025-11-26 16:48:57,932 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:48:57,932 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:48:57,933 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:48:57,933 - main - INFO - 
2025-11-26 16:48:57,933 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:48:57,933 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:48:57,934 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:48:57,934 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:48:57,934 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:48:57,934 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:48:57,934 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:48:57,934 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:48:57,935 - main - INFO - 
2025-11-26 16:48:57,935 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:48:57,935 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:48:57,935 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:48:57,935 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:48:57,936 - main - INFO -      4. No re-upload needed!
2025-11-26 16:48:57,936 - main - INFO - 
2025-11-26 16:48:57,936 - main - INFO - ================================================================================
2025-11-26 16:48:57,936 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:48:57,937 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:48:57,938 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:48:57,940 - main - INFO - ================================================================================
2025-11-26 16:48:57,940 - main - INFO - 
2025-11-26 16:48:57,940 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:49:07,056 - main - INFO - 
2025-11-26 16:49:07,056 - main - INFO - ================================================================================
2025-11-26 16:49:07,056 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:49:07,057 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:49:07,058 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:49:07,058 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:49:07,059 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:49:07,059 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:49:07,060 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:49:07,060 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:49:07,061 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:49:07,061 - main - INFO - ================================================================================
2025-11-26 16:49:07,061 - main - INFO - 
2025-11-26 16:49:11,419 - main - INFO - 
2025-11-26 16:49:11,419 - main - INFO - ================================================================================
2025-11-26 16:49:11,420 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:49:11,420 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:49:11,420 - main - INFO - ================================================================================
2025-11-26 16:49:11,420 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:49:11,421 - main - INFO -   Upload Directory: uploads
2025-11-26 16:49:11,421 - main - INFO -   Max File Size: 20MB
2025-11-26 16:49:11,422 - main - INFO - ================================================================================
2025-11-26 16:49:11,422 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:49:11,422 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:49:11,423 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:49:11,443 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:49:11,453 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:49:11,454 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:49:11,454 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:49:11,454 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:49:11,455 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:49:11,462 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:49:11,463 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:49:11,464 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:49:11,466 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:49:11,467 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:49:11,468 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:49:11,469 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:49:11,469 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:49:11,502 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:49:11,503 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:49:11,504 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:49:11,504 - main - INFO - 
2025-11-26 16:49:11,505 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:49:11,506 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:49:11,507 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:49:11,507 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:49:11,508 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:49:11,509 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:49:11,509 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:49:11,510 - main - INFO - 
2025-11-26 16:49:11,510 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:49:11,511 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:49:11,511 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:49:11,512 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:49:11,512 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:49:11,513 - main - INFO - 
2025-11-26 16:49:11,513 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:49:11,514 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:49:11,514 - main - INFO -        - No manual section generation
2025-11-26 16:49:11,515 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:49:11,516 - main - INFO - 
2025-11-26 16:49:11,517 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:49:11,518 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:49:11,519 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:49:11,520 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:49:11,520 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:49:11,521 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:49:11,522 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:49:11,522 - main - INFO - 
2025-11-26 16:49:11,523 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:49:11,523 - main - INFO -      Main:
2025-11-26 16:49:11,524 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:49:11,525 - main - INFO - 
2025-11-26 16:49:11,525 - main - INFO -      Retrieval:
2025-11-26 16:49:11,526 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:49:11,526 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:49:11,526 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:49:11,527 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:49:11,527 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:49:11,528 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:49:11,528 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:49:11,528 - main - INFO - 
2025-11-26 16:49:11,528 - main - INFO -      Management:
2025-11-26 16:49:11,529 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:49:11,529 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:49:11,530 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:49:11,530 - main - INFO - 
2025-11-26 16:49:11,530 - main - INFO -      Documents (MongoDB):
2025-11-26 16:49:11,531 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:49:11,531 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:49:11,531 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:49:11,532 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:49:11,532 - main - INFO - 
2025-11-26 16:49:11,533 - main - INFO -      Diagnostics & Health:
2025-11-26 16:49:11,533 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:49:11,534 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:49:11,535 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:49:11,535 - main - INFO - 
2025-11-26 16:49:11,536 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:49:11,536 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:49:11,536 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:49:11,537 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:49:11,537 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:49:11,537 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:49:11,538 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:49:11,538 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:49:11,538 - main - INFO - 
2025-11-26 16:49:11,539 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:49:11,539 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:49:11,540 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:49:11,540 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:49:11,540 - main - INFO -      4. No re-upload needed!
2025-11-26 16:49:11,541 - main - INFO - 
2025-11-26 16:49:11,541 - main - INFO - ================================================================================
2025-11-26 16:49:11,541 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:49:11,542 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:49:11,542 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:49:11,542 - main - INFO - ================================================================================
2025-11-26 16:49:11,542 - main - INFO - 
2025-11-26 16:49:11,543 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:49:46,379 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 16:49:46,462 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 16:49:46,462 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 16:49:46,463 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 16:49:46,463 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 16:49:46,465 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 16:49:46,468 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 16:49:46,469 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 16:49:46,470 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 16:49:46,470 - app.api.routes - INFO -    - Files uploaded: 8
2025-11-26 16:49:46,471 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764175786_fa6b73134bfb
2025-11-26 16:49:46,471 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_28f15cebc1b9 (8 files)
2025-11-26 16:49:46,472 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_28f15cebc1b9
2025-11-26 16:49:46,474 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,474 - app.api.routes - INFO - ðŸ“„ Processing: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:46,475 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,475 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,476 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:49:46,476 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,477 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ aadb9e5a882e41dbb005493c58bb3d53.pdf (213039 bytes)
2025-11-26 16:49:46,478 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:49:46,479 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\aadb9e5a882e41dbb005493c58bb3d53.pdf
2025-11-26 16:49:46,479 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,480 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:49:46,533 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,558 - app.services.pdf_extractor - INFO - Successfully extracted 12221 characters from 6 pages
2025-11-26 16:49:46,559 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 0fc3786da2ff457db8e110bccbf9f9ed.pdf (241116 bytes)
2025-11-26 16:49:46,559 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:49:46,560 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,560 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\0fc3786da2ff457db8e110bccbf9f9ed.pdf
2025-11-26 16:49:46,560 - app.api.routes - INFO - ðŸ“„ Processing: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:49:46,560 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,625 - app.services.pdf_extractor - INFO - Successfully extracted 13483 characters from 6 pages
2025-11-26 16:49:46,626 - app.api.routes - INFO - ðŸ’¾ Saved file: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 378ec89289bc447ea1165fbd09dbbfa5.pdf (843321 bytes)
2025-11-26 16:49:46,626 - app.api.routes - INFO - ðŸ“– Extracting text from: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:49:46,627 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,627 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\378ec89289bc447ea1165fbd09dbbfa5.pdf
2025-11-26 16:49:46,627 - app.api.routes - INFO - ðŸ“„ Processing: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:49:46,650 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,703 - app.services.pdf_extractor - INFO - Successfully extracted 7736 characters from 4 pages
2025-11-26 16:49:46,704 - app.api.routes - INFO - ðŸ’¾ Saved file: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 93c9a6200eec4a45bc417990b33322e8.pdf (290798 bytes)
2025-11-26 16:49:46,707 - app.api.routes - INFO - ðŸ“– Extracting text from: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:49:46,707 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,708 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\93c9a6200eec4a45bc417990b33322e8.pdf
2025-11-26 16:49:46,708 - app.api.routes - INFO - ðŸ“„ Processing: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:46,709 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,757 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,778 - app.services.pdf_extractor - INFO - Successfully extracted 15546 characters from 7 pages
2025-11-26 16:49:46,779 - app.api.routes - INFO - ðŸ“„ Processing: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:49:46,779 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,780 - app.api.routes - INFO - ðŸ’¾ Saved file: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ ad303f7553e24f2aa7d545c958c145c1.pdf (309991 bytes)
2025-11-26 16:49:46,780 - app.api.routes - INFO - ðŸ“– Extracting text from: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:49:46,780 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:49:46,781 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\ad303f7553e24f2aa7d545c958c145c1.pdf
2025-11-26 16:49:46,781 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:49:46,781 - app.api.routes - INFO - ======================================================================
2025-11-26 16:49:46,832 - app.services.pdf_extractor - INFO - Successfully extracted 12679 characters from 5 pages
2025-11-26 16:49:46,834 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ cd1146ed75484d2294781d66b223c397.pdf (175401 bytes)
2025-11-26 16:49:46,835 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:49:46,836 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\cd1146ed75484d2294781d66b223c397.pdf
2025-11-26 16:49:46,838 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:49:46,877 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:49:46,894 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:49:46,903 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-26 16:49:46,907 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:49:46,907 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:49:46,908 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:46,908 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:49:46,908 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 16:49:46,908 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 16:49:46,991 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:49:46,991 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:47,612 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:49:47,612 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:49:47,614 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:49:47,614 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:49:47,620 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:49:47,622 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:47,625 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:49:47,626 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 16:49:47,626 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 16:49:47,787 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:49:47,787 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:47,792 - app.api.routes - INFO - ðŸ¤– Parsing with AI: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:49:47,792 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:49:47,793 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:49:47,794 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:49:47,794 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 16:49:47,794 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:47,794 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:49:47,888 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:49:47,889 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:47,891 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:49:47,892 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:49:47,893 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 16:49:47,893 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 16:49:47,894 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:49:47,894 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:47,894 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 16:49:47,894 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 16:49:47,895 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 16:49:48,002 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 16:49:48,003 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:48,006 - app.api.routes - INFO - ðŸ¤– Parsing with AI: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:49:48,007 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:49:48,009 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Wataniya Insurance
2025-11-26 16:49:48,009 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Wataniya Insurance
2025-11-26 16:49:48,009 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 16:49:48,010 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:48,010 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:49:48,104 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 16:49:48,105 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:48,107 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:49:48,107 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:49:48,107 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-26 16:49:48,108 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-26 16:49:48,108 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 16:49:48,108 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:48,108 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-26 16:49:48,193 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-26 16:49:48,193 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:48,227 - app.api.routes - INFO - ðŸ’¾ Saved file: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ db40f875c38742ce852027da8230b990.pdf (2137120 bytes)
2025-11-26 16:49:48,228 - app.api.routes - INFO - ðŸ“– Extracting text from: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:48,229 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\db40f875c38742ce852027da8230b990.pdf
2025-11-26 16:49:48,289 - app.api.routes - INFO - ðŸ’¾ Saved file: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 451ee39e28d4413fafba8557f3e11609.pdf (2510488 bytes)
2025-11-26 16:49:48,300 - app.services.pdf_extractor - INFO - Successfully extracted 11585 characters from 4 pages
2025-11-26 16:49:48,301 - app.api.routes - INFO - ðŸ“– Extracting text from: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:48,304 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:48,305 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\451ee39e28d4413fafba8557f3e11609.pdf
2025-11-26 16:49:48,307 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:48,308 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 16:49:48,360 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 16:49:48,393 - app.services.pdf_extractor - INFO - Successfully extracted 17529 characters from 6 pages
2025-11-26 16:49:48,393 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:49:48,394 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:48,394 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:49:48,474 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-26 16:49:48,474 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:49:48,477 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:48,477 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:49:48,479 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 16:49:48,479 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 16:49:48,480 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 16:49:48,480 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 16:49:48,480 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 16:49:48,610 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 16:49:48,610 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 16:50:17,789 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:17,799 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:17,800 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:17,801 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:17,802 - app.services.ai_parser - WARNING - âš ï¸ Only 5 benefits, using fallback...
2025-11-26 16:50:17,810 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 16:50:17,810 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 11 total
2025-11-26 16:50:17,810 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:23,036 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:23,038 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:23,038 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:23,038 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:23,038 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:50:23,040 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 16:50:23,041 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 6 total
2025-11-26 16:50:23,041 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:23,448 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:23,452 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:23,452 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:23,453 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium, SAR 1,000 Per Project' â†’ 'FLAT Premium'
2025-11-26 16:50:23,453 - app.services.ai_parser - INFO - ðŸ’° Calculated: 4000000.00 from SI: 4000000.0 Ã— Rate: Flat Premium, SAR 1,000 Per Project
2025-11-26 16:50:23,453 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SAR 10,000
2025-11-26 16:50:23,454 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:23,454 - app.services.ai_parser - INFO - ðŸ“Š Counts: 11 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 16:50:25,597 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:25,611 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:25,611 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:25,611 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:25,612 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:50:25,614 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 16 benefits from patterns
2025-11-26 16:50:25,614 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 15 total
2025-11-26 16:50:25,614 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:28,605 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:28,609 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:28,610 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:28,610 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:28,611 - app.services.ai_parser - WARNING - âš ï¸ Only 3 benefits, using fallback...
2025-11-26 16:50:28,619 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 13 benefits from patterns
2025-11-26 16:50:28,620 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 16 total
2025-11-26 16:50:28,621 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:28,855 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:28,857 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:28,857 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:28,858 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:28,858 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:50:28,859 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 23 benefits from patterns
2025-11-26 16:50:28,860 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 23 total
2025-11-26 16:50:28,860 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:29,579 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:29,844 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:29,845 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:29,845 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:29,846 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:29,873 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:29,879 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:50:29,879 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:29,880 - app.services.ai_parser - INFO - 
2025-11-26 16:50:29,881 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:29,881 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:50:29,882 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:29,884 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 16:50:29,884 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:50:29,885 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 20,000.00
2025-11-26 16:50:29,885 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 16:50:29,886 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:50:29,886 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-26 16:50:29,887 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SAR 10,000
2025-11-26 16:50:29,887 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:29,888 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:50:29,888 - app.services.ai_parser - INFO - 
2025-11-26 16:50:29,889 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:29,889 - app.services.ai_parser - INFO -    âœ“ Benefits: 11
2025-11-26 16:50:29,890 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 16:50:29,890 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:50:29,891 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:50:29,892 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:50:29,893 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:29,895 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 0fc3786da2ff457db8e110bccbf9f9ed.pdf â†’ 69272fd5074e86e2ea322fea
2025-11-26 16:50:29,895 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fd5074e86e2ea322fea
2025-11-26 16:50:29,897 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 69272fd5074e86e2ea322feb (241116 bytes)
2025-11-26 16:50:29,898 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 69272fd5074e86e2ea322feb
2025-11-26 16:50:29,898 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 16:50:30,036 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:30,037 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:30,037 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:30,038 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium' â†’ 'FLAT Premium'
2025-11-26 16:50:30,038 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount, minimum SAR 10,000
2025-11-26 16:50:30,038 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:30,039 - app.services.ai_parser - INFO - ðŸ“Š Counts: 6 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 16:50:30,535 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:30,539 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:30,540 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:30,541 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:30,542 - app.services.ai_parser - WARNING - âš ï¸ Only 7 benefits, using fallback...
2025-11-26 16:50:30,548 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 20 benefits from patterns
2025-11-26 16:50:30,549 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 25 total
2025-11-26 16:50:30,550 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:32,204 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:32,233 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:32,240 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:32,241 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 2,250/- (Flat) + 15% VAT' â†’ '2%'
2025-11-26 16:50:32,264 - app.services.ai_parser - INFO - ðŸ’° Calculated: 3208500.00 from SI: 142600.0 Ã— Rate: SR 2,250/- (Flat) + 15% VAT
2025-11-26 16:50:32,265 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SR 50,000
2025-11-26 16:50:32,265 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:32,266 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 65 exclusions, 20 warranties, 0 extensions
2025-11-26 16:50:33,838 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:33,842 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:33,843 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:33,843 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.1â€°' â†’ '1.1â€°'
2025-11-26 16:50:33,844 - app.services.ai_parser - INFO - ðŸ’° Calculated: 609853.20 from SI: 554412000.0 Ã— Rate: 1.1â€°
2025-11-26 16:50:33,846 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SR 1,000,000 | BI: 10%, min SR 10,000
2025-11-26 16:50:33,847 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:33,848 - app.services.ai_parser - INFO - ðŸ“Š Counts: 23 benefits, 29 exclusions, 6 warranties, 0 extensions
2025-11-26 16:50:36,136 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:36,139 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 75.0
2025-11-26 16:50:36,139 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:36,140 - app.services.ai_parser - INFO - 
2025-11-26 16:50:36,141 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:36,141 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:50:36,142 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:36,143 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 16:50:36,144 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:50:36,144 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,500.00
2025-11-26 16:50:36,145 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 16:50:36,146 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 75.0/100
2025-11-26 16:50:36,146 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.0/100
2025-11-26 16:50:36,147 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount, minimum SAR 10,000
2025-11-26 16:50:36,147 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:36,148 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:50:36,149 - app.services.ai_parser - INFO - 
2025-11-26 16:50:36,149 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:36,150 - app.services.ai_parser - INFO -    âœ“ Benefits: 6
2025-11-26 16:50:36,150 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 16:50:36,151 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 16:50:36,152 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:50:36,152 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:50:36,153 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:36,156 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: aadb9e5a882e41dbb005493c58bb3d53.pdf â†’ 69272fdc074e86e2ea322fec
2025-11-26 16:50:36,157 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fdc074e86e2ea322fec
2025-11-26 16:50:36,162 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 69272fdc074e86e2ea322fed (213039 bytes)
2025-11-26 16:50:36,163 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 69272fdc074e86e2ea322fed
2025-11-26 16:50:36,163 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 16:50:36,462 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:36,463 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:36,463 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:36,464 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 18,000/- + Plus VAT 15%' â†’ '18%'
2025-11-26 16:50:36,464 - app.services.ai_parser - INFO - ðŸ’° Calculated: 720000000.00 from SI: 4000000.0 Ã— Rate: SR 18,000/- + Plus VAT 15%
2025-11-26 16:50:36,464 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SR 50,000
2025-11-26 16:50:36,465 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:36,465 - app.services.ai_parser - INFO - ðŸ“Š Counts: 16 benefits, 65 exclusions, 19 warranties, 0 extensions
2025-11-26 16:50:36,943 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:36,978 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 16:50:36,978 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 16:50:36,978 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 16:50:36,979 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 16:50:36,981 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 37 benefits from patterns
2025-11-26 16:50:36,982 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 34 total
2025-11-26 16:50:36,982 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 16:50:37,203 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:37,204 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:37,204 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:37,204 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-26 16:50:37,205 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-26 16:50:37,205 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:50:37,205 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:50:37,206 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 16:50:37,206 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 16:50:37,206 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:37,207 - app.services.ai_parser - INFO - ðŸ“Š Counts: 37 benefits, 29 exclusions, 10 warranties, 5 extensions
2025-11-26 16:50:37,231 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:37,237 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:37,238 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:37,238 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.00â€° (Per Mille)' â†’ '1.00â€°'
2025-11-26 16:50:37,238 - app.services.ai_parser - INFO - ðŸ’° Calculated: 365000.00 from SI: 365000000.0 Ã— Rate: 1.00â€° (Per Mille)
2025-11-26 16:50:37,239 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000 | BI: Nil for Bodily injury | Nat Cat: 1% of the claim amount subject to a minimum of SAR 1,000,000
2025-11-26 16:50:37,239 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:37,239 - app.services.ai_parser - INFO - ðŸ“Š Counts: 25 benefits, 28 exclusions, 5 warranties, 9 extensions
2025-11-26 16:50:38,358 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:38,365 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:50:38,366 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:38,367 - app.services.ai_parser - INFO - 
2025-11-26 16:50:38,368 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:38,368 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:50:38,369 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:38,370 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 16:50:38,371 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:50:38,371 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,250.00
2025-11-26 16:50:38,372 - app.services.ai_parser - INFO - ðŸ“Š Rate: 2%
2025-11-26 16:50:38,373 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:50:38,373 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.3/100
2025-11-26 16:50:38,374 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SR 50,000
2025-11-26 16:50:38,374 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:38,375 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:50:38,375 - app.services.ai_parser - INFO - 
2025-11-26 16:50:38,376 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:38,377 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-26 16:50:38,377 - app.services.ai_parser - INFO -    âœ“ Exclusions: 65
2025-11-26 16:50:38,378 - app.services.ai_parser - INFO -    âœ“ Warranties: 20
2025-11-26 16:50:38,378 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:50:38,379 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:50:38,379 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:38,382 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: db40f875c38742ce852027da8230b990.pdf â†’ 69272fde074e86e2ea322fee
2025-11-26 16:50:38,382 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fde074e86e2ea322fee
2025-11-26 16:50:38,401 - app.services.user_documents_service - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272fde074e86e2ea322fef (2137120 bytes)
2025-11-26 16:50:38,402 - app.api.routes - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272fde074e86e2ea322fef
2025-11-26 16:50:38,402 - app.api.routes - INFO - âœ… Successfully processed: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:50:39,793 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:39,796 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:50:39,797 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:39,798 - app.services.ai_parser - INFO - 
2025-11-26 16:50:39,798 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:39,799 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:50:39,800 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:39,801 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 16:50:39,801 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 16:50:39,802 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 609,853.20
2025-11-26 16:50:39,803 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.1â€°
2025-11-26 16:50:39,803 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:50:39,804 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.0/100
2025-11-26 16:50:39,805 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SR 1,000,000 | BI: 10%, min SR 10,000
2025-11-26 16:50:39,806 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:39,806 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:50:39,807 - app.services.ai_parser - INFO - 
2025-11-26 16:50:39,807 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:39,808 - app.services.ai_parser - INFO -    âœ“ Benefits: 23
2025-11-26 16:50:39,809 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 16:50:39,809 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 16:50:39,810 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:50:39,811 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:50:39,811 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:39,814 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 378ec89289bc447ea1165fbd09dbbfa5.pdf â†’ 69272fdf074e86e2ea322ff0
2025-11-26 16:50:39,815 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fdf074e86e2ea322ff0
2025-11-26 16:50:39,825 - app.services.user_documents_service - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 69272fdf074e86e2ea322ff1 (843321 bytes)
2025-11-26 16:50:39,826 - app.api.routes - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 69272fdf074e86e2ea322ff1
2025-11-26 16:50:39,827 - app.api.routes - INFO - âœ… Successfully processed: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 16:50:40,166 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:40,168 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 16:50:40,168 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 16:50:40,169 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.95%o on total sum insured of SAR 350,328,000/-' â†’ '0.95â€°'
2025-11-26 16:50:40,169 - app.services.ai_parser - INFO - ðŸ’° Calculated: 332811.60 from SI: 350328000.0 Ã— Rate: 0.95%o on total sum insured of SAR 350,328,000/-
2025-11-26 16:50:40,169 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 16:50:40,170 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 16:50:40,170 - app.services.ai_parser - INFO - ðŸ“Š Counts: 34 benefits, 42 exclusions, 6 warranties, 0 extensions
2025-11-26 16:50:42,988 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:42,996 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:50:42,997 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:42,997 - app.services.ai_parser - INFO - 
2025-11-26 16:50:42,998 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:42,999 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:50:42,999 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,000 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Wataniya Insurance
2025-11-26 16:50:43,001 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 16:50:43,002 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 365,000.00
2025-11-26 16:50:43,002 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.00â€°
2025-11-26 16:50:43,003 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:50:43,003 - app.services.ai_parser - INFO - ðŸ“ Quality: 94.3/100
2025-11-26 16:50:43,003 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000 | BI: Nil for Bodily injury | Nat Cat: 1% of the claim amount subject to a minimum of SAR 1,000,000
2025-11-26 16:50:43,004 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:43,004 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:50:43,004 - app.services.ai_parser - INFO - 
2025-11-26 16:50:43,004 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:43,004 - app.services.ai_parser - INFO -    âœ“ Benefits: 25
2025-11-26 16:50:43,005 - app.services.ai_parser - INFO -    âœ“ Exclusions: 28
2025-11-26 16:50:43,005 - app.services.ai_parser - INFO -    âœ“ Warranties: 5
2025-11-26 16:50:43,005 - app.services.ai_parser - INFO -    âœ“ Extensions: 9
2025-11-26 16:50:43,005 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:50:43,005 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,007 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: ad303f7553e24f2aa7d545c958c145c1.pdf â†’ 69272fe3074e86e2ea322ff2
2025-11-26 16:50:43,008 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fe3074e86e2ea322ff2
2025-11-26 16:50:43,010 - app.services.user_documents_service - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 69272fe3074e86e2ea322ff3 (309991 bytes)
2025-11-26 16:50:43,010 - app.api.routes - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 69272fe3074e86e2ea322ff3
2025-11-26 16:50:43,011 - app.api.routes - INFO - âœ… Successfully processed: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 16:50:43,240 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:43,244 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:50:43,245 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:43,246 - app.services.ai_parser - INFO - 
2025-11-26 16:50:43,246 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,247 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:50:43,248 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,248 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 16:50:43,249 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:50:43,250 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 900.00
2025-11-26 16:50:43,250 - app.services.ai_parser - INFO - ðŸ“Š Rate: 18%
2025-11-26 16:50:43,251 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:50:43,251 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.3/100
2025-11-26 16:50:43,252 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SR 50,000
2025-11-26 16:50:43,252 - app.services.ai_parser - INFO - â° Validity: Quotation period as specified
2025-11-26 16:50:43,253 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 16:50:43,253 - app.services.ai_parser - INFO - 
2025-11-26 16:50:43,254 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:43,254 - app.services.ai_parser - INFO -    âœ“ Benefits: 16
2025-11-26 16:50:43,255 - app.services.ai_parser - INFO -    âœ“ Exclusions: 65
2025-11-26 16:50:43,255 - app.services.ai_parser - INFO -    âœ“ Warranties: 19
2025-11-26 16:50:43,255 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:50:43,255 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 5
2025-11-26 16:50:43,256 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,257 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 451ee39e28d4413fafba8557f3e11609.pdf â†’ 69272fe3074e86e2ea322ff4
2025-11-26 16:50:43,258 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fe3074e86e2ea322ff4
2025-11-26 16:50:43,275 - app.services.user_documents_service - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272fe3074e86e2ea322ff5 (2510488 bytes)
2025-11-26 16:50:43,275 - app.api.routes - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69272fe3074e86e2ea322ff5
2025-11-26 16:50:43,276 - app.api.routes - INFO - âœ… Successfully processed: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 16:50:43,638 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:43,639 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 16:50:43,639 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:43,640 - app.services.ai_parser - INFO - 
2025-11-26 16:50:43,640 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,640 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:50:43,641 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,641 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-26 16:50:43,641 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 16:50:43,642 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-26 16:50:43,642 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-26 16:50:43,642 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 16:50:43,642 - app.services.ai_parser - INFO - ðŸ“ Quality: 96.3/100
2025-11-26 16:50:43,643 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 16:50:43,643 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:43,643 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 16:50:43,643 - app.services.ai_parser - INFO - 
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO -    âœ“ Benefits: 37
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO -    âœ“ Warranties: 10
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 16:50:43,644 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:43,646 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: cd1146ed75484d2294781d66b223c397.pdf â†’ 69272fe3074e86e2ea322ff6
2025-11-26 16:50:43,646 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fe3074e86e2ea322ff6
2025-11-26 16:50:43,647 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69272fe3074e86e2ea322ff7 (175401 bytes)
2025-11-26 16:50:43,648 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69272fe3074e86e2ea322ff7
2025-11-26 16:50:43,648 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 16:50:47,152 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:50:47,155 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 16:50:47,156 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 16:50:47,157 - app.services.ai_parser - INFO - 
2025-11-26 16:50:47,157 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:47,158 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:50:47,159 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:47,159 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 16:50:47,160 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 16:50:47,161 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 322,811.60
2025-11-26 16:50:47,161 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.95â€°
2025-11-26 16:50:47,162 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 16:50:47,162 - app.services.ai_parser - INFO - ðŸ“ Quality: 95.3/100
2025-11-26 16:50:47,163 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 16:50:47,164 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 16:50:47,165 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 16:50:47,165 - app.services.ai_parser - INFO - 
2025-11-26 16:50:47,166 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 16:50:47,166 - app.services.ai_parser - INFO -    âœ“ Benefits: 34
2025-11-26 16:50:47,167 - app.services.ai_parser - INFO -    âœ“ Exclusions: 42
2025-11-26 16:50:47,167 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 16:50:47,168 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 16:50:47,168 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 0
2025-11-26 16:50:47,169 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 16:50:47,172 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 93c9a6200eec4a45bc417990b33322e8.pdf â†’ 69272fe7074e86e2ea322ff8
2025-11-26 16:50:47,173 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69272fe7074e86e2ea322ff8
2025-11-26 16:50:47,177 - app.services.user_documents_service - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69272fe7074e86e2ea322ff9 (290798 bytes)
2025-11-26 16:50:47,178 - app.api.routes - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69272fe7074e86e2ea322ff9
2025-11-26 16:50:47,178 - app.api.routes - INFO - âœ… Successfully processed: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 16:50:47,179 - app.api.routes - INFO - 
âœ… Successfully extracted 8 quotes
2025-11-26 16:50:47,180 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:50:47,180 - app.api.routes - INFO - ðŸ”€ Generating comparison for 8 quotes
2025-11-26 16:50:47,181 - app.api.routes - INFO - ======================================================================
2025-11-26 16:50:47,181 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 8 quotes
2025-11-26 16:50:47,182 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 16:50:47,182 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 16:50:47,183 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 16:50:47,183 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 16:50:47,184 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 16:50:47,184 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,185 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 16:50:47,186 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,188 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,189 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,190 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,191 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,191 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:50:47,192 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,192 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,193 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,193 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,193 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 4,000,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SAR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1%, min SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1%, min SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and SAR 200,000 in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and SAR 200,000 in the aggregate during the policy period",
    "Claims Preparation Clause": "SR 25,000"
  },
  "exclusio
2025-11-26 16:50:47,199 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,199 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:50:47,200 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:50:47,201 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,201 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,201 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,202 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,202 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,203 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,203 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,203 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,204 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,205 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,205 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,206 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:50:47,206 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,207 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Liva Insurance
2025-11-26 16:50:47,208 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 16:50:47,209 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:50:47,209 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:50:47,209 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 16:50:47,210 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:50:47,210 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,210 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 16:50:47,210 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,211 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,211 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,211 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,212 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,212 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:50:47,212 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,212 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,213 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,213 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,213 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 200,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 200000,
    "total_sum_insured": "SAR 200,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All losses",
        "deductible": "1% of the loss amount, minimum SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All losses",
      "deductible": "1% of the loss amount, minimum SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and in the aggregate",
   
2025-11-26 16:50:47,214 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,214 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:50:47,215 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:50:47,215 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,215 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,215 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,215 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,218 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,218 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,218 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,218 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:50:47,219 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,219 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Liva Insurance
2025-11-26 16:50:47,219 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 16:50:47,219 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 16:50:47,220 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:50:47,220 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 16:50:47,220 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:50:47,220 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,220 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 16:50:47,221 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,221 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,221 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,222 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,222 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,222 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:50:47,223 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,224 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,224 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,224 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,225 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 142,600/-",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 142600,
    "total_sum_insured": "SR 142,600"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all natural perils",
        "deductible": "1%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "other than natural perils",
        "deductible": "1%, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "flood",
        "deductible": "10%, min SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "all natural perils",
      "deductible": "1%, min SR 50,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {
2025-11-26 16:50:47,227 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,227 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:50:47,227 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:50:47,227 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,228 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,228 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,228 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,228 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,228 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,229 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,229 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,229 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,229 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,229 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,230 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,230 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,230 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:50:47,230 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,230 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 16:50:47,231 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 16:50:47,231 - app.services.ai_ranker - INFO -    Warranties: 20
2025-11-26 16:50:47,231 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:50:47,231 - app.services.ai_ranker - INFO -    Exclusions: 65
2025-11-26 16:50:47,231 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:50:47,231 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,232 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 16:50:47,232 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,232 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,232 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,233 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,233 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,234 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:50:47,234 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,234 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,234 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,235 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,235 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 544,412,000",
    "business_interruption": "SAR 10,000,000",
    "total_sum_insured_numeric": 554412000,
    "total_sum_insured": "SR 554,412,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all claims",
        "deductible": "1%, min SR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "natural catastrophe risks",
        "deductible": "1%, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "underground property/services",
        "deductible": "10%, min SR 10,000",
        "applies_to": "third_party_liability"
      },
      {
        "range": "third-party property damage",
        "deductible": "SR 10,000",
        "applies_to": "third_party_liability"
      }
    ],
    "natural_cat
2025-11-26 16:50:47,237 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,237 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:50:47,238 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:50:47,238 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,238 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,238 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,238 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,239 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,239 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,240 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,240 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,240 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,241 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,241 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,241 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,242 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,242 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:50:47,242 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,242 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Rajhi Takaful
2025-11-26 16:50:47,242 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 16:50:47,243 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 16:50:47,243 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:50:47,243 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 16:50:47,243 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:50:47,243 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,243 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Wataniya Insurance
2025-11-26 16:50:47,244 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,244 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,244 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,244 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,244 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,244 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:50:47,245 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,245 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,245 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,245 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,246 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 365,000,000.00",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 365000000,
    "total_sum_insured": "SAR 365,000,000.00"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "N/A",
        "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "N/A",
        "deductible": "Nil for Bodily injury",
        "applies_to": "business_interruption"
      }
    ],
    "natural_catastrophe_tiers": [
      {
        "range": "N/A",
        "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000"
      }
    ],
    "applicable_md_tier": {
      "range": "N/A",
      "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
    
2025-11-26 16:50:47,247 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,247 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:50:47,247 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:50:47,247 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,250 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,250 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,250 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,251 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:50:47,251 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,251 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Wataniya Insurance
2025-11-26 16:50:47,252 - app.services.ai_ranker - INFO - 
ðŸ“Š Wataniya Insurance:
2025-11-26 16:50:47,252 - app.services.ai_ranker - INFO -    Warranties: 5
2025-11-26 16:50:47,252 - app.services.ai_ranker - INFO -    Extensions: 9
2025-11-26 16:50:47,252 - app.services.ai_ranker - INFO -    Exclusions: 28
2025-11-26 16:50:47,253 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:50:47,253 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,253 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 16:50:47,253 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,254 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,254 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,254 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,255 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,255 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer', 'National Address', 'VAT Certificate'], 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing'], 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy', 'Copy of the project contingency plans', 'Copy of any agreement imposing specific insurance or risk management criteria', 'Copy of any clauses in the works contract or tender documentation specifying types of insurance required']}
2025-11-26 16:50:47,256 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,256 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,257 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,258 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,259 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 4,000,000",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all natural perils",
        "deductible": "1%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "other than natural perils",
        "deductible": "1%, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "flood",
        "deductible": "10%, min SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "all natural perils",
      "deductible": "1%, min SR 50,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier"
2025-11-26 16:50:47,261 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 16:50:47,262 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing']
2025-11-26 16:50:47,262 - app.services.ai_ranker - INFO -    âœ… Found 6 items in key 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy']
2025-11-26 16:50:47,262 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,265 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,265 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,265 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,265 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,266 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 14
2025-11-26 16:50:47,266 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 16:50:47,266 - app.services.ai_ranker - INFO -    âœ… Extracted 14 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 16:50:47,267 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 16:50:47,267 - app.services.ai_ranker - INFO -    Warranties: 19
2025-11-26 16:50:47,267 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:50:47,267 - app.services.ai_ranker - INFO -    Exclusions: 65
2025-11-26 16:50:47,268 - app.services.ai_ranker - INFO -    Subjectivities: 14
2025-11-26 16:50:47,268 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,268 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-26 16:50:47,269 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,269 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,269 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,270 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,270 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,270 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 16:50:47,271 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,271 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,271 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,271 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,272 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_t
2025-11-26 16:50:47,274 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,274 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 16:50:47,275 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 16:50:47,275 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,275 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,276 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,276 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,276 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,276 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,277 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,277 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,277 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,277 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,278 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,278 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,278 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,278 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 16:50:47,279 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 16:50:47,279 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-26 16:50:47,279 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-26 16:50:47,279 - app.services.ai_ranker - INFO -    Warranties: 10
2025-11-26 16:50:47,280 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-26 16:50:47,280 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 16:50:47,280 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 16:50:47,280 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 16:50:47,281 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 16:50:47,281 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 16:50:47,281 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 16:50:47,282 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:50:47,282 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 16:50:47,283 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 16:50:47,283 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': [], 'conditions_precedent': ['No deterioration in loss record'], 'documentation_required': []}
2025-11-26 16:50:47,284 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 16:50:47,284 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 16:50:47,285 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 16:50:47,285 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 16:50:47,285 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 350,328,000",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 350328000,
    "total_sum_insured": "SAR 350,328,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Other losses",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "NATCAT",
      "deductible": "1% of the loss amount minimum SAR 1,000,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "Publi
2025-11-26 16:50:47,288 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-26 16:50:47,288 - app.services.ai_ranker - INFO -    âœ… Found 1 items in key 'conditions_precedent': ['No deterioration in loss record']
2025-11-26 16:50:47,288 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-26 16:50:47,288 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 16:50:47,289 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 16:50:47,289 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 16:50:47,290 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 16:50:47,290 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 16:50:47,290 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,291 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 16:50:47,291 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 16:50:47,292 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 16:50:47,292 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 16:50:47,292 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 16:50:47,293 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 16:50:47,293 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 16:50:47,293 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 1
2025-11-26 16:50:47,294 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['No deterioration in loss record']
2025-11-26 16:50:47,294 - app.services.ai_ranker - INFO -    âœ… Extracted 1 subjectivities for Liva Insurance
2025-11-26 16:50:47,294 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 16:50:47,294 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 16:50:47,295 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 16:50:47,295 - app.services.ai_ranker - INFO -    Exclusions: 42
2025-11-26 16:50:47,295 - app.services.ai_ranker - INFO -    Subjectivities: 1
2025-11-26 16:50:47,295 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-26 16:50:48,268 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 16:50:48,268 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:50:48,268 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:50:48,268 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:50:48,269 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:50:48,269 - app.services.ai_ranker - INFO -       â€¢ Tandem Lift Provision Warranty
2025-11-26 16:50:48,269 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Sagr Co-operative Insurance Company
2025-11-26 16:50:49,853 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 10
2025-11-26 16:50:49,854 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:50:49,854 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:50:49,854 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-26 16:50:49,854 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:50:49,855 - app.services.ai_ranker - INFO -       â€¢ Warranted that third party claims are not covered
2025-11-26 16:50:49,855 - app.services.ai_ranker - INFO -       â€¢ Warranted that professional & expert operator to perform duties.
2025-11-26 16:50:49,855 - app.services.ai_ranker - INFO -       â€¢ Warranted heavy lifting should be carried out by competent and skilled manpower
2025-11-26 16:50:49,856 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Rajhi Takaful
2025-11-26 16:50:50,775 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 16:50:50,775 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 16:50:50,775 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:50:50,775 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:50:50,776 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Wataniya Insurance
2025-11-26 16:50:51,580 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 16:50:51,580 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 9
2025-11-26 16:50:51,581 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 16:50:51,581 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:50:51,581 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:50:51,581 - app.services.ai_ranker - INFO -       â€¢ Warranted that Reasonable Precautions to be taken during the project period
2025-11-26 16:50:51,582 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-26 16:50:52,500 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 3
2025-11-26 16:50:52,501 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 5
2025-11-26 16:50:52,501 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 9
2025-11-26 16:50:52,501 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 16:50:52,501 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 16:50:52,502 - app.services.ai_ranker - INFO -       â€¢ Stillage Warranty â€“ 15 cm
2025-11-26 16:50:52,502 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-26 16:50:52,502 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-26 16:50:52,503 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 16:50:52,503 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 16:50:52,503 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 16:50:52,504 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=64.55
2025-11-26 16:50:52,504 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=60.55
2025-11-26 16:50:52,504 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=66.75
2025-11-26 16:50:52,505 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=69.32
2025-11-26 16:50:52,505 - app.services.ai_ranker - INFO - ðŸ“Š Wataniya Insurance: Hakim Score=88.0 (Strong), Weighted Score=76.15
2025-11-26 16:50:52,505 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=74.00
2025-11-26 16:50:52,506 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=75.47
2025-11-26 16:50:52,506 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=71.85
2025-11-26 16:50:52,506 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 16:50:52,507 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 16:51:04,887 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 16:51:04,894 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 16:51:04,894 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 16:51:04,894 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 16:51:04,896 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 16:51:04,896 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 16:51:04,896 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764175786_fa6b73134bfb
2025-11-26 16:51:04,896 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 8
2025-11-26 16:51:04,897 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 16:51:04,897 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 8
2025-11-26 16:51:04,897 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-26 16:51:04,897 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 16:51:04,897 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 16:51:04,898 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 16:51:04,898 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 16:51:04,898 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 16:51:04,898 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 16:51:04,899 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Liva Insurance
2025-11-26 16:51:04,899 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 16:51:04,899 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 16:51:04,899 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 16:51:04,899 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 16:51:04,900 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 16:51:04,900 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 16:51:04,906 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 16:51:04,907 - app.services.mongodb_service_enhanced - INFO -    Summary: 14,037 bytes
2025-11-26 16:51:04,907 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 82,813 bytes
2025-11-26 16:51:04,907 - app.services.mongodb_service_enhanced - INFO -    Data table: 35,338 bytes
2025-11-26 16:51:04,908 - app.services.mongodb_service_enhanced - INFO -    Analytics: 3,344 bytes
2025-11-26 16:51:04,908 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 120,364 bytes
2025-11-26 16:51:04,908 - app.services.mongodb_service_enhanced - INFO -    Total document: 536,412 bytes
2025-11-26 16:51:04,908 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 16:51:04,909 - app.services.mongodb_service_enhanced - INFO -       premium: 8 items
2025-11-26 16:51:04,909 - app.services.mongodb_service_enhanced - INFO -       rate: 8 items
2025-11-26 16:51:04,909 - app.services.mongodb_service_enhanced - INFO -       score: 8 items
2025-11-26 16:51:04,909 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 8 items
2025-11-26 16:51:04,910 - app.services.mongodb_service_enhanced - INFO -       deductible: 8 items
2025-11-26 16:51:04,910 - app.services.mongodb_service_enhanced - INFO -       coverage: 8 items
2025-11-26 16:51:04,910 - app.services.mongodb_service_enhanced - INFO -       benefits: 8 items
2025-11-26 16:51:04,910 - app.services.mongodb_service_enhanced - INFO -       exclusions: 8 items
2025-11-26 16:51:04,911 - app.services.mongodb_service_enhanced - INFO -       warranties: 8 items
2025-11-26 16:51:04,911 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 8 items
2025-11-26 16:51:04,911 - app.services.mongodb_service_enhanced - INFO -       conditions: 8 items
2025-11-26 16:51:04,911 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 8 items
2025-11-26 16:51:04,912 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 8 items
2025-11-26 16:51:04,912 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 8 items
2025-11-26 16:51:04,912 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 16:51:04,913 - app.services.mongodb_service_enhanced - INFO -       - Count: 8
2025-11-26 16:51:04,913 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 16:51:04,914 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:51:04,915 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 16:51:04,925 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764175786_fa6b73134bfb
2025-11-26 16:51:04,925 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69272ff8b757af6a8efab05e
2025-11-26 16:51:04,934 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 16:51:04,935 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 16:51:04,935 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 16:51:04,935 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 16:51:04,935 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 16:51:04,935 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 16:51:04,936 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 16:51:04,936 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 8
2025-11-26 16:51:04,936 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 16:51:04,936 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 8
2025-11-26 16:51:04,936 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 16:51:04,937 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 8
2025-11-26 16:51:04,937 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 16:51:04,937 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 16:51:04,937 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 16:51:04,938 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 16:51:04,938 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 16:51:04,938 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 16:51:04,938 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 16:51:04,939 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69272ff8b757af6a8efab05e
2025-11-26 16:51:04,939 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 16:51:04,939 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 16:51:04,939 - app.api.routes - INFO -    Comparison ID: cmp_1764175786_fa6b73134bfb
2025-11-26 16:51:04,941 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 16:51:04,941 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 16:51:04,941 - app.api.routes - INFO - 
======================================================================
2025-11-26 16:51:04,942 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 16:51:04,942 - app.api.routes - INFO - ======================================================================
2025-11-26 16:51:04,942 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764175786_fa6b73134bfb
2025-11-26 16:51:04,942 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 16:51:04,942 - app.api.routes - INFO - ðŸ“„ Files Processed: 8/8
2025-11-26 16:51:04,943 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 8 PDFs + 1 comparison
2025-11-26 16:51:04,943 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 16:51:04,943 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 16:51:04,943 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 16:51:04,944 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 16:51:04,948 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 16:51:04,948 - app.api.routes - INFO - ======================================================================

2025-11-26 16:51:04,949 - app.services.progress_tracker - INFO - âœ… Job completed: job_28f15cebc1b9 â†’ comparison_id: cmp_1764175786_fa6b73134bfb
2025-11-26 16:51:04,954 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 78.58s
2025-11-26 16:51:04,985 - main - INFO - 
2025-11-26 16:51:04,985 - main - INFO - ================================================================================
2025-11-26 16:51:04,986 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:51:04,986 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:51:04,987 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:51:04,988 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:51:04,988 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:51:04,989 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:51:04,989 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:51:04,992 - main - INFO -   âœ… Cleaned up 8 temporary files
2025-11-26 16:51:04,993 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:51:04,993 - main - INFO - ================================================================================
2025-11-26 16:51:04,993 - main - INFO - 
2025-11-26 16:51:07,885 - main - INFO - 
2025-11-26 16:51:07,885 - main - INFO - ================================================================================
2025-11-26 16:51:07,885 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:51:07,886 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:51:07,886 - main - INFO - ================================================================================
2025-11-26 16:51:07,886 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:51:07,887 - main - INFO -   Upload Directory: uploads
2025-11-26 16:51:07,887 - main - INFO -   Max File Size: 20MB
2025-11-26 16:51:07,887 - main - INFO - ================================================================================
2025-11-26 16:51:07,887 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:51:07,888 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:51:07,888 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:51:07,915 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:51:07,923 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:51:07,923 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:51:07,924 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:51:07,924 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:51:07,924 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:51:07,931 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:51:07,933 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:51:07,935 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:51:07,937 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:51:07,937 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:51:07,938 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:51:07,938 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:51:07,938 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:51:07,945 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:51:07,945 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:51:07,945 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:51:07,946 - main - INFO - 
2025-11-26 16:51:07,946 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:51:07,946 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:51:07,946 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:51:07,947 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:51:07,947 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:51:07,947 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:51:07,947 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:51:07,948 - main - INFO - 
2025-11-26 16:51:07,948 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:51:07,948 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:51:07,948 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:51:07,948 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:51:07,949 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:51:07,949 - main - INFO - 
2025-11-26 16:51:07,949 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:51:07,950 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:51:07,950 - main - INFO -        - No manual section generation
2025-11-26 16:51:07,951 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:51:07,952 - main - INFO - 
2025-11-26 16:51:07,952 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:51:07,952 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:51:07,952 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:51:07,953 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:51:07,953 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:51:07,954 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:51:07,954 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:51:07,954 - main - INFO - 
2025-11-26 16:51:07,955 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:51:07,955 - main - INFO -      Main:
2025-11-26 16:51:07,955 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:51:07,955 - main - INFO - 
2025-11-26 16:51:07,956 - main - INFO -      Retrieval:
2025-11-26 16:51:07,956 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:51:07,956 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:51:07,956 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:51:07,957 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:51:07,957 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:51:07,957 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:51:07,957 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:51:07,957 - main - INFO - 
2025-11-26 16:51:07,957 - main - INFO -      Management:
2025-11-26 16:51:07,957 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:51:07,958 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:51:07,958 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:51:07,958 - main - INFO - 
2025-11-26 16:51:07,958 - main - INFO -      Documents (MongoDB):
2025-11-26 16:51:07,958 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:51:07,958 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:51:07,959 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:51:07,959 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:51:07,959 - main - INFO - 
2025-11-26 16:51:07,959 - main - INFO -      Diagnostics & Health:
2025-11-26 16:51:07,959 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:51:07,959 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:51:07,960 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:51:07,960 - main - INFO - 
2025-11-26 16:51:07,960 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:51:07,960 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:51:07,960 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:51:07,960 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:51:07,960 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:51:07,961 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:51:07,961 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:51:07,961 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:51:07,961 - main - INFO - 
2025-11-26 16:51:07,961 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:51:07,961 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:51:07,961 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:51:07,962 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:51:07,962 - main - INFO -      4. No re-upload needed!
2025-11-26 16:51:07,962 - main - INFO - 
2025-11-26 16:51:07,962 - main - INFO - ================================================================================
2025-11-26 16:51:07,963 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:51:07,963 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:51:07,963 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:51:07,963 - main - INFO - ================================================================================
2025-11-26 16:51:07,963 - main - INFO - 
2025-11-26 16:51:07,964 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:59:04,494 - main - INFO - 
2025-11-26 16:59:04,495 - main - INFO - ================================================================================
2025-11-26 16:59:04,495 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:59:04,496 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:04,496 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:59:04,497 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:04,497 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:59:04,498 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:59:04,498 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:59:04,498 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:59:04,499 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:59:04,499 - main - INFO - ================================================================================
2025-11-26 16:59:04,499 - main - INFO - 
2025-11-26 16:59:07,877 - main - INFO - 
2025-11-26 16:59:07,877 - main - INFO - ================================================================================
2025-11-26 16:59:07,878 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:59:07,878 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:59:07,878 - main - INFO - ================================================================================
2025-11-26 16:59:07,878 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:59:07,879 - main - INFO -   Upload Directory: uploads
2025-11-26 16:59:07,879 - main - INFO -   Max File Size: 20MB
2025-11-26 16:59:07,879 - main - INFO - ================================================================================
2025-11-26 16:59:07,880 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:59:07,880 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:59:07,881 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:59:07,913 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:59:07,921 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:59:07,922 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:59:07,922 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:59:07,922 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:07,923 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:59:07,936 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:59:07,938 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:59:07,940 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:59:07,942 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:59:07,942 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:59:07,943 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:59:07,943 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:07,943 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:59:07,958 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:59:07,959 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:59:07,960 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:59:07,960 - main - INFO - 
2025-11-26 16:59:07,960 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:59:07,960 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:59:07,960 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:59:07,961 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:59:07,961 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:59:07,961 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:59:07,961 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:59:07,961 - main - INFO - 
2025-11-26 16:59:07,962 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:59:07,962 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:59:07,962 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:59:07,962 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:59:07,962 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:59:07,962 - main - INFO - 
2025-11-26 16:59:07,963 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:59:07,963 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:59:07,963 - main - INFO -        - No manual section generation
2025-11-26 16:59:07,963 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:59:07,963 - main - INFO - 
2025-11-26 16:59:07,963 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:59:07,964 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:59:07,964 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:59:07,964 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:59:07,964 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:59:07,964 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:59:07,965 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:59:07,965 - main - INFO - 
2025-11-26 16:59:07,965 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:59:07,965 - main - INFO -      Main:
2025-11-26 16:59:07,965 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:59:07,966 - main - INFO - 
2025-11-26 16:59:07,966 - main - INFO -      Retrieval:
2025-11-26 16:59:07,966 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:59:07,967 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:59:07,967 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:59:07,967 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:59:07,968 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:59:07,968 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:59:07,968 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:59:07,968 - main - INFO - 
2025-11-26 16:59:07,969 - main - INFO -      Management:
2025-11-26 16:59:07,969 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:59:07,969 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:59:07,969 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:59:07,969 - main - INFO - 
2025-11-26 16:59:07,970 - main - INFO -      Documents (MongoDB):
2025-11-26 16:59:07,970 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:59:07,970 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:59:07,970 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:59:07,971 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:59:07,971 - main - INFO - 
2025-11-26 16:59:07,971 - main - INFO -      Diagnostics & Health:
2025-11-26 16:59:07,971 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:59:07,971 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:59:07,972 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:59:07,972 - main - INFO - 
2025-11-26 16:59:07,972 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:59:07,972 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:59:07,972 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:59:07,973 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:59:07,973 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:59:07,973 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:59:07,973 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:59:07,973 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:59:07,974 - main - INFO - 
2025-11-26 16:59:07,974 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:59:07,974 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:59:07,982 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:59:07,986 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:59:07,986 - main - INFO -      4. No re-upload needed!
2025-11-26 16:59:07,988 - main - INFO - 
2025-11-26 16:59:07,988 - main - INFO - ================================================================================
2025-11-26 16:59:07,989 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:59:07,989 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:59:07,989 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:59:07,990 - main - INFO - ================================================================================
2025-11-26 16:59:07,990 - main - INFO - 
2025-11-26 16:59:07,991 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:59:09,994 - main - INFO - 
2025-11-26 16:59:09,994 - main - INFO - ================================================================================
2025-11-26 16:59:09,995 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:59:09,996 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:09,997 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:59:09,998 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:09,998 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:59:09,999 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:59:10,000 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:59:10,000 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:59:10,001 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:59:10,001 - main - INFO - ================================================================================
2025-11-26 16:59:10,002 - main - INFO - 
2025-11-26 16:59:13,789 - main - INFO - 
2025-11-26 16:59:13,790 - main - INFO - ================================================================================
2025-11-26 16:59:13,790 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:59:13,790 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:59:13,791 - main - INFO - ================================================================================
2025-11-26 16:59:13,791 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:59:13,791 - main - INFO -   Upload Directory: uploads
2025-11-26 16:59:13,791 - main - INFO -   Max File Size: 20MB
2025-11-26 16:59:13,791 - main - INFO - ================================================================================
2025-11-26 16:59:13,792 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:59:13,792 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:59:13,792 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:59:13,834 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:59:13,844 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:59:13,845 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:59:13,845 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:59:13,845 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:13,846 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:59:13,861 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:59:13,862 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:59:13,863 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:59:13,865 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:59:13,865 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:59:13,865 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:59:13,867 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:13,868 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:59:13,879 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:59:13,879 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:59:13,879 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:59:13,880 - main - INFO - 
2025-11-26 16:59:13,880 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:59:13,880 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:59:13,880 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:59:13,880 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:59:13,881 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:59:13,881 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:59:13,881 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:59:13,881 - main - INFO - 
2025-11-26 16:59:13,881 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:59:13,882 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:59:13,882 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:59:13,882 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:59:13,882 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:59:13,883 - main - INFO - 
2025-11-26 16:59:13,884 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:59:13,884 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:59:13,885 - main - INFO -        - No manual section generation
2025-11-26 16:59:13,885 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:59:13,886 - main - INFO - 
2025-11-26 16:59:13,886 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:59:13,887 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:59:13,887 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:59:13,887 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:59:13,888 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:59:13,888 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:59:13,888 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:59:13,889 - main - INFO - 
2025-11-26 16:59:13,890 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:59:13,890 - main - INFO -      Main:
2025-11-26 16:59:13,890 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:59:13,891 - main - INFO - 
2025-11-26 16:59:13,891 - main - INFO -      Retrieval:
2025-11-26 16:59:13,891 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:59:13,891 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:59:13,892 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:59:13,892 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:59:13,892 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:59:13,892 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:59:13,893 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:59:13,893 - main - INFO - 
2025-11-26 16:59:13,893 - main - INFO -      Management:
2025-11-26 16:59:13,893 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:59:13,893 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:59:13,894 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:59:13,894 - main - INFO - 
2025-11-26 16:59:13,894 - main - INFO -      Documents (MongoDB):
2025-11-26 16:59:13,894 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:59:13,894 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:59:13,895 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:59:13,895 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:59:13,895 - main - INFO - 
2025-11-26 16:59:13,895 - main - INFO -      Diagnostics & Health:
2025-11-26 16:59:13,895 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:59:13,895 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:59:13,896 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:59:13,896 - main - INFO - 
2025-11-26 16:59:13,896 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:59:13,896 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:59:13,896 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:59:13,897 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:59:13,897 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:59:13,897 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:59:13,897 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:59:13,897 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:59:13,897 - main - INFO - 
2025-11-26 16:59:13,898 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:59:13,898 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:59:13,898 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:59:13,898 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:59:13,898 - main - INFO -      4. No re-upload needed!
2025-11-26 16:59:13,898 - main - INFO - 
2025-11-26 16:59:13,899 - main - INFO - ================================================================================
2025-11-26 16:59:13,899 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:59:13,899 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:59:13,900 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:59:13,901 - main - INFO - ================================================================================
2025-11-26 16:59:13,902 - main - INFO - 
2025-11-26 16:59:13,903 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:59:20,764 - main - INFO - 
2025-11-26 16:59:20,764 - main - INFO - ================================================================================
2025-11-26 16:59:20,765 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:59:20,769 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:20,769 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:59:20,770 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:20,771 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:59:20,772 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:59:20,772 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:59:20,773 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:59:20,773 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:59:20,773 - main - INFO - ================================================================================
2025-11-26 16:59:20,773 - main - INFO - 
2025-11-26 16:59:24,304 - main - INFO - 
2025-11-26 16:59:24,305 - main - INFO - ================================================================================
2025-11-26 16:59:24,305 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:59:24,306 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:59:24,306 - main - INFO - ================================================================================
2025-11-26 16:59:24,306 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:59:24,306 - main - INFO -   Upload Directory: uploads
2025-11-26 16:59:24,307 - main - INFO -   Max File Size: 20MB
2025-11-26 16:59:24,307 - main - INFO - ================================================================================
2025-11-26 16:59:24,307 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:59:24,308 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:59:24,308 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:59:24,348 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:59:24,364 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:59:24,365 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:59:24,366 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:59:24,367 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:24,368 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:59:24,388 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:59:24,390 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:59:24,392 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:59:24,395 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:59:24,396 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:59:24,396 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:59:24,396 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:24,397 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:59:24,426 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:59:24,426 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:59:24,426 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:59:24,427 - main - INFO - 
2025-11-26 16:59:24,427 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:59:24,427 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:59:24,427 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:59:24,427 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:59:24,428 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:59:24,428 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:59:24,428 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:59:24,428 - main - INFO - 
2025-11-26 16:59:24,428 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:59:24,428 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:59:24,429 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:59:24,429 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:59:24,429 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:59:24,429 - main - INFO - 
2025-11-26 16:59:24,430 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:59:24,430 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:59:24,430 - main - INFO -        - No manual section generation
2025-11-26 16:59:24,430 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:59:24,430 - main - INFO - 
2025-11-26 16:59:24,430 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:59:24,431 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:59:24,431 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:59:24,431 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:59:24,431 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:59:24,431 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:59:24,432 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:59:24,432 - main - INFO - 
2025-11-26 16:59:24,432 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:59:24,432 - main - INFO -      Main:
2025-11-26 16:59:24,432 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:59:24,433 - main - INFO - 
2025-11-26 16:59:24,433 - main - INFO -      Retrieval:
2025-11-26 16:59:24,434 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:59:24,435 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:59:24,435 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:59:24,436 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:59:24,436 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:59:24,436 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:59:24,436 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:59:24,437 - main - INFO - 
2025-11-26 16:59:24,437 - main - INFO -      Management:
2025-11-26 16:59:24,437 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:59:24,437 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:59:24,438 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:59:24,438 - main - INFO - 
2025-11-26 16:59:24,438 - main - INFO -      Documents (MongoDB):
2025-11-26 16:59:24,438 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:59:24,439 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:59:24,439 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:59:24,439 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:59:24,439 - main - INFO - 
2025-11-26 16:59:24,439 - main - INFO -      Diagnostics & Health:
2025-11-26 16:59:24,440 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:59:24,440 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:59:24,440 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:59:24,440 - main - INFO - 
2025-11-26 16:59:24,441 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:59:24,441 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:59:24,441 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:59:24,441 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:59:24,441 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:59:24,442 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:59:24,442 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:59:24,442 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:59:24,442 - main - INFO - 
2025-11-26 16:59:24,442 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:59:24,443 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:59:24,443 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:59:24,443 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:59:24,443 - main - INFO -      4. No re-upload needed!
2025-11-26 16:59:24,443 - main - INFO - 
2025-11-26 16:59:24,443 - main - INFO - ================================================================================
2025-11-26 16:59:24,444 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:59:24,444 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:59:24,444 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:59:24,444 - main - INFO - ================================================================================
2025-11-26 16:59:24,444 - main - INFO - 
2025-11-26 16:59:24,445 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:59:28,658 - main - INFO - 
2025-11-26 16:59:28,658 - main - INFO - ================================================================================
2025-11-26 16:59:28,658 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:59:28,659 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:28,660 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:59:28,661 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:28,661 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:59:28,662 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:59:28,663 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:59:28,663 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:59:28,663 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:59:28,664 - main - INFO - ================================================================================
2025-11-26 16:59:28,664 - main - INFO - 
2025-11-26 16:59:32,163 - main - INFO - 
2025-11-26 16:59:32,163 - main - INFO - ================================================================================
2025-11-26 16:59:32,163 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:59:32,163 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:59:32,164 - main - INFO - ================================================================================
2025-11-26 16:59:32,164 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:59:32,164 - main - INFO -   Upload Directory: uploads
2025-11-26 16:59:32,164 - main - INFO -   Max File Size: 20MB
2025-11-26 16:59:32,164 - main - INFO - ================================================================================
2025-11-26 16:59:32,165 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:59:32,165 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:59:32,165 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:59:32,216 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:59:32,229 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:59:32,230 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:59:32,230 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:59:32,231 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:32,231 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:59:32,256 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:59:32,258 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:59:32,259 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:59:32,261 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:59:32,261 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:59:32,262 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:59:32,262 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:32,262 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:59:32,274 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:59:32,275 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:59:32,275 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:59:32,275 - main - INFO - 
2025-11-26 16:59:32,275 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:59:32,276 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:59:32,276 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:59:32,276 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:59:32,276 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:59:32,276 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:59:32,276 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:59:32,277 - main - INFO - 
2025-11-26 16:59:32,277 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:59:32,277 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:59:32,277 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:59:32,277 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:59:32,278 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:59:32,278 - main - INFO - 
2025-11-26 16:59:32,278 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:59:32,278 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:59:32,278 - main - INFO -        - No manual section generation
2025-11-26 16:59:32,279 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:59:32,279 - main - INFO - 
2025-11-26 16:59:32,279 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:59:32,279 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:59:32,279 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:59:32,279 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:59:32,280 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:59:32,280 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:59:32,280 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:59:32,280 - main - INFO - 
2025-11-26 16:59:32,280 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:59:32,281 - main - INFO -      Main:
2025-11-26 16:59:32,281 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:59:32,281 - main - INFO - 
2025-11-26 16:59:32,281 - main - INFO -      Retrieval:
2025-11-26 16:59:32,281 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:59:32,282 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:59:32,282 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:59:32,282 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:59:32,283 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:59:32,284 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:59:32,284 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:59:32,285 - main - INFO - 
2025-11-26 16:59:32,286 - main - INFO -      Management:
2025-11-26 16:59:32,286 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:59:32,286 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:59:32,287 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:59:32,287 - main - INFO - 
2025-11-26 16:59:32,287 - main - INFO -      Documents (MongoDB):
2025-11-26 16:59:32,287 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:59:32,288 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:59:32,288 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:59:32,288 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:59:32,288 - main - INFO - 
2025-11-26 16:59:32,288 - main - INFO -      Diagnostics & Health:
2025-11-26 16:59:32,289 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:59:32,289 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:59:32,289 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:59:32,290 - main - INFO - 
2025-11-26 16:59:32,290 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:59:32,290 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:59:32,290 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:59:32,291 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:59:32,291 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:59:32,291 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:59:32,291 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:59:32,291 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:59:32,292 - main - INFO - 
2025-11-26 16:59:32,292 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:59:32,292 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:59:32,292 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:59:32,292 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:59:32,293 - main - INFO -      4. No re-upload needed!
2025-11-26 16:59:32,293 - main - INFO - 
2025-11-26 16:59:32,293 - main - INFO - ================================================================================
2025-11-26 16:59:32,293 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:59:32,294 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:59:32,294 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:59:32,294 - main - INFO - ================================================================================
2025-11-26 16:59:32,294 - main - INFO - 
2025-11-26 16:59:32,294 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:59:49,520 - main - INFO - 
2025-11-26 16:59:49,521 - main - INFO - ================================================================================
2025-11-26 16:59:49,521 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:59:49,523 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:49,523 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:59:49,524 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:49,525 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:59:49,526 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:59:49,526 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:59:49,527 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:59:49,527 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:59:49,528 - main - INFO - ================================================================================
2025-11-26 16:59:49,528 - main - INFO - 
2025-11-26 16:59:53,361 - main - INFO - 
2025-11-26 16:59:53,361 - main - INFO - ================================================================================
2025-11-26 16:59:53,362 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:59:53,362 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:59:53,362 - main - INFO - ================================================================================
2025-11-26 16:59:53,362 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:59:53,363 - main - INFO -   Upload Directory: uploads
2025-11-26 16:59:53,363 - main - INFO -   Max File Size: 20MB
2025-11-26 16:59:53,363 - main - INFO - ================================================================================
2025-11-26 16:59:53,363 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:59:53,364 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:59:53,364 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:59:53,387 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:59:53,392 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:59:53,392 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:59:53,393 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:59:53,393 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:53,393 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:59:53,406 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:59:53,407 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:59:53,409 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:59:53,411 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:59:53,412 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:59:53,412 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:59:53,413 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:53,413 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:59:53,422 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:59:53,423 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:59:53,423 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:59:53,423 - main - INFO - 
2025-11-26 16:59:53,424 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:59:53,424 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:59:53,425 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:59:53,425 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:59:53,425 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:59:53,426 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:59:53,426 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:59:53,426 - main - INFO - 
2025-11-26 16:59:53,426 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:59:53,426 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:59:53,427 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:59:53,427 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:59:53,428 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:59:53,428 - main - INFO - 
2025-11-26 16:59:53,428 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:59:53,428 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:59:53,428 - main - INFO -        - No manual section generation
2025-11-26 16:59:53,429 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:59:53,429 - main - INFO - 
2025-11-26 16:59:53,429 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:59:53,429 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:59:53,429 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:59:53,430 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:59:53,430 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:59:53,430 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:59:53,430 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:59:53,430 - main - INFO - 
2025-11-26 16:59:53,431 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:59:53,431 - main - INFO -      Main:
2025-11-26 16:59:53,431 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:59:53,431 - main - INFO - 
2025-11-26 16:59:53,431 - main - INFO -      Retrieval:
2025-11-26 16:59:53,432 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:59:53,432 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:59:53,432 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:59:53,432 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:59:53,432 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:59:53,433 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:59:53,433 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:59:53,434 - main - INFO - 
2025-11-26 16:59:53,434 - main - INFO -      Management:
2025-11-26 16:59:53,435 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:59:53,435 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:59:53,435 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:59:53,436 - main - INFO - 
2025-11-26 16:59:53,436 - main - INFO -      Documents (MongoDB):
2025-11-26 16:59:53,436 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:59:53,436 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:59:53,436 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:59:53,437 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:59:53,437 - main - INFO - 
2025-11-26 16:59:53,437 - main - INFO -      Diagnostics & Health:
2025-11-26 16:59:53,437 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:59:53,437 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:59:53,438 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:59:53,438 - main - INFO - 
2025-11-26 16:59:53,438 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:59:53,439 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:59:53,440 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:59:53,442 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:59:53,443 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:59:53,443 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:59:53,444 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:59:53,444 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:59:53,445 - main - INFO - 
2025-11-26 16:59:53,445 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:59:53,445 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:59:53,446 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:59:53,446 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:59:53,446 - main - INFO -      4. No re-upload needed!
2025-11-26 16:59:53,446 - main - INFO - 
2025-11-26 16:59:53,447 - main - INFO - ================================================================================
2025-11-26 16:59:53,447 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:59:53,447 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:59:53,448 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:59:53,448 - main - INFO - ================================================================================
2025-11-26 16:59:53,448 - main - INFO - 
2025-11-26 16:59:53,448 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 16:59:54,041 - main - INFO - 
2025-11-26 16:59:54,041 - main - INFO - ================================================================================
2025-11-26 16:59:54,041 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 16:59:54,042 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:54,042 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 16:59:54,043 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 16:59:54,043 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 16:59:54,044 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 16:59:54,044 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 16:59:54,044 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 16:59:54,045 - main - INFO -   âœ… Application stopped successfully
2025-11-26 16:59:54,045 - main - INFO - ================================================================================
2025-11-26 16:59:54,045 - main - INFO - 
2025-11-26 16:59:58,208 - main - INFO - 
2025-11-26 16:59:58,208 - main - INFO - ================================================================================
2025-11-26 16:59:58,208 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 16:59:58,208 - main - INFO -   Production-Ready Complete Integration
2025-11-26 16:59:58,209 - main - INFO - ================================================================================
2025-11-26 16:59:58,209 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 16:59:58,209 - main - INFO -   Upload Directory: uploads
2025-11-26 16:59:58,209 - main - INFO -   Max File Size: 20MB
2025-11-26 16:59:58,210 - main - INFO - ================================================================================
2025-11-26 16:59:58,210 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 16:59:58,210 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 16:59:58,210 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 16:59:58,257 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 16:59:58,262 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 16:59:58,262 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 16:59:58,263 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 16:59:58,263 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:58,263 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 16:59:58,274 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 16:59:58,276 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 16:59:58,277 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 16:59:58,278 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 16:59:58,278 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 16:59:58,279 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 16:59:58,279 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 16:59:58,279 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 16:59:58,298 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 16:59:58,298 - main - INFO -   âœ… User Documents Service connected
2025-11-26 16:59:58,298 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 16:59:58,299 - main - INFO - 
2025-11-26 16:59:58,299 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 16:59:58,299 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 16:59:58,299 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 16:59:58,299 - main - INFO -        - Separates warranties from extensions
2025-11-26 16:59:58,300 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 16:59:58,300 - main - INFO -        - Correct deductible tier detection
2025-11-26 16:59:58,300 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 16:59:58,300 - main - INFO - 
2025-11-26 16:59:58,300 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 16:59:58,301 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 16:59:58,301 - main - INFO -        - Identifies unique items per provider
2025-11-26 16:59:58,301 - main - INFO -        - Transparent scoring methodology
2025-11-26 16:59:58,301 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 16:59:58,301 - main - INFO - 
2025-11-26 16:59:58,302 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 16:59:58,302 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 16:59:58,302 - main - INFO -        - No manual section generation
2025-11-26 16:59:58,302 - main - INFO -        - Complete MongoDB integration
2025-11-26 16:59:58,302 - main - INFO - 
2025-11-26 16:59:58,303 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 16:59:58,303 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 16:59:58,304 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 16:59:58,304 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 16:59:58,305 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 16:59:58,306 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 16:59:58,307 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 16:59:58,307 - main - INFO - 
2025-11-26 16:59:58,307 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 16:59:58,308 - main - INFO -      Main:
2025-11-26 16:59:58,308 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 16:59:58,308 - main - INFO - 
2025-11-26 16:59:58,308 - main - INFO -      Retrieval:
2025-11-26 16:59:58,308 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 16:59:58,309 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 16:59:58,309 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 16:59:58,309 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 16:59:58,309 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 16:59:58,309 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 16:59:58,310 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 16:59:58,310 - main - INFO - 
2025-11-26 16:59:58,310 - main - INFO -      Management:
2025-11-26 16:59:58,310 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 16:59:58,310 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 16:59:58,310 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 16:59:58,311 - main - INFO - 
2025-11-26 16:59:58,311 - main - INFO -      Documents (MongoDB):
2025-11-26 16:59:58,311 - main - INFO -        GET  /api/documents                All documents
2025-11-26 16:59:58,311 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 16:59:58,311 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 16:59:58,311 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 16:59:58,311 - main - INFO - 
2025-11-26 16:59:58,311 - main - INFO -      Diagnostics & Health:
2025-11-26 16:59:58,312 - main - INFO -        GET  /api/health                   System health
2025-11-26 16:59:58,312 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 16:59:58,312 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 16:59:58,312 - main - INFO - 
2025-11-26 16:59:58,312 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 16:59:58,312 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 16:59:58,312 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 16:59:58,313 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 16:59:58,313 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 16:59:58,313 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 16:59:58,313 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 16:59:58,313 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 16:59:58,313 - main - INFO - 
2025-11-26 16:59:58,314 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 16:59:58,314 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 16:59:58,314 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 16:59:58,314 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 16:59:58,314 - main - INFO -      4. No re-upload needed!
2025-11-26 16:59:58,314 - main - INFO - 
2025-11-26 16:59:58,314 - main - INFO - ================================================================================
2025-11-26 16:59:58,315 - main - INFO -   âœ… Application started successfully!
2025-11-26 16:59:58,315 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 16:59:58,315 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 16:59:58,315 - main - INFO - ================================================================================
2025-11-26 16:59:58,315 - main - INFO - 
2025-11-26 16:59:58,316 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:00:02,263 - main - INFO - 
2025-11-26 17:00:02,264 - main - INFO - ================================================================================
2025-11-26 17:00:02,264 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:00:02,264 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:00:02,264 - main - INFO - ================================================================================
2025-11-26 17:00:02,264 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:00:02,265 - main - INFO -   Upload Directory: uploads
2025-11-26 17:00:02,265 - main - INFO -   Max File Size: 20MB
2025-11-26 17:00:02,265 - main - INFO - ================================================================================
2025-11-26 17:00:02,265 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:00:02,266 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:00:02,266 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:00:02,291 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:00:02,296 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:00:02,296 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:00:02,296 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:00:02,296 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:02,297 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:00:02,309 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:00:02,310 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:00:02,311 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:00:02,313 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:00:02,313 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:00:02,313 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:00:02,314 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:02,314 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:00:02,405 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:00:02,408 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:00:02,426 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:00:02,428 - main - INFO - 
2025-11-26 17:00:02,446 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:00:02,457 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:00:02,457 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:00:02,458 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:00:02,459 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:00:02,474 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:00:02,478 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:00:02,492 - main - INFO - 
2025-11-26 17:00:02,494 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:00:02,495 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:00:02,495 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:00:02,496 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:00:02,496 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:00:02,497 - main - INFO - 
2025-11-26 17:00:02,497 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:00:02,498 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:00:02,498 - main - INFO -        - No manual section generation
2025-11-26 17:00:02,498 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:00:02,500 - main - INFO - 
2025-11-26 17:00:02,508 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:00:02,508 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:00:02,524 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:00:02,524 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:00:02,524 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:00:02,525 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:00:02,525 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:00:02,525 - main - INFO - 
2025-11-26 17:00:02,525 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:00:02,526 - main - INFO -      Main:
2025-11-26 17:00:02,526 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:00:02,526 - main - INFO - 
2025-11-26 17:00:02,526 - main - INFO -      Retrieval:
2025-11-26 17:00:02,526 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:00:02,527 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:00:02,527 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:00:02,527 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:00:02,528 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:00:02,528 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:00:02,528 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:00:02,528 - main - INFO - 
2025-11-26 17:00:02,528 - main - INFO -      Management:
2025-11-26 17:00:02,529 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:00:02,529 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:00:02,529 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:00:02,529 - main - INFO - 
2025-11-26 17:00:02,530 - main - INFO -      Documents (MongoDB):
2025-11-26 17:00:02,530 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:00:02,530 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:00:02,530 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:00:02,531 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:00:02,531 - main - INFO - 
2025-11-26 17:00:02,531 - main - INFO -      Diagnostics & Health:
2025-11-26 17:00:02,531 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:00:02,531 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:00:02,532 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:00:02,532 - main - INFO - 
2025-11-26 17:00:02,532 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:00:02,533 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:00:02,533 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:00:02,534 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:00:02,535 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:00:02,536 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:00:02,536 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:00:02,537 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:00:02,537 - main - INFO - 
2025-11-26 17:00:02,537 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:00:02,537 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:00:02,538 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:00:02,538 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:00:02,538 - main - INFO -      4. No re-upload needed!
2025-11-26 17:00:02,538 - main - INFO - 
2025-11-26 17:00:02,539 - main - INFO - ================================================================================
2025-11-26 17:00:02,539 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:00:02,539 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:00:02,540 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:00:02,540 - main - INFO - ================================================================================
2025-11-26 17:00:02,540 - main - INFO - 
2025-11-26 17:00:02,541 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:00:05,887 - main - INFO - 
2025-11-26 17:00:05,888 - main - INFO - ================================================================================
2025-11-26 17:00:05,889 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:00:05,890 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:00:05,890 - main - INFO - ================================================================================
2025-11-26 17:00:05,890 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:00:05,891 - main - INFO -   Upload Directory: uploads
2025-11-26 17:00:05,891 - main - INFO -   Max File Size: 20MB
2025-11-26 17:00:05,891 - main - INFO - ================================================================================
2025-11-26 17:00:05,891 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:00:05,892 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:00:05,892 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:00:05,925 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:00:05,930 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:00:05,930 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:00:05,930 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:00:05,931 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:05,931 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:00:05,942 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:00:05,943 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:00:05,945 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:00:05,946 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:00:05,947 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:00:05,947 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:00:05,947 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:05,947 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:00:05,958 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:00:05,958 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:00:05,958 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:00:05,959 - main - INFO - 
2025-11-26 17:00:05,959 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:00:05,959 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:00:05,959 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:00:05,959 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:00:05,960 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:00:05,960 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:00:05,960 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:00:05,960 - main - INFO - 
2025-11-26 17:00:05,960 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:00:05,961 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:00:05,961 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:00:05,961 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:00:05,961 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:00:05,961 - main - INFO - 
2025-11-26 17:00:05,961 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:00:05,961 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:00:05,962 - main - INFO -        - No manual section generation
2025-11-26 17:00:05,962 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:00:05,962 - main - INFO - 
2025-11-26 17:00:05,962 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:00:05,962 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:00:05,962 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:00:05,962 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:00:05,963 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:00:05,963 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:00:05,963 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:00:05,963 - main - INFO - 
2025-11-26 17:00:05,963 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:00:05,963 - main - INFO -      Main:
2025-11-26 17:00:05,963 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:00:05,964 - main - INFO - 
2025-11-26 17:00:05,964 - main - INFO -      Retrieval:
2025-11-26 17:00:05,964 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:00:05,964 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:00:05,964 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:00:05,964 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:00:05,965 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:00:05,965 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:00:05,965 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:00:05,965 - main - INFO - 
2025-11-26 17:00:05,965 - main - INFO -      Management:
2025-11-26 17:00:05,965 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:00:05,966 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:00:05,966 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:00:05,966 - main - INFO - 
2025-11-26 17:00:05,966 - main - INFO -      Documents (MongoDB):
2025-11-26 17:00:05,966 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:00:05,967 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:00:05,967 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:00:05,967 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:00:05,967 - main - INFO - 
2025-11-26 17:00:05,967 - main - INFO -      Diagnostics & Health:
2025-11-26 17:00:05,968 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:00:05,968 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:00:05,968 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:00:05,969 - main - INFO - 
2025-11-26 17:00:05,970 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:00:05,970 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:00:05,971 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:00:05,972 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:00:05,973 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:00:05,973 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:00:05,974 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:00:05,974 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:00:05,974 - main - INFO - 
2025-11-26 17:00:05,975 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:00:05,975 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:00:05,975 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:00:05,975 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:00:05,975 - main - INFO -      4. No re-upload needed!
2025-11-26 17:00:05,976 - main - INFO - 
2025-11-26 17:00:05,976 - main - INFO - ================================================================================
2025-11-26 17:00:05,976 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:00:05,976 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:00:05,976 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:00:05,977 - main - INFO - ================================================================================
2025-11-26 17:00:05,977 - main - INFO - 
2025-11-26 17:00:05,977 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:00:24,266 - main - INFO - 
2025-11-26 17:00:24,266 - main - INFO - ================================================================================
2025-11-26 17:00:24,267 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:00:24,268 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:00:24,268 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:00:24,269 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:00:24,269 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:00:24,270 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:00:24,270 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:00:24,271 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:00:24,271 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:00:24,271 - main - INFO - ================================================================================
2025-11-26 17:00:24,271 - main - INFO - 
2025-11-26 17:00:28,042 - main - INFO - 
2025-11-26 17:00:28,042 - main - INFO - ================================================================================
2025-11-26 17:00:28,043 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:00:28,043 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:00:28,043 - main - INFO - ================================================================================
2025-11-26 17:00:28,043 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:00:28,043 - main - INFO -   Upload Directory: uploads
2025-11-26 17:00:28,044 - main - INFO -   Max File Size: 20MB
2025-11-26 17:00:28,044 - main - INFO - ================================================================================
2025-11-26 17:00:28,044 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:00:28,045 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:00:28,045 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:00:28,064 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:00:28,075 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:00:28,075 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:00:28,075 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:00:28,076 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:28,076 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:00:28,110 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:00:28,111 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:00:28,112 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:00:28,113 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:00:28,114 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:00:28,114 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:00:28,114 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:28,114 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:00:28,141 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:00:28,142 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:00:28,142 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:00:28,142 - main - INFO - 
2025-11-26 17:00:28,143 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:00:28,143 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:00:28,143 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:00:28,143 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:00:28,144 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:00:28,144 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:00:28,144 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:00:28,144 - main - INFO - 
2025-11-26 17:00:28,145 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:00:28,145 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:00:28,145 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:00:28,145 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:00:28,146 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:00:28,146 - main - INFO - 
2025-11-26 17:00:28,146 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:00:28,146 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:00:28,146 - main - INFO -        - No manual section generation
2025-11-26 17:00:28,147 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:00:28,147 - main - INFO - 
2025-11-26 17:00:28,147 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:00:28,147 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:00:28,147 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:00:28,148 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:00:28,148 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:00:28,148 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:00:28,148 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:00:28,148 - main - INFO - 
2025-11-26 17:00:28,149 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:00:28,149 - main - INFO -      Main:
2025-11-26 17:00:28,149 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:00:28,150 - main - INFO - 
2025-11-26 17:00:28,151 - main - INFO -      Retrieval:
2025-11-26 17:00:28,153 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:00:28,154 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:00:28,154 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:00:28,155 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:00:28,156 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:00:28,157 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:00:28,157 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:00:28,157 - main - INFO - 
2025-11-26 17:00:28,158 - main - INFO -      Management:
2025-11-26 17:00:28,158 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:00:28,158 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:00:28,159 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:00:28,159 - main - INFO - 
2025-11-26 17:00:28,159 - main - INFO -      Documents (MongoDB):
2025-11-26 17:00:28,159 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:00:28,160 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:00:28,160 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:00:28,160 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:00:28,160 - main - INFO - 
2025-11-26 17:00:28,161 - main - INFO -      Diagnostics & Health:
2025-11-26 17:00:28,161 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:00:28,161 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:00:28,161 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:00:28,162 - main - INFO - 
2025-11-26 17:00:28,162 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:00:28,163 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:00:28,163 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:00:28,163 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:00:28,163 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:00:28,164 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:00:28,164 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:00:28,164 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:00:28,164 - main - INFO - 
2025-11-26 17:00:28,165 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:00:28,165 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:00:28,165 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:00:28,165 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:00:28,166 - main - INFO -      4. No re-upload needed!
2025-11-26 17:00:28,168 - main - INFO - 
2025-11-26 17:00:28,169 - main - INFO - ================================================================================
2025-11-26 17:00:28,170 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:00:28,171 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:00:28,172 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:00:28,172 - main - INFO - ================================================================================
2025-11-26 17:00:28,175 - main - INFO - 
2025-11-26 17:00:28,175 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:00:29,345 - main - INFO - 
2025-11-26 17:00:29,346 - main - INFO - ================================================================================
2025-11-26 17:00:29,346 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:00:29,348 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:00:29,349 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:00:29,352 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:00:29,353 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:00:29,354 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:00:29,354 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:00:29,355 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:00:29,355 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:00:29,355 - main - INFO - ================================================================================
2025-11-26 17:00:29,356 - main - INFO - 
2025-11-26 17:00:33,107 - main - INFO - 
2025-11-26 17:00:33,108 - main - INFO - ================================================================================
2025-11-26 17:00:33,108 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:00:33,109 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:00:33,109 - main - INFO - ================================================================================
2025-11-26 17:00:33,109 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:00:33,109 - main - INFO -   Upload Directory: uploads
2025-11-26 17:00:33,109 - main - INFO -   Max File Size: 20MB
2025-11-26 17:00:33,110 - main - INFO - ================================================================================
2025-11-26 17:00:33,110 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:00:33,110 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:00:33,111 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:00:33,145 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:00:33,153 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:00:33,154 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:00:33,154 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:00:33,155 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:33,155 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:00:33,163 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:00:33,164 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:00:33,165 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:00:33,170 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:00:33,170 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:00:33,171 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:00:33,171 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:00:33,172 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:00:33,179 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:00:33,180 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:00:33,180 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:00:33,180 - main - INFO - 
2025-11-26 17:00:33,180 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:00:33,180 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:00:33,181 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:00:33,181 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:00:33,181 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:00:33,181 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:00:33,181 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:00:33,181 - main - INFO - 
2025-11-26 17:00:33,182 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:00:33,182 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:00:33,182 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:00:33,182 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:00:33,183 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:00:33,185 - main - INFO - 
2025-11-26 17:00:33,185 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:00:33,186 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:00:33,186 - main - INFO -        - No manual section generation
2025-11-26 17:00:33,187 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:00:33,187 - main - INFO - 
2025-11-26 17:00:33,187 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:00:33,188 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:00:33,188 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:00:33,189 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:00:33,190 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:00:33,191 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:00:33,191 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:00:33,192 - main - INFO - 
2025-11-26 17:00:33,192 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:00:33,192 - main - INFO -      Main:
2025-11-26 17:00:33,192 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:00:33,193 - main - INFO - 
2025-11-26 17:00:33,193 - main - INFO -      Retrieval:
2025-11-26 17:00:33,193 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:00:33,193 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:00:33,194 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:00:33,194 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:00:33,194 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:00:33,194 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:00:33,195 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:00:33,195 - main - INFO - 
2025-11-26 17:00:33,195 - main - INFO -      Management:
2025-11-26 17:00:33,195 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:00:33,195 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:00:33,196 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:00:33,196 - main - INFO - 
2025-11-26 17:00:33,196 - main - INFO -      Documents (MongoDB):
2025-11-26 17:00:33,196 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:00:33,196 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:00:33,196 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:00:33,197 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:00:33,197 - main - INFO - 
2025-11-26 17:00:33,197 - main - INFO -      Diagnostics & Health:
2025-11-26 17:00:33,197 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:00:33,197 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:00:33,197 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:00:33,198 - main - INFO - 
2025-11-26 17:00:33,198 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:00:33,198 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:00:33,198 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:00:33,198 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:00:33,198 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:00:33,198 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:00:33,199 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:00:33,199 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:00:33,199 - main - INFO - 
2025-11-26 17:00:33,200 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:00:33,200 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:00:33,201 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:00:33,202 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:00:33,202 - main - INFO -      4. No re-upload needed!
2025-11-26 17:00:33,203 - main - INFO - 
2025-11-26 17:00:33,203 - main - INFO - ================================================================================
2025-11-26 17:00:33,203 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:00:33,204 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:00:33,204 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:00:33,204 - main - INFO - ================================================================================
2025-11-26 17:00:33,204 - main - INFO - 
2025-11-26 17:00:33,205 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:01:14,669 - main - INFO - 
2025-11-26 17:01:14,669 - main - INFO - ================================================================================
2025-11-26 17:01:14,669 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:01:14,670 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:01:14,670 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:01:14,671 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:01:14,671 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:01:14,672 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:01:14,672 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:01:14,673 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:01:14,673 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:01:14,673 - main - INFO - ================================================================================
2025-11-26 17:01:14,673 - main - INFO - 
2025-11-26 17:01:18,707 - main - INFO - 
2025-11-26 17:01:18,707 - main - INFO - ================================================================================
2025-11-26 17:01:18,708 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:01:18,708 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:01:18,708 - main - INFO - ================================================================================
2025-11-26 17:01:18,708 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:01:18,708 - main - INFO -   Upload Directory: uploads
2025-11-26 17:01:18,709 - main - INFO -   Max File Size: 20MB
2025-11-26 17:01:18,709 - main - INFO - ================================================================================
2025-11-26 17:01:18,709 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:01:18,709 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:01:18,710 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:01:18,759 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:01:18,772 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:01:18,773 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:01:18,773 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:01:18,773 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:18,774 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:01:18,787 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:01:18,788 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:01:18,789 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:01:18,791 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:01:18,792 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:01:18,792 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:01:18,792 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:18,793 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:01:18,803 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:01:18,804 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:01:18,804 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:01:18,804 - main - INFO - 
2025-11-26 17:01:18,804 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:01:18,805 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:01:18,805 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:01:18,805 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:01:18,805 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:01:18,806 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:01:18,806 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:01:18,806 - main - INFO - 
2025-11-26 17:01:18,806 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:01:18,806 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:01:18,807 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:01:18,807 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:01:18,807 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:01:18,807 - main - INFO - 
2025-11-26 17:01:18,807 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:01:18,807 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:01:18,808 - main - INFO -        - No manual section generation
2025-11-26 17:01:18,808 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:01:18,808 - main - INFO - 
2025-11-26 17:01:18,808 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:01:18,809 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:01:18,809 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:01:18,809 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:01:18,810 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:01:18,810 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:01:18,810 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:01:18,810 - main - INFO - 
2025-11-26 17:01:18,810 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:01:18,811 - main - INFO -      Main:
2025-11-26 17:01:18,811 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:01:18,811 - main - INFO - 
2025-11-26 17:01:18,811 - main - INFO -      Retrieval:
2025-11-26 17:01:18,811 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:01:18,811 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:01:18,812 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:01:18,812 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:01:18,812 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:01:18,812 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:01:18,812 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:01:18,813 - main - INFO - 
2025-11-26 17:01:18,813 - main - INFO -      Management:
2025-11-26 17:01:18,813 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:01:18,813 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:01:18,813 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:01:18,813 - main - INFO - 
2025-11-26 17:01:18,814 - main - INFO -      Documents (MongoDB):
2025-11-26 17:01:18,814 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:01:18,814 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:01:18,814 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:01:18,814 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:01:18,814 - main - INFO - 
2025-11-26 17:01:18,815 - main - INFO -      Diagnostics & Health:
2025-11-26 17:01:18,815 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:01:18,815 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:01:18,815 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:01:18,815 - main - INFO - 
2025-11-26 17:01:18,815 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:01:18,816 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:01:18,816 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:01:18,816 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:01:18,817 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:01:18,817 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:01:18,818 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:01:18,818 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:01:18,819 - main - INFO - 
2025-11-26 17:01:18,819 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:01:18,820 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:01:18,820 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:01:18,820 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:01:18,820 - main - INFO -      4. No re-upload needed!
2025-11-26 17:01:18,820 - main - INFO - 
2025-11-26 17:01:18,821 - main - INFO - ================================================================================
2025-11-26 17:01:18,821 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:01:18,821 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:01:18,821 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:01:18,821 - main - INFO - ================================================================================
2025-11-26 17:01:18,822 - main - INFO - 
2025-11-26 17:01:18,822 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:01:20,292 - main - INFO - 
2025-11-26 17:01:20,292 - main - INFO - ================================================================================
2025-11-26 17:01:20,293 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:01:20,295 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:01:20,296 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:01:20,298 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:01:20,299 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:01:20,303 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:01:20,304 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:01:20,305 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:01:20,306 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:01:20,312 - main - INFO - ================================================================================
2025-11-26 17:01:20,313 - main - INFO - 
2025-11-26 17:01:24,457 - main - INFO - 
2025-11-26 17:01:24,457 - main - INFO - ================================================================================
2025-11-26 17:01:24,458 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:01:24,458 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:01:24,458 - main - INFO - ================================================================================
2025-11-26 17:01:24,459 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:01:24,459 - main - INFO -   Upload Directory: uploads
2025-11-26 17:01:24,459 - main - INFO -   Max File Size: 20MB
2025-11-26 17:01:24,459 - main - INFO - ================================================================================
2025-11-26 17:01:24,460 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:01:24,460 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:01:24,460 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:01:24,497 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:01:24,505 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:01:24,506 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:01:24,507 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:01:24,509 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:24,509 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:01:24,518 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:01:24,520 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:01:24,521 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:01:24,523 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:01:24,524 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:01:24,524 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:01:24,524 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:24,525 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:01:24,540 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:01:24,541 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:01:24,541 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:01:24,541 - main - INFO - 
2025-11-26 17:01:24,541 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:01:24,542 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:01:24,542 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:01:24,542 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:01:24,542 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:01:24,542 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:01:24,542 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:01:24,543 - main - INFO - 
2025-11-26 17:01:24,543 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:01:24,543 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:01:24,543 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:01:24,543 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:01:24,544 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:01:24,544 - main - INFO - 
2025-11-26 17:01:24,544 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:01:24,544 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:01:24,544 - main - INFO -        - No manual section generation
2025-11-26 17:01:24,545 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:01:24,545 - main - INFO - 
2025-11-26 17:01:24,545 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:01:24,545 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:01:24,546 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:01:24,546 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:01:24,546 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:01:24,546 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:01:24,546 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:01:24,547 - main - INFO - 
2025-11-26 17:01:24,547 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:01:24,547 - main - INFO -      Main:
2025-11-26 17:01:24,547 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:01:24,548 - main - INFO - 
2025-11-26 17:01:24,548 - main - INFO -      Retrieval:
2025-11-26 17:01:24,548 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:01:24,548 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:01:24,548 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:01:24,549 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:01:24,549 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:01:24,549 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:01:24,549 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:01:24,550 - main - INFO - 
2025-11-26 17:01:24,550 - main - INFO -      Management:
2025-11-26 17:01:24,550 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:01:24,550 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:01:24,551 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:01:24,551 - main - INFO - 
2025-11-26 17:01:24,551 - main - INFO -      Documents (MongoDB):
2025-11-26 17:01:24,551 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:01:24,552 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:01:24,552 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:01:24,552 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:01:24,552 - main - INFO - 
2025-11-26 17:01:24,553 - main - INFO -      Diagnostics & Health:
2025-11-26 17:01:24,553 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:01:24,553 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:01:24,553 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:01:24,554 - main - INFO - 
2025-11-26 17:01:24,554 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:01:24,554 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:01:24,554 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:01:24,554 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:01:24,555 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:01:24,555 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:01:24,555 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:01:24,555 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:01:24,555 - main - INFO - 
2025-11-26 17:01:24,556 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:01:24,556 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:01:24,556 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:01:24,556 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:01:24,557 - main - INFO -      4. No re-upload needed!
2025-11-26 17:01:24,557 - main - INFO - 
2025-11-26 17:01:24,557 - main - INFO - ================================================================================
2025-11-26 17:01:24,558 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:01:24,558 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:01:24,559 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:01:24,559 - main - INFO - ================================================================================
2025-11-26 17:01:24,560 - main - INFO - 
2025-11-26 17:01:24,560 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:01:26,179 - main - INFO - 
2025-11-26 17:01:26,181 - main - INFO - ================================================================================
2025-11-26 17:01:26,181 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:01:26,183 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:01:26,186 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:01:26,192 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:01:26,193 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:01:26,194 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:01:26,195 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:01:26,195 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:01:26,196 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:01:26,196 - main - INFO - ================================================================================
2025-11-26 17:01:26,196 - main - INFO - 
2025-11-26 17:01:31,684 - main - INFO - 
2025-11-26 17:01:31,684 - main - INFO - ================================================================================
2025-11-26 17:01:31,685 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:01:31,685 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:01:31,685 - main - INFO - ================================================================================
2025-11-26 17:01:31,686 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:01:31,686 - main - INFO -   Upload Directory: uploads
2025-11-26 17:01:31,687 - main - INFO -   Max File Size: 20MB
2025-11-26 17:01:31,687 - main - INFO - ================================================================================
2025-11-26 17:01:31,688 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:01:31,688 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:01:31,688 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:01:31,752 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:01:31,765 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:01:31,766 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:01:31,766 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:01:31,767 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:31,767 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:01:31,778 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:01:31,780 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:01:31,782 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:01:31,788 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:01:31,789 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:01:31,789 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:01:31,790 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:31,790 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:01:31,802 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:01:31,803 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:01:31,803 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:01:31,804 - main - INFO - 
2025-11-26 17:01:31,804 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:01:31,804 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:01:31,805 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:01:31,805 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:01:31,807 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:01:31,807 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:01:31,808 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:01:31,808 - main - INFO - 
2025-11-26 17:01:31,808 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:01:31,808 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:01:31,809 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:01:31,809 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:01:31,809 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:01:31,810 - main - INFO - 
2025-11-26 17:01:31,810 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:01:31,811 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:01:31,811 - main - INFO -        - No manual section generation
2025-11-26 17:01:31,811 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:01:31,811 - main - INFO - 
2025-11-26 17:01:31,812 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:01:31,812 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:01:31,812 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:01:31,812 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:01:31,813 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:01:31,813 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:01:31,813 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:01:31,813 - main - INFO - 
2025-11-26 17:01:31,814 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:01:31,814 - main - INFO -      Main:
2025-11-26 17:01:31,814 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:01:31,815 - main - INFO - 
2025-11-26 17:01:31,815 - main - INFO -      Retrieval:
2025-11-26 17:01:31,815 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:01:31,816 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:01:31,816 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:01:31,816 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:01:31,817 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:01:31,817 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:01:31,817 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:01:31,818 - main - INFO - 
2025-11-26 17:01:31,818 - main - INFO -      Management:
2025-11-26 17:01:31,818 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:01:31,818 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:01:31,819 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:01:31,819 - main - INFO - 
2025-11-26 17:01:31,819 - main - INFO -      Documents (MongoDB):
2025-11-26 17:01:31,820 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:01:31,820 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:01:31,820 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:01:31,820 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:01:31,820 - main - INFO - 
2025-11-26 17:01:31,821 - main - INFO -      Diagnostics & Health:
2025-11-26 17:01:31,821 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:01:31,821 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:01:31,821 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:01:31,822 - main - INFO - 
2025-11-26 17:01:31,822 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:01:31,822 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:01:31,822 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:01:31,822 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:01:31,823 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:01:31,823 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:01:31,823 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:01:31,823 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:01:31,824 - main - INFO - 
2025-11-26 17:01:31,824 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:01:31,824 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:01:31,824 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:01:31,824 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:01:31,825 - main - INFO -      4. No re-upload needed!
2025-11-26 17:01:31,825 - main - INFO - 
2025-11-26 17:01:31,825 - main - INFO - ================================================================================
2025-11-26 17:01:31,826 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:01:31,826 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:01:31,826 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:01:31,826 - main - INFO - ================================================================================
2025-11-26 17:01:31,827 - main - INFO - 
2025-11-26 17:01:31,827 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:01:36,116 - main - INFO - 
2025-11-26 17:01:36,117 - main - INFO - ================================================================================
2025-11-26 17:01:36,118 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:01:36,119 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:01:36,119 - main - INFO - ================================================================================
2025-11-26 17:01:36,120 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:01:36,120 - main - INFO -   Upload Directory: uploads
2025-11-26 17:01:36,120 - main - INFO -   Max File Size: 20MB
2025-11-26 17:01:36,120 - main - INFO - ================================================================================
2025-11-26 17:01:36,121 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:01:36,122 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:01:36,122 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:01:36,144 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:01:36,149 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:01:36,149 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:01:36,149 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:01:36,150 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:36,151 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:01:36,160 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:01:36,161 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:01:36,162 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:01:36,164 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:01:36,164 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:01:36,165 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:01:36,165 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:01:36,165 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:01:36,176 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:01:36,176 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:01:36,176 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:01:36,177 - main - INFO - 
2025-11-26 17:01:36,177 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:01:36,177 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:01:36,177 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:01:36,177 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:01:36,177 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:01:36,178 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:01:36,178 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:01:36,178 - main - INFO - 
2025-11-26 17:01:36,178 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:01:36,178 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:01:36,178 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:01:36,178 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:01:36,179 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:01:36,179 - main - INFO - 
2025-11-26 17:01:36,179 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:01:36,179 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:01:36,179 - main - INFO -        - No manual section generation
2025-11-26 17:01:36,179 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:01:36,180 - main - INFO - 
2025-11-26 17:01:36,180 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:01:36,180 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:01:36,180 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:01:36,180 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:01:36,180 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:01:36,180 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:01:36,181 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:01:36,181 - main - INFO - 
2025-11-26 17:01:36,181 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:01:36,181 - main - INFO -      Main:
2025-11-26 17:01:36,181 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:01:36,181 - main - INFO - 
2025-11-26 17:01:36,181 - main - INFO -      Retrieval:
2025-11-26 17:01:36,182 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:01:36,182 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:01:36,182 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:01:36,182 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:01:36,182 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:01:36,183 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:01:36,183 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:01:36,183 - main - INFO - 
2025-11-26 17:01:36,184 - main - INFO -      Management:
2025-11-26 17:01:36,184 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:01:36,185 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:01:36,185 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:01:36,186 - main - INFO - 
2025-11-26 17:01:36,186 - main - INFO -      Documents (MongoDB):
2025-11-26 17:01:36,186 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:01:36,186 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:01:36,187 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:01:36,187 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:01:36,187 - main - INFO - 
2025-11-26 17:01:36,187 - main - INFO -      Diagnostics & Health:
2025-11-26 17:01:36,188 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:01:36,188 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:01:36,188 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:01:36,188 - main - INFO - 
2025-11-26 17:01:36,188 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:01:36,189 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:01:36,189 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:01:36,189 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:01:36,189 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:01:36,190 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:01:36,190 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:01:36,190 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:01:36,190 - main - INFO - 
2025-11-26 17:01:36,190 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:01:36,190 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:01:36,191 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:01:36,191 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:01:36,191 - main - INFO -      4. No re-upload needed!
2025-11-26 17:01:36,191 - main - INFO - 
2025-11-26 17:01:36,191 - main - INFO - ================================================================================
2025-11-26 17:01:36,191 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:01:36,192 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:01:36,192 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:01:36,192 - main - INFO - ================================================================================
2025-11-26 17:01:36,192 - main - INFO - 
2025-11-26 17:01:36,192 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:02:00,829 - main - INFO - 
2025-11-26 17:02:00,829 - main - INFO - ================================================================================
2025-11-26 17:02:00,830 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:02:00,831 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:02:00,831 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:02:00,832 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:02:00,833 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:02:00,834 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:02:00,834 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:02:00,835 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:02:00,835 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:02:00,835 - main - INFO - ================================================================================
2025-11-26 17:02:00,835 - main - INFO - 
2025-11-26 17:02:04,978 - main - INFO - 
2025-11-26 17:02:04,978 - main - INFO - ================================================================================
2025-11-26 17:02:04,979 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:02:04,979 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:02:04,979 - main - INFO - ================================================================================
2025-11-26 17:02:04,979 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:02:04,980 - main - INFO -   Upload Directory: uploads
2025-11-26 17:02:04,980 - main - INFO -   Max File Size: 20MB
2025-11-26 17:02:04,980 - main - INFO - ================================================================================
2025-11-26 17:02:04,980 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:02:04,981 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:02:04,981 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:02:05,001 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:02:05,009 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:02:05,009 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:02:05,010 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:02:05,010 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:02:05,010 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:02:05,018 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:02:05,019 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:02:05,021 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:02:05,023 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:02:05,023 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:02:05,023 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:02:05,024 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:02:05,024 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:02:05,031 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:02:05,031 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:02:05,032 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:02:05,032 - main - INFO - 
2025-11-26 17:02:05,032 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:02:05,033 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:02:05,033 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:02:05,033 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:02:05,033 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:02:05,034 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:02:05,034 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:02:05,034 - main - INFO - 
2025-11-26 17:02:05,034 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:02:05,034 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:02:05,035 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:02:05,035 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:02:05,035 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:02:05,035 - main - INFO - 
2025-11-26 17:02:05,035 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:02:05,036 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:02:05,036 - main - INFO -        - No manual section generation
2025-11-26 17:02:05,036 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:02:05,036 - main - INFO - 
2025-11-26 17:02:05,036 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:02:05,037 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:02:05,037 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:02:05,037 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:02:05,037 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:02:05,037 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:02:05,037 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:02:05,038 - main - INFO - 
2025-11-26 17:02:05,038 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:02:05,038 - main - INFO -      Main:
2025-11-26 17:02:05,038 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:02:05,038 - main - INFO - 
2025-11-26 17:02:05,038 - main - INFO -      Retrieval:
2025-11-26 17:02:05,039 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:02:05,039 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:02:05,039 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:02:05,039 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:02:05,039 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:02:05,040 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:02:05,040 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:02:05,040 - main - INFO - 
2025-11-26 17:02:05,040 - main - INFO -      Management:
2025-11-26 17:02:05,040 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:02:05,041 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:02:05,041 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:02:05,041 - main - INFO - 
2025-11-26 17:02:05,041 - main - INFO -      Documents (MongoDB):
2025-11-26 17:02:05,041 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:02:05,041 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:02:05,042 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:02:05,042 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:02:05,042 - main - INFO - 
2025-11-26 17:02:05,042 - main - INFO -      Diagnostics & Health:
2025-11-26 17:02:05,042 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:02:05,042 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:02:05,043 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:02:05,043 - main - INFO - 
2025-11-26 17:02:05,043 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:02:05,043 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:02:05,043 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:02:05,044 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:02:05,044 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:02:05,044 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:02:05,044 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:02:05,044 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:02:05,045 - main - INFO - 
2025-11-26 17:02:05,045 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:02:05,045 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:02:05,045 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:02:05,045 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:02:05,046 - main - INFO -      4. No re-upload needed!
2025-11-26 17:02:05,046 - main - INFO - 
2025-11-26 17:02:05,046 - main - INFO - ================================================================================
2025-11-26 17:02:05,046 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:02:05,046 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:02:05,047 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:02:05,047 - main - INFO - ================================================================================
2025-11-26 17:02:05,047 - main - INFO - 
2025-11-26 17:02:05,047 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:02:08,661 - main - INFO - 
2025-11-26 17:02:08,661 - main - INFO - ================================================================================
2025-11-26 17:02:08,661 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:02:08,661 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:02:08,662 - main - INFO - ================================================================================
2025-11-26 17:02:08,662 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:02:08,662 - main - INFO -   Upload Directory: uploads
2025-11-26 17:02:08,662 - main - INFO -   Max File Size: 20MB
2025-11-26 17:02:08,663 - main - INFO - ================================================================================
2025-11-26 17:02:08,663 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:02:08,663 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:02:08,664 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:02:08,714 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:02:08,724 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:02:08,724 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:02:08,724 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:02:08,725 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:02:08,725 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:02:08,747 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:02:08,748 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:02:08,749 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:02:08,753 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:02:08,753 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:02:08,754 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:02:08,754 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:02:08,754 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:02:08,793 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:02:08,793 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:02:08,793 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:02:08,794 - main - INFO - 
2025-11-26 17:02:08,794 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:02:08,794 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:02:08,794 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:02:08,794 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:02:08,795 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:02:08,795 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:02:08,795 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:02:08,795 - main - INFO - 
2025-11-26 17:02:08,796 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:02:08,796 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:02:08,796 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:02:08,796 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:02:08,796 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:02:08,797 - main - INFO - 
2025-11-26 17:02:08,797 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:02:08,797 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:02:08,797 - main - INFO -        - No manual section generation
2025-11-26 17:02:08,797 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:02:08,798 - main - INFO - 
2025-11-26 17:02:08,798 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:02:08,798 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:02:08,798 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:02:08,799 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:02:08,799 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:02:08,799 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:02:08,800 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:02:08,801 - main - INFO - 
2025-11-26 17:02:08,801 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:02:08,802 - main - INFO -      Main:
2025-11-26 17:02:08,803 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:02:08,803 - main - INFO - 
2025-11-26 17:02:08,804 - main - INFO -      Retrieval:
2025-11-26 17:02:08,804 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:02:08,805 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:02:08,805 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:02:08,805 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:02:08,806 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:02:08,806 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:02:08,806 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:02:08,807 - main - INFO - 
2025-11-26 17:02:08,807 - main - INFO -      Management:
2025-11-26 17:02:08,807 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:02:08,808 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:02:08,808 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:02:08,808 - main - INFO - 
2025-11-26 17:02:08,808 - main - INFO -      Documents (MongoDB):
2025-11-26 17:02:08,808 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:02:08,809 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:02:08,809 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:02:08,809 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:02:08,809 - main - INFO - 
2025-11-26 17:02:08,809 - main - INFO -      Diagnostics & Health:
2025-11-26 17:02:08,810 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:02:08,810 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:02:08,810 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:02:08,810 - main - INFO - 
2025-11-26 17:02:08,810 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:02:08,811 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:02:08,811 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:02:08,811 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:02:08,811 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:02:08,811 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:02:08,812 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:02:08,812 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:02:08,812 - main - INFO - 
2025-11-26 17:02:08,812 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:02:08,812 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:02:08,813 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:02:08,813 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:02:08,813 - main - INFO -      4. No re-upload needed!
2025-11-26 17:02:08,813 - main - INFO - 
2025-11-26 17:02:08,814 - main - INFO - ================================================================================
2025-11-26 17:02:08,814 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:02:08,814 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:02:08,815 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:02:08,815 - main - INFO - ================================================================================
2025-11-26 17:02:08,815 - main - INFO - 
2025-11-26 17:02:08,815 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:04:01,480 - main - INFO - 
2025-11-26 17:04:01,490 - main - INFO - ================================================================================
2025-11-26 17:04:01,498 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:04:01,500 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:04:01,501 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:04:01,502 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:04:01,502 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:04:01,503 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:04:01,504 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:04:01,505 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:04:01,505 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:04:01,505 - main - INFO - ================================================================================
2025-11-26 17:04:01,506 - main - INFO - 
2025-11-26 17:04:04,266 - main - INFO - 
2025-11-26 17:04:04,267 - main - INFO - ================================================================================
2025-11-26 17:04:04,267 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:04:04,267 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:04:04,267 - main - INFO - ================================================================================
2025-11-26 17:04:04,268 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:04:04,268 - main - INFO -   Upload Directory: uploads
2025-11-26 17:04:04,268 - main - INFO -   Max File Size: 20MB
2025-11-26 17:04:04,268 - main - INFO - ================================================================================
2025-11-26 17:04:04,269 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:04:04,269 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:04:04,270 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:04:04,292 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:04:04,297 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:04:04,297 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:04:04,297 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:04:04,298 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:04:04,298 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:04:04,330 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:04:04,331 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:04:04,331 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:04:04,334 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:04:04,335 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:04:04,335 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:04:04,335 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:04:04,335 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:04:04,375 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:04:04,376 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:04:04,376 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:04:04,376 - main - INFO - 
2025-11-26 17:04:04,376 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:04:04,376 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:04:04,377 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:04:04,377 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:04:04,377 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:04:04,377 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:04:04,377 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:04:04,377 - main - INFO - 
2025-11-26 17:04:04,378 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:04:04,378 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:04:04,378 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:04:04,378 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:04:04,378 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:04:04,379 - main - INFO - 
2025-11-26 17:04:04,379 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:04:04,379 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:04:04,379 - main - INFO -        - No manual section generation
2025-11-26 17:04:04,379 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:04:04,379 - main - INFO - 
2025-11-26 17:04:04,379 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:04:04,380 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:04:04,380 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:04:04,380 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:04:04,380 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:04:04,380 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:04:04,380 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:04:04,380 - main - INFO - 
2025-11-26 17:04:04,381 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:04:04,381 - main - INFO -      Main:
2025-11-26 17:04:04,381 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:04:04,381 - main - INFO - 
2025-11-26 17:04:04,381 - main - INFO -      Retrieval:
2025-11-26 17:04:04,381 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:04:04,382 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:04:04,382 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:04:04,382 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:04:04,382 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:04:04,382 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:04:04,383 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:04:04,383 - main - INFO - 
2025-11-26 17:04:04,383 - main - INFO -      Management:
2025-11-26 17:04:04,384 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:04:04,384 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:04:04,384 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:04:04,385 - main - INFO - 
2025-11-26 17:04:04,385 - main - INFO -      Documents (MongoDB):
2025-11-26 17:04:04,385 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:04:04,385 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:04:04,385 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:04:04,386 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:04:04,386 - main - INFO - 
2025-11-26 17:04:04,386 - main - INFO -      Diagnostics & Health:
2025-11-26 17:04:04,386 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:04:04,386 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:04:04,387 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:04:04,387 - main - INFO - 
2025-11-26 17:04:04,387 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:04:04,387 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:04:04,387 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:04:04,388 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:04:04,388 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:04:04,388 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:04:04,388 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:04:04,388 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:04:04,388 - main - INFO - 
2025-11-26 17:04:04,389 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:04:04,389 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:04:04,389 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:04:04,389 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:04:04,390 - main - INFO -      4. No re-upload needed!
2025-11-26 17:04:04,390 - main - INFO - 
2025-11-26 17:04:04,390 - main - INFO - ================================================================================
2025-11-26 17:04:04,390 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:04:04,391 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:04:04,391 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:04:04,391 - main - INFO - ================================================================================
2025-11-26 17:04:04,391 - main - INFO - 
2025-11-26 17:04:04,392 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:04:36,882 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764175786_fa6b73134bfb/pdf
2025-11-26 17:04:36,883 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764175786_fa6b73134bfb
2025-11-26 17:04:36,891 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764175786_fa6b73134bfb
2025-11-26 17:04:36,892 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:04:36,892 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:04:36,893 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:04:36,893 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:04:36,895 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:04:36,895 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:04:36,914 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:04:36,914 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:04:36,916 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:04:36,916 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:04:36,918 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:04:36,918 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:04:36,920 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:04:37,213 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764175786_fa6b73134bfb
2025-11-26 17:04:37,213 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764175786_fa6b73134bfb_20251126_170437.pdf (158143 bytes)
2025-11-26 17:04:37,215 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764175786_fa6b73134bfb/pdf - 200 - 0.33s
2025-11-26 17:17:51,501 - main - INFO - 
2025-11-26 17:17:51,502 - main - INFO - ================================================================================
2025-11-26 17:17:51,502 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:17:51,503 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:17:51,504 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:17:51,505 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:17:51,505 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:17:51,507 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:17:51,507 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:17:51,508 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:17:51,508 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:17:51,509 - main - INFO - ================================================================================
2025-11-26 17:17:51,509 - main - INFO - 
2025-11-26 17:17:55,175 - main - INFO - 
2025-11-26 17:17:55,175 - main - INFO - ================================================================================
2025-11-26 17:17:55,175 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:17:55,175 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:17:55,176 - main - INFO - ================================================================================
2025-11-26 17:17:55,176 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:17:55,176 - main - INFO -   Upload Directory: uploads
2025-11-26 17:17:55,176 - main - INFO -   Max File Size: 20MB
2025-11-26 17:17:55,176 - main - INFO - ================================================================================
2025-11-26 17:17:55,177 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:17:55,177 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:17:55,177 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:17:55,222 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:17:55,230 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:17:55,230 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:17:55,230 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:17:55,231 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:17:55,231 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:17:55,244 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:17:55,246 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:17:55,247 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:17:55,249 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:17:55,249 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:17:55,249 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:17:55,250 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:17:55,250 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:17:55,280 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:17:55,280 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:17:55,281 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:17:55,281 - main - INFO - 
2025-11-26 17:17:55,282 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:17:55,282 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:17:55,282 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:17:55,282 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:17:55,283 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:17:55,283 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:17:55,283 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:17:55,284 - main - INFO - 
2025-11-26 17:17:55,284 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:17:55,285 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:17:55,285 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:17:55,285 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:17:55,286 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:17:55,286 - main - INFO - 
2025-11-26 17:17:55,286 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:17:55,287 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:17:55,287 - main - INFO -        - No manual section generation
2025-11-26 17:17:55,287 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:17:55,287 - main - INFO - 
2025-11-26 17:17:55,287 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:17:55,288 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:17:55,289 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:17:55,289 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:17:55,289 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:17:55,290 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:17:55,290 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:17:55,290 - main - INFO - 
2025-11-26 17:17:55,291 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:17:55,291 - main - INFO -      Main:
2025-11-26 17:17:55,291 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:17:55,292 - main - INFO - 
2025-11-26 17:17:55,292 - main - INFO -      Retrieval:
2025-11-26 17:17:55,292 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:17:55,293 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:17:55,293 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:17:55,293 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:17:55,293 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:17:55,293 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:17:55,294 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:17:55,294 - main - INFO - 
2025-11-26 17:17:55,294 - main - INFO -      Management:
2025-11-26 17:17:55,294 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:17:55,295 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:17:55,295 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:17:55,295 - main - INFO - 
2025-11-26 17:17:55,295 - main - INFO -      Documents (MongoDB):
2025-11-26 17:17:55,296 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:17:55,296 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:17:55,296 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:17:55,296 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:17:55,296 - main - INFO - 
2025-11-26 17:17:55,297 - main - INFO -      Diagnostics & Health:
2025-11-26 17:17:55,297 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:17:55,297 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:17:55,297 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:17:55,297 - main - INFO - 
2025-11-26 17:17:55,297 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:17:55,298 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:17:55,298 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:17:55,298 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:17:55,298 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:17:55,298 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:17:55,298 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:17:55,299 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:17:55,299 - main - INFO - 
2025-11-26 17:17:55,299 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:17:55,299 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:17:55,299 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:17:55,299 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:17:55,300 - main - INFO -      4. No re-upload needed!
2025-11-26 17:17:55,300 - main - INFO - 
2025-11-26 17:17:55,300 - main - INFO - ================================================================================
2025-11-26 17:17:55,300 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:17:55,301 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:17:55,302 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:17:55,303 - main - INFO - ================================================================================
2025-11-26 17:17:55,303 - main - INFO - 
2025-11-26 17:17:55,304 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:18:57,208 - main - INFO - 
2025-11-26 17:18:57,209 - main - INFO - ================================================================================
2025-11-26 17:18:57,209 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:18:57,210 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:18:57,211 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:18:57,212 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:18:57,213 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:18:57,214 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:18:57,214 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:18:57,215 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:18:57,215 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:18:57,216 - main - INFO - ================================================================================
2025-11-26 17:18:57,216 - main - INFO - 
2025-11-26 17:19:01,197 - main - INFO - 
2025-11-26 17:19:01,197 - main - INFO - ================================================================================
2025-11-26 17:19:01,197 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:19:01,198 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:19:01,198 - main - INFO - ================================================================================
2025-11-26 17:19:01,198 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:19:01,198 - main - INFO -   Upload Directory: uploads
2025-11-26 17:19:01,198 - main - INFO -   Max File Size: 20MB
2025-11-26 17:19:01,199 - main - INFO - ================================================================================
2025-11-26 17:19:01,199 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:19:01,199 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:19:01,199 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:19:01,246 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:19:01,250 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:19:01,251 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:19:01,251 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:19:01,252 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:19:01,252 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:19:01,263 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:19:01,264 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:19:01,265 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:19:01,267 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:19:01,267 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:19:01,268 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:19:01,268 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:19:01,268 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:19:01,279 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:19:01,280 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:19:01,280 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:19:01,280 - main - INFO - 
2025-11-26 17:19:01,280 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:19:01,281 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:19:01,281 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:19:01,281 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:19:01,281 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:19:01,282 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:19:01,282 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:19:01,282 - main - INFO - 
2025-11-26 17:19:01,282 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:19:01,282 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:19:01,283 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:19:01,283 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:19:01,283 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:19:01,283 - main - INFO - 
2025-11-26 17:19:01,283 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:19:01,284 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:19:01,284 - main - INFO -        - No manual section generation
2025-11-26 17:19:01,284 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:19:01,284 - main - INFO - 
2025-11-26 17:19:01,285 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:19:01,285 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:19:01,285 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:19:01,285 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:19:01,286 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:19:01,286 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:19:01,286 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:19:01,286 - main - INFO - 
2025-11-26 17:19:01,287 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:19:01,287 - main - INFO -      Main:
2025-11-26 17:19:01,287 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:19:01,288 - main - INFO - 
2025-11-26 17:19:01,289 - main - INFO -      Retrieval:
2025-11-26 17:19:01,289 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:19:01,290 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:19:01,291 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:19:01,292 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:19:01,292 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:19:01,292 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:19:01,293 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:19:01,293 - main - INFO - 
2025-11-26 17:19:01,293 - main - INFO -      Management:
2025-11-26 17:19:01,293 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:19:01,294 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:19:01,294 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:19:01,294 - main - INFO - 
2025-11-26 17:19:01,294 - main - INFO -      Documents (MongoDB):
2025-11-26 17:19:01,294 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:19:01,295 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:19:01,295 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:19:01,295 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:19:01,295 - main - INFO - 
2025-11-26 17:19:01,296 - main - INFO -      Diagnostics & Health:
2025-11-26 17:19:01,296 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:19:01,296 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:19:01,296 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:19:01,296 - main - INFO - 
2025-11-26 17:19:01,297 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:19:01,297 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:19:01,297 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:19:01,297 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:19:01,298 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:19:01,298 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:19:01,298 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:19:01,298 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:19:01,298 - main - INFO - 
2025-11-26 17:19:01,299 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:19:01,299 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:19:01,299 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:19:01,299 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:19:01,300 - main - INFO -      4. No re-upload needed!
2025-11-26 17:19:01,300 - main - INFO - 
2025-11-26 17:19:01,300 - main - INFO - ================================================================================
2025-11-26 17:19:01,300 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:19:01,300 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:19:01,301 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:19:01,301 - main - INFO - ================================================================================
2025-11-26 17:19:01,302 - main - INFO - 
2025-11-26 17:19:01,302 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:19:19,754 - main - INFO - 
2025-11-26 17:19:19,755 - main - INFO - ================================================================================
2025-11-26 17:19:19,755 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:19:19,756 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:19:19,757 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:19:19,758 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:19:19,758 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:19:19,759 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:19:19,759 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:19:19,760 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:19:19,760 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:19:19,761 - main - INFO - ================================================================================
2025-11-26 17:19:19,761 - main - INFO - 
2025-11-26 17:19:23,694 - main - INFO - 
2025-11-26 17:19:23,695 - main - INFO - ================================================================================
2025-11-26 17:19:23,695 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:19:23,695 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:19:23,695 - main - INFO - ================================================================================
2025-11-26 17:19:23,696 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:19:23,696 - main - INFO -   Upload Directory: uploads
2025-11-26 17:19:23,696 - main - INFO -   Max File Size: 20MB
2025-11-26 17:19:23,696 - main - INFO - ================================================================================
2025-11-26 17:19:23,696 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:19:23,697 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:19:23,697 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:19:23,717 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:19:23,727 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:19:23,727 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:19:23,727 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:19:23,727 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:19:23,728 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:19:23,734 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:19:23,738 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:19:23,740 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:19:23,743 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:19:23,743 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:19:23,744 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:19:23,744 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:19:23,744 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:19:23,779 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:19:23,780 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:19:23,781 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:19:23,781 - main - INFO - 
2025-11-26 17:19:23,782 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:19:23,782 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:19:23,783 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:19:23,783 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:19:23,784 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:19:23,785 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:19:23,786 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:19:23,786 - main - INFO - 
2025-11-26 17:19:23,787 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:19:23,788 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:19:23,788 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:19:23,789 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:19:23,789 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:19:23,790 - main - INFO - 
2025-11-26 17:19:23,790 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:19:23,791 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:19:23,792 - main - INFO -        - No manual section generation
2025-11-26 17:19:23,792 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:19:23,793 - main - INFO - 
2025-11-26 17:19:23,793 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:19:23,794 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:19:23,795 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:19:23,796 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:19:23,796 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:19:23,797 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:19:23,798 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:19:23,798 - main - INFO - 
2025-11-26 17:19:23,799 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:19:23,799 - main - INFO -      Main:
2025-11-26 17:19:23,800 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:19:23,801 - main - INFO - 
2025-11-26 17:19:23,801 - main - INFO -      Retrieval:
2025-11-26 17:19:23,803 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:19:23,804 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:19:23,805 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:19:23,806 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:19:23,807 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:19:23,807 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:19:23,808 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:19:23,808 - main - INFO - 
2025-11-26 17:19:23,809 - main - INFO -      Management:
2025-11-26 17:19:23,809 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:19:23,810 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:19:23,810 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:19:23,810 - main - INFO - 
2025-11-26 17:19:23,811 - main - INFO -      Documents (MongoDB):
2025-11-26 17:19:23,811 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:19:23,812 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:19:23,812 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:19:23,813 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:19:23,813 - main - INFO - 
2025-11-26 17:19:23,814 - main - INFO -      Diagnostics & Health:
2025-11-26 17:19:23,814 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:19:23,814 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:19:23,815 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:19:23,815 - main - INFO - 
2025-11-26 17:19:23,815 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:19:23,816 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:19:23,816 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:19:23,816 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:19:23,816 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:19:23,817 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:19:23,817 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:19:23,818 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:19:23,818 - main - INFO - 
2025-11-26 17:19:23,819 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:19:23,819 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:19:23,820 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:19:23,820 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:19:23,820 - main - INFO -      4. No re-upload needed!
2025-11-26 17:19:23,821 - main - INFO - 
2025-11-26 17:19:23,821 - main - INFO - ================================================================================
2025-11-26 17:19:23,821 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:19:23,822 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:19:23,822 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:19:23,822 - main - INFO - ================================================================================
2025-11-26 17:19:23,823 - main - INFO - 
2025-11-26 17:19:23,823 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:20:08,119 - main - INFO - 
2025-11-26 17:20:08,119 - main - INFO - ================================================================================
2025-11-26 17:20:08,120 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:20:08,122 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:20:08,123 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:20:08,125 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:20:08,125 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:20:08,127 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:20:08,128 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:20:08,128 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:20:08,129 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:20:08,129 - main - INFO - ================================================================================
2025-11-26 17:20:08,130 - main - INFO - 
2025-11-26 17:20:11,455 - main - INFO - 
2025-11-26 17:20:11,455 - main - INFO - ================================================================================
2025-11-26 17:20:11,455 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:20:11,456 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:20:11,456 - main - INFO - ================================================================================
2025-11-26 17:20:11,456 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:20:11,456 - main - INFO -   Upload Directory: uploads
2025-11-26 17:20:11,456 - main - INFO -   Max File Size: 20MB
2025-11-26 17:20:11,457 - main - INFO - ================================================================================
2025-11-26 17:20:11,458 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:20:11,458 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:20:11,459 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:20:11,477 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:20:11,480 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:20:11,481 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:20:11,481 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:20:11,481 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:20:11,481 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:20:11,496 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:20:11,497 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:20:11,498 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:20:11,501 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:20:11,501 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:20:11,501 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:20:11,501 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:20:11,502 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:20:11,512 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:20:11,513 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:20:11,513 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:20:11,513 - main - INFO - 
2025-11-26 17:20:11,513 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:20:11,514 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:20:11,514 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:20:11,514 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:20:11,514 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:20:11,514 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:20:11,515 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:20:11,515 - main - INFO - 
2025-11-26 17:20:11,515 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:20:11,515 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:20:11,515 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:20:11,516 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:20:11,516 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:20:11,516 - main - INFO - 
2025-11-26 17:20:11,516 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:20:11,516 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:20:11,517 - main - INFO -        - No manual section generation
2025-11-26 17:20:11,517 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:20:11,517 - main - INFO - 
2025-11-26 17:20:11,517 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:20:11,517 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:20:11,518 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:20:11,518 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:20:11,518 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:20:11,518 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:20:11,518 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:20:11,519 - main - INFO - 
2025-11-26 17:20:11,519 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:20:11,519 - main - INFO -      Main:
2025-11-26 17:20:11,519 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:20:11,519 - main - INFO - 
2025-11-26 17:20:11,519 - main - INFO -      Retrieval:
2025-11-26 17:20:11,520 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:20:11,520 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:20:11,520 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:20:11,520 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:20:11,520 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:20:11,520 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:20:11,521 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:20:11,521 - main - INFO - 
2025-11-26 17:20:11,521 - main - INFO -      Management:
2025-11-26 17:20:11,521 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:20:11,521 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:20:11,522 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:20:11,522 - main - INFO - 
2025-11-26 17:20:11,522 - main - INFO -      Documents (MongoDB):
2025-11-26 17:20:11,522 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:20:11,522 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:20:11,523 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:20:11,523 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:20:11,524 - main - INFO - 
2025-11-26 17:20:11,524 - main - INFO -      Diagnostics & Health:
2025-11-26 17:20:11,524 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:20:11,524 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:20:11,525 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:20:11,525 - main - INFO - 
2025-11-26 17:20:11,525 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:20:11,526 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:20:11,526 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:20:11,526 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:20:11,526 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:20:11,527 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:20:11,527 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:20:11,527 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:20:11,527 - main - INFO - 
2025-11-26 17:20:11,528 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:20:11,529 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:20:11,530 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:20:11,531 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:20:11,531 - main - INFO -      4. No re-upload needed!
2025-11-26 17:20:11,532 - main - INFO - 
2025-11-26 17:20:11,532 - main - INFO - ================================================================================
2025-11-26 17:20:11,532 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:20:11,532 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:20:11,532 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:20:11,533 - main - INFO - ================================================================================
2025-11-26 17:20:11,533 - main - INFO - 
2025-11-26 17:20:11,533 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:20:11,978 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764175786_fa6b73134bfb/pdf
2025-11-26 17:20:11,979 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764175786_fa6b73134bfb
2025-11-26 17:20:11,994 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764175786_fa6b73134bfb
2025-11-26 17:20:11,994 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:20:11,995 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:20:11,997 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:20:11,997 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:20:12,000 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:20:12,000 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:20:12,030 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:20:12,030 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:20:12,032 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:20:12,032 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:20:12,034 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:20:12,034 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:20:12,037 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:20:12,278 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764175786_fa6b73134bfb
2025-11-26 17:20:12,278 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764175786_fa6b73134bfb_20251126_172012.pdf (159478 bytes)
2025-11-26 17:20:12,279 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764175786_fa6b73134bfb/pdf - 200 - 0.30s
2025-11-26 17:20:19,721 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 17:20:19,779 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 17:20:19,779 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 17:20:19,780 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 17:20:19,780 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 17:20:19,782 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 17:20:19,785 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 17:20:19,786 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 17:20:19,786 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 17:20:19,787 - app.api.routes - INFO -    - Files uploaded: 8
2025-11-26 17:20:19,789 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764177619_37f18418c472
2025-11-26 17:20:19,791 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_eb60e41bec20 (8 files)
2025-11-26 17:20:19,792 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_eb60e41bec20
2025-11-26 17:20:19,794 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:19,797 - app.api.routes - INFO - ðŸ“„ Processing: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:19,800 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:19,800 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:19,800 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:20:19,801 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:19,803 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 135b397ed64e4c069823431dc6ffc8ce.pdf (213039 bytes)
2025-11-26 17:20:19,804 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:20:19,805 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\135b397ed64e4c069823431dc6ffc8ce.pdf
2025-11-26 17:20:19,805 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:19,806 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:20:19,842 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:19,863 - app.services.pdf_extractor - INFO - Successfully extracted 12221 characters from 6 pages
2025-11-26 17:20:19,863 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ e0128b0d5ab043a7981ede78e8db6e70.pdf (241116 bytes)
2025-11-26 17:20:19,863 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:20:19,863 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:19,864 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e0128b0d5ab043a7981ede78e8db6e70.pdf
2025-11-26 17:20:19,864 - app.api.routes - INFO - ðŸ“„ Processing: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:20:19,864 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:19,916 - app.services.pdf_extractor - INFO - Successfully extracted 13483 characters from 6 pages
2025-11-26 17:20:19,917 - app.api.routes - INFO - ðŸ’¾ Saved file: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 3f17e2020bb945d49dff4b91b291f784.pdf (843321 bytes)
2025-11-26 17:20:19,918 - app.api.routes - INFO - ðŸ“– Extracting text from: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:20:19,919 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:19,919 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\3f17e2020bb945d49dff4b91b291f784.pdf
2025-11-26 17:20:19,919 - app.api.routes - INFO - ðŸ“„ Processing: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:20:19,920 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:19,968 - app.services.pdf_extractor - INFO - Successfully extracted 7736 characters from 4 pages
2025-11-26 17:20:19,969 - app.api.routes - INFO - ðŸ’¾ Saved file: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 24b7db8aa40e4abd94c730d2cc00b072.pdf (290798 bytes)
2025-11-26 17:20:19,969 - app.api.routes - INFO - ðŸ“– Extracting text from: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:20:19,969 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:19,970 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\24b7db8aa40e4abd94c730d2cc00b072.pdf
2025-11-26 17:20:19,970 - app.api.routes - INFO - ðŸ“„ Processing: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:19,970 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:19,987 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:20,004 - app.api.routes - INFO - ðŸ“„ Processing: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:20:20,028 - app.services.pdf_extractor - INFO - Successfully extracted 15546 characters from 7 pages
2025-11-26 17:20:20,029 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:20,031 - app.api.routes - INFO - ðŸ’¾ Saved file: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ ba8a8fa5f6944b128371c02702c7aea6.pdf (309991 bytes)
2025-11-26 17:20:20,031 - app.api.routes - INFO - ðŸ“– Extracting text from: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:20:20,031 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:20:20,031 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\ba8a8fa5f6944b128371c02702c7aea6.pdf
2025-11-26 17:20:20,032 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:20:20,063 - app.api.routes - INFO - ======================================================================
2025-11-26 17:20:20,074 - app.services.pdf_extractor - INFO - Successfully extracted 12679 characters from 5 pages
2025-11-26 17:20:20,076 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ e743279a58404ac1a6972c6241553828.pdf (175401 bytes)
2025-11-26 17:20:20,077 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:20:20,077 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\e743279a58404ac1a6972c6241553828.pdf
2025-11-26 17:20:20,078 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:20:20,100 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:20:20,120 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:20:20,132 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:20:20,136 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-26 17:20:20,136 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:20:20,136 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:20,137 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 17:20:20,137 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 17:20:20,138 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 17:20:20,221 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:20:20,221 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:20,682 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:20:20,682 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:20:20,684 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:20:20,685 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:20:20,685 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:20:20,685 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:20,686 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 17:20:20,686 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 17:20:20,686 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 17:20:20,772 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:20:20,772 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:20,773 - app.api.routes - INFO - ðŸ¤– Parsing with AI: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:20:20,774 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:20:20,775 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:20:20,775 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:20:20,775 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 17:20:20,776 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:20,776 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:20:20,837 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:20:20,837 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:20,839 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:20:20,839 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:20:20,841 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:20:20,841 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:20:20,841 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:20:20,842 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:20,842 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 17:20:20,842 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 17:20:20,843 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 17:20:20,932 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:20:20,932 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:20,934 - app.api.routes - INFO - ðŸ¤– Parsing with AI: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:20:20,935 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:20:20,936 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Wataniya Insurance
2025-11-26 17:20:20,936 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Wataniya Insurance
2025-11-26 17:20:20,936 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 17:20:20,936 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:20,937 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:20:21,023 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 17:20:21,023 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:21,025 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:20:21,025 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:20:21,025 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-26 17:20:21,026 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-26 17:20:21,026 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 17:20:21,027 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:21,027 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-26 17:20:21,138 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-26 17:20:21,139 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:21,164 - app.api.routes - INFO - ðŸ’¾ Saved file: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ a536286b0ae24b3ba344c5387efb9575.pdf (2137120 bytes)
2025-11-26 17:20:21,165 - app.api.routes - INFO - ðŸ“– Extracting text from: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:21,165 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\a536286b0ae24b3ba344c5387efb9575.pdf
2025-11-26 17:20:21,214 - app.api.routes - INFO - ðŸ’¾ Saved file: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ d9c4be00bcb8459d981cd63f4da0e90a.pdf (2510488 bytes)
2025-11-26 17:20:21,235 - app.services.pdf_extractor - INFO - Successfully extracted 11585 characters from 4 pages
2025-11-26 17:20:21,236 - app.api.routes - INFO - ðŸ“– Extracting text from: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:21,237 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\d9c4be00bcb8459d981cd63f4da0e90a.pdf
2025-11-26 17:20:21,237 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:21,237 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:21,276 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 17:20:21,307 - app.services.pdf_extractor - INFO - Successfully extracted 17529 characters from 6 pages
2025-11-26 17:20:21,308 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 17:20:21,308 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:20:21,308 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:21,309 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:20:21,396 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-26 17:20:21,396 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:21,399 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:21,399 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:20:21,404 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 17:20:21,405 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 17:20:21,406 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:20:21,407 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:20:21,408 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:20:21,566 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 17:20:21,566 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:20:47,497 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:47,507 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:20:47,508 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:20:47,508 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:20:47,508 - app.services.ai_parser - WARNING - âš ï¸ Only 4 benefits, using fallback...
2025-11-26 17:20:47,512 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 17:20:47,512 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 10 total
2025-11-26 17:20:47,513 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:20:47,967 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:47,989 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:20:47,989 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:20:47,990 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:20:47,990 - app.services.ai_parser - WARNING - âš ï¸ Only 7 benefits, using fallback...
2025-11-26 17:20:47,992 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 20 benefits from patterns
2025-11-26 17:20:47,993 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 25 total
2025-11-26 17:20:47,993 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:20:48,971 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:48,985 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:20:48,985 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:20:48,985 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:20:48,986 - app.services.ai_parser - WARNING - âš ï¸ Only 3 benefits, using fallback...
2025-11-26 17:20:48,987 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 17:20:48,988 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 9 total
2025-11-26 17:20:48,988 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:20:49,375 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:49,381 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:20:49,381 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:20:49,381 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:20:49,382 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:20:49,384 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 23 benefits from patterns
2025-11-26 17:20:49,384 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 23 total
2025-11-26 17:20:49,384 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:20:50,643 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:50,648 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:20:50,648 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:20:50,648 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:20:50,649 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-26 17:20:50,652 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 60 benefits from patterns
2025-11-26 17:20:50,652 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 58 total
2025-11-26 17:20:50,652 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:20:53,669 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:53,670 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:20:53,670 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:20:53,670 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium' â†’ 'FLAT Premium'
2025-11-26 17:20:53,671 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 10,000
2025-11-26 17:20:53,671 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:20:53,671 - app.services.ai_parser - INFO - ðŸ“Š Counts: 10 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 17:20:53,819 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:53,820 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:20:53,820 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:20:53,821 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.00â€° (Per Mille)' â†’ '1.00â€°'
2025-11-26 17:20:53,821 - app.services.ai_parser - INFO - ðŸ’° Calculated: 365000.00 from SI: 365000000.0 Ã— Rate: 1.00â€° (Per Mille)
2025-11-26 17:20:53,821 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000
2025-11-26 17:20:53,822 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:20:53,822 - app.services.ai_parser - INFO - ðŸ“Š Counts: 25 benefits, 27 exclusions, 5 warranties, 8 extensions
2025-11-26 17:20:54,608 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:54,610 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:20:54,611 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:20:54,611 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium, SAR 1,000 Per Project' â†’ 'FLAT Premium'
2025-11-26 17:20:54,612 - app.services.ai_parser - INFO - ðŸ’° Calculated: 4000000.00 from SI: 4000000.0 Ã— Rate: Flat Premium, SAR 1,000 Per Project
2025-11-26 17:20:54,612 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount, minimum SAR 10,000
2025-11-26 17:20:54,613 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:20:54,614 - app.services.ai_parser - INFO - ðŸ“Š Counts: 9 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 17:20:55,092 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:55,099 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:20:55,100 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:20:55,100 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.1â€°' â†’ '1.1â€°'
2025-11-26 17:20:55,100 - app.services.ai_parser - INFO - ðŸ’° Calculated: 609853.20 from SI: 554412000.0 Ã— Rate: 1.1â€°
2025-11-26 17:20:55,101 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount | BI: 10%
2025-11-26 17:20:55,101 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:20:55,101 - app.services.ai_parser - INFO - ðŸ“Š Counts: 23 benefits, 29 exclusions, 6 warranties, 0 extensions
2025-11-26 17:20:57,036 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:57,063 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:20:57,063 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:20:57,064 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-26 17:20:57,064 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-26 17:20:57,064 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 17:20:57,065 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 17:20:57,065 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 17:20:57,066 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 17:20:57,066 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:20:57,066 - app.services.ai_parser - INFO - ðŸ“Š Counts: 58 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-26 17:20:59,452 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:20:59,453 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 75.0
2025-11-26 17:20:59,454 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:20:59,454 - app.services.ai_parser - INFO - 
2025-11-26 17:20:59,454 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:20:59,455 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:20:59,455 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:20:59,456 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 17:20:59,456 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:20:59,456 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,500.00
2025-11-26 17:20:59,456 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 17:20:59,457 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 75.0/100
2025-11-26 17:20:59,457 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:20:59,457 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 10,000
2025-11-26 17:20:59,458 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:20:59,458 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:20:59,458 - app.services.ai_parser - INFO - 
2025-11-26 17:20:59,458 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:20:59,459 - app.services.ai_parser - INFO -    âœ“ Benefits: 10
2025-11-26 17:20:59,459 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 17:20:59,459 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 17:20:59,459 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:20:59,459 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:20:59,460 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:20:59,461 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 135b397ed64e4c069823431dc6ffc8ce.pdf â†’ 692736fb075776287f31e07b
2025-11-26 17:20:59,461 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692736fb075776287f31e07b
2025-11-26 17:20:59,464 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 692736fb075776287f31e07c (213039 bytes)
2025-11-26 17:20:59,464 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 692736fb075776287f31e07c
2025-11-26 17:20:59,465 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:21:00,760 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:00,788 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:21:00,789 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:00,789 - app.services.ai_parser - INFO - 
2025-11-26 17:21:00,789 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:00,790 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:21:00,790 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:00,791 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 17:21:00,791 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 17:21:00,791 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 609,853.20
2025-11-26 17:21:00,792 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.1â€°
2025-11-26 17:21:00,792 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:21:00,792 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.3/100
2025-11-26 17:21:00,792 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount | BI: 10%
2025-11-26 17:21:00,793 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:21:00,793 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:21:00,793 - app.services.ai_parser - INFO - 
2025-11-26 17:21:00,793 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:00,793 - app.services.ai_parser - INFO -    âœ“ Benefits: 23
2025-11-26 17:21:00,794 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 17:21:00,794 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 17:21:00,794 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:21:00,794 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:21:00,794 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:00,796 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 3f17e2020bb945d49dff4b91b291f784.pdf â†’ 692736fc075776287f31e07d
2025-11-26 17:21:00,796 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692736fc075776287f31e07d
2025-11-26 17:21:00,801 - app.services.user_documents_service - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 692736fc075776287f31e07e (843321 bytes)
2025-11-26 17:21:00,802 - app.api.routes - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 692736fc075776287f31e07e
2025-11-26 17:21:00,803 - app.api.routes - INFO - âœ… Successfully processed: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:21:00,869 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:00,870 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-26 17:21:00,870 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:00,871 - app.services.ai_parser - INFO - 
2025-11-26 17:21:00,871 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:00,871 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:21:00,871 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:00,872 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Wataniya Insurance
2025-11-26 17:21:00,872 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 17:21:00,872 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 365,000.00
2025-11-26 17:21:00,873 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.00â€°
2025-11-26 17:21:00,873 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-26 17:21:00,873 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.0/100
2025-11-26 17:21:00,873 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000
2025-11-26 17:21:00,874 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:21:00,874 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:21:00,874 - app.services.ai_parser - INFO - 
2025-11-26 17:21:00,874 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:00,874 - app.services.ai_parser - INFO -    âœ“ Benefits: 25
2025-11-26 17:21:00,874 - app.services.ai_parser - INFO -    âœ“ Exclusions: 27
2025-11-26 17:21:00,875 - app.services.ai_parser - INFO -    âœ“ Warranties: 5
2025-11-26 17:21:00,875 - app.services.ai_parser - INFO -    âœ“ Extensions: 8
2025-11-26 17:21:00,875 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:21:00,875 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:00,876 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: ba8a8fa5f6944b128371c02702c7aea6.pdf â†’ 692736fc075776287f31e07f
2025-11-26 17:21:00,877 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692736fc075776287f31e07f
2025-11-26 17:21:00,879 - app.services.user_documents_service - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 692736fc075776287f31e080 (309991 bytes)
2025-11-26 17:21:00,879 - app.api.routes - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 692736fc075776287f31e080
2025-11-26 17:21:00,879 - app.api.routes - INFO - âœ… Successfully processed: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:21:01,688 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:01,689 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:21:01,689 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:01,689 - app.services.ai_parser - INFO - 
2025-11-26 17:21:01,690 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:01,690 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:21:01,690 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:01,691 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-26 17:21:01,691 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 17:21:01,691 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 500,000.00
2025-11-26 17:21:01,692 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-26 17:21:01,692 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:21:01,692 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:21:01,692 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount, min SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount, min SR 1,500,000
2025-11-26 17:21:01,692 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:21:01,693 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:21:01,693 - app.services.ai_parser - INFO - 
2025-11-26 17:21:01,693 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:01,693 - app.services.ai_parser - INFO -    âœ“ Benefits: 58
2025-11-26 17:21:01,693 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 17:21:01,694 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 17:21:01,694 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-26 17:21:01,694 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:21:01,694 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:01,695 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e743279a58404ac1a6972c6241553828.pdf â†’ 692736fd075776287f31e081
2025-11-26 17:21:01,696 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692736fd075776287f31e081
2025-11-26 17:21:01,697 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 692736fd075776287f31e082 (175401 bytes)
2025-11-26 17:21:01,697 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 692736fd075776287f31e082
2025-11-26 17:21:01,698 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:21:01,859 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:01,860 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 17:21:01,861 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:01,861 - app.services.ai_parser - INFO - 
2025-11-26 17:21:01,861 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:01,862 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:21:01,862 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:01,862 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 17:21:01,862 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:21:01,863 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 20,000.00
2025-11-26 17:21:01,863 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 17:21:01,863 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 17:21:01,863 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.7/100
2025-11-26 17:21:01,864 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount, minimum SAR 10,000
2025-11-26 17:21:01,864 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:21:01,864 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:21:01,864 - app.services.ai_parser - INFO - 
2025-11-26 17:21:01,864 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:01,865 - app.services.ai_parser - INFO -    âœ“ Benefits: 9
2025-11-26 17:21:01,865 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 17:21:01,865 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 17:21:01,865 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:21:01,865 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:21:01,865 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:01,867 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: e0128b0d5ab043a7981ede78e8db6e70.pdf â†’ 692736fd075776287f31e083
2025-11-26 17:21:01,867 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692736fd075776287f31e083
2025-11-26 17:21:01,870 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 692736fd075776287f31e084 (241116 bytes)
2025-11-26 17:21:01,870 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 692736fd075776287f31e084
2025-11-26 17:21:01,871 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:21:06,856 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:06,859 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:21:06,859 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:21:06,860 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:21:06,860 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:21:06,862 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 16 benefits from patterns
2025-11-26 17:21:06,863 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 15 total
2025-11-26 17:21:06,863 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:21:11,704 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:11,706 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:21:11,706 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:21:11,706 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:21:11,707 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:21:11,711 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 37 benefits from patterns
2025-11-26 17:21:11,711 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 34 total
2025-11-26 17:21:11,712 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:21:12,882 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:12,884 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:21:12,884 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:21:12,884 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 2,250/- (Flat) + 15% VAT' â†’ '2%'
2025-11-26 17:21:12,885 - app.services.ai_parser - INFO - ðŸ’° Calculated: 3208500.00 from SI: 142600.0 Ã— Rate: SR 2,250/- (Flat) + 15% VAT
2025-11-26 17:21:12,885 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR. 50,000/- each & every loss for all natural perils except flood
2025-11-26 17:21:12,885 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:21:12,886 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 64 exclusions, 20 warranties, 0 extensions
2025-11-26 17:21:14,662 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:14,663 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:21:14,663 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:21:14,663 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.95%o on total sum insured of SAR 350,328,000/-' â†’ '0.95â€°'
2025-11-26 17:21:14,664 - app.services.ai_parser - INFO - ðŸ’° Calculated: 332811.60 from SI: 350328000.0 Ã— Rate: 0.95%o on total sum insured of SAR 350,328,000/-
2025-11-26 17:21:14,664 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 1,000,000 | Nat Cat: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 17:21:14,664 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:21:14,664 - app.services.ai_parser - INFO - ðŸ“Š Counts: 34 benefits, 42 exclusions, 6 warranties, 0 extensions
2025-11-26 17:21:16,290 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:16,292 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:21:16,292 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:21:16,292 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:21:16,293 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:21:18,386 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:18,388 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 17:21:18,388 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:18,388 - app.services.ai_parser - INFO - 
2025-11-26 17:21:18,388 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:18,389 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:21:18,389 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:18,389 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 17:21:18,389 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,250.00
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - ðŸ“Š Rate: 2%
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR. 50,000/- each & every loss for all natural perils except flood
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:21:18,390 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:21:18,391 - app.services.ai_parser - INFO - 
2025-11-26 17:21:18,391 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:18,391 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-26 17:21:18,391 - app.services.ai_parser - INFO -    âœ“ Exclusions: 64
2025-11-26 17:21:18,392 - app.services.ai_parser - INFO -    âœ“ Warranties: 20
2025-11-26 17:21:18,392 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:21:18,392 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:21:18,392 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:18,394 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: a536286b0ae24b3ba344c5387efb9575.pdf â†’ 6927370e075776287f31e085
2025-11-26 17:21:18,394 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6927370e075776287f31e085
2025-11-26 17:21:18,412 - app.services.user_documents_service - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 6927370e075776287f31e086 (2137120 bytes)
2025-11-26 17:21:18,412 - app.api.routes - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 6927370e075776287f31e086
2025-11-26 17:21:18,413 - app.api.routes - INFO - âœ… Successfully processed: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:21:20,636 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:20,659 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:21:20,659 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:20,660 - app.services.ai_parser - INFO - 
2025-11-26 17:21:20,660 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:20,660 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:21:20,660 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:20,661 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 17:21:20,661 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:21:20,661 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 322,811.60
2025-11-26 17:21:20,662 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.95â€°
2025-11-26 17:21:20,662 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:21:20,662 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:21:20,662 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 1,000,000 | Nat Cat: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 17:21:20,662 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:21:20,663 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 17:21:20,663 - app.services.ai_parser - INFO - 
2025-11-26 17:21:20,663 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:20,663 - app.services.ai_parser - INFO -    âœ“ Benefits: 34
2025-11-26 17:21:20,663 - app.services.ai_parser - INFO -    âœ“ Exclusions: 42
2025-11-26 17:21:20,664 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 17:21:20,664 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:21:20,664 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 0
2025-11-26 17:21:20,664 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:20,665 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 24b7db8aa40e4abd94c730d2cc00b072.pdf â†’ 69273710075776287f31e087
2025-11-26 17:21:20,666 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273710075776287f31e087
2025-11-26 17:21:20,668 - app.services.user_documents_service - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69273710075776287f31e088 (290798 bytes)
2025-11-26 17:21:20,668 - app.api.routes - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69273710075776287f31e088
2025-11-26 17:21:20,669 - app.api.routes - INFO - âœ… Successfully processed: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:21:22,712 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:22,713 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:21:22,713 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:21:22,713 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 18,000/- + Plus VAT 15%' â†’ '18%'
2025-11-26 17:21:22,714 - app.services.ai_parser - INFO - ðŸ’° Calculated: 720000000.00 from SI: 4000000.0 Ã— Rate: SR 18,000/- + Plus VAT 15%
2025-11-26 17:21:22,714 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 17:21:22,715 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:21:22,715 - app.services.ai_parser - INFO - ðŸ“Š Counts: 12 benefits, 64 exclusions, 19 warranties, 0 extensions
2025-11-26 17:21:28,672 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:28,676 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 75.0
2025-11-26 17:21:28,676 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:21:28,677 - app.services.ai_parser - INFO - 
2025-11-26 17:21:28,678 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:28,679 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:21:28,679 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:28,680 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 17:21:28,681 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:21:28,681 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 18,000.00
2025-11-26 17:21:28,682 - app.services.ai_parser - INFO - ðŸ“Š Rate: 18%
2025-11-26 17:21:28,683 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 75.0/100
2025-11-26 17:21:28,683 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:21:28,684 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 17:21:28,685 - app.services.ai_parser - INFO - â° Validity: Quotation period as specified
2025-11-26 17:21:28,685 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 17:21:28,686 - app.services.ai_parser - INFO - 
2025-11-26 17:21:28,686 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:21:28,687 - app.services.ai_parser - INFO -    âœ“ Benefits: 12
2025-11-26 17:21:28,688 - app.services.ai_parser - INFO -    âœ“ Exclusions: 64
2025-11-26 17:21:28,688 - app.services.ai_parser - INFO -    âœ“ Warranties: 19
2025-11-26 17:21:28,689 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:21:28,689 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 5
2025-11-26 17:21:28,690 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:21:28,693 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: d9c4be00bcb8459d981cd63f4da0e90a.pdf â†’ 69273718075776287f31e089
2025-11-26 17:21:28,694 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273718075776287f31e089
2025-11-26 17:21:28,711 - app.services.user_documents_service - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69273718075776287f31e08a (2510488 bytes)
2025-11-26 17:21:28,711 - app.api.routes - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69273718075776287f31e08a
2025-11-26 17:21:28,712 - app.api.routes - INFO - âœ… Successfully processed: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:21:28,712 - app.api.routes - INFO - 
âœ… Successfully extracted 8 quotes
2025-11-26 17:21:28,712 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:21:28,713 - app.api.routes - INFO - ðŸ”€ Generating comparison for 8 quotes
2025-11-26 17:21:28,713 - app.api.routes - INFO - ======================================================================
2025-11-26 17:21:28,713 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 8 quotes
2025-11-26 17:21:28,714 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 17:21:28,714 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 17:21:28,715 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 17:21:28,715 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 17:21:28,715 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 17:21:28,716 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,717 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 17:21:28,718 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,719 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,720 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,720 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,720 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,721 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:21:28,721 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,721 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,721 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,722 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,722 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 200,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 200000,
    "total_sum_insured": "SAR 200,000"
  },
  "deductibles_complete": {
    "structure_type": "fixed",
    "material_damage_tiers": [
      {
        "range": "All losses",
        "deductible": "1% of the loss amount minimum SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All losses",
      "deductible": "1% of the loss amount minimum SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and in the aggregate",
    "debris_removal":
2025-11-26 17:21:28,723 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,723 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:21:28,724 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:21:28,724 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,724 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,724 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,725 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,725 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,725 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,725 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,726 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,726 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,727 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,727 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,727 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,728 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,728 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:21:28,728 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,729 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Liva Insurance
2025-11-26 17:21:28,729 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 17:21:28,729 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 17:21:28,730 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:21:28,730 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 17:21:28,730 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:21:28,730 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,730 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 17:21:28,731 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,731 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,731 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,732 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,732 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,733 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:21:28,734 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,734 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,734 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,735 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,735 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 544,412,000",
    "business_interruption": "SAR 10,000,000",
    "total_sum_insured_numeric": 554412000,
    "total_sum_insured": "SR 554,412,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "1% of the claim amount applied, subject to a minimum of SR 1,000,000",
        "deductible": "1% of the claim amount",
        "applies_to": "material_damage"
      },
      {
        "range": "1% of the claim amount applied, subject to a minimum of SR 1,000,000 for all natural catastrophe risks",
        "deductible": "1% of the claim amount",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "10% of Claim amount, subject to minimum excess of SAR 10,000/- Each and Every Loss",
        "deductible": "10%",
        "applies_to": "Third Party Liability"

2025-11-26 17:21:28,737 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,737 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:21:28,737 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:21:28,737 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,738 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,738 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,738 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,738 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,738 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,738 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,739 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,739 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,739 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,739 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,739 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,740 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,740 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:21:28,740 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,740 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Rajhi Takaful
2025-11-26 17:21:28,740 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 17:21:28,740 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 17:21:28,741 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:21:28,741 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 17:21:28,741 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:21:28,741 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,741 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Wataniya Insurance
2025-11-26 17:21:28,741 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,742 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,742 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,742 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,742 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,742 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:21:28,743 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,743 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,743 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,743 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,744 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 365,000,000.00",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 365000000,
    "total_sum_insured": "SAR 365,000,000.00"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All losses",
        "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All losses",
      "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "N/A",
    "srcc_malicious_damage": "N/A"
  },
  "exclusions_complete": {
    "all_exclusi
2025-11-26 17:21:28,745 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,745 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:21:28,745 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:21:28,746 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,746 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,746 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,746 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,746 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,747 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,747 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,748 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,748 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,748 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,749 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,749 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,749 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,749 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:21:28,749 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,750 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Wataniya Insurance
2025-11-26 17:21:28,750 - app.services.ai_ranker - INFO - 
ðŸ“Š Wataniya Insurance:
2025-11-26 17:21:28,750 - app.services.ai_ranker - INFO -    Warranties: 5
2025-11-26 17:21:28,751 - app.services.ai_ranker - INFO -    Extensions: 8
2025-11-26 17:21:28,751 - app.services.ai_ranker - INFO -    Exclusions: 27
2025-11-26 17:21:28,751 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:21:28,752 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,752 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-26 17:21:28,753 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,753 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,754 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,754 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,754 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,755 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:21:28,756 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,756 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,757 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,757 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,758 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount, min SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount, min SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_t
2025-11-26 17:21:28,760 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,760 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:21:28,760 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:21:28,761 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,761 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,762 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,763 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,763 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,763 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,764 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,764 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,764 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,765 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,766 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:21:28,766 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,766 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-26 17:21:28,766 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-26 17:21:28,766 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 17:21:28,767 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-26 17:21:28,767 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 17:21:28,767 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:21:28,767 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,767 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 17:21:28,768 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,768 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,769 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,769 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,769 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,769 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:21:28,770 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,770 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,770 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,771 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,771 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 4,000,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SAR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1% of the loss amount, minimum SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1% of the loss amount, minimum SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and SAR 200,000 in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and SAR 200,000 in the aggregate",
    "debris_removal": "SAR 10,000 any on
2025-11-26 17:21:28,773 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,773 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:21:28,774 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:21:28,774 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,774 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,775 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,775 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,776 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,776 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,776 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,776 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,777 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,777 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,777 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,777 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,778 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,778 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:21:28,778 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,778 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Liva Insurance
2025-11-26 17:21:28,778 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 17:21:28,779 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 17:21:28,779 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:21:28,779 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 17:21:28,779 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:21:28,779 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,779 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 17:21:28,780 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,780 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,780 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,780 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,780 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,780 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:21:28,781 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,781 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,781 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,781 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,781 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 142,600/-",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 142600,
    "total_sum_insured": "SR 142,600"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all",
        "deductible": "1% of the claim amount subject to minimum of SR. 50,000/- each & every loss for all natural perils except flood",
        "applies_to": "material_damage"
      },
      {
        "range": "all",
        "deductible": "1% of the claim amount subject to minimum of SR. 25,000/- each & every loss for other than natural perils",
        "applies_to": "material_damage"
      },
      {
        "range": "all",
        "deductible": "10% of the claim amount subject to minimum of SR. 25,000/- each & every loss for flood",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    
2025-11-26 17:21:28,783 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,783 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:21:28,783 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:21:28,783 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,784 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,784 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,784 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,784 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,785 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,785 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,785 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,786 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,786 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,786 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,786 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,786 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,787 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:21:28,787 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:21:28,787 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 17:21:28,787 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 17:21:28,788 - app.services.ai_ranker - INFO -    Warranties: 20
2025-11-26 17:21:28,788 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:21:28,788 - app.services.ai_ranker - INFO -    Exclusions: 64
2025-11-26 17:21:28,788 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:21:28,788 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,789 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 17:21:28,789 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,789 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,789 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,789 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,790 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,790 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': [], 'conditions_precedent': ['No deterioration in loss record'], 'documentation_required': []}
2025-11-26 17:21:28,790 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,790 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,791 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,791 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,791 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 350,328,000",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 350328000,
    "total_sum_insured": "SAR 350,328,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Other losses",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000"
      }
    ],
    "applicable_md_tier": {
      "range": "NATCAT",
      "deductible": "1% of the loss amount minimum SAR 1,000,000",
      "applies_to": "material_dama
2025-11-26 17:21:28,794 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-26 17:21:28,794 - app.services.ai_ranker - INFO -    âœ… Found 1 items in key 'conditions_precedent': ['No deterioration in loss record']
2025-11-26 17:21:28,794 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-26 17:21:28,794 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,794 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,795 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,795 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,795 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,795 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,795 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,795 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,796 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,796 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,796 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,796 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,796 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,796 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 1
2025-11-26 17:21:28,797 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['No deterioration in loss record']
2025-11-26 17:21:28,797 - app.services.ai_ranker - INFO -    âœ… Extracted 1 subjectivities for Liva Insurance
2025-11-26 17:21:28,797 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 17:21:28,797 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 17:21:28,797 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:21:28,797 - app.services.ai_ranker - INFO -    Exclusions: 42
2025-11-26 17:21:28,798 - app.services.ai_ranker - INFO -    Subjectivities: 1
2025-11-26 17:21:28,798 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:21:28,798 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 17:21:28,798 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:21:28,798 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:21:28,798 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:28,799 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:21:28,799 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:21:28,799 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer', 'National Address', 'VAT Certificate'], 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing'], 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy', 'Copy of the project contingency plans', 'Copy of any agreement imposing specific insurance or risk management criteria', 'Copy of any clauses in the works contract or tender documentation specifying types of insurance required']}
2025-11-26 17:21:28,799 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:21:28,800 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:21:28,800 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:21:28,800 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:21:28,800 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 4,000,000",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "other than natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "flood",
        "deductible": "10% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "all natural perils",
2025-11-26 17:21:28,802 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 17:21:28,802 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing']
2025-11-26 17:21:28,803 - app.services.ai_ranker - INFO -    âœ… Found 6 items in key 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy']
2025-11-26 17:21:28,803 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:21:28,804 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:21:28,804 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:21:28,804 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:21:28,804 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:21:28,805 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,805 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:21:28,805 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:21:28,806 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:21:28,806 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:21:28,806 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:21:28,807 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:21:28,807 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:21:28,807 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 14
2025-11-26 17:21:28,808 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 17:21:28,808 - app.services.ai_ranker - INFO -    âœ… Extracted 14 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 17:21:28,808 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 17:21:28,809 - app.services.ai_ranker - INFO -    Warranties: 19
2025-11-26 17:21:28,810 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:21:28,810 - app.services.ai_ranker - INFO -    Exclusions: 64
2025-11-26 17:21:28,811 - app.services.ai_ranker - INFO -    Subjectivities: 14
2025-11-26 17:21:28,811 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-26 17:21:29,861 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 17:21:29,861 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:21:29,862 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:21:29,862 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:21:29,862 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:21:29,862 - app.services.ai_ranker - INFO -       â€¢ Tandem Lift Provision Warranty
2025-11-26 17:21:29,863 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Rajhi Takaful
2025-11-26 17:21:30,748 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 17:21:30,748 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:21:30,748 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:21:30,749 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:21:30,749 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Wataniya Insurance
2025-11-26 17:21:31,419 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 17:21:31,419 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 8
2025-11-26 17:21:31,419 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:21:31,420 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:21:31,420 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:21:31,420 - app.services.ai_ranker - INFO -       â€¢ Warranted that Reasonable Precautions to be taken during the project period
2025-11-26 17:21:31,421 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-26 17:21:31,958 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-26 17:21:31,959 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 5
2025-11-26 17:21:31,959 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 9
2025-11-26 17:21:31,959 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:21:31,960 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:21:31,960 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-26 17:21:31,960 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-26 17:21:31,960 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Sagr Co-operative Insurance Company
2025-11-26 17:21:33,629 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 10
2025-11-26 17:21:33,629 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:21:33,629 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:21:33,629 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 10
2025-11-26 17:21:33,630 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:21:33,630 - app.services.ai_ranker - INFO -       â€¢ Warranted that third party claims are not covered
2025-11-26 17:21:33,630 - app.services.ai_ranker - INFO -       â€¢ Warranted that professional & expert operator to perform duties
2025-11-26 17:21:33,630 - app.services.ai_ranker - INFO -       â€¢ Warranted heavy lifting should be carried out by competent and skilled manpower
2025-11-26 17:21:33,630 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 17:21:33,630 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 17:21:33,631 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 17:21:33,631 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=64.50
2025-11-26 17:21:33,631 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=66.25
2025-11-26 17:21:33,631 - app.services.ai_ranker - INFO - ðŸ“Š Wataniya Insurance: Hakim Score=88.0 (Strong), Weighted Score=73.35
2025-11-26 17:21:33,632 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=79.18
2025-11-26 17:21:33,632 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=58.50
2025-11-26 17:21:33,632 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=66.84
2025-11-26 17:21:33,633 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=69.83
2025-11-26 17:21:33,633 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=58.77
2025-11-26 17:21:33,633 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 17:21:33,634 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 17:21:42,500 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:21:42,516 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 17:21:42,516 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 17:21:42,516 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 17:21:42,518 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 17:21:42,518 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 17:21:42,519 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764177619_37f18418c472
2025-11-26 17:21:42,519 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 8
2025-11-26 17:21:42,519 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 17:21:42,519 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 8
2025-11-26 17:21:42,520 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-26 17:21:42,520 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 17:21:42,520 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 17:21:42,520 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 17:21:42,521 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 17:21:42,521 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 17:21:42,521 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 17:21:42,522 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Al Rajhi Takaful
2025-11-26 17:21:42,522 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 17:21:42,522 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 17:21:42,523 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 17:21:42,523 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 17:21:42,523 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 17:21:42,523 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 17:21:42,531 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 17:21:42,532 - app.services.mongodb_service_enhanced - INFO -    Summary: 13,538 bytes
2025-11-26 17:21:42,532 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 107,942 bytes
2025-11-26 17:21:42,532 - app.services.mongodb_service_enhanced - INFO -    Data table: 48,235 bytes
2025-11-26 17:21:42,533 - app.services.mongodb_service_enhanced - INFO -    Analytics: 3,336 bytes
2025-11-26 17:21:42,533 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 131,073 bytes
2025-11-26 17:21:42,533 - app.services.mongodb_service_enhanced - INFO -    Total document: 632,692 bytes
2025-11-26 17:21:42,533 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 17:21:42,534 - app.services.mongodb_service_enhanced - INFO -       premium: 8 items
2025-11-26 17:21:42,534 - app.services.mongodb_service_enhanced - INFO -       rate: 8 items
2025-11-26 17:21:42,534 - app.services.mongodb_service_enhanced - INFO -       score: 8 items
2025-11-26 17:21:42,535 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 8 items
2025-11-26 17:21:42,535 - app.services.mongodb_service_enhanced - INFO -       deductible: 8 items
2025-11-26 17:21:42,536 - app.services.mongodb_service_enhanced - INFO -       coverage: 8 items
2025-11-26 17:21:42,536 - app.services.mongodb_service_enhanced - INFO -       benefits: 8 items
2025-11-26 17:21:42,536 - app.services.mongodb_service_enhanced - INFO -       exclusions: 8 items
2025-11-26 17:21:42,537 - app.services.mongodb_service_enhanced - INFO -       warranties: 8 items
2025-11-26 17:21:42,537 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 8 items
2025-11-26 17:21:42,537 - app.services.mongodb_service_enhanced - INFO -       conditions: 8 items
2025-11-26 17:21:42,537 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 8 items
2025-11-26 17:21:42,538 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 8 items
2025-11-26 17:21:42,538 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 8 items
2025-11-26 17:21:42,538 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 17:21:42,538 - app.services.mongodb_service_enhanced - INFO -       - Count: 8
2025-11-26 17:21:42,539 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 17:21:42,539 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:42,540 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 17:21:42,551 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764177619_37f18418c472
2025-11-26 17:21:42,552 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69273726b757af6a8efab05f
2025-11-26 17:21:42,561 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 17:21:42,561 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 17:21:42,562 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 17:21:42,562 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 17:21:42,562 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 17:21:42,562 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 17:21:42,562 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 17:21:42,563 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 8
2025-11-26 17:21:42,563 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 17:21:42,563 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 8
2025-11-26 17:21:42,563 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 17:21:42,564 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 8
2025-11-26 17:21:42,564 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 17:21:42,564 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 17:21:42,564 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 17:21:42,565 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 17:21:42,565 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 17:21:42,565 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 17:21:42,565 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:21:42,566 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69273726b757af6a8efab05f
2025-11-26 17:21:42,566 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 17:21:42,566 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 17:21:42,566 - app.api.routes - INFO -    Comparison ID: cmp_1764177619_37f18418c472
2025-11-26 17:21:42,570 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 17:21:42,570 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 17:21:42,570 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:21:42,570 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 17:21:42,571 - app.api.routes - INFO - ======================================================================
2025-11-26 17:21:42,571 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764177619_37f18418c472
2025-11-26 17:21:42,571 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 17:21:42,571 - app.api.routes - INFO - ðŸ“„ Files Processed: 8/8
2025-11-26 17:21:42,572 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 8 PDFs + 1 comparison
2025-11-26 17:21:42,572 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 17:21:42,572 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 17:21:42,573 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 17:21:42,574 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 17:21:42,578 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 17:21:42,578 - app.api.routes - INFO - ======================================================================

2025-11-26 17:21:42,579 - app.services.progress_tracker - INFO - âœ… Job completed: job_eb60e41bec20 â†’ comparison_id: cmp_1764177619_37f18418c472
2025-11-26 17:21:42,583 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 82.86s
2025-11-26 17:22:08,509 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764177619_37f18418c472/pdf
2025-11-26 17:22:08,510 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:22:08,515 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764177619_37f18418c472
2025-11-26 17:22:08,515 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:22:08,516 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:22:08,516 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:22:08,516 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:22:08,519 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:22:08,519 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:22:08,549 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:22:08,549 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:22:08,550 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:22:08,551 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:22:08,553 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:22:08,554 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:22:08,557 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:22:08,765 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:22:08,765 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764177619_37f18418c472_20251126_172208.pdf (164862 bytes)
2025-11-26 17:22:08,766 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764177619_37f18418c472/pdf - 200 - 0.26s
2025-11-26 17:27:33,216 - main - INFO - 
2025-11-26 17:27:33,216 - main - INFO - ================================================================================
2025-11-26 17:27:33,217 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:27:33,218 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:27:33,218 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:27:33,219 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:27:33,220 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:27:33,223 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:27:33,224 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:27:33,228 - main - INFO -   âœ… Cleaned up 8 temporary files
2025-11-26 17:27:33,229 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:27:33,229 - main - INFO - ================================================================================
2025-11-26 17:27:33,230 - main - INFO - 
2025-11-26 17:27:37,463 - main - INFO - 
2025-11-26 17:27:37,464 - main - INFO - ================================================================================
2025-11-26 17:27:37,464 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:27:37,464 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:27:37,464 - main - INFO - ================================================================================
2025-11-26 17:27:37,465 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:27:37,465 - main - INFO -   Upload Directory: uploads
2025-11-26 17:27:37,465 - main - INFO -   Max File Size: 20MB
2025-11-26 17:27:37,465 - main - INFO - ================================================================================
2025-11-26 17:27:37,466 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:27:37,466 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:27:37,466 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:27:37,500 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:27:37,704 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:27:37,716 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:27:37,726 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:27:37,727 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:27:37,732 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:27:37,784 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:27:37,786 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:27:37,792 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:27:37,796 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:27:37,797 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:27:37,797 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:27:37,797 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:27:37,798 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:27:37,812 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:27:37,813 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:27:37,813 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:27:37,813 - main - INFO - 
2025-11-26 17:27:37,814 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:27:37,814 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:27:37,814 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:27:37,814 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:27:37,815 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:27:37,815 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:27:37,815 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:27:37,815 - main - INFO - 
2025-11-26 17:27:37,815 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:27:37,816 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:27:37,816 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:27:37,816 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:27:37,816 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:27:37,817 - main - INFO - 
2025-11-26 17:27:37,817 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:27:37,817 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:27:37,818 - main - INFO -        - No manual section generation
2025-11-26 17:27:37,818 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:27:37,818 - main - INFO - 
2025-11-26 17:27:37,818 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:27:37,819 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:27:37,819 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:27:37,819 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:27:37,820 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:27:37,820 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:27:37,820 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:27:37,821 - main - INFO - 
2025-11-26 17:27:37,823 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:27:37,824 - main - INFO -      Main:
2025-11-26 17:27:37,825 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:27:37,825 - main - INFO - 
2025-11-26 17:27:37,825 - main - INFO -      Retrieval:
2025-11-26 17:27:37,825 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:27:37,826 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:27:37,826 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:27:37,826 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:27:37,826 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:27:37,827 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:27:37,827 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:27:37,827 - main - INFO - 
2025-11-26 17:27:37,827 - main - INFO -      Management:
2025-11-26 17:27:37,827 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:27:37,828 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:27:37,828 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:27:37,828 - main - INFO - 
2025-11-26 17:27:37,828 - main - INFO -      Documents (MongoDB):
2025-11-26 17:27:37,828 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:27:37,829 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:27:37,829 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:27:37,831 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:27:37,831 - main - INFO - 
2025-11-26 17:27:37,831 - main - INFO -      Diagnostics & Health:
2025-11-26 17:27:37,832 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:27:37,860 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:27:37,861 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:27:37,862 - main - INFO - 
2025-11-26 17:27:37,879 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:27:37,884 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:27:37,886 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:27:37,886 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:27:37,887 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:27:37,888 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:27:37,888 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:27:37,889 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:27:37,890 - main - INFO - 
2025-11-26 17:27:37,892 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:27:37,894 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:27:37,895 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:27:37,895 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:27:37,896 - main - INFO -      4. No re-upload needed!
2025-11-26 17:27:37,896 - main - INFO - 
2025-11-26 17:27:37,896 - main - INFO - ================================================================================
2025-11-26 17:27:37,896 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:27:37,897 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:27:37,897 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:27:37,897 - main - INFO - ================================================================================
2025-11-26 17:27:37,897 - main - INFO - 
2025-11-26 17:27:37,898 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:27:38,837 - main - INFO - 
2025-11-26 17:27:38,838 - main - INFO - ================================================================================
2025-11-26 17:27:38,838 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:27:38,839 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:27:38,840 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:27:38,841 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:27:38,841 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:27:38,842 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:27:38,842 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:27:38,843 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:27:38,843 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:27:38,844 - main - INFO - ================================================================================
2025-11-26 17:27:38,844 - main - INFO - 
2025-11-26 17:27:43,214 - main - INFO - 
2025-11-26 17:27:43,215 - main - INFO - ================================================================================
2025-11-26 17:27:43,215 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:27:43,215 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:27:43,215 - main - INFO - ================================================================================
2025-11-26 17:27:43,215 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:27:43,215 - main - INFO -   Upload Directory: uploads
2025-11-26 17:27:43,216 - main - INFO -   Max File Size: 20MB
2025-11-26 17:27:43,216 - main - INFO - ================================================================================
2025-11-26 17:27:43,216 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:27:43,216 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:27:43,217 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:27:43,245 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:27:43,249 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:27:43,249 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:27:43,249 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:27:43,250 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:27:43,250 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:27:43,262 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:27:43,263 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:27:43,264 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:27:43,265 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:27:43,265 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:27:43,266 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:27:43,266 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:27:43,266 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:27:43,278 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:27:43,279 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:27:43,279 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:27:43,279 - main - INFO - 
2025-11-26 17:27:43,279 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:27:43,279 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:27:43,280 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:27:43,280 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:27:43,280 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:27:43,280 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:27:43,280 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:27:43,280 - main - INFO - 
2025-11-26 17:27:43,280 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:27:43,281 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:27:43,281 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:27:43,281 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:27:43,281 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:27:43,281 - main - INFO - 
2025-11-26 17:27:43,281 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:27:43,282 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:27:43,282 - main - INFO -        - No manual section generation
2025-11-26 17:27:43,282 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:27:43,282 - main - INFO - 
2025-11-26 17:27:43,282 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:27:43,282 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:27:43,282 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:27:43,283 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:27:43,283 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:27:43,283 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:27:43,283 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:27:43,283 - main - INFO - 
2025-11-26 17:27:43,283 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:27:43,284 - main - INFO -      Main:
2025-11-26 17:27:43,284 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:27:43,284 - main - INFO - 
2025-11-26 17:27:43,285 - main - INFO -      Retrieval:
2025-11-26 17:27:43,286 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:27:43,287 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:27:43,288 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:27:43,288 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:27:43,289 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:27:43,289 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:27:43,289 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:27:43,290 - main - INFO - 
2025-11-26 17:27:43,290 - main - INFO -      Management:
2025-11-26 17:27:43,290 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:27:43,291 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:27:43,291 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:27:43,291 - main - INFO - 
2025-11-26 17:27:43,291 - main - INFO -      Documents (MongoDB):
2025-11-26 17:27:43,292 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:27:43,292 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:27:43,292 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:27:43,292 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:27:43,292 - main - INFO - 
2025-11-26 17:27:43,293 - main - INFO -      Diagnostics & Health:
2025-11-26 17:27:43,293 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:27:43,293 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:27:43,293 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:27:43,294 - main - INFO - 
2025-11-26 17:27:43,294 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:27:43,294 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:27:43,294 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:27:43,294 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:27:43,294 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:27:43,295 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:27:43,295 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:27:43,295 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:27:43,295 - main - INFO - 
2025-11-26 17:27:43,295 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:27:43,295 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:27:43,296 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:27:43,296 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:27:43,296 - main - INFO -      4. No re-upload needed!
2025-11-26 17:27:43,296 - main - INFO - 
2025-11-26 17:27:43,296 - main - INFO - ================================================================================
2025-11-26 17:27:43,296 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:27:43,296 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:27:43,297 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:27:43,297 - main - INFO - ================================================================================
2025-11-26 17:27:43,297 - main - INFO - 
2025-11-26 17:27:43,297 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:27:45,670 - main - INFO - 
2025-11-26 17:27:45,671 - main - INFO - ================================================================================
2025-11-26 17:27:45,671 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:27:45,674 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:27:45,675 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:27:45,676 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:27:45,677 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:27:45,679 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:27:45,680 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:27:45,680 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:27:45,681 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:27:45,682 - main - INFO - ================================================================================
2025-11-26 17:27:45,683 - main - INFO - 
2025-11-26 17:27:49,232 - main - INFO - 
2025-11-26 17:27:49,232 - main - INFO - ================================================================================
2025-11-26 17:27:49,233 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:27:49,233 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:27:49,233 - main - INFO - ================================================================================
2025-11-26 17:27:49,233 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:27:49,234 - main - INFO -   Upload Directory: uploads
2025-11-26 17:27:49,234 - main - INFO -   Max File Size: 20MB
2025-11-26 17:27:49,234 - main - INFO - ================================================================================
2025-11-26 17:27:49,235 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:27:49,237 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:27:49,238 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:27:49,261 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:27:49,266 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:27:49,266 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:27:49,266 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:27:49,267 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:27:49,267 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:27:49,312 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:27:49,314 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:27:49,317 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:27:49,323 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:27:49,324 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:27:49,324 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:27:49,325 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:27:49,326 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:27:49,364 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:27:49,365 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:27:49,365 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:27:49,365 - main - INFO - 
2025-11-26 17:27:49,366 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:27:49,366 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:27:49,367 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:27:49,367 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:27:49,367 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:27:49,368 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:27:49,368 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:27:49,369 - main - INFO - 
2025-11-26 17:27:49,370 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:27:49,370 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:27:49,371 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:27:49,371 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:27:49,371 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:27:49,372 - main - INFO - 
2025-11-26 17:27:49,372 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:27:49,372 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:27:49,373 - main - INFO -        - No manual section generation
2025-11-26 17:27:49,373 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:27:49,373 - main - INFO - 
2025-11-26 17:27:49,373 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:27:49,374 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:27:49,374 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:27:49,374 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:27:49,375 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:27:49,375 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:27:49,375 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:27:49,375 - main - INFO - 
2025-11-26 17:27:49,375 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:27:49,376 - main - INFO -      Main:
2025-11-26 17:27:49,376 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:27:49,376 - main - INFO - 
2025-11-26 17:27:49,376 - main - INFO -      Retrieval:
2025-11-26 17:27:49,376 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:27:49,377 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:27:49,377 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:27:49,377 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:27:49,378 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:27:49,378 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:27:49,378 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:27:49,379 - main - INFO - 
2025-11-26 17:27:49,379 - main - INFO -      Management:
2025-11-26 17:27:49,379 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:27:49,379 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:27:49,380 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:27:49,380 - main - INFO - 
2025-11-26 17:27:49,380 - main - INFO -      Documents (MongoDB):
2025-11-26 17:27:49,380 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:27:49,380 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:27:49,380 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:27:49,381 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:27:49,381 - main - INFO - 
2025-11-26 17:27:49,381 - main - INFO -      Diagnostics & Health:
2025-11-26 17:27:49,381 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:27:49,381 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:27:49,382 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:27:49,382 - main - INFO - 
2025-11-26 17:27:49,382 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:27:49,382 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:27:49,382 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:27:49,383 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:27:49,383 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:27:49,383 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:27:49,383 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:27:49,383 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:27:49,383 - main - INFO - 
2025-11-26 17:27:49,384 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:27:49,384 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:27:49,384 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:27:49,384 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:27:49,384 - main - INFO -      4. No re-upload needed!
2025-11-26 17:27:49,385 - main - INFO - 
2025-11-26 17:27:49,385 - main - INFO - ================================================================================
2025-11-26 17:27:49,387 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:27:49,387 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:27:49,388 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:27:49,388 - main - INFO - ================================================================================
2025-11-26 17:27:49,389 - main - INFO - 
2025-11-26 17:27:49,389 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:28:52,206 - main - INFO - 
2025-11-26 17:28:52,207 - main - INFO - ================================================================================
2025-11-26 17:28:52,253 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:28:52,256 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:28:52,256 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:28:52,258 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:28:52,259 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:28:52,260 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:28:52,277 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:28:52,277 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:28:52,277 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:28:52,278 - main - INFO - ================================================================================
2025-11-26 17:28:52,278 - main - INFO - 
2025-11-26 17:28:54,932 - main - INFO - 
2025-11-26 17:28:54,932 - main - INFO - ================================================================================
2025-11-26 17:28:54,932 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:28:54,933 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:28:54,933 - main - INFO - ================================================================================
2025-11-26 17:28:54,933 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:28:54,933 - main - INFO -   Upload Directory: uploads
2025-11-26 17:28:54,934 - main - INFO -   Max File Size: 20MB
2025-11-26 17:28:54,934 - main - INFO - ================================================================================
2025-11-26 17:28:54,934 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:28:54,935 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:28:54,935 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:28:54,954 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:28:54,965 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:28:54,965 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:28:54,965 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:28:54,966 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:28:54,966 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:28:54,978 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:28:54,980 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:28:54,981 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:28:54,982 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:28:54,983 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:28:54,983 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:28:54,983 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:28:54,983 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:28:54,991 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:28:54,991 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:28:54,991 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:28:54,992 - main - INFO - 
2025-11-26 17:28:54,992 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:28:54,992 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:28:54,992 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:28:54,992 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:28:54,992 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:28:54,993 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:28:54,993 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:28:54,993 - main - INFO - 
2025-11-26 17:28:54,993 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:28:54,993 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:28:54,993 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:28:54,994 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:28:54,994 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:28:54,994 - main - INFO - 
2025-11-26 17:28:54,994 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:28:54,994 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:28:54,995 - main - INFO -        - No manual section generation
2025-11-26 17:28:54,995 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:28:54,995 - main - INFO - 
2025-11-26 17:28:54,995 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:28:54,995 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:28:54,996 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:28:54,996 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:28:54,996 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:28:54,996 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:28:54,997 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:28:54,997 - main - INFO - 
2025-11-26 17:28:54,997 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:28:54,998 - main - INFO -      Main:
2025-11-26 17:28:54,998 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:28:54,998 - main - INFO - 
2025-11-26 17:28:54,998 - main - INFO -      Retrieval:
2025-11-26 17:28:54,998 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:28:54,998 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:28:54,999 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:28:54,999 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:28:54,999 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:28:54,999 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:28:54,999 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:28:55,000 - main - INFO - 
2025-11-26 17:28:55,000 - main - INFO -      Management:
2025-11-26 17:28:55,000 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:28:55,001 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:28:55,002 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:28:55,002 - main - INFO - 
2025-11-26 17:28:55,002 - main - INFO -      Documents (MongoDB):
2025-11-26 17:28:55,002 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:28:55,003 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:28:55,003 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:28:55,003 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:28:55,004 - main - INFO - 
2025-11-26 17:28:55,004 - main - INFO -      Diagnostics & Health:
2025-11-26 17:28:55,005 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:28:55,006 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:28:55,006 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:28:55,006 - main - INFO - 
2025-11-26 17:28:55,007 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:28:55,007 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:28:55,007 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:28:55,007 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:28:55,008 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:28:55,008 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:28:55,008 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:28:55,008 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:28:55,008 - main - INFO - 
2025-11-26 17:28:55,009 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:28:55,009 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:28:55,009 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:28:55,009 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:28:55,010 - main - INFO -      4. No re-upload needed!
2025-11-26 17:28:55,010 - main - INFO - 
2025-11-26 17:28:55,010 - main - INFO - ================================================================================
2025-11-26 17:28:55,010 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:28:55,011 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:28:55,011 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:28:55,011 - main - INFO - ================================================================================
2025-11-26 17:28:55,011 - main - INFO - 
2025-11-26 17:28:55,012 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:29:14,716 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764177619_37f18418c472/pdf
2025-11-26 17:29:14,717 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:29:14,723 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764177619_37f18418c472
2025-11-26 17:29:14,723 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:29:14,723 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:29:14,724 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:29:14,724 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:29:14,725 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:29:14,726 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:29:14,747 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:29:14,748 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:29:14,749 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:29:14,750 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:29:14,752 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:29:14,752 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:29:14,755 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:29:14,992 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:29:14,992 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764177619_37f18418c472_20251126_172914.pdf (164470 bytes)
2025-11-26 17:29:14,994 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764177619_37f18418c472/pdf - 200 - 0.28s
2025-11-26 17:30:48,100 - main - INFO - 
2025-11-26 17:30:48,101 - main - INFO - ================================================================================
2025-11-26 17:30:48,105 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:30:48,108 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:30:48,110 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:30:48,113 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:30:48,117 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:30:48,119 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:30:48,122 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:30:48,128 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:30:48,128 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:30:48,129 - main - INFO - ================================================================================
2025-11-26 17:30:48,129 - main - INFO - 
2025-11-26 17:30:52,362 - main - INFO - 
2025-11-26 17:30:52,362 - main - INFO - ================================================================================
2025-11-26 17:30:52,362 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:30:52,363 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:30:52,363 - main - INFO - ================================================================================
2025-11-26 17:30:52,363 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:30:52,363 - main - INFO -   Upload Directory: uploads
2025-11-26 17:30:52,364 - main - INFO -   Max File Size: 20MB
2025-11-26 17:30:52,364 - main - INFO - ================================================================================
2025-11-26 17:30:52,364 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:30:52,365 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:30:52,365 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:30:52,393 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:30:52,401 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:30:52,401 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:30:52,402 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:30:52,402 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:30:52,402 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:30:52,415 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:30:52,417 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:30:52,418 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:30:52,421 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:30:52,422 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:30:52,422 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:30:52,422 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:30:52,423 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:30:52,433 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:30:52,433 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:30:52,434 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:30:52,434 - main - INFO - 
2025-11-26 17:30:52,434 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:30:52,434 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:30:52,435 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:30:52,435 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:30:52,435 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:30:52,435 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:30:52,436 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:30:52,436 - main - INFO - 
2025-11-26 17:30:52,436 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:30:52,437 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:30:52,437 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:30:52,437 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:30:52,437 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:30:52,438 - main - INFO - 
2025-11-26 17:30:52,438 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:30:52,438 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:30:52,439 - main - INFO -        - No manual section generation
2025-11-26 17:30:52,439 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:30:52,439 - main - INFO - 
2025-11-26 17:30:52,440 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:30:52,441 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:30:52,441 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:30:52,442 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:30:52,443 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:30:52,443 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:30:52,444 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:30:52,444 - main - INFO - 
2025-11-26 17:30:52,444 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:30:52,445 - main - INFO -      Main:
2025-11-26 17:30:52,445 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:30:52,445 - main - INFO - 
2025-11-26 17:30:52,445 - main - INFO -      Retrieval:
2025-11-26 17:30:52,445 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:30:52,446 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:30:52,446 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:30:52,446 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:30:52,446 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:30:52,447 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:30:52,447 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:30:52,447 - main - INFO - 
2025-11-26 17:30:52,447 - main - INFO -      Management:
2025-11-26 17:30:52,447 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:30:52,448 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:30:52,448 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:30:52,448 - main - INFO - 
2025-11-26 17:30:52,448 - main - INFO -      Documents (MongoDB):
2025-11-26 17:30:52,449 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:30:52,449 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:30:52,449 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:30:52,449 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:30:52,449 - main - INFO - 
2025-11-26 17:30:52,449 - main - INFO -      Diagnostics & Health:
2025-11-26 17:30:52,450 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:30:52,450 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:30:52,450 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:30:52,450 - main - INFO - 
2025-11-26 17:30:52,450 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:30:52,450 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:30:52,451 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:30:52,451 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:30:52,451 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:30:52,451 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:30:52,451 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:30:52,452 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:30:52,452 - main - INFO - 
2025-11-26 17:30:52,452 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:30:52,452 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:30:52,453 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:30:52,453 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:30:52,453 - main - INFO -      4. No re-upload needed!
2025-11-26 17:30:52,453 - main - INFO - 
2025-11-26 17:30:52,453 - main - INFO - ================================================================================
2025-11-26 17:30:52,454 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:30:52,454 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:30:52,454 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:30:52,455 - main - INFO - ================================================================================
2025-11-26 17:30:52,455 - main - INFO - 
2025-11-26 17:30:52,455 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:31:06,111 - main - INFO - 
2025-11-26 17:31:06,111 - main - INFO - ================================================================================
2025-11-26 17:31:06,112 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:31:06,112 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:31:06,113 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:31:06,114 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:31:06,114 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:31:06,115 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:31:06,116 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:31:06,117 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:31:06,117 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:31:06,117 - main - INFO - ================================================================================
2025-11-26 17:31:06,118 - main - INFO - 
2025-11-26 17:31:10,282 - main - INFO - 
2025-11-26 17:31:10,283 - main - INFO - ================================================================================
2025-11-26 17:31:10,283 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:31:10,283 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:31:10,283 - main - INFO - ================================================================================
2025-11-26 17:31:10,283 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:31:10,284 - main - INFO -   Upload Directory: uploads
2025-11-26 17:31:10,284 - main - INFO -   Max File Size: 20MB
2025-11-26 17:31:10,284 - main - INFO - ================================================================================
2025-11-26 17:31:10,286 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:31:10,287 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:31:10,287 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:31:10,337 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:31:10,343 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:31:10,344 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:31:10,344 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:31:10,345 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:31:10,345 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:31:10,355 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:31:10,356 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:31:10,357 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:31:10,360 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:31:10,360 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:31:10,360 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:31:10,360 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:31:10,361 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:31:10,371 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:31:10,371 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:31:10,372 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:31:10,372 - main - INFO - 
2025-11-26 17:31:10,372 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:31:10,372 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:31:10,372 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:31:10,373 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:31:10,373 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:31:10,373 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:31:10,373 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:31:10,373 - main - INFO - 
2025-11-26 17:31:10,373 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:31:10,374 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:31:10,374 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:31:10,374 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:31:10,374 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:31:10,374 - main - INFO - 
2025-11-26 17:31:10,375 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:31:10,375 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:31:10,375 - main - INFO -        - No manual section generation
2025-11-26 17:31:10,376 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:31:10,376 - main - INFO - 
2025-11-26 17:31:10,376 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:31:10,377 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:31:10,377 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:31:10,377 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:31:10,377 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:31:10,378 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:31:10,378 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:31:10,378 - main - INFO - 
2025-11-26 17:31:10,378 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:31:10,378 - main - INFO -      Main:
2025-11-26 17:31:10,379 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:31:10,379 - main - INFO - 
2025-11-26 17:31:10,379 - main - INFO -      Retrieval:
2025-11-26 17:31:10,379 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:31:10,380 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:31:10,380 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:31:10,380 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:31:10,380 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:31:10,381 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:31:10,382 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:31:10,382 - main - INFO - 
2025-11-26 17:31:10,383 - main - INFO -      Management:
2025-11-26 17:31:10,383 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:31:10,383 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:31:10,383 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:31:10,383 - main - INFO - 
2025-11-26 17:31:10,384 - main - INFO -      Documents (MongoDB):
2025-11-26 17:31:10,384 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:31:10,384 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:31:10,384 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:31:10,384 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:31:10,385 - main - INFO - 
2025-11-26 17:31:10,385 - main - INFO -      Diagnostics & Health:
2025-11-26 17:31:10,386 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:31:10,386 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:31:10,386 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:31:10,387 - main - INFO - 
2025-11-26 17:31:10,387 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:31:10,387 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:31:10,387 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:31:10,388 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:31:10,388 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:31:10,388 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:31:10,388 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:31:10,388 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:31:10,389 - main - INFO - 
2025-11-26 17:31:10,389 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:31:10,389 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:31:10,389 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:31:10,389 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:31:10,389 - main - INFO -      4. No re-upload needed!
2025-11-26 17:31:10,389 - main - INFO - 
2025-11-26 17:31:10,390 - main - INFO - ================================================================================
2025-11-26 17:31:10,390 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:31:10,390 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:31:10,390 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:31:10,390 - main - INFO - ================================================================================
2025-11-26 17:31:10,391 - main - INFO - 
2025-11-26 17:31:10,391 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:31:35,216 - main - INFO - 
2025-11-26 17:31:35,225 - main - INFO - ================================================================================
2025-11-26 17:31:35,240 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:31:35,281 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:31:35,302 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:31:35,335 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:31:35,336 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:31:35,338 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:31:35,338 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:31:35,339 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:31:35,339 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:31:35,339 - main - INFO - ================================================================================
2025-11-26 17:31:35,339 - main - INFO - 
2025-11-26 17:31:38,551 - main - INFO - 
2025-11-26 17:31:38,551 - main - INFO - ================================================================================
2025-11-26 17:31:38,552 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:31:38,552 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:31:38,552 - main - INFO - ================================================================================
2025-11-26 17:31:38,553 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:31:38,553 - main - INFO -   Upload Directory: uploads
2025-11-26 17:31:38,553 - main - INFO -   Max File Size: 20MB
2025-11-26 17:31:38,553 - main - INFO - ================================================================================
2025-11-26 17:31:38,554 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:31:38,554 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:31:38,554 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:31:38,609 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:31:38,620 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:31:38,621 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:31:38,622 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:31:38,622 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:31:38,623 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:31:38,658 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:31:38,660 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:31:38,662 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:31:38,664 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:31:38,664 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:31:38,664 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:31:38,665 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:31:38,665 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:31:38,674 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:31:38,674 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:31:38,675 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:31:38,675 - main - INFO - 
2025-11-26 17:31:38,675 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:31:38,676 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:31:38,676 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:31:38,676 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:31:38,677 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:31:38,677 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:31:38,677 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:31:38,677 - main - INFO - 
2025-11-26 17:31:38,677 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:31:38,678 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:31:38,678 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:31:38,678 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:31:38,678 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:31:38,678 - main - INFO - 
2025-11-26 17:31:38,678 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:31:38,679 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:31:38,679 - main - INFO -        - No manual section generation
2025-11-26 17:31:38,679 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:31:38,679 - main - INFO - 
2025-11-26 17:31:38,679 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:31:38,679 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:31:38,680 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:31:38,680 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:31:38,680 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:31:38,680 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:31:38,680 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:31:38,680 - main - INFO - 
2025-11-26 17:31:38,680 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:31:38,681 - main - INFO -      Main:
2025-11-26 17:31:38,681 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:31:38,681 - main - INFO - 
2025-11-26 17:31:38,681 - main - INFO -      Retrieval:
2025-11-26 17:31:38,681 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:31:38,681 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:31:38,681 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:31:38,682 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:31:38,682 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:31:38,682 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:31:38,682 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:31:38,682 - main - INFO - 
2025-11-26 17:31:38,682 - main - INFO -      Management:
2025-11-26 17:31:38,682 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:31:38,682 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:31:38,683 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:31:38,683 - main - INFO - 
2025-11-26 17:31:38,683 - main - INFO -      Documents (MongoDB):
2025-11-26 17:31:38,683 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:31:38,683 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:31:38,683 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:31:38,683 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:31:38,684 - main - INFO - 
2025-11-26 17:31:38,684 - main - INFO -      Diagnostics & Health:
2025-11-26 17:31:38,684 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:31:38,684 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:31:38,684 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:31:38,685 - main - INFO - 
2025-11-26 17:31:38,685 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:31:38,686 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:31:38,686 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:31:38,686 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:31:38,686 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:31:38,687 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:31:38,687 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:31:38,687 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:31:38,687 - main - INFO - 
2025-11-26 17:31:38,687 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:31:38,688 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:31:38,688 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:31:38,688 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:31:38,688 - main - INFO -      4. No re-upload needed!
2025-11-26 17:31:38,688 - main - INFO - 
2025-11-26 17:31:38,688 - main - INFO - ================================================================================
2025-11-26 17:31:38,689 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:31:38,689 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:31:38,689 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:31:38,689 - main - INFO - ================================================================================
2025-11-26 17:31:38,690 - main - INFO - 
2025-11-26 17:31:38,690 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:31:42,681 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764177619_37f18418c472/pdf
2025-11-26 17:31:42,682 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:31:42,687 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764177619_37f18418c472
2025-11-26 17:31:42,688 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:31:42,688 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:31:42,689 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:31:42,689 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:31:42,690 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:31:42,691 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:31:42,714 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:31:42,714 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:31:42,716 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:31:42,716 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:31:42,719 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:31:42,719 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:31:42,721 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:31:42,958 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:31:42,959 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764177619_37f18418c472_20251126_173142.pdf (164476 bytes)
2025-11-26 17:31:42,960 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764177619_37f18418c472/pdf - 200 - 0.28s
2025-11-26 17:33:27,185 - main - INFO - 
2025-11-26 17:33:27,186 - main - INFO - ================================================================================
2025-11-26 17:33:27,186 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:33:27,189 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:33:27,190 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:33:27,191 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:33:27,191 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:33:27,192 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:33:27,193 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:33:27,193 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:33:27,194 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:33:27,194 - main - INFO - ================================================================================
2025-11-26 17:33:27,194 - main - INFO - 
2025-11-26 17:33:30,684 - main - INFO - 
2025-11-26 17:33:30,684 - main - INFO - ================================================================================
2025-11-26 17:33:30,685 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:33:30,686 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:33:30,686 - main - INFO - ================================================================================
2025-11-26 17:33:30,686 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:33:30,687 - main - INFO -   Upload Directory: uploads
2025-11-26 17:33:30,687 - main - INFO -   Max File Size: 20MB
2025-11-26 17:33:30,687 - main - INFO - ================================================================================
2025-11-26 17:33:30,688 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:33:30,688 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:33:30,688 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:33:30,713 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:33:30,717 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:33:30,717 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:33:30,718 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:33:30,718 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:33:30,718 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:33:30,729 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:33:30,730 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:33:30,731 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:33:30,733 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:33:30,734 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:33:30,734 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:33:30,734 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:33:30,735 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:33:30,748 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:33:30,749 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:33:30,749 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:33:30,749 - main - INFO - 
2025-11-26 17:33:30,750 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:33:30,750 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:33:30,750 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:33:30,751 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:33:30,751 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:33:30,752 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:33:30,752 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:33:30,752 - main - INFO - 
2025-11-26 17:33:30,752 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:33:30,753 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:33:30,753 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:33:30,753 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:33:30,754 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:33:30,754 - main - INFO - 
2025-11-26 17:33:30,754 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:33:30,755 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:33:30,755 - main - INFO -        - No manual section generation
2025-11-26 17:33:30,755 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:33:30,755 - main - INFO - 
2025-11-26 17:33:30,755 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:33:30,756 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:33:30,756 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:33:30,756 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:33:30,756 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:33:30,757 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:33:30,757 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:33:30,757 - main - INFO - 
2025-11-26 17:33:30,757 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:33:30,757 - main - INFO -      Main:
2025-11-26 17:33:30,758 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:33:30,758 - main - INFO - 
2025-11-26 17:33:30,758 - main - INFO -      Retrieval:
2025-11-26 17:33:30,758 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:33:30,759 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:33:30,759 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:33:30,759 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:33:30,760 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:33:30,760 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:33:30,760 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:33:30,761 - main - INFO - 
2025-11-26 17:33:30,761 - main - INFO -      Management:
2025-11-26 17:33:30,761 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:33:30,761 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:33:30,762 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:33:30,762 - main - INFO - 
2025-11-26 17:33:30,763 - main - INFO -      Documents (MongoDB):
2025-11-26 17:33:30,763 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:33:30,764 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:33:30,764 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:33:30,766 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:33:30,766 - main - INFO - 
2025-11-26 17:33:30,767 - main - INFO -      Diagnostics & Health:
2025-11-26 17:33:30,767 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:33:30,767 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:33:30,767 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:33:30,768 - main - INFO - 
2025-11-26 17:33:30,768 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:33:30,768 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:33:30,768 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:33:30,768 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:33:30,768 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:33:30,769 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:33:30,769 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:33:30,769 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:33:30,769 - main - INFO - 
2025-11-26 17:33:30,769 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:33:30,769 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:33:30,769 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:33:30,770 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:33:30,770 - main - INFO -      4. No re-upload needed!
2025-11-26 17:33:30,770 - main - INFO - 
2025-11-26 17:33:30,770 - main - INFO - ================================================================================
2025-11-26 17:33:30,770 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:33:30,770 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:33:30,771 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:33:30,771 - main - INFO - ================================================================================
2025-11-26 17:33:30,771 - main - INFO - 
2025-11-26 17:33:30,771 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:33:32,022 - main - INFO - 
2025-11-26 17:33:32,022 - main - INFO - ================================================================================
2025-11-26 17:33:32,023 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:33:32,024 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:33:32,024 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:33:32,025 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:33:32,025 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:33:32,026 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:33:32,026 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:33:32,027 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:33:32,027 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:33:32,027 - main - INFO - ================================================================================
2025-11-26 17:33:32,027 - main - INFO - 
2025-11-26 17:33:35,707 - main - INFO - 
2025-11-26 17:33:35,708 - main - INFO - ================================================================================
2025-11-26 17:33:35,708 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:33:35,708 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:33:35,709 - main - INFO - ================================================================================
2025-11-26 17:33:35,709 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:33:35,709 - main - INFO -   Upload Directory: uploads
2025-11-26 17:33:35,709 - main - INFO -   Max File Size: 20MB
2025-11-26 17:33:35,709 - main - INFO - ================================================================================
2025-11-26 17:33:35,710 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:33:35,710 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:33:35,710 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:33:35,735 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:33:35,744 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:33:35,745 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:33:35,745 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:33:35,745 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:33:35,745 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:33:35,755 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:33:35,758 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:33:35,759 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:33:35,761 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:33:35,761 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:33:35,761 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:33:35,761 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:33:35,762 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:33:35,775 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:33:35,775 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:33:35,775 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:33:35,775 - main - INFO - 
2025-11-26 17:33:35,776 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:33:35,776 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:33:35,776 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:33:35,776 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:33:35,776 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:33:35,777 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:33:35,777 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:33:35,777 - main - INFO - 
2025-11-26 17:33:35,777 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:33:35,777 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:33:35,777 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:33:35,778 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:33:35,778 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:33:35,778 - main - INFO - 
2025-11-26 17:33:35,778 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:33:35,778 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:33:35,779 - main - INFO -        - No manual section generation
2025-11-26 17:33:35,779 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:33:35,779 - main - INFO - 
2025-11-26 17:33:35,779 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:33:35,779 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:33:35,779 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:33:35,780 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:33:35,780 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:33:35,780 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:33:35,780 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:33:35,780 - main - INFO - 
2025-11-26 17:33:35,780 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:33:35,781 - main - INFO -      Main:
2025-11-26 17:33:35,781 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:33:35,781 - main - INFO - 
2025-11-26 17:33:35,781 - main - INFO -      Retrieval:
2025-11-26 17:33:35,781 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:33:35,781 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:33:35,781 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:33:35,782 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:33:35,782 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:33:35,782 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:33:35,782 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:33:35,782 - main - INFO - 
2025-11-26 17:33:35,782 - main - INFO -      Management:
2025-11-26 17:33:35,783 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:33:35,783 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:33:35,783 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:33:35,783 - main - INFO - 
2025-11-26 17:33:35,783 - main - INFO -      Documents (MongoDB):
2025-11-26 17:33:35,783 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:33:35,784 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:33:35,784 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:33:35,784 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:33:35,784 - main - INFO - 
2025-11-26 17:33:35,784 - main - INFO -      Diagnostics & Health:
2025-11-26 17:33:35,785 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:33:35,786 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:33:35,787 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:33:35,787 - main - INFO - 
2025-11-26 17:33:35,788 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:33:35,788 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:33:35,788 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:33:35,788 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:33:35,788 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:33:35,789 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:33:35,789 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:33:35,789 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:33:35,790 - main - INFO - 
2025-11-26 17:33:35,791 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:33:35,791 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:33:35,791 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:33:35,791 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:33:35,792 - main - INFO -      4. No re-upload needed!
2025-11-26 17:33:35,792 - main - INFO - 
2025-11-26 17:33:35,792 - main - INFO - ================================================================================
2025-11-26 17:33:35,792 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:33:35,792 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:33:35,793 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:33:35,793 - main - INFO - ================================================================================
2025-11-26 17:33:35,793 - main - INFO - 
2025-11-26 17:33:35,793 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:33:37,934 - main - INFO - 
2025-11-26 17:33:37,935 - main - INFO - ================================================================================
2025-11-26 17:33:37,935 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:33:37,936 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:33:37,936 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:33:37,937 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:33:37,937 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:33:37,938 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:33:37,938 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:33:37,939 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:33:37,939 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:33:37,939 - main - INFO - ================================================================================
2025-11-26 17:33:37,939 - main - INFO - 
2025-11-26 17:33:41,698 - main - INFO - 
2025-11-26 17:33:41,698 - main - INFO - ================================================================================
2025-11-26 17:33:41,698 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:33:41,698 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:33:41,698 - main - INFO - ================================================================================
2025-11-26 17:33:41,699 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:33:41,699 - main - INFO -   Upload Directory: uploads
2025-11-26 17:33:41,699 - main - INFO -   Max File Size: 20MB
2025-11-26 17:33:41,699 - main - INFO - ================================================================================
2025-11-26 17:33:41,699 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:33:41,700 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:33:41,700 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:33:41,726 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:33:41,732 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:33:41,732 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:33:41,732 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:33:41,733 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:33:41,733 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:33:41,745 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:33:41,746 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:33:41,747 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:33:41,749 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:33:41,749 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:33:41,749 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:33:41,750 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:33:41,750 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:33:41,762 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:33:41,763 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:33:41,763 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:33:41,763 - main - INFO - 
2025-11-26 17:33:41,764 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:33:41,764 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:33:41,764 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:33:41,764 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:33:41,764 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:33:41,765 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:33:41,765 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:33:41,765 - main - INFO - 
2025-11-26 17:33:41,765 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:33:41,765 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:33:41,766 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:33:41,766 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:33:41,766 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:33:41,766 - main - INFO - 
2025-11-26 17:33:41,766 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:33:41,766 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:33:41,767 - main - INFO -        - No manual section generation
2025-11-26 17:33:41,767 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:33:41,767 - main - INFO - 
2025-11-26 17:33:41,767 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:33:41,767 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:33:41,768 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:33:41,768 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:33:41,768 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:33:41,768 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:33:41,769 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:33:41,769 - main - INFO - 
2025-11-26 17:33:41,769 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:33:41,769 - main - INFO -      Main:
2025-11-26 17:33:41,770 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:33:41,770 - main - INFO - 
2025-11-26 17:33:41,770 - main - INFO -      Retrieval:
2025-11-26 17:33:41,771 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:33:41,771 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:33:41,771 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:33:41,772 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:33:41,772 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:33:41,772 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:33:41,773 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:33:41,775 - main - INFO - 
2025-11-26 17:33:41,776 - main - INFO -      Management:
2025-11-26 17:33:41,776 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:33:41,777 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:33:41,777 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:33:41,777 - main - INFO - 
2025-11-26 17:33:41,777 - main - INFO -      Documents (MongoDB):
2025-11-26 17:33:41,778 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:33:41,778 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:33:41,778 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:33:41,778 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:33:41,779 - main - INFO - 
2025-11-26 17:33:41,779 - main - INFO -      Diagnostics & Health:
2025-11-26 17:33:41,779 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:33:41,779 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:33:41,779 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:33:41,780 - main - INFO - 
2025-11-26 17:33:41,780 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:33:41,780 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:33:41,780 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:33:41,780 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:33:41,781 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:33:41,781 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:33:41,781 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:33:41,781 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:33:41,781 - main - INFO - 
2025-11-26 17:33:41,782 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:33:41,782 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:33:41,782 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:33:41,782 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:33:41,782 - main - INFO -      4. No re-upload needed!
2025-11-26 17:33:41,782 - main - INFO - 
2025-11-26 17:33:41,783 - main - INFO - ================================================================================
2025-11-26 17:33:41,783 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:33:41,783 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:33:41,783 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:33:41,783 - main - INFO - ================================================================================
2025-11-26 17:33:41,783 - main - INFO - 
2025-11-26 17:33:41,784 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:34:16,271 - main - INFO - 
2025-11-26 17:34:16,272 - main - INFO - ================================================================================
2025-11-26 17:34:16,273 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:34:16,275 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:34:16,275 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:34:16,277 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:34:16,278 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:34:16,280 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:34:16,280 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:34:16,281 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:34:16,282 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:34:16,282 - main - INFO - ================================================================================
2025-11-26 17:34:16,283 - main - INFO - 
2025-11-26 17:34:19,775 - main - INFO - 
2025-11-26 17:34:19,775 - main - INFO - ================================================================================
2025-11-26 17:34:19,775 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:34:19,775 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:34:19,776 - main - INFO - ================================================================================
2025-11-26 17:34:19,776 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:34:19,776 - main - INFO -   Upload Directory: uploads
2025-11-26 17:34:19,776 - main - INFO -   Max File Size: 20MB
2025-11-26 17:34:19,777 - main - INFO - ================================================================================
2025-11-26 17:34:19,777 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:34:19,777 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:34:19,777 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:34:19,815 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:34:19,823 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:34:19,824 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:34:19,824 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:34:19,825 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:34:19,825 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:34:19,859 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:34:19,861 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:34:19,864 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:34:19,866 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:34:19,867 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:34:19,867 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:34:19,867 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:34:19,868 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:34:19,903 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:34:19,904 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:34:19,904 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:34:19,904 - main - INFO - 
2025-11-26 17:34:19,904 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:34:19,905 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:34:19,905 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:34:19,905 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:34:19,905 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:34:19,906 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:34:19,906 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:34:19,906 - main - INFO - 
2025-11-26 17:34:19,906 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:34:19,907 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:34:19,907 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:34:19,907 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:34:19,907 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:34:19,908 - main - INFO - 
2025-11-26 17:34:19,908 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:34:19,908 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:34:19,908 - main - INFO -        - No manual section generation
2025-11-26 17:34:19,908 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:34:19,909 - main - INFO - 
2025-11-26 17:34:19,909 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:34:19,909 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:34:19,909 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:34:19,910 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:34:19,910 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:34:19,910 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:34:19,911 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:34:19,911 - main - INFO - 
2025-11-26 17:34:19,912 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:34:19,912 - main - INFO -      Main:
2025-11-26 17:34:19,912 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:34:19,913 - main - INFO - 
2025-11-26 17:34:19,913 - main - INFO -      Retrieval:
2025-11-26 17:34:19,913 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:34:19,913 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:34:19,913 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:34:19,914 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:34:19,914 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:34:19,914 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:34:19,914 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:34:19,914 - main - INFO - 
2025-11-26 17:34:19,915 - main - INFO -      Management:
2025-11-26 17:34:19,915 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:34:19,915 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:34:19,915 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:34:19,915 - main - INFO - 
2025-11-26 17:34:19,915 - main - INFO -      Documents (MongoDB):
2025-11-26 17:34:19,916 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:34:19,916 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:34:19,916 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:34:19,916 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:34:19,916 - main - INFO - 
2025-11-26 17:34:19,916 - main - INFO -      Diagnostics & Health:
2025-11-26 17:34:19,916 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:34:19,917 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:34:19,917 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:34:19,917 - main - INFO - 
2025-11-26 17:34:19,917 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:34:19,917 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:34:19,918 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:34:19,918 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:34:19,918 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:34:19,918 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:34:19,918 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:34:19,919 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:34:19,919 - main - INFO - 
2025-11-26 17:34:19,920 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:34:19,920 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:34:19,921 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:34:19,921 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:34:19,921 - main - INFO -      4. No re-upload needed!
2025-11-26 17:34:19,921 - main - INFO - 
2025-11-26 17:34:19,922 - main - INFO - ================================================================================
2025-11-26 17:34:19,922 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:34:19,922 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:34:19,922 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:34:19,923 - main - INFO - ================================================================================
2025-11-26 17:34:19,923 - main - INFO - 
2025-11-26 17:34:19,923 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:34:22,695 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764177619_37f18418c472/pdf
2025-11-26 17:34:22,696 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:34:22,701 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764177619_37f18418c472
2025-11-26 17:34:22,701 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:34:22,702 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:34:22,703 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:34:22,703 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:34:22,704 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:34:22,705 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:34:22,731 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:34:22,732 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:34:22,734 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:34:22,735 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:34:22,739 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:34:22,739 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:34:22,742 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:34:22,989 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:34:22,990 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764177619_37f18418c472_20251126_173422.pdf (164542 bytes)
2025-11-26 17:34:22,991 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764177619_37f18418c472/pdf - 200 - 0.30s
2025-11-26 17:36:37,681 - main - INFO - 
2025-11-26 17:36:37,682 - main - INFO - ================================================================================
2025-11-26 17:36:37,682 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:36:37,683 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:36:37,684 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:36:37,686 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:36:37,686 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:36:37,688 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:36:37,688 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:36:37,689 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:36:37,689 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:36:37,690 - main - INFO - ================================================================================
2025-11-26 17:36:37,690 - main - INFO - 
2025-11-26 17:36:41,552 - main - INFO - 
2025-11-26 17:36:41,556 - main - INFO - ================================================================================
2025-11-26 17:36:41,557 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:36:41,558 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:36:41,558 - main - INFO - ================================================================================
2025-11-26 17:36:41,559 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:36:41,559 - main - INFO -   Upload Directory: uploads
2025-11-26 17:36:41,559 - main - INFO -   Max File Size: 20MB
2025-11-26 17:36:41,560 - main - INFO - ================================================================================
2025-11-26 17:36:41,560 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:36:41,561 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:36:41,561 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:36:41,592 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:36:41,600 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:36:41,600 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:36:41,601 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:36:41,602 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:41,602 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:36:41,611 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:36:41,614 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:36:41,616 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:36:41,621 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:36:41,622 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:36:41,622 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:36:41,623 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:41,623 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:36:41,631 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:36:41,631 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:36:41,631 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:36:41,632 - main - INFO - 
2025-11-26 17:36:41,632 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:36:41,632 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:36:41,632 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:36:41,633 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:36:41,633 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:36:41,633 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:36:41,635 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:36:41,635 - main - INFO - 
2025-11-26 17:36:41,635 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:36:41,635 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:36:41,636 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:36:41,636 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:36:41,636 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:36:41,636 - main - INFO - 
2025-11-26 17:36:41,637 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:36:41,637 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:36:41,637 - main - INFO -        - No manual section generation
2025-11-26 17:36:41,637 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:36:41,638 - main - INFO - 
2025-11-26 17:36:41,638 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:36:41,638 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:36:41,638 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:36:41,638 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:36:41,639 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:36:41,639 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:36:41,639 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:36:41,639 - main - INFO - 
2025-11-26 17:36:41,639 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:36:41,639 - main - INFO -      Main:
2025-11-26 17:36:41,640 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:36:41,640 - main - INFO - 
2025-11-26 17:36:41,640 - main - INFO -      Retrieval:
2025-11-26 17:36:41,640 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:36:41,640 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:36:41,641 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:36:41,641 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:36:41,641 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:36:41,641 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:36:41,642 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:36:41,642 - main - INFO - 
2025-11-26 17:36:41,642 - main - INFO -      Management:
2025-11-26 17:36:41,642 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:36:41,642 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:36:41,643 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:36:41,643 - main - INFO - 
2025-11-26 17:36:41,643 - main - INFO -      Documents (MongoDB):
2025-11-26 17:36:41,644 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:36:41,644 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:36:41,644 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:36:41,645 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:36:41,645 - main - INFO - 
2025-11-26 17:36:41,645 - main - INFO -      Diagnostics & Health:
2025-11-26 17:36:41,646 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:36:41,646 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:36:41,647 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:36:41,648 - main - INFO - 
2025-11-26 17:36:41,648 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:36:41,648 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:36:41,649 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:36:41,649 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:36:41,649 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:36:41,651 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:36:41,652 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:36:41,653 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:36:41,653 - main - INFO - 
2025-11-26 17:36:41,654 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:36:41,654 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:36:41,656 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:36:41,656 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:36:41,658 - main - INFO -      4. No re-upload needed!
2025-11-26 17:36:41,659 - main - INFO - 
2025-11-26 17:36:41,659 - main - INFO - ================================================================================
2025-11-26 17:36:41,660 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:36:41,660 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:36:41,660 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:36:41,660 - main - INFO - ================================================================================
2025-11-26 17:36:41,661 - main - INFO - 
2025-11-26 17:36:41,661 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:36:42,494 - main - INFO - 
2025-11-26 17:36:42,494 - main - INFO - ================================================================================
2025-11-26 17:36:42,494 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:36:42,495 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:36:42,496 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:36:42,497 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:36:42,497 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:36:42,498 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:36:42,498 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:36:42,499 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:36:42,499 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:36:42,499 - main - INFO - ================================================================================
2025-11-26 17:36:42,499 - main - INFO - 
2025-11-26 17:36:46,428 - main - INFO - 
2025-11-26 17:36:46,428 - main - INFO - ================================================================================
2025-11-26 17:36:46,429 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:36:46,429 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:36:46,429 - main - INFO - ================================================================================
2025-11-26 17:36:46,429 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:36:46,430 - main - INFO -   Upload Directory: uploads
2025-11-26 17:36:46,430 - main - INFO -   Max File Size: 20MB
2025-11-26 17:36:46,430 - main - INFO - ================================================================================
2025-11-26 17:36:46,430 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:36:46,430 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:36:46,431 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:36:46,447 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:36:46,452 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:36:46,452 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:36:46,452 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:36:46,453 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:46,453 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:36:46,472 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:36:46,473 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:36:46,474 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:36:46,476 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:36:46,476 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:36:46,476 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:36:46,477 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:46,477 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:36:46,483 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:36:46,484 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:36:46,484 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:36:46,484 - main - INFO - 
2025-11-26 17:36:46,484 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:36:46,484 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:36:46,485 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:36:46,485 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:36:46,485 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:36:46,485 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:36:46,485 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:36:46,486 - main - INFO - 
2025-11-26 17:36:46,486 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:36:46,486 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:36:46,486 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:36:46,486 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:36:46,487 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:36:46,487 - main - INFO - 
2025-11-26 17:36:46,487 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:36:46,487 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:36:46,487 - main - INFO -        - No manual section generation
2025-11-26 17:36:46,488 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:36:46,488 - main - INFO - 
2025-11-26 17:36:46,488 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:36:46,488 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:36:46,488 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:36:46,488 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:36:46,489 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:36:46,489 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:36:46,489 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:36:46,489 - main - INFO - 
2025-11-26 17:36:46,489 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:36:46,489 - main - INFO -      Main:
2025-11-26 17:36:46,490 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:36:46,490 - main - INFO - 
2025-11-26 17:36:46,490 - main - INFO -      Retrieval:
2025-11-26 17:36:46,490 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:36:46,490 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:36:46,491 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:36:46,491 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:36:46,491 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:36:46,491 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:36:46,491 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:36:46,491 - main - INFO - 
2025-11-26 17:36:46,492 - main - INFO -      Management:
2025-11-26 17:36:46,492 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:36:46,492 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:36:46,492 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:36:46,492 - main - INFO - 
2025-11-26 17:36:46,492 - main - INFO -      Documents (MongoDB):
2025-11-26 17:36:46,493 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:36:46,493 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:36:46,493 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:36:46,493 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:36:46,493 - main - INFO - 
2025-11-26 17:36:46,493 - main - INFO -      Diagnostics & Health:
2025-11-26 17:36:46,493 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:36:46,494 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:36:46,494 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:36:46,494 - main - INFO - 
2025-11-26 17:36:46,494 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:36:46,494 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:36:46,494 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:36:46,495 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:36:46,495 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:36:46,495 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:36:46,495 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:36:46,495 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:36:46,495 - main - INFO - 
2025-11-26 17:36:46,495 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:36:46,496 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:36:46,496 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:36:46,496 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:36:46,496 - main - INFO -      4. No re-upload needed!
2025-11-26 17:36:46,496 - main - INFO - 
2025-11-26 17:36:46,496 - main - INFO - ================================================================================
2025-11-26 17:36:46,496 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:36:46,497 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:36:46,497 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:36:46,497 - main - INFO - ================================================================================
2025-11-26 17:36:46,497 - main - INFO - 
2025-11-26 17:36:46,497 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:36:50,684 - main - INFO - 
2025-11-26 17:36:50,684 - main - INFO - ================================================================================
2025-11-26 17:36:50,684 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:36:50,684 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:36:50,684 - main - INFO - ================================================================================
2025-11-26 17:36:50,685 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:36:50,685 - main - INFO -   Upload Directory: uploads
2025-11-26 17:36:50,685 - main - INFO -   Max File Size: 20MB
2025-11-26 17:36:50,685 - main - INFO - ================================================================================
2025-11-26 17:36:50,686 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:36:50,687 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:36:50,687 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:36:50,703 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:36:50,709 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:36:50,709 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:36:50,709 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:36:50,709 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:50,710 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:36:50,716 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:36:50,717 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:36:50,717 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:36:50,719 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:36:50,720 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:36:50,720 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:36:50,720 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:50,720 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:36:50,737 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:36:50,738 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:36:50,738 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:36:50,738 - main - INFO - 
2025-11-26 17:36:50,739 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:36:50,739 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:36:50,739 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:36:50,739 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:36:50,739 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:36:50,740 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:36:50,740 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:36:50,740 - main - INFO - 
2025-11-26 17:36:50,740 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:36:50,740 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:36:50,741 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:36:50,741 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:36:50,741 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:36:50,741 - main - INFO - 
2025-11-26 17:36:50,741 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:36:50,742 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:36:50,742 - main - INFO -        - No manual section generation
2025-11-26 17:36:50,742 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:36:50,742 - main - INFO - 
2025-11-26 17:36:50,743 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:36:50,743 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:36:50,743 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:36:50,743 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:36:50,743 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:36:50,744 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:36:50,744 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:36:50,744 - main - INFO - 
2025-11-26 17:36:50,744 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:36:50,745 - main - INFO -      Main:
2025-11-26 17:36:50,745 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:36:50,745 - main - INFO - 
2025-11-26 17:36:50,745 - main - INFO -      Retrieval:
2025-11-26 17:36:50,745 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:36:50,746 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:36:50,746 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:36:50,746 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:36:50,746 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:36:50,746 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:36:50,746 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:36:50,747 - main - INFO - 
2025-11-26 17:36:50,747 - main - INFO -      Management:
2025-11-26 17:36:50,747 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:36:50,747 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:36:50,747 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:36:50,748 - main - INFO - 
2025-11-26 17:36:50,748 - main - INFO -      Documents (MongoDB):
2025-11-26 17:36:50,748 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:36:50,748 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:36:50,749 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:36:50,749 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:36:50,749 - main - INFO - 
2025-11-26 17:36:50,749 - main - INFO -      Diagnostics & Health:
2025-11-26 17:36:50,749 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:36:50,750 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:36:50,750 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:36:50,750 - main - INFO - 
2025-11-26 17:36:50,750 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:36:50,750 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:36:50,751 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:36:50,751 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:36:50,751 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:36:50,751 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:36:50,751 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:36:50,752 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:36:50,752 - main - INFO - 
2025-11-26 17:36:50,752 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:36:50,752 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:36:50,753 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:36:50,753 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:36:50,753 - main - INFO -      4. No re-upload needed!
2025-11-26 17:36:50,753 - main - INFO - 
2025-11-26 17:36:50,753 - main - INFO - ================================================================================
2025-11-26 17:36:50,754 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:36:50,754 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:36:50,754 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:36:50,754 - main - INFO - ================================================================================
2025-11-26 17:36:50,755 - main - INFO - 
2025-11-26 17:36:50,755 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:36:54,859 - main - INFO - 
2025-11-26 17:36:54,860 - main - INFO - ================================================================================
2025-11-26 17:36:54,860 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:36:54,860 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:36:54,861 - main - INFO - ================================================================================
2025-11-26 17:36:54,861 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:36:54,861 - main - INFO -   Upload Directory: uploads
2025-11-26 17:36:54,861 - main - INFO -   Max File Size: 20MB
2025-11-26 17:36:54,862 - main - INFO - ================================================================================
2025-11-26 17:36:54,862 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:36:54,863 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:36:54,863 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:36:54,895 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:36:54,905 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:36:54,906 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:36:54,907 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:36:54,908 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:54,909 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:36:54,917 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:36:54,919 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:36:54,922 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:36:54,926 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:36:54,927 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:36:54,927 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:36:54,928 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:54,928 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:36:54,941 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:36:54,941 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:36:54,942 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:36:54,942 - main - INFO - 
2025-11-26 17:36:54,942 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:36:54,942 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:36:54,943 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:36:54,943 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:36:54,943 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:36:54,943 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:36:54,944 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:36:54,944 - main - INFO - 
2025-11-26 17:36:54,944 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:36:54,944 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:36:54,944 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:36:54,945 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:36:54,945 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:36:54,945 - main - INFO - 
2025-11-26 17:36:54,945 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:36:54,945 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:36:54,946 - main - INFO -        - No manual section generation
2025-11-26 17:36:54,946 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:36:54,946 - main - INFO - 
2025-11-26 17:36:54,946 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:36:54,947 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:36:54,947 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:36:54,947 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:36:54,947 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:36:54,948 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:36:54,948 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:36:54,948 - main - INFO - 
2025-11-26 17:36:54,948 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:36:54,949 - main - INFO -      Main:
2025-11-26 17:36:54,949 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:36:54,949 - main - INFO - 
2025-11-26 17:36:54,950 - main - INFO -      Retrieval:
2025-11-26 17:36:54,950 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:36:54,950 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:36:54,950 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:36:54,951 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:36:54,951 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:36:54,951 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:36:54,951 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:36:54,952 - main - INFO - 
2025-11-26 17:36:54,953 - main - INFO -      Management:
2025-11-26 17:36:54,953 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:36:54,954 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:36:54,954 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:36:54,954 - main - INFO - 
2025-11-26 17:36:54,955 - main - INFO -      Documents (MongoDB):
2025-11-26 17:36:54,955 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:36:54,955 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:36:54,955 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:36:54,956 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:36:54,956 - main - INFO - 
2025-11-26 17:36:54,956 - main - INFO -      Diagnostics & Health:
2025-11-26 17:36:54,956 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:36:54,957 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:36:54,957 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:36:54,958 - main - INFO - 
2025-11-26 17:36:54,958 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:36:54,958 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:36:54,958 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:36:54,958 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:36:54,959 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:36:54,959 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:36:54,959 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:36:54,959 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:36:54,959 - main - INFO - 
2025-11-26 17:36:54,960 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:36:54,960 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:36:54,960 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:36:54,960 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:36:54,960 - main - INFO -      4. No re-upload needed!
2025-11-26 17:36:54,961 - main - INFO - 
2025-11-26 17:36:54,961 - main - INFO - ================================================================================
2025-11-26 17:36:54,961 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:36:54,962 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:36:54,962 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:36:54,963 - main - INFO - ================================================================================
2025-11-26 17:36:54,963 - main - INFO - 
2025-11-26 17:36:54,964 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:36:58,816 - main - INFO - 
2025-11-26 17:36:58,817 - main - INFO - ================================================================================
2025-11-26 17:36:58,817 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:36:58,817 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:36:58,817 - main - INFO - ================================================================================
2025-11-26 17:36:58,818 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:36:58,818 - main - INFO -   Upload Directory: uploads
2025-11-26 17:36:58,819 - main - INFO -   Max File Size: 20MB
2025-11-26 17:36:58,819 - main - INFO - ================================================================================
2025-11-26 17:36:58,821 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:36:58,822 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:36:58,822 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:36:58,866 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:36:58,878 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:36:58,878 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:36:58,879 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:36:58,879 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:58,879 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:36:58,893 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:36:58,894 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:36:58,895 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:36:58,897 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:36:58,898 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:36:58,898 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:36:58,899 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:36:58,899 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:36:58,914 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:36:58,915 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:36:58,915 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:36:58,915 - main - INFO - 
2025-11-26 17:36:58,916 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:36:58,916 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:36:58,916 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:36:58,916 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:36:58,916 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:36:58,917 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:36:58,917 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:36:58,917 - main - INFO - 
2025-11-26 17:36:58,917 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:36:58,918 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:36:58,920 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:36:58,921 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:36:58,922 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:36:58,922 - main - INFO - 
2025-11-26 17:36:58,923 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:36:58,923 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:36:58,924 - main - INFO -        - No manual section generation
2025-11-26 17:36:58,924 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:36:58,924 - main - INFO - 
2025-11-26 17:36:58,924 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:36:58,925 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:36:58,925 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:36:58,925 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:36:58,925 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:36:58,926 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:36:58,926 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:36:58,927 - main - INFO - 
2025-11-26 17:36:58,927 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:36:58,928 - main - INFO -      Main:
2025-11-26 17:36:58,928 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:36:58,928 - main - INFO - 
2025-11-26 17:36:58,928 - main - INFO -      Retrieval:
2025-11-26 17:36:58,929 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:36:58,929 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:36:58,929 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:36:58,929 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:36:58,930 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:36:58,930 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:36:58,930 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:36:58,930 - main - INFO - 
2025-11-26 17:36:58,930 - main - INFO -      Management:
2025-11-26 17:36:58,931 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:36:58,931 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:36:58,931 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:36:58,931 - main - INFO - 
2025-11-26 17:36:58,931 - main - INFO -      Documents (MongoDB):
2025-11-26 17:36:58,932 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:36:58,932 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:36:58,932 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:36:58,932 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:36:58,932 - main - INFO - 
2025-11-26 17:36:58,932 - main - INFO -      Diagnostics & Health:
2025-11-26 17:36:58,933 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:36:58,933 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:36:58,933 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:36:58,933 - main - INFO - 
2025-11-26 17:36:58,933 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:36:58,934 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:36:58,934 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:36:58,934 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:36:58,934 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:36:58,934 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:36:58,935 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:36:58,936 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:36:58,937 - main - INFO - 
2025-11-26 17:36:58,938 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:36:58,938 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:36:58,939 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:36:58,939 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:36:58,939 - main - INFO -      4. No re-upload needed!
2025-11-26 17:36:58,940 - main - INFO - 
2025-11-26 17:36:58,940 - main - INFO - ================================================================================
2025-11-26 17:36:58,940 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:36:58,940 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:36:58,941 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:36:58,941 - main - INFO - ================================================================================
2025-11-26 17:36:58,942 - main - INFO - 
2025-11-26 17:36:58,943 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:37:02,493 - main - INFO - 
2025-11-26 17:37:02,493 - main - INFO - ================================================================================
2025-11-26 17:37:02,494 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:37:02,494 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:37:02,494 - main - INFO - ================================================================================
2025-11-26 17:37:02,495 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:37:02,496 - main - INFO -   Upload Directory: uploads
2025-11-26 17:37:02,496 - main - INFO -   Max File Size: 20MB
2025-11-26 17:37:02,496 - main - INFO - ================================================================================
2025-11-26 17:37:02,496 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:37:02,497 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:37:02,497 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:37:02,521 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:37:02,530 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:37:02,530 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:37:02,531 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:37:02,531 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:37:02,531 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:37:02,557 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:37:02,558 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:37:02,559 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:37:02,562 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:37:02,563 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:37:02,564 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:37:02,564 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:37:02,564 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:37:02,574 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:37:02,574 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:37:02,574 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:37:02,575 - main - INFO - 
2025-11-26 17:37:02,575 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:37:02,575 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:37:02,575 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:37:02,575 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:37:02,576 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:37:02,576 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:37:02,576 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:37:02,576 - main - INFO - 
2025-11-26 17:37:02,577 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:37:02,577 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:37:02,577 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:37:02,577 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:37:02,578 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:37:02,578 - main - INFO - 
2025-11-26 17:37:02,578 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:37:02,578 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:37:02,579 - main - INFO -        - No manual section generation
2025-11-26 17:37:02,579 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:37:02,579 - main - INFO - 
2025-11-26 17:37:02,579 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:37:02,579 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:37:02,580 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:37:02,580 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:37:02,580 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:37:02,580 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:37:02,581 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:37:02,581 - main - INFO - 
2025-11-26 17:37:02,581 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:37:02,581 - main - INFO -      Main:
2025-11-26 17:37:02,581 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:37:02,582 - main - INFO - 
2025-11-26 17:37:02,582 - main - INFO -      Retrieval:
2025-11-26 17:37:02,582 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:37:02,582 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:37:02,582 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:37:02,583 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:37:02,583 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:37:02,583 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:37:02,583 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:37:02,583 - main - INFO - 
2025-11-26 17:37:02,583 - main - INFO -      Management:
2025-11-26 17:37:02,584 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:37:02,584 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:37:02,584 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:37:02,584 - main - INFO - 
2025-11-26 17:37:02,584 - main - INFO -      Documents (MongoDB):
2025-11-26 17:37:02,584 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:37:02,585 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:37:02,585 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:37:02,586 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:37:02,586 - main - INFO - 
2025-11-26 17:37:02,587 - main - INFO -      Diagnostics & Health:
2025-11-26 17:37:02,587 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:37:02,588 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:37:02,588 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:37:02,588 - main - INFO - 
2025-11-26 17:37:02,588 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:37:02,589 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:37:02,589 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:37:02,589 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:37:02,589 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:37:02,589 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:37:02,589 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:37:02,590 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:37:02,590 - main - INFO - 
2025-11-26 17:37:02,590 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:37:02,590 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:37:02,590 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:37:02,590 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:37:02,591 - main - INFO -      4. No re-upload needed!
2025-11-26 17:37:02,591 - main - INFO - 
2025-11-26 17:37:02,591 - main - INFO - ================================================================================
2025-11-26 17:37:02,591 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:37:02,592 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:37:02,592 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:37:02,592 - main - INFO - ================================================================================
2025-11-26 17:37:02,593 - main - INFO - 
2025-11-26 17:37:02,593 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:37:11,198 - main - INFO - 
2025-11-26 17:37:11,198 - main - INFO - ================================================================================
2025-11-26 17:37:11,199 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:37:11,200 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:37:11,200 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:37:11,202 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:37:11,202 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:37:11,203 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:37:11,204 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:37:11,204 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:37:11,205 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:37:11,205 - main - INFO - ================================================================================
2025-11-26 17:37:11,205 - main - INFO - 
2025-11-26 17:37:14,765 - main - INFO - 
2025-11-26 17:37:14,765 - main - INFO - ================================================================================
2025-11-26 17:37:14,765 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:37:14,766 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:37:14,766 - main - INFO - ================================================================================
2025-11-26 17:37:14,766 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:37:14,766 - main - INFO -   Upload Directory: uploads
2025-11-26 17:37:14,766 - main - INFO -   Max File Size: 20MB
2025-11-26 17:37:14,767 - main - INFO - ================================================================================
2025-11-26 17:37:14,767 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:37:14,767 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:37:14,767 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:37:14,797 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:37:14,805 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:37:14,805 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:37:14,805 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:37:14,806 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:37:14,806 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:37:14,817 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:37:14,818 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:37:14,819 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:37:14,822 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:37:14,822 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:37:14,822 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:37:14,823 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:37:14,823 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:37:14,834 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:37:14,835 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:37:14,835 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:37:14,835 - main - INFO - 
2025-11-26 17:37:14,835 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:37:14,835 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:37:14,836 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:37:14,836 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:37:14,836 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:37:14,836 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:37:14,837 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:37:14,837 - main - INFO - 
2025-11-26 17:37:14,837 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:37:14,837 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:37:14,837 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:37:14,838 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:37:14,838 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:37:14,838 - main - INFO - 
2025-11-26 17:37:14,838 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:37:14,838 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:37:14,839 - main - INFO -        - No manual section generation
2025-11-26 17:37:14,839 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:37:14,839 - main - INFO - 
2025-11-26 17:37:14,839 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:37:14,839 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:37:14,840 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:37:14,840 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:37:14,841 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:37:14,841 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:37:14,841 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:37:14,841 - main - INFO - 
2025-11-26 17:37:14,842 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:37:14,842 - main - INFO -      Main:
2025-11-26 17:37:14,842 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:37:14,842 - main - INFO - 
2025-11-26 17:37:14,842 - main - INFO -      Retrieval:
2025-11-26 17:37:14,843 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:37:14,843 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:37:14,843 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:37:14,843 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:37:14,844 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:37:14,844 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:37:14,844 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:37:14,844 - main - INFO - 
2025-11-26 17:37:14,845 - main - INFO -      Management:
2025-11-26 17:37:14,845 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:37:14,846 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:37:14,847 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:37:14,848 - main - INFO - 
2025-11-26 17:37:14,848 - main - INFO -      Documents (MongoDB):
2025-11-26 17:37:14,849 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:37:14,849 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:37:14,849 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:37:14,849 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:37:14,850 - main - INFO - 
2025-11-26 17:37:14,850 - main - INFO -      Diagnostics & Health:
2025-11-26 17:37:14,850 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:37:14,850 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:37:14,850 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:37:14,851 - main - INFO - 
2025-11-26 17:37:14,851 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:37:14,851 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:37:14,851 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:37:14,851 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:37:14,852 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:37:14,852 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:37:14,852 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:37:14,852 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:37:14,852 - main - INFO - 
2025-11-26 17:37:14,853 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:37:14,853 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:37:14,853 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:37:14,853 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:37:14,853 - main - INFO -      4. No re-upload needed!
2025-11-26 17:37:14,853 - main - INFO - 
2025-11-26 17:37:14,854 - main - INFO - ================================================================================
2025-11-26 17:37:14,854 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:37:14,854 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:37:14,854 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:37:14,854 - main - INFO - ================================================================================
2025-11-26 17:37:14,855 - main - INFO - 
2025-11-26 17:37:14,855 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:37:36,605 - main - INFO - 
2025-11-26 17:37:36,605 - main - INFO - ================================================================================
2025-11-26 17:37:36,605 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:37:36,606 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:37:36,607 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:37:36,607 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:37:36,608 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:37:36,609 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:37:36,609 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:37:36,610 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:37:36,610 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:37:36,610 - main - INFO - ================================================================================
2025-11-26 17:37:36,610 - main - INFO - 
2025-11-26 17:37:39,867 - main - INFO - 
2025-11-26 17:37:39,867 - main - INFO - ================================================================================
2025-11-26 17:37:39,868 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:37:39,868 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:37:39,868 - main - INFO - ================================================================================
2025-11-26 17:37:39,869 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:37:39,869 - main - INFO -   Upload Directory: uploads
2025-11-26 17:37:39,869 - main - INFO -   Max File Size: 20MB
2025-11-26 17:37:39,870 - main - INFO - ================================================================================
2025-11-26 17:37:39,870 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:37:39,870 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:37:39,871 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:37:39,892 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:37:39,900 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:37:39,900 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:37:39,901 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:37:39,901 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:37:39,901 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:37:39,938 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:37:39,948 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:37:39,951 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:37:39,965 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:37:39,966 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:37:39,966 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:37:39,996 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:37:40,007 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:37:40,093 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:37:40,101 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:37:40,103 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:37:40,103 - main - INFO - 
2025-11-26 17:37:40,104 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:37:40,104 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:37:40,105 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:37:40,105 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:37:40,105 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:37:40,106 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:37:40,106 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:37:40,106 - main - INFO - 
2025-11-26 17:37:40,106 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:37:40,106 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:37:40,107 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:37:40,107 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:37:40,107 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:37:40,107 - main - INFO - 
2025-11-26 17:37:40,107 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:37:40,107 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:37:40,108 - main - INFO -        - No manual section generation
2025-11-26 17:37:40,108 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:37:40,108 - main - INFO - 
2025-11-26 17:37:40,108 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:37:40,108 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:37:40,109 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:37:40,109 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:37:40,109 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:37:40,109 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:37:40,109 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:37:40,110 - main - INFO - 
2025-11-26 17:37:40,110 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:37:40,110 - main - INFO -      Main:
2025-11-26 17:37:40,110 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:37:40,110 - main - INFO - 
2025-11-26 17:37:40,110 - main - INFO -      Retrieval:
2025-11-26 17:37:40,111 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:37:40,111 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:37:40,111 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:37:40,111 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:37:40,111 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:37:40,112 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:37:40,112 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:37:40,112 - main - INFO - 
2025-11-26 17:37:40,112 - main - INFO -      Management:
2025-11-26 17:37:40,112 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:37:40,113 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:37:40,113 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:37:40,113 - main - INFO - 
2025-11-26 17:37:40,113 - main - INFO -      Documents (MongoDB):
2025-11-26 17:37:40,113 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:37:40,113 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:37:40,114 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:37:40,114 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:37:40,114 - main - INFO - 
2025-11-26 17:37:40,114 - main - INFO -      Diagnostics & Health:
2025-11-26 17:37:40,114 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:37:40,115 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:37:40,115 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:37:40,115 - main - INFO - 
2025-11-26 17:37:40,115 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:37:40,115 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:37:40,115 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:37:40,116 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:37:40,116 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:37:40,116 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:37:40,116 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:37:40,117 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:37:40,117 - main - INFO - 
2025-11-26 17:37:40,117 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:37:40,117 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:37:40,117 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:37:40,117 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:37:40,118 - main - INFO -      4. No re-upload needed!
2025-11-26 17:37:40,118 - main - INFO - 
2025-11-26 17:37:40,118 - main - INFO - ================================================================================
2025-11-26 17:37:40,118 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:37:40,119 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:37:40,119 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:37:40,119 - main - INFO - ================================================================================
2025-11-26 17:37:40,119 - main - INFO - 
2025-11-26 17:37:40,120 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:37:41,543 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764177619_37f18418c472/pdf
2025-11-26 17:37:41,544 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:37:41,548 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764177619_37f18418c472
2025-11-26 17:37:41,549 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:37:41,549 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:37:41,550 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:37:41,550 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:37:41,551 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:37:41,551 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:37:41,578 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:37:41,578 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:37:41,580 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:37:41,580 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:37:41,583 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:37:41,583 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:37:41,584 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:37:41,826 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:37:41,826 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764177619_37f18418c472_20251126_173741.pdf (164559 bytes)
2025-11-26 17:37:41,828 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764177619_37f18418c472/pdf - 200 - 0.29s
2025-11-26 17:40:36,176 - main - INFO - 
2025-11-26 17:40:36,177 - main - INFO - ================================================================================
2025-11-26 17:40:36,177 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:40:36,179 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:40:36,179 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:40:36,181 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:40:36,183 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:40:36,184 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:40:36,184 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:40:36,185 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:40:36,185 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:40:36,185 - main - INFO - ================================================================================
2025-11-26 17:40:36,186 - main - INFO - 
2025-11-26 17:40:40,828 - main - INFO - 
2025-11-26 17:40:40,829 - main - INFO - ================================================================================
2025-11-26 17:40:40,830 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:40:40,830 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:40:40,830 - main - INFO - ================================================================================
2025-11-26 17:40:40,831 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:40:40,831 - main - INFO -   Upload Directory: uploads
2025-11-26 17:40:40,831 - main - INFO -   Max File Size: 20MB
2025-11-26 17:40:40,832 - main - INFO - ================================================================================
2025-11-26 17:40:40,832 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:40:40,833 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:40:40,833 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:40:40,863 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:40:40,873 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:40:40,873 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:40:40,874 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:40:40,874 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:40,874 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:40:40,885 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:40:40,888 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:40:40,890 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:40:40,893 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:40:40,894 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:40:40,894 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:40:40,895 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:40,895 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:40:40,908 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:40:40,909 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:40:40,909 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:40:40,909 - main - INFO - 
2025-11-26 17:40:40,910 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:40:40,910 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:40:40,910 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:40:40,910 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:40:40,910 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:40:40,911 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:40:40,911 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:40:40,911 - main - INFO - 
2025-11-26 17:40:40,911 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:40:40,911 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:40:40,912 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:40:40,912 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:40:40,912 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:40:40,912 - main - INFO - 
2025-11-26 17:40:40,912 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:40:40,913 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:40:40,913 - main - INFO -        - No manual section generation
2025-11-26 17:40:40,913 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:40:40,913 - main - INFO - 
2025-11-26 17:40:40,913 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:40:40,914 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:40:40,914 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:40:40,914 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:40:40,914 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:40:40,915 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:40:40,915 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:40:40,915 - main - INFO - 
2025-11-26 17:40:40,915 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:40:40,915 - main - INFO -      Main:
2025-11-26 17:40:40,916 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:40:40,916 - main - INFO - 
2025-11-26 17:40:40,916 - main - INFO -      Retrieval:
2025-11-26 17:40:40,916 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:40:40,917 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:40:40,917 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:40:40,917 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:40:40,917 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:40:40,917 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:40:40,918 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:40:40,918 - main - INFO - 
2025-11-26 17:40:40,918 - main - INFO -      Management:
2025-11-26 17:40:40,918 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:40:40,919 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:40:40,919 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:40:40,919 - main - INFO - 
2025-11-26 17:40:40,919 - main - INFO -      Documents (MongoDB):
2025-11-26 17:40:40,919 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:40:40,920 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:40:40,920 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:40:40,920 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:40:40,920 - main - INFO - 
2025-11-26 17:40:40,920 - main - INFO -      Diagnostics & Health:
2025-11-26 17:40:40,921 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:40:40,921 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:40:40,921 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:40:40,921 - main - INFO - 
2025-11-26 17:40:40,921 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:40:40,922 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:40:40,922 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:40:40,922 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:40:40,922 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:40:40,922 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:40:40,923 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:40:40,923 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:40:40,923 - main - INFO - 
2025-11-26 17:40:40,923 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:40:40,923 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:40:40,924 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:40:40,924 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:40:40,924 - main - INFO -      4. No re-upload needed!
2025-11-26 17:40:40,925 - main - INFO - 
2025-11-26 17:40:40,925 - main - INFO - ================================================================================
2025-11-26 17:40:40,925 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:40:40,925 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:40:40,926 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:40:40,926 - main - INFO - ================================================================================
2025-11-26 17:40:40,926 - main - INFO - 
2025-11-26 17:40:40,927 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:40:45,703 - main - INFO - 
2025-11-26 17:40:45,704 - main - INFO - ================================================================================
2025-11-26 17:40:45,704 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:40:45,704 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:40:45,704 - main - INFO - ================================================================================
2025-11-26 17:40:45,705 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:40:45,705 - main - INFO -   Upload Directory: uploads
2025-11-26 17:40:45,707 - main - INFO -   Max File Size: 20MB
2025-11-26 17:40:45,707 - main - INFO - ================================================================================
2025-11-26 17:40:45,708 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:40:45,709 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:40:45,709 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:40:45,753 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:40:45,767 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:40:45,768 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:40:45,769 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:40:45,769 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:45,770 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:40:45,795 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:40:45,796 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:40:45,797 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:40:45,799 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:40:45,799 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:40:45,800 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:40:45,800 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:45,800 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:40:45,812 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:40:45,813 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:40:45,813 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:40:45,813 - main - INFO - 
2025-11-26 17:40:45,813 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:40:45,814 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:40:45,814 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:40:45,814 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:40:45,814 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:40:45,814 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:40:45,815 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:40:45,815 - main - INFO - 
2025-11-26 17:40:45,815 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:40:45,815 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:40:45,815 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:40:45,815 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:40:45,816 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:40:45,816 - main - INFO - 
2025-11-26 17:40:45,816 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:40:45,816 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:40:45,816 - main - INFO -        - No manual section generation
2025-11-26 17:40:45,816 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:40:45,816 - main - INFO - 
2025-11-26 17:40:45,816 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:40:45,817 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:40:45,817 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:40:45,817 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:40:45,817 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:40:45,817 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:40:45,817 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:40:45,817 - main - INFO - 
2025-11-26 17:40:45,818 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:40:45,818 - main - INFO -      Main:
2025-11-26 17:40:45,818 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:40:45,818 - main - INFO - 
2025-11-26 17:40:45,818 - main - INFO -      Retrieval:
2025-11-26 17:40:45,819 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:40:45,819 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:40:45,819 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:40:45,819 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:40:45,820 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:40:45,820 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:40:45,820 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:40:45,820 - main - INFO - 
2025-11-26 17:40:45,821 - main - INFO -      Management:
2025-11-26 17:40:45,821 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:40:45,821 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:40:45,822 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:40:45,822 - main - INFO - 
2025-11-26 17:40:45,823 - main - INFO -      Documents (MongoDB):
2025-11-26 17:40:45,823 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:40:45,824 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:40:45,824 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:40:45,825 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:40:45,825 - main - INFO - 
2025-11-26 17:40:45,825 - main - INFO -      Diagnostics & Health:
2025-11-26 17:40:45,826 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:40:45,826 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:40:45,826 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:40:45,826 - main - INFO - 
2025-11-26 17:40:45,826 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:40:45,826 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:40:45,827 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:40:45,827 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:40:45,827 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:40:45,827 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:40:45,828 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:40:45,828 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:40:45,828 - main - INFO - 
2025-11-26 17:40:45,828 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:40:45,829 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:40:45,829 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:40:45,829 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:40:45,829 - main - INFO -      4. No re-upload needed!
2025-11-26 17:40:45,829 - main - INFO - 
2025-11-26 17:40:45,829 - main - INFO - ================================================================================
2025-11-26 17:40:45,830 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:40:45,830 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:40:45,830 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:40:45,830 - main - INFO - ================================================================================
2025-11-26 17:40:45,830 - main - INFO - 
2025-11-26 17:40:45,831 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:40:49,829 - main - INFO - 
2025-11-26 17:40:49,829 - main - INFO - ================================================================================
2025-11-26 17:40:49,829 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:40:49,831 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:40:49,831 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:40:49,832 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:40:49,832 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:40:49,833 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:40:49,834 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:40:49,835 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:40:49,836 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:40:49,837 - main - INFO - ================================================================================
2025-11-26 17:40:49,837 - main - INFO - 
2025-11-26 17:40:54,910 - main - INFO - 
2025-11-26 17:40:54,910 - main - INFO - ================================================================================
2025-11-26 17:40:54,911 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:40:54,911 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:40:54,911 - main - INFO - ================================================================================
2025-11-26 17:40:54,911 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:40:54,912 - main - INFO -   Upload Directory: uploads
2025-11-26 17:40:54,912 - main - INFO -   Max File Size: 20MB
2025-11-26 17:40:54,912 - main - INFO - ================================================================================
2025-11-26 17:40:54,913 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:40:54,913 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:40:54,913 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:40:54,939 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:40:54,945 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:40:54,945 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:40:54,945 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:40:54,946 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:54,946 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:40:54,954 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:40:54,955 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:40:54,956 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:40:54,958 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:40:54,958 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:40:54,958 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:40:54,959 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:54,959 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:40:54,966 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:40:54,966 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:40:54,966 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:40:54,967 - main - INFO - 
2025-11-26 17:40:54,967 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:40:54,967 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:40:54,967 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:40:54,967 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:40:54,967 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:40:54,967 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:40:54,968 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:40:54,968 - main - INFO - 
2025-11-26 17:40:54,968 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:40:54,968 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:40:54,968 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:40:54,969 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:40:54,969 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:40:54,969 - main - INFO - 
2025-11-26 17:40:54,969 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:40:54,969 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:40:54,969 - main - INFO -        - No manual section generation
2025-11-26 17:40:54,970 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:40:54,970 - main - INFO - 
2025-11-26 17:40:54,970 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:40:54,970 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:40:54,970 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:40:54,970 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:40:54,971 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:40:54,971 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:40:54,971 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:40:54,971 - main - INFO - 
2025-11-26 17:40:54,971 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:40:54,971 - main - INFO -      Main:
2025-11-26 17:40:54,972 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:40:54,972 - main - INFO - 
2025-11-26 17:40:54,973 - main - INFO -      Retrieval:
2025-11-26 17:40:54,973 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:40:54,973 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:40:54,974 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:40:54,974 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:40:54,974 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:40:54,974 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:40:54,975 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:40:54,975 - main - INFO - 
2025-11-26 17:40:54,975 - main - INFO -      Management:
2025-11-26 17:40:54,975 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:40:54,976 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:40:54,976 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:40:54,976 - main - INFO - 
2025-11-26 17:40:54,976 - main - INFO -      Documents (MongoDB):
2025-11-26 17:40:54,976 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:40:54,977 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:40:54,977 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:40:54,977 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:40:54,977 - main - INFO - 
2025-11-26 17:40:54,977 - main - INFO -      Diagnostics & Health:
2025-11-26 17:40:54,978 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:40:54,978 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:40:54,978 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:40:54,978 - main - INFO - 
2025-11-26 17:40:54,978 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:40:54,979 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:40:54,979 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:40:54,979 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:40:54,979 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:40:54,979 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:40:54,980 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:40:54,980 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:40:54,980 - main - INFO - 
2025-11-26 17:40:54,980 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:40:54,981 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:40:54,981 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:40:54,981 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:40:54,981 - main - INFO -      4. No re-upload needed!
2025-11-26 17:40:54,981 - main - INFO - 
2025-11-26 17:40:54,981 - main - INFO - ================================================================================
2025-11-26 17:40:54,982 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:40:54,982 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:40:54,982 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:40:54,982 - main - INFO - ================================================================================
2025-11-26 17:40:54,982 - main - INFO - 
2025-11-26 17:40:54,983 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:40:58,732 - main - INFO - 
2025-11-26 17:40:58,732 - main - INFO - ================================================================================
2025-11-26 17:40:58,732 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:40:58,733 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:40:58,733 - main - INFO - ================================================================================
2025-11-26 17:40:58,733 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:40:58,734 - main - INFO -   Upload Directory: uploads
2025-11-26 17:40:58,734 - main - INFO -   Max File Size: 20MB
2025-11-26 17:40:58,734 - main - INFO - ================================================================================
2025-11-26 17:40:58,734 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:40:58,735 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:40:58,735 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:40:58,771 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:40:58,776 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:40:58,776 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:40:58,776 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:40:58,777 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:58,777 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:40:58,783 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:40:58,784 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:40:58,785 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:40:58,788 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:40:58,789 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:40:58,790 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:40:58,791 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:40:58,792 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:40:58,816 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:40:58,816 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:40:58,816 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:40:58,816 - main - INFO - 
2025-11-26 17:40:58,817 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:40:58,817 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:40:58,817 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:40:58,817 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:40:58,817 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:40:58,817 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:40:58,818 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:40:58,818 - main - INFO - 
2025-11-26 17:40:58,818 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:40:58,818 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:40:58,818 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:40:58,819 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:40:58,819 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:40:58,819 - main - INFO - 
2025-11-26 17:40:58,819 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:40:58,820 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:40:58,820 - main - INFO -        - No manual section generation
2025-11-26 17:40:58,820 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:40:58,820 - main - INFO - 
2025-11-26 17:40:58,821 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:40:58,821 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:40:58,821 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:40:58,821 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:40:58,822 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:40:58,822 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:40:58,823 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:40:58,823 - main - INFO - 
2025-11-26 17:40:58,824 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:40:58,824 - main - INFO -      Main:
2025-11-26 17:40:58,824 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:40:58,824 - main - INFO - 
2025-11-26 17:40:58,825 - main - INFO -      Retrieval:
2025-11-26 17:40:58,825 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:40:58,825 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:40:58,825 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:40:58,826 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:40:58,826 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:40:58,826 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:40:58,826 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:40:58,826 - main - INFO - 
2025-11-26 17:40:58,827 - main - INFO -      Management:
2025-11-26 17:40:58,827 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:40:58,827 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:40:58,827 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:40:58,827 - main - INFO - 
2025-11-26 17:40:58,827 - main - INFO -      Documents (MongoDB):
2025-11-26 17:40:58,828 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:40:58,828 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:40:58,828 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:40:58,828 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:40:58,828 - main - INFO - 
2025-11-26 17:40:58,828 - main - INFO -      Diagnostics & Health:
2025-11-26 17:40:58,829 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:40:58,829 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:40:58,829 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:40:58,829 - main - INFO - 
2025-11-26 17:40:58,829 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:40:58,829 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:40:58,829 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:40:58,830 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:40:58,830 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:40:58,830 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:40:58,830 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:40:58,830 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:40:58,830 - main - INFO - 
2025-11-26 17:40:58,830 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:40:58,831 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:40:58,831 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:40:58,831 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:40:58,831 - main - INFO -      4. No re-upload needed!
2025-11-26 17:40:58,831 - main - INFO - 
2025-11-26 17:40:58,831 - main - INFO - ================================================================================
2025-11-26 17:40:58,831 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:40:58,832 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:40:58,832 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:40:58,832 - main - INFO - ================================================================================
2025-11-26 17:40:58,832 - main - INFO - 
2025-11-26 17:40:58,832 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:41:04,140 - main - INFO - 
2025-11-26 17:41:04,140 - main - INFO - ================================================================================
2025-11-26 17:41:04,140 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:41:04,141 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:41:04,141 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:41:04,142 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:41:04,142 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:41:04,143 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:41:04,143 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:41:04,144 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:41:04,144 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:41:04,144 - main - INFO - ================================================================================
2025-11-26 17:41:04,144 - main - INFO - 
2025-11-26 17:41:08,230 - main - INFO - 
2025-11-26 17:41:08,230 - main - INFO - ================================================================================
2025-11-26 17:41:08,230 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:41:08,231 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:41:08,231 - main - INFO - ================================================================================
2025-11-26 17:41:08,231 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:41:08,231 - main - INFO -   Upload Directory: uploads
2025-11-26 17:41:08,231 - main - INFO -   Max File Size: 20MB
2025-11-26 17:41:08,232 - main - INFO - ================================================================================
2025-11-26 17:41:08,232 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:41:08,232 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:41:08,232 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:41:08,248 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:41:08,253 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:41:08,254 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:41:08,254 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:41:08,254 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:41:08,254 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:41:08,261 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:41:08,262 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:41:08,263 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:41:08,264 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:41:08,265 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:41:08,265 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:41:08,265 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:41:08,265 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:41:08,283 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:41:08,283 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:41:08,283 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:41:08,283 - main - INFO - 
2025-11-26 17:41:08,283 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:41:08,284 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:41:08,284 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:41:08,284 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:41:08,284 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:41:08,284 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:41:08,285 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:41:08,285 - main - INFO - 
2025-11-26 17:41:08,285 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:41:08,285 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:41:08,285 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:41:08,285 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:41:08,286 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:41:08,286 - main - INFO - 
2025-11-26 17:41:08,286 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:41:08,286 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:41:08,286 - main - INFO -        - No manual section generation
2025-11-26 17:41:08,287 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:41:08,287 - main - INFO - 
2025-11-26 17:41:08,287 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:41:08,287 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:41:08,287 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:41:08,288 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:41:08,288 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:41:08,288 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:41:08,288 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:41:08,288 - main - INFO - 
2025-11-26 17:41:08,288 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:41:08,289 - main - INFO -      Main:
2025-11-26 17:41:08,289 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:41:08,289 - main - INFO - 
2025-11-26 17:41:08,289 - main - INFO -      Retrieval:
2025-11-26 17:41:08,289 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:41:08,289 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:41:08,289 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:41:08,290 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:41:08,290 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:41:08,290 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:41:08,290 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:41:08,290 - main - INFO - 
2025-11-26 17:41:08,291 - main - INFO -      Management:
2025-11-26 17:41:08,291 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:41:08,291 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:41:08,291 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:41:08,291 - main - INFO - 
2025-11-26 17:41:08,291 - main - INFO -      Documents (MongoDB):
2025-11-26 17:41:08,292 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:41:08,292 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:41:08,292 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:41:08,292 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:41:08,292 - main - INFO - 
2025-11-26 17:41:08,292 - main - INFO -      Diagnostics & Health:
2025-11-26 17:41:08,292 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:41:08,293 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:41:08,293 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:41:08,293 - main - INFO - 
2025-11-26 17:41:08,293 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:41:08,293 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:41:08,293 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:41:08,293 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:41:08,294 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:41:08,294 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:41:08,294 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:41:08,294 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:41:08,294 - main - INFO - 
2025-11-26 17:41:08,294 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:41:08,294 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:41:08,295 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:41:08,295 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:41:08,295 - main - INFO -      4. No re-upload needed!
2025-11-26 17:41:08,295 - main - INFO - 
2025-11-26 17:41:08,295 - main - INFO - ================================================================================
2025-11-26 17:41:08,295 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:41:08,296 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:41:08,296 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:41:08,296 - main - INFO - ================================================================================
2025-11-26 17:41:08,296 - main - INFO - 
2025-11-26 17:41:08,297 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:41:12,379 - main - INFO - 
2025-11-26 17:41:12,379 - main - INFO - ================================================================================
2025-11-26 17:41:12,379 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:41:12,379 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:41:12,380 - main - INFO - ================================================================================
2025-11-26 17:41:12,380 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:41:12,380 - main - INFO -   Upload Directory: uploads
2025-11-26 17:41:12,380 - main - INFO -   Max File Size: 20MB
2025-11-26 17:41:12,381 - main - INFO - ================================================================================
2025-11-26 17:41:12,381 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:41:12,381 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:41:12,381 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:41:12,402 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:41:12,413 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:41:12,413 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:41:12,413 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:41:12,414 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:41:12,414 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:41:12,423 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:41:12,427 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:41:12,428 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:41:12,430 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:41:12,431 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:41:12,431 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:41:12,431 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:41:12,431 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:41:12,462 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:41:12,463 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:41:12,463 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:41:12,463 - main - INFO - 
2025-11-26 17:41:12,463 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:41:12,464 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:41:12,464 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:41:12,464 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:41:12,464 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:41:12,464 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:41:12,464 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:41:12,465 - main - INFO - 
2025-11-26 17:41:12,465 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:41:12,465 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:41:12,465 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:41:12,465 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:41:12,465 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:41:12,465 - main - INFO - 
2025-11-26 17:41:12,466 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:41:12,466 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:41:12,466 - main - INFO -        - No manual section generation
2025-11-26 17:41:12,466 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:41:12,466 - main - INFO - 
2025-11-26 17:41:12,466 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:41:12,467 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:41:12,467 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:41:12,467 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:41:12,467 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:41:12,467 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:41:12,467 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:41:12,468 - main - INFO - 
2025-11-26 17:41:12,468 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:41:12,468 - main - INFO -      Main:
2025-11-26 17:41:12,468 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:41:12,468 - main - INFO - 
2025-11-26 17:41:12,469 - main - INFO -      Retrieval:
2025-11-26 17:41:12,469 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:41:12,469 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:41:12,469 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:41:12,469 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:41:12,470 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:41:12,470 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:41:12,470 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:41:12,470 - main - INFO - 
2025-11-26 17:41:12,471 - main - INFO -      Management:
2025-11-26 17:41:12,471 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:41:12,471 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:41:12,471 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:41:12,471 - main - INFO - 
2025-11-26 17:41:12,472 - main - INFO -      Documents (MongoDB):
2025-11-26 17:41:12,472 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:41:12,472 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:41:12,473 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:41:12,474 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:41:12,475 - main - INFO - 
2025-11-26 17:41:12,476 - main - INFO -      Diagnostics & Health:
2025-11-26 17:41:12,476 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:41:12,477 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:41:12,477 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:41:12,477 - main - INFO - 
2025-11-26 17:41:12,477 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:41:12,478 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:41:12,478 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:41:12,478 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:41:12,478 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:41:12,479 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:41:12,479 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:41:12,479 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:41:12,479 - main - INFO - 
2025-11-26 17:41:12,480 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:41:12,480 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:41:12,480 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:41:12,480 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:41:12,480 - main - INFO -      4. No re-upload needed!
2025-11-26 17:41:12,480 - main - INFO - 
2025-11-26 17:41:12,481 - main - INFO - ================================================================================
2025-11-26 17:41:12,481 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:41:12,481 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:41:12,481 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:41:12,481 - main - INFO - ================================================================================
2025-11-26 17:41:12,482 - main - INFO - 
2025-11-26 17:41:12,482 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:41:46,744 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764177619_37f18418c472/pdf
2025-11-26 17:41:46,744 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:41:46,750 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764177619_37f18418c472
2025-11-26 17:41:46,750 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:41:46,750 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:41:46,751 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:41:46,751 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:41:46,754 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:41:46,754 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:41:46,778 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:41:46,779 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:41:46,781 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:41:46,781 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:41:46,782 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:41:46,783 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:41:46,784 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:41:47,156 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764177619_37f18418c472
2025-11-26 17:41:47,175 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764177619_37f18418c472_20251126_174147.pdf (164542 bytes)
2025-11-26 17:41:47,194 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764177619_37f18418c472/pdf - 200 - 0.45s
2025-11-26 17:46:18,447 - main - INFO - 
2025-11-26 17:46:18,447 - main - INFO - ================================================================================
2025-11-26 17:46:18,448 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:46:18,448 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:46:18,449 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:46:18,450 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:46:18,450 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:46:18,450 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:46:18,451 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:46:18,451 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:46:18,451 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:46:18,452 - main - INFO - ================================================================================
2025-11-26 17:46:18,453 - main - INFO - 
2025-11-26 17:46:21,711 - main - INFO - 
2025-11-26 17:46:21,711 - main - INFO - ================================================================================
2025-11-26 17:46:21,711 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:46:21,712 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:46:21,712 - main - INFO - ================================================================================
2025-11-26 17:46:21,712 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:46:21,713 - main - INFO -   Upload Directory: uploads
2025-11-26 17:46:21,713 - main - INFO -   Max File Size: 20MB
2025-11-26 17:46:21,713 - main - INFO - ================================================================================
2025-11-26 17:46:21,714 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:46:21,714 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:46:21,714 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:46:21,738 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:46:21,744 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:46:21,744 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:46:21,744 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:46:21,744 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:46:21,745 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:46:21,764 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:46:21,765 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:46:21,767 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:46:21,769 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:46:21,769 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:46:21,770 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:46:21,771 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:46:21,771 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:46:21,778 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:46:21,778 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:46:21,779 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:46:21,779 - main - INFO - 
2025-11-26 17:46:21,779 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:46:21,779 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:46:21,780 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:46:21,780 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:46:21,780 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:46:21,780 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:46:21,780 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:46:21,781 - main - INFO - 
2025-11-26 17:46:21,781 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:46:21,781 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:46:21,781 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:46:21,782 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:46:21,782 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:46:21,782 - main - INFO - 
2025-11-26 17:46:21,782 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:46:21,782 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:46:21,782 - main - INFO -        - No manual section generation
2025-11-26 17:46:21,783 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:46:21,783 - main - INFO - 
2025-11-26 17:46:21,783 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:46:21,783 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:46:21,783 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:46:21,784 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:46:21,784 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:46:21,784 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:46:21,784 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:46:21,784 - main - INFO - 
2025-11-26 17:46:21,784 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:46:21,785 - main - INFO -      Main:
2025-11-26 17:46:21,785 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:46:21,785 - main - INFO - 
2025-11-26 17:46:21,785 - main - INFO -      Retrieval:
2025-11-26 17:46:21,785 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:46:21,786 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:46:21,786 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:46:21,786 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:46:21,786 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:46:21,786 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:46:21,787 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:46:21,787 - main - INFO - 
2025-11-26 17:46:21,787 - main - INFO -      Management:
2025-11-26 17:46:21,787 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:46:21,787 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:46:21,787 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:46:21,788 - main - INFO - 
2025-11-26 17:46:21,788 - main - INFO -      Documents (MongoDB):
2025-11-26 17:46:21,788 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:46:21,788 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:46:21,788 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:46:21,789 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:46:21,789 - main - INFO - 
2025-11-26 17:46:21,789 - main - INFO -      Diagnostics & Health:
2025-11-26 17:46:21,789 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:46:21,789 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:46:21,790 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:46:21,790 - main - INFO - 
2025-11-26 17:46:21,790 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:46:21,790 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:46:21,790 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:46:21,791 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:46:21,791 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:46:21,791 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:46:21,791 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:46:21,792 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:46:21,792 - main - INFO - 
2025-11-26 17:46:21,792 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:46:21,792 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:46:21,792 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:46:21,793 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:46:21,793 - main - INFO -      4. No re-upload needed!
2025-11-26 17:46:21,794 - main - INFO - 
2025-11-26 17:46:21,794 - main - INFO - ================================================================================
2025-11-26 17:46:21,795 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:46:21,795 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:46:21,795 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:46:21,796 - main - INFO - ================================================================================
2025-11-26 17:46:21,796 - main - INFO - 
2025-11-26 17:46:21,796 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:46:21,849 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 17:46:21,893 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 17:46:21,894 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 17:46:21,894 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 17:46:21,894 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 17:46:21,895 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 17:46:21,896 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 17:46:21,896 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 17:46:21,896 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 17:46:21,896 - app.api.routes - INFO -    - Files uploaded: 8
2025-11-26 17:46:21,897 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:46:21,897 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_115e23b89903 (8 files)
2025-11-26 17:46:21,897 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_115e23b89903
2025-11-26 17:46:21,897 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:21,898 - app.api.routes - INFO - ðŸ“„ Processing: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:21,898 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:21,898 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:21,898 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:46:21,898 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:21,899 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 6ac665da804a468b838585ac58c32a30.pdf (213039 bytes)
2025-11-26 17:46:21,900 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:46:21,900 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6ac665da804a468b838585ac58c32a30.pdf
2025-11-26 17:46:21,900 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:21,936 - app.api.routes - INFO - ðŸ“„ Processing: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:46:21,936 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:21,951 - app.services.pdf_extractor - INFO - Successfully extracted 12221 characters from 6 pages
2025-11-26 17:46:21,952 - app.api.routes - INFO - ðŸ’¾ Saved file: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ f2615f3fc0fd41758db24ac9b9e86552.pdf (241116 bytes)
2025-11-26 17:46:21,952 - app.api.routes - INFO - ðŸ“– Extracting text from: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:46:21,953 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:21,953 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\f2615f3fc0fd41758db24ac9b9e86552.pdf
2025-11-26 17:46:21,953 - app.api.routes - INFO - ðŸ“„ Processing: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:46:21,953 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:21,997 - app.services.pdf_extractor - INFO - Successfully extracted 13483 characters from 6 pages
2025-11-26 17:46:21,998 - app.api.routes - INFO - ðŸ’¾ Saved file: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 6798c6e6d2c64d16824ad19aa4075a2e.pdf (843321 bytes)
2025-11-26 17:46:21,998 - app.api.routes - INFO - ðŸ“– Extracting text from: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:46:21,998 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:21,999 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\6798c6e6d2c64d16824ad19aa4075a2e.pdf
2025-11-26 17:46:21,999 - app.api.routes - INFO - ðŸ“„ Processing: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:46:22,046 - app.services.pdf_extractor - INFO - Successfully extracted 7736 characters from 4 pages
2025-11-26 17:46:22,047 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:22,048 - app.api.routes - INFO - ðŸ’¾ Saved file: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ eb18ce08bf4b4e4cac2d2c5d5b91d432.pdf (290798 bytes)
2025-11-26 17:46:22,048 - app.api.routes - INFO - ðŸ“– Extracting text from: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:46:22,049 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:22,049 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\eb18ce08bf4b4e4cac2d2c5d5b91d432.pdf
2025-11-26 17:46:22,049 - app.api.routes - INFO - ðŸ“„ Processing: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:22,082 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:22,100 - app.services.pdf_extractor - INFO - Successfully extracted 15546 characters from 7 pages
2025-11-26 17:46:22,100 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:22,100 - app.api.routes - INFO - ðŸ“„ Processing: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:46:22,101 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:22,101 - app.api.routes - INFO - ðŸ’¾ Saved file: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ b36b11e659bd4b88aba0bf396a8e2cc7.pdf (309991 bytes)
2025-11-26 17:46:22,102 - app.api.routes - INFO - ðŸ“– Extracting text from: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:46:22,102 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:46:22,102 - app.api.routes - INFO - ðŸ“„ Processing: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:46:22,102 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\b36b11e659bd4b88aba0bf396a8e2cc7.pdf
2025-11-26 17:46:22,103 - app.api.routes - INFO - ======================================================================
2025-11-26 17:46:22,146 - app.services.pdf_extractor - INFO - Successfully extracted 12679 characters from 5 pages
2025-11-26 17:46:22,146 - app.api.routes - INFO - ðŸ’¾ Saved file: AL Salama Hospital - PAR - Chubb.pdf â†’ d4b143453e3e4a009c15a5b5b82dfe40.pdf (175401 bytes)
2025-11-26 17:46:22,147 - app.api.routes - INFO - ðŸ“– Extracting text from: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:46:22,147 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\d4b143453e3e4a009c15a5b5b82dfe40.pdf
2025-11-26 17:46:22,148 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:46:22,189 - app.services.pdf_extractor - INFO - Successfully extracted 14268 characters from 7 pages
2025-11-26 17:46:22,189 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:46:22,192 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:46:22,193 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:46:22,193 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:46:22,194 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:22,194 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 17:46:22,194 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 17:46:22,194 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 17:46:22,264 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:46:22,264 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:22,603 - app.api.routes - INFO - ðŸ¤– Parsing with AI: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:46:22,603 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:46:22,604 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:46:22,605 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:46:22,605 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:46:22,605 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:22,605 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 17:46:22,606 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 17:46:22,606 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 17:46:22,688 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:46:22,689 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:22,689 - app.api.routes - INFO - ðŸ¤– Parsing with AI: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:46:22,690 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:46:22,691 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:46:22,691 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:46:22,691 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 17:46:22,692 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:22,692 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:46:22,750 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:46:22,750 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:22,751 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:46:22,752 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:46:22,754 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Rajhi Takaful
2025-11-26 17:46:22,755 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Rajhi Takaful
2025-11-26 17:46:22,755 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:46:22,755 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:22,756 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: LIVA
2025-11-26 17:46:22,756 - app.services.ai_parser - WARNING - âš ï¸ Format/Company mismatch: Format=LIVA, Company=Al Rajhi Takaful
2025-11-26 17:46:22,756 - app.services.ai_parser - INFO - ðŸ”§ Overriding company name to: Liva Insurance (based on document format)
2025-11-26 17:46:22,838 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 1 sublimits
2025-11-26 17:46:22,838 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:22,839 - app.api.routes - INFO - ðŸ¤– Parsing with AI: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:46:22,839 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:46:22,840 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Wataniya Insurance
2025-11-26 17:46:22,840 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Wataniya Insurance
2025-11-26 17:46:22,841 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 17:46:22,841 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:22,841 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:46:22,925 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 17:46:22,926 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:22,928 - app.api.routes - INFO - ðŸ¤– Parsing with AI: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:46:22,929 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:46:22,929 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Chubb Arabia (pattern: \bchubb\b)
2025-11-26 17:46:22,930 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Chubb Arabia
2025-11-26 17:46:22,930 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 17:46:22,930 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:22,931 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: CHUBB
2025-11-26 17:46:23,041 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 3 sublimits
2025-11-26 17:46:23,041 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:23,064 - app.api.routes - INFO - ðŸ’¾ Saved file: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 8ea175534ab243f5ae9875eff51abeed.pdf (2510488 bytes)
2025-11-26 17:46:23,064 - app.api.routes - INFO - ðŸ“– Extracting text from: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:23,065 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\8ea175534ab243f5ae9875eff51abeed.pdf
2025-11-26 17:46:23,130 - app.services.pdf_extractor - INFO - Successfully extracted 17529 characters from 6 pages
2025-11-26 17:46:23,131 - app.api.routes - INFO - ðŸ’¾ Saved file: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ ad529852c7e94bf49408f22c542a4928.pdf (2137120 bytes)
2025-11-26 17:46:23,131 - app.api.routes - INFO - ðŸ“– Extracting text from: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:23,131 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\ad529852c7e94bf49408f22c542a4928.pdf
2025-11-26 17:46:23,132 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:23,149 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:23,184 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 17:46:23,185 - app.services.pdf_extractor - INFO - Successfully extracted 11585 characters from 4 pages
2025-11-26 17:46:23,186 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 17:46:23,186 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:46:23,186 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:23,187 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:46:23,295 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 17:46:23,296 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:23,298 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:23,298 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:46:23,299 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Al Sagr Co-operative Insurance Company
2025-11-26 17:46:23,300 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Al Sagr Co-operative Insurance Company
2025-11-26 17:46:23,300 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:46:23,300 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:46:23,301 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:46:23,361 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 7 sublimits
2025-11-26 17:46:23,361 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:46:50,628 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:50,648 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:46:50,649 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:46:50,650 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:46:50,650 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:46:50,656 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 23 benefits from patterns
2025-11-26 17:46:50,656 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 23 total
2025-11-26 17:46:50,657 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:46:52,296 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:52,304 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:46:52,305 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:46:52,305 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:46:52,305 - app.services.ai_parser - WARNING - âš ï¸ Only 8 benefits, using fallback...
2025-11-26 17:46:52,307 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 17:46:52,307 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 14 total
2025-11-26 17:46:52,308 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:46:53,330 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:53,333 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:46:53,334 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:46:53,334 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:46:53,334 - app.services.ai_parser - WARNING - âš ï¸ Only 7 benefits, using fallback...
2025-11-26 17:46:53,337 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 20 benefits from patterns
2025-11-26 17:46:53,337 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 25 total
2025-11-26 17:46:53,337 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:46:54,190 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:54,201 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:46:54,201 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:46:54,201 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:46:54,202 - app.services.ai_parser - WARNING - âš ï¸ Only 4 benefits, using fallback...
2025-11-26 17:46:54,204 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 6 benefits from patterns
2025-11-26 17:46:54,204 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 10 total
2025-11-26 17:46:54,204 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:46:56,940 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:56,959 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:46:56,960 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:46:56,961 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.1â€°' â†’ '1.1â€°'
2025-11-26 17:46:56,961 - app.services.ai_parser - INFO - ðŸ’° Calculated: 609853.20 from SI: 554412000.0 Ã— Rate: 1.1â€°
2025-11-26 17:46:56,963 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SR 1,000,000 | BI: 10%, min SR 10,000
2025-11-26 17:46:56,963 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:46:56,964 - app.services.ai_parser - INFO - ðŸ“Š Counts: 23 benefits, 29 exclusions, 6 warranties, 0 extensions
2025-11-26 17:46:58,130 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:58,131 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:46:58,132 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:46:58,132 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium' â†’ 'FLAT Premium'
2025-11-26 17:46:58,132 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 10,000
2025-11-26 17:46:58,132 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:46:58,133 - app.services.ai_parser - INFO - ðŸ“Š Counts: 14 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 17:46:59,009 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:46:59,010 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:46:59,010 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:46:59,011 - app.services.ai_parser - INFO - ðŸ”„ Rate: '1.00â€° (Per Mille)' â†’ '1.00â€°'
2025-11-26 17:46:59,011 - app.services.ai_parser - INFO - ðŸ’° Calculated: 365000.00 from SI: 365000000.0 Ã— Rate: 1.00â€° (Per Mille)
2025-11-26 17:46:59,011 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000
2025-11-26 17:46:59,012 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:46:59,012 - app.services.ai_parser - INFO - ðŸ“Š Counts: 25 benefits, 28 exclusions, 5 warranties, 9 extensions
2025-11-26 17:47:00,157 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:00,162 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:47:00,162 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:47:00,162 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'Flat Premium, SAR 1,000 Per Project' â†’ 'FLAT Premium'
2025-11-26 17:47:00,163 - app.services.ai_parser - INFO - ðŸ’° Calculated: 4000000.00 from SI: 4000000.0 Ã— Rate: Flat Premium, SAR 1,000 Per Project
2025-11-26 17:47:00,163 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1%, min SAR 10,000
2025-11-26 17:47:00,164 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:47:00,164 - app.services.ai_parser - INFO - ðŸ“Š Counts: 10 benefits, 41 exclusions, 9 warranties, 0 extensions
2025-11-26 17:47:04,138 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:04,160 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:47:04,161 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:04,162 - app.services.ai_parser - INFO - 
2025-11-26 17:47:04,163 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:04,163 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:47:04,164 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:04,165 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 17:47:04,166 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:47:04,167 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,500.00
2025-11-26 17:47:04,167 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 17:47:04,168 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:47:04,169 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:47:04,169 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 10,000
2025-11-26 17:47:04,170 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:04,171 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:47:04,172 - app.services.ai_parser - INFO - 
2025-11-26 17:47:04,172 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:04,173 - app.services.ai_parser - INFO -    âœ“ Benefits: 14
2025-11-26 17:47:04,174 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 17:47:04,174 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 17:47:04,175 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:47:04,176 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:47:04,177 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:04,180 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6ac665da804a468b838585ac58c32a30.pdf â†’ 69273d18ba6c5e5b55032962
2025-11-26 17:47:04,181 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d18ba6c5e5b55032962
2025-11-26 17:47:04,185 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 69273d18ba6c5e5b55032963 (213039 bytes)
2025-11-26 17:47:04,185 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Single Project.pdf â†’ 69273d18ba6c5e5b55032963
2025-11-26 17:47:04,186 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Single Project.pdf
2025-11-26 17:47:04,541 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:04,543 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:47:04,543 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:04,543 - app.services.ai_parser - INFO - 
2025-11-26 17:47:04,543 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:04,544 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:47:04,544 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:04,545 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Wataniya Insurance
2025-11-26 17:47:04,545 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Dev. Co.
2025-11-26 17:47:04,545 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 365,000.00
2025-11-26 17:47:04,545 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.00â€°
2025-11-26 17:47:04,546 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:47:04,546 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.3/100
2025-11-26 17:47:04,546 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to a minimum of SAR 1,000,000
2025-11-26 17:47:04,546 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:04,546 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:47:04,547 - app.services.ai_parser - INFO - 
2025-11-26 17:47:04,547 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:04,547 - app.services.ai_parser - INFO -    âœ“ Benefits: 25
2025-11-26 17:47:04,547 - app.services.ai_parser - INFO -    âœ“ Exclusions: 28
2025-11-26 17:47:04,547 - app.services.ai_parser - INFO -    âœ“ Warranties: 5
2025-11-26 17:47:04,548 - app.services.ai_parser - INFO -    âœ“ Extensions: 9
2025-11-26 17:47:04,548 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:47:04,548 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:04,549 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: b36b11e659bd4b88aba0bf396a8e2cc7.pdf â†’ 69273d18ba6c5e5b55032964
2025-11-26 17:47:04,550 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d18ba6c5e5b55032964
2025-11-26 17:47:04,551 - app.services.user_documents_service - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 69273d18ba6c5e5b55032965 (309991 bytes)
2025-11-26 17:47:04,552 - app.api.routes - INFO - âœ… Saved user document: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf â†’ 69273d18ba6c5e5b55032965
2025-11-26 17:47:04,552 - app.api.routes - INFO - âœ… Successfully processed: ..Al Sharif Contracting  TERMS.docx  22-05-2025.pdf...pdf
2025-11-26 17:47:05,627 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:05,629 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 17:47:05,630 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:05,630 - app.services.ai_parser - INFO - 
2025-11-26 17:47:05,630 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:05,630 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:47:05,631 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:05,631 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Rajhi Takaful
2025-11-26 17:47:05,631 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Al Sharif Contracting and Commercial Development Company is a one-
2025-11-26 17:47:05,631 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 609,853.20
2025-11-26 17:47:05,631 - app.services.ai_parser - INFO - ðŸ“Š Rate: 1.1â€°
2025-11-26 17:47:05,632 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 17:47:05,632 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.3/100
2025-11-26 17:47:05,632 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SR 1,000,000 | BI: 10%, min SR 10,000
2025-11-26 17:47:05,632 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:05,632 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:47:05,633 - app.services.ai_parser - INFO - 
2025-11-26 17:47:05,633 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:05,633 - app.services.ai_parser - INFO -    âœ“ Benefits: 23
2025-11-26 17:47:05,633 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 17:47:05,633 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 17:47:05,634 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:47:05,634 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:47:05,634 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:05,636 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 6798c6e6d2c64d16824ad19aa4075a2e.pdf â†’ 69273d19ba6c5e5b55032966
2025-11-26 17:47:05,636 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d19ba6c5e5b55032966
2025-11-26 17:47:05,643 - app.services.user_documents_service - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 69273d19ba6c5e5b55032967 (843321 bytes)
2025-11-26 17:47:05,644 - app.api.routes - INFO - âœ… Saved user document: QU CAR Al Sharif Contracting 4400021356.pdf â†’ 69273d19ba6c5e5b55032967
2025-11-26 17:47:05,644 - app.api.routes - INFO - âœ… Successfully processed: QU CAR Al Sharif Contracting 4400021356.pdf
2025-11-26 17:47:06,680 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:06,685 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 75.0
2025-11-26 17:47:06,686 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:06,686 - app.services.ai_parser - INFO - 
2025-11-26 17:47:06,686 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:06,687 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:47:06,687 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:06,687 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 17:47:06,687 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:47:06,688 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 20,000.00
2025-11-26 17:47:06,688 - app.services.ai_parser - INFO - ðŸ“Š Rate: FLAT Premium
2025-11-26 17:47:06,688 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 75.0/100
2025-11-26 17:47:06,688 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:47:06,688 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1%, min SAR 10,000
2025-11-26 17:47:06,689 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:06,689 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:47:06,689 - app.services.ai_parser - INFO - 
2025-11-26 17:47:06,689 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:06,689 - app.services.ai_parser - INFO -    âœ“ Benefits: 10
2025-11-26 17:47:06,690 - app.services.ai_parser - INFO -    âœ“ Exclusions: 41
2025-11-26 17:47:06,690 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 17:47:06,690 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:47:06,690 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:47:06,690 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:06,692 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: f2615f3fc0fd41758db24ac9b9e86552.pdf â†’ 69273d1aba6c5e5b55032968
2025-11-26 17:47:06,692 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d1aba6c5e5b55032968
2025-11-26 17:47:06,694 - app.services.user_documents_service - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 69273d1aba6c5e5b55032969 (241116 bytes)
2025-11-26 17:47:06,694 - app.api.routes - INFO - âœ… Saved user document: REQ106402 - CAR - Nexaura Events - Annual.pdf â†’ 69273d1aba6c5e5b55032969
2025-11-26 17:47:06,695 - app.api.routes - INFO - âœ… Successfully processed: REQ106402 - CAR - Nexaura Events - Annual.pdf
2025-11-26 17:47:09,529 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:09,536 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:47:09,537 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:47:09,538 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:47:09,539 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:47:09,545 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 37 benefits from patterns
2025-11-26 17:47:09,546 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 34 total
2025-11-26 17:47:09,546 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:47:11,295 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:11,298 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:47:11,299 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:47:11,299 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:47:11,299 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:47:12,480 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:12,481 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:47:12,481 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:47:12,482 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:47:12,482 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:47:12,484 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 16 benefits from patterns
2025-11-26 17:47:12,484 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 15 total
2025-11-26 17:47:12,485 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:47:12,704 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:12,707 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:47:12,707 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:47:12,708 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.95%o on total sum insured of SAR 350,328,000/-' â†’ '0.95â€°'
2025-11-26 17:47:12,708 - app.services.ai_parser - INFO - ðŸ’° Calculated: 332811.60 from SI: 350328000.0 Ã— Rate: 0.95%o on total sum insured of SAR 350,328,000/-
2025-11-26 17:47:12,709 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the loss amount minimum SAR 1,000,000 | Nat Cat: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 17:47:12,710 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:47:12,710 - app.services.ai_parser - INFO - ðŸ“Š Counts: 34 benefits, 42 exclusions, 6 warranties, 0 extensions
2025-11-26 17:47:18,781 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:18,785 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:47:18,786 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:47:18,786 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 18,000/- + Plus VAT 15%' â†’ '18%'
2025-11-26 17:47:18,787 - app.services.ai_parser - INFO - ðŸ’° Calculated: 720000000.00 from SI: 4000000.0 Ã— Rate: SR 18,000/- + Plus VAT 15%
2025-11-26 17:47:18,788 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 17:47:18,789 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:47:18,789 - app.services.ai_parser - INFO - ðŸ“Š Counts: 12 benefits, 64 exclusions, 19 warranties, 0 extensions
2025-11-26 17:47:19,806 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:19,810 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:47:19,811 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:47:19,812 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 2,250/- (Flat) + 15% VAT' â†’ '2%'
2025-11-26 17:47:19,812 - app.services.ai_parser - INFO - ðŸ’° Calculated: 3208500.00 from SI: 142600.0 Ã— Rate: SR 2,250/- (Flat) + 15% VAT
2025-11-26 17:47:19,814 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 1% of the claim amount subject to minimum of SR. 50,000/- each & every loss for all natural perils except flood
2025-11-26 17:47:19,815 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:47:19,815 - app.services.ai_parser - INFO - ðŸ“Š Counts: 15 benefits, 65 exclusions, 20 warranties, 0 extensions
2025-11-26 17:47:19,977 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:19,989 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-26 17:47:19,990 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:19,990 - app.services.ai_parser - INFO - 
2025-11-26 17:47:19,990 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:19,991 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:47:19,991 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:19,992 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Liva Insurance
2025-11-26 17:47:19,992 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:47:19,992 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 322,811.60
2025-11-26 17:47:19,993 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.95â€°
2025-11-26 17:47:19,993 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-26 17:47:19,993 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:47:19,993 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the loss amount minimum SAR 1,000,000 | Nat Cat: 1% of the loss amount minimum SAR 1,000,000
2025-11-26 17:47:19,994 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:19,994 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 17:47:19,994 - app.services.ai_parser - INFO - 
2025-11-26 17:47:19,994 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:19,994 - app.services.ai_parser - INFO -    âœ“ Benefits: 34
2025-11-26 17:47:19,994 - app.services.ai_parser - INFO -    âœ“ Exclusions: 42
2025-11-26 17:47:19,995 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 17:47:19,995 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:47:19,995 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 0
2025-11-26 17:47:19,995 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:19,996 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: eb18ce08bf4b4e4cac2d2c5d5b91d432.pdf â†’ 69273d27ba6c5e5b5503296a
2025-11-26 17:47:19,997 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d27ba6c5e5b5503296a
2025-11-26 17:47:19,998 - app.services.user_documents_service - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69273d27ba6c5e5b5503296b (290798 bytes)
2025-11-26 17:47:19,998 - app.api.routes - INFO - âœ… Saved user document: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf â†’ 69273d27ba6c5e5b5503296b
2025-11-26 17:47:19,998 - app.api.routes - INFO - âœ… Successfully processed: Q-10817-1-CAR - Al Sharif Contracting-  Contract  4400021955.pdf
2025-11-26 17:47:24,541 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:24,552 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 17:47:24,552 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:24,553 - app.services.ai_parser - INFO - 
2025-11-26 17:47:24,553 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:24,553 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:47:24,554 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:24,554 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 17:47:24,554 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:47:24,555 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 18,000.00
2025-11-26 17:47:24,555 - app.services.ai_parser - INFO - ðŸ“Š Rate: 18%
2025-11-26 17:47:24,555 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 17:47:24,556 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:47:24,556 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR 50,000
2025-11-26 17:47:24,556 - app.services.ai_parser - INFO - â° Validity: Quotation period as specified
2025-11-26 17:47:24,557 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: N/A
2025-11-26 17:47:24,557 - app.services.ai_parser - INFO - 
2025-11-26 17:47:24,557 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:24,557 - app.services.ai_parser - INFO -    âœ“ Benefits: 12
2025-11-26 17:47:24,558 - app.services.ai_parser - INFO -    âœ“ Exclusions: 64
2025-11-26 17:47:24,558 - app.services.ai_parser - INFO -    âœ“ Warranties: 19
2025-11-26 17:47:24,558 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:47:24,558 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 5
2025-11-26 17:47:24,558 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:24,560 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 8ea175534ab243f5ae9875eff51abeed.pdf â†’ 69273d2cba6c5e5b5503296c
2025-11-26 17:47:24,560 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d2cba6c5e5b5503296c
2025-11-26 17:47:24,572 - app.services.user_documents_service - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69273d2cba6c5e5b5503296d (2510488 bytes)
2025-11-26 17:47:24,573 - app.api.routes - INFO - âœ… Saved user document: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69273d2cba6c5e5b5503296d
2025-11-26 17:47:24,574 - app.api.routes - INFO - âœ… Successfully processed: Annual  - CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:47:25,357 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:25,361 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 76.0
2025-11-26 17:47:25,362 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:25,363 - app.services.ai_parser - INFO - 
2025-11-26 17:47:25,363 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:25,364 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:47:25,365 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:25,366 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Al Sagr Co-operative Insurance Company
2025-11-26 17:47:25,367 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:47:25,367 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 2,250.00
2025-11-26 17:47:25,368 - app.services.ai_parser - INFO - ðŸ“Š Rate: 2%
2025-11-26 17:47:25,369 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 76.0/100
2025-11-26 17:47:25,369 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:47:25,370 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 1% of the claim amount subject to minimum of SR. 50,000/- each & every loss for all natural perils except flood
2025-11-26 17:47:25,371 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:25,371 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:47:25,372 - app.services.ai_parser - INFO - 
2025-11-26 17:47:25,373 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:25,373 - app.services.ai_parser - INFO -    âœ“ Benefits: 15
2025-11-26 17:47:25,374 - app.services.ai_parser - INFO -    âœ“ Exclusions: 65
2025-11-26 17:47:25,375 - app.services.ai_parser - INFO -    âœ“ Warranties: 20
2025-11-26 17:47:25,375 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:47:25,376 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:47:25,377 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:25,381 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: ad529852c7e94bf49408f22c542a4928.pdf â†’ 69273d2dba6c5e5b5503296e
2025-11-26 17:47:25,383 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d2dba6c5e5b5503296e
2025-11-26 17:47:25,400 - app.services.user_documents_service - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69273d2dba6c5e5b5503296f (2137120 bytes)
2025-11-26 17:47:25,401 - app.api.routes - INFO - âœ… Saved user document: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf â†’ 69273d2dba6c5e5b5503296f
2025-11-26 17:47:25,401 - app.api.routes - INFO - âœ… Successfully processed: Revised Single CAR  QTN - NexAura â€“ Events & Exhibitions Production.pdf
2025-11-26 17:47:35,210 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:35,471 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:47:35,471 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:47:35,471 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:47:35,472 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:47:43,327 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:43,348 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:47:43,349 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:47:43,349 - app.services.ai_parser - INFO - ðŸ”„ Rate: '@ 0.35%o per mille' â†’ '0.35â€°'
2025-11-26 17:47:43,350 - app.services.ai_parser - INFO - ðŸ’° Calculated: 547628.31 from SI: 1564652306.0 Ã— Rate: @ 0.35%o per mille
2025-11-26 17:47:43,350 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 17:47:43,350 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 17:47:43,350 - app.services.ai_parser - INFO - âœ“ Deductible tier: >500M applies (SI: 1564.7M)
2025-11-26 17:47:43,351 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-26 17:47:43,351 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:47:43,351 - app.services.ai_parser - INFO - ðŸ“Š Counts: 48 benefits, 29 exclusions, 9 warranties, 5 extensions
2025-11-26 17:47:49,197 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:47:49,198 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 82.0
2025-11-26 17:47:49,198 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:47:49,198 - app.services.ai_parser - INFO - 
2025-11-26 17:47:49,199 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:49,199 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:47:49,199 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:49,200 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Chubb Arabia
2025-11-26 17:47:49,200 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/s. Mediclinic Al Murjan Hospital &/or Al Murjan Medical Centre Co. &/or Al Murjan Group
2025-11-26 17:47:49,200 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 547,628.31
2025-11-26 17:47:49,200 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.35â€°
2025-11-26 17:47:49,201 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 82.0/100
2025-11-26 17:47:49,201 - app.services.ai_parser - INFO - ðŸ“ Quality: 100.0/100
2025-11-26 17:47:49,201 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claims amount minimum SR 1,000,000 | BI: Minimum 21 days | Nat Cat: 5% of claims amount minimum SR 1,500,000
2025-11-26 17:47:49,201 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:47:49,201 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:47:49,202 - app.services.ai_parser - INFO - 
2025-11-26 17:47:49,202 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:47:49,202 - app.services.ai_parser - INFO -    âœ“ Benefits: 48
2025-11-26 17:47:49,202 - app.services.ai_parser - INFO -    âœ“ Exclusions: 29
2025-11-26 17:47:49,203 - app.services.ai_parser - INFO -    âœ“ Warranties: 9
2025-11-26 17:47:49,203 - app.services.ai_parser - INFO -    âœ“ Extensions: 5
2025-11-26 17:47:49,203 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:47:49,203 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:47:49,205 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: d4b143453e3e4a009c15a5b5b82dfe40.pdf â†’ 69273d45ba6c5e5b55032970
2025-11-26 17:47:49,205 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273d45ba6c5e5b55032970
2025-11-26 17:47:49,207 - app.services.user_documents_service - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69273d45ba6c5e5b55032971 (175401 bytes)
2025-11-26 17:47:49,207 - app.api.routes - INFO - âœ… Saved user document: AL Salama Hospital - PAR - Chubb.pdf â†’ 69273d45ba6c5e5b55032971
2025-11-26 17:47:49,208 - app.api.routes - INFO - âœ… Successfully processed: AL Salama Hospital - PAR - Chubb.pdf
2025-11-26 17:47:49,208 - app.api.routes - INFO - 
âœ… Successfully extracted 8 quotes
2025-11-26 17:47:49,208 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:47:49,209 - app.api.routes - INFO - ðŸ”€ Generating comparison for 8 quotes
2025-11-26 17:47:49,209 - app.api.routes - INFO - ======================================================================
2025-11-26 17:47:49,209 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 8 quotes
2025-11-26 17:47:49,210 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 17:47:49,210 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 17:47:49,210 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 17:47:49,210 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 17:47:49,211 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 17:47:49,211 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,211 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 17:47:49,211 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,212 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,212 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,212 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,212 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,213 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:47:49,213 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,213 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,213 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,213 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,213 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 200,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 200000,
    "total_sum_insured": "SAR 200,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All losses",
        "deductible": "1% of the loss amount minimum SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All losses",
      "deductible": "1% of the loss amount minimum SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and in the aggregate",
    "
2025-11-26 17:47:49,215 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,215 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:47:49,215 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:47:49,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,216 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,217 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,218 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,218 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,218 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:47:49,218 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,219 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Liva Insurance
2025-11-26 17:47:49,219 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 17:47:49,219 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 17:47:49,219 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:47:49,219 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 17:47:49,220 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:47:49,220 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,220 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Wataniya Insurance
2025-11-26 17:47:49,220 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,221 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,221 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,221 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,221 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,222 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:47:49,222 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,223 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,223 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,223 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,223 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 365,000,000.00",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 365000000,
    "total_sum_insured": "SAR 365,000,000.00"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "All losses including Natural Catastrophe Risks",
        "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "All losses including Natural Catastrophe Risks",
      "deductible": "1% of the claim amount subject to a minimum of SAR 1,000,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "N/A",
    "srcc_m
2025-11-26 17:47:49,227 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,228 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:47:49,229 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:47:49,230 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,230 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,230 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,231 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,231 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,231 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,232 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,232 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,232 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,233 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,233 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,233 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,234 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,234 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:47:49,234 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,235 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Wataniya Insurance
2025-11-26 17:47:49,235 - app.services.ai_ranker - INFO - 
ðŸ“Š Wataniya Insurance:
2025-11-26 17:47:49,235 - app.services.ai_ranker - INFO -    Warranties: 5
2025-11-26 17:47:49,236 - app.services.ai_ranker - INFO -    Extensions: 9
2025-11-26 17:47:49,236 - app.services.ai_ranker - INFO -    Exclusions: 28
2025-11-26 17:47:49,237 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:47:49,237 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,238 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Rajhi Takaful
2025-11-26 17:47:49,238 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,238 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,239 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,239 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,240 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,240 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:47:49,241 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,241 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,241 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,241 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,242 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SAR 544,412,000",
    "business_interruption": "SAR 10,000,000",
    "total_sum_insured_numeric": 554412000,
    "total_sum_insured": "SR 554,412,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all claims",
        "deductible": "1%, min SR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "natural catastrophe risks",
        "deductible": "1%, min SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [
      {
        "range": "underground property/services",
        "deductible": "10%, min SR 10,000",
        "applies_to": "third_party_liability"
      },
      {
        "range": "third-party property damage",
        "deductible": "SR 10,000",
        "applies_to": "third_party_liability"
      }
    ],
    "applicable_
2025-11-26 17:47:49,245 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,246 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:47:49,246 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:47:49,246 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,247 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,247 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,247 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,247 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,247 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,248 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,249 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,249 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:47:49,250 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,250 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Rajhi Takaful
2025-11-26 17:47:49,250 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Rajhi Takaful:
2025-11-26 17:47:49,250 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 17:47:49,250 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:47:49,251 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 17:47:49,251 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:47:49,251 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,251 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 17:47:49,251 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,252 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,252 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,252 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,252 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,253 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:47:49,254 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,254 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,254 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,255 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,255 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 4,000,000",
    "business_interruption": "Not Covered",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SAR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_loss_amount",
    "material_damage_tiers": [
      {
        "range": "Any loss amount",
        "deductible": "1%, min SAR 10,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "Any loss amount",
      "deductible": "1%, min SAR 10,000",
      "applies_to": "material_damage"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "care_custody_control": "SAR 25,000 any one occurrence and SAR 200,000 in the aggregate",
    "srcc_malicious_damage": "SAR 50,000 any one occurrence and SAR 200,000 in the aggregate during the policy period",
    "Claims Preparation Clause": "SR 25,000"
  },
  "exclusio
2025-11-26 17:47:49,257 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,258 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:47:49,258 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:47:49,259 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,259 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,260 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,260 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,261 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,262 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,262 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,263 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,264 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,264 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:47:49,265 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,265 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Liva Insurance
2025-11-26 17:47:49,265 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 17:47:49,265 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 17:47:49,266 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:47:49,266 - app.services.ai_ranker - INFO -    Exclusions: 41
2025-11-26 17:47:49,266 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:47:49,266 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,266 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Liva Insurance
2025-11-26 17:47:49,266 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,267 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,267 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,267 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,268 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,268 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': [], 'conditions_precedent': ['No deterioration of loss record'], 'documentation_required': []}
2025-11-26 17:47:49,268 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,268 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,268 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,269 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,269 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "LIVA",
  "sum_insured_breakdown": {
    "material_damage": "SAR 350,328,000",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 350328000,
    "total_sum_insured": "SAR 350,328,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Other losses",
        "deductible": "1% of the loss amount minimum SAR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [
      {
        "range": "NATCAT",
        "deductible": "1% of the loss amount minimum SAR 1,000,000"
      }
    ],
    "applicable_md_tier": {
      "range": "NATCAT",
      "deductible": "1% of the loss amount minimum SAR 1,000,000",
      "applies_to": "material_dama
2025-11-26 17:47:49,273 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'binding_requirements': []
2025-11-26 17:47:49,273 - app.services.ai_ranker - INFO -    âœ… Found 1 items in key 'conditions_precedent': ['No deterioration of loss record']
2025-11-26 17:47:49,273 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'documentation_required': []
2025-11-26 17:47:49,274 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,274 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,275 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,275 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,275 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,276 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,276 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,277 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,278 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,278 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,280 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,280 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,280 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,281 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 1
2025-11-26 17:47:49,281 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['No deterioration of loss record']
2025-11-26 17:47:49,281 - app.services.ai_ranker - INFO -    âœ… Extracted 1 subjectivities for Liva Insurance
2025-11-26 17:47:49,281 - app.services.ai_ranker - INFO - 
ðŸ“Š Liva Insurance:
2025-11-26 17:47:49,281 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 17:47:49,281 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:47:49,282 - app.services.ai_ranker - INFO -    Exclusions: 42
2025-11-26 17:47:49,282 - app.services.ai_ranker - INFO -    Subjectivities: 1
2025-11-26 17:47:49,282 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,282 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 17:47:49,282 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,283 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,283 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,283 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,283 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,283 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer', 'National Address', 'VAT Certificate'], 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing'], 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy', 'Copy of the project contingency plans', 'Copy of any agreement imposing specific insurance or risk management criteria', 'Copy of any clauses in the works contract or tender documentation specifying types of insurance required']}
2025-11-26 17:47:49,284 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,284 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,284 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,284 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,285 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 4,000,000",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 4000000,
    "total_sum_insured": "SR 4,000,000"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "other than natural perils",
        "deductible": "1% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "flood",
        "deductible": "10% of the claim amount subject to minimum of SR 25,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "all natural perils",
2025-11-26 17:47:49,287 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'binding_requirements': ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 17:47:49,288 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['All subjectivities to be applied on each & every project separately', 'Quotation deemed invalid if any information is found to be materially incorrect', 'Terms invalid after expiry of quotation period unless otherwise agreed in writing']
2025-11-26 17:47:49,288 - app.services.ai_ranker - INFO -    âœ… Found 6 items in key 'documentation_required': ['Copy of the project managerâ€™s risk review and risk register', 'Copy of the project risk mitigation strategy document', 'Details on the risk management strategy']
2025-11-26 17:47:49,288 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,289 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,289 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,289 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,289 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,290 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,290 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,291 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,291 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,292 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,292 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,293 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,293 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,294 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 14
2025-11-26 17:47:49,295 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Completed signed & stamped KYC Form', 'CR copy', 'Copy of ID of the authorized person to transact on behalf of the customer']
2025-11-26 17:47:49,297 - app.services.ai_ranker - INFO -    âœ… Extracted 14 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 17:47:49,298 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 17:47:49,298 - app.services.ai_ranker - INFO -    Warranties: 19
2025-11-26 17:47:49,299 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:47:49,299 - app.services.ai_ranker - INFO -    Exclusions: 64
2025-11-26 17:47:49,299 - app.services.ai_ranker - INFO -    Subjectivities: 14
2025-11-26 17:47:49,299 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,300 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Al Sagr Co-operative Insurance Company
2025-11-26 17:47:49,300 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,300 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,300 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,301 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,301 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,301 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:47:49,301 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,302 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,302 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,302 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,302 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 142,600/-",
    "business_interruption": "Nil",
    "total_sum_insured_numeric": 142600,
    "total_sum_insured": "SR 142,600"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "all",
        "deductible": "1% of the claim amount subject to minimum of SR. 50,000/- each & every loss for all natural perils except flood",
        "applies_to": "material_damage"
      },
      {
        "range": "all",
        "deductible": "1% of the claim amount subject to minimum of SR. 25,000/- each & every loss for other than natural perils",
        "applies_to": "material_damage"
      },
      {
        "range": "all",
        "deductible": "10% of the claim amount subject to minimum of SR. 25,000/- each & every loss for flood",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    
2025-11-26 17:47:49,305 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,305 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:47:49,306 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:47:49,306 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,306 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,306 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,307 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,307 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,308 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,308 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,308 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,309 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,309 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,310 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,310 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,311 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,311 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:47:49,311 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,312 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Al Sagr Co-operative Insurance Company
2025-11-26 17:47:49,312 - app.services.ai_ranker - INFO - 
ðŸ“Š Al Sagr Co-operative Insurance Company:
2025-11-26 17:47:49,312 - app.services.ai_ranker - INFO -    Warranties: 20
2025-11-26 17:47:49,312 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:47:49,312 - app.services.ai_ranker - INFO -    Exclusions: 65
2025-11-26 17:47:49,313 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:47:49,313 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:47:49,313 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Chubb Arabia
2025-11-26 17:47:49,313 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:47:49,314 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:47:49,314 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:47:49,314 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:47:49,314 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:47:49,314 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:47:49,315 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:47:49,315 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:47:49,315 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:47:49,315 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:47:49,316 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "CHUBB",
  "sum_insured_breakdown": {
    "material_damage": "SR 914,652,306",
    "business_interruption": "SR 650,000,000",
    "total_sum_insured_numeric": 1564652306,
    "total_sum_insured": "SR 1,564,652,306"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 40M",
        "deductible": "5% of claims amount minimum SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 40M to SR 100M",
        "deductible": "5% of claims amount minimum SR 100,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100M to SR 500M",
        "deductible": "5% of claims amount minimum SR 500,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500M",
        "deductible": "5% of claims amount minimum SR 1,000,000",
        "applies_to": "material_damage"
      }
    ],
    "business_in
2025-11-26 17:47:49,317 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,317 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:47:49,318 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:47:49,318 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:47:49,318 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:47:49,318 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:47:49,318 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:47:49,319 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:47:49,319 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,320 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:47:49,320 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:47:49,321 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:47:49,321 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:47:49,322 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:47:49,322 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:47:49,322 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:47:49,323 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:47:49,323 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:47:49,323 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Chubb Arabia
2025-11-26 17:47:49,323 - app.services.ai_ranker - INFO - 
ðŸ“Š Chubb Arabia:
2025-11-26 17:47:49,324 - app.services.ai_ranker - INFO -    Warranties: 9
2025-11-26 17:47:49,324 - app.services.ai_ranker - INFO -    Extensions: 5
2025-11-26 17:47:49,324 - app.services.ai_ranker - INFO -    Exclusions: 29
2025-11-26 17:47:49,324 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:47:49,325 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Liva Insurance
2025-11-26 17:47:50,427 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 17:47:50,427 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:47:50,427 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:47:50,428 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:47:50,428 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:47:50,428 - app.services.ai_ranker - INFO -       â€¢ Tandem Lift Provision Warranty
2025-11-26 17:47:50,429 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Wataniya Insurance
2025-11-26 17:47:51,206 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 1
2025-11-26 17:47:51,207 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 9
2025-11-26 17:47:51,207 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:47:51,207 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:47:51,207 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:47:51,208 - app.services.ai_ranker - INFO -       â€¢ Warranted that Reasonable Precautions to be taken during the project period
2025-11-26 17:47:51,208 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Rajhi Takaful
2025-11-26 17:47:52,067 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 17:47:52,068 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:47:52,068 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:47:52,068 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:47:52,068 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Al Sagr Co-operative Insurance Company
2025-11-26 17:47:53,748 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 10
2025-11-26 17:47:53,749 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:47:53,749 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:47:53,749 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:47:53,749 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:47:53,750 - app.services.ai_ranker - INFO -       â€¢ Warranted that third party claims are not covered
2025-11-26 17:47:53,750 - app.services.ai_ranker - INFO -       â€¢ Warranted that professional & expert operator to perform duties
2025-11-26 17:47:53,750 - app.services.ai_ranker - INFO -       â€¢ Warranted heavy lifting should be carried out by competent and skilled manpower
2025-11-26 17:47:53,751 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Chubb Arabia
2025-11-26 17:47:54,536 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 2
2025-11-26 17:47:54,536 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 5
2025-11-26 17:47:54,537 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 9
2025-11-26 17:47:54,537 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:47:54,537 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:47:54,537 - app.services.ai_ranker - INFO -       â€¢ Warranted strict adherence of local/police/Civil Defense authorities for all saf...
2025-11-26 17:47:54,538 - app.services.ai_ranker - INFO -       â€¢ Civil Defense Certificate clause
2025-11-26 17:47:54,538 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 17:47:54,538 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 17:47:54,538 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 17:47:54,539 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=65.75
2025-11-26 17:47:54,539 - app.services.ai_ranker - INFO - ðŸ“Š Wataniya Insurance: Hakim Score=88.0 (Strong), Weighted Score=74.20
2025-11-26 17:47:54,539 - app.services.ai_ranker - INFO - ðŸ“Š Al Rajhi Takaful: Hakim Score=80.0 (Baseline), Weighted Score=67.11
2025-11-26 17:47:54,540 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=59.08
2025-11-26 17:47:54,540 - app.services.ai_ranker - INFO - ðŸ“Š Liva Insurance: Hakim Score=84.0 (Solid), Weighted Score=71.10
2025-11-26 17:47:54,540 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=59.28
2025-11-26 17:47:54,540 - app.services.ai_ranker - INFO - ðŸ“Š Al Sagr Co-operative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=67.38
2025-11-26 17:47:54,541 - app.services.ai_ranker - INFO - ðŸ“Š Chubb Arabia: Hakim Score=80.0 (Baseline), Weighted Score=78.94
2025-11-26 17:47:54,541 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 17:47:54,541 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 17:48:04,101 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:48:04,104 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 17:48:04,104 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 17:48:04,105 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 17:48:09,257 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:48:09,258 - app.services.ai_ranker - INFO - âœ… Generated reasoning for Chubb Arabia: Chubb Arabia stands out as the best insurance provider with a top rank of #1 and a score of 78.9/100...
2025-11-26 17:48:09,259 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 17:48:09,259 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 17:48:09,259 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:09,260 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 8
2025-11-26 17:48:09,260 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 17:48:09,260 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 8
2025-11-26 17:48:09,260 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Liva Insurance
2025-11-26 17:48:09,261 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 17:48:09,261 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 17:48:09,261 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 17:48:09,261 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 17:48:09,261 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 17:48:09,261 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 17:48:09,262 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Wataniya Insurance
2025-11-26 17:48:09,262 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 17:48:09,262 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 17:48:09,262 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 17:48:09,262 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 17:48:09,263 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 17:48:09,263 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 17:48:09,268 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 17:48:09,268 - app.services.mongodb_service_enhanced - INFO -    Summary: 12,893 bytes
2025-11-26 17:48:09,269 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 111,355 bytes
2025-11-26 17:48:09,269 - app.services.mongodb_service_enhanced - INFO -    Data table: 50,198 bytes
2025-11-26 17:48:09,269 - app.services.mongodb_service_enhanced - INFO -    Analytics: 3,339 bytes
2025-11-26 17:48:09,269 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 132,548 bytes
2025-11-26 17:48:09,270 - app.services.mongodb_service_enhanced - INFO -    Total document: 646,797 bytes
2025-11-26 17:48:09,270 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 17:48:09,270 - app.services.mongodb_service_enhanced - INFO -       premium: 8 items
2025-11-26 17:48:09,271 - app.services.mongodb_service_enhanced - INFO -       rate: 8 items
2025-11-26 17:48:09,271 - app.services.mongodb_service_enhanced - INFO -       score: 8 items
2025-11-26 17:48:09,271 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 8 items
2025-11-26 17:48:09,271 - app.services.mongodb_service_enhanced - INFO -       deductible: 8 items
2025-11-26 17:48:09,271 - app.services.mongodb_service_enhanced - INFO -       coverage: 8 items
2025-11-26 17:48:09,272 - app.services.mongodb_service_enhanced - INFO -       benefits: 8 items
2025-11-26 17:48:09,272 - app.services.mongodb_service_enhanced - INFO -       exclusions: 8 items
2025-11-26 17:48:09,272 - app.services.mongodb_service_enhanced - INFO -       warranties: 8 items
2025-11-26 17:48:09,272 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 8 items
2025-11-26 17:48:09,273 - app.services.mongodb_service_enhanced - INFO -       conditions: 8 items
2025-11-26 17:48:09,273 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 8 items
2025-11-26 17:48:09,273 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 8 items
2025-11-26 17:48:09,273 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 8 items
2025-11-26 17:48:09,273 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 17:48:09,274 - app.services.mongodb_service_enhanced - INFO -       - Count: 8
2025-11-26 17:48:09,274 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 17:48:09,275 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:48:09,275 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 17:48:09,288 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:09,288 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69273d59b757af6a8efab060
2025-11-26 17:48:09,297 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 17:48:09,297 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 17:48:09,297 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 17:48:09,298 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 17:48:09,298 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 17:48:09,298 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 17:48:09,298 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 17:48:09,298 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 8
2025-11-26 17:48:09,299 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 17:48:09,299 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 8
2025-11-26 17:48:09,299 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 17:48:09,299 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 8
2025-11-26 17:48:09,300 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 17:48:09,300 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 17:48:09,300 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 17:48:09,301 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 17:48:09,301 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 17:48:09,301 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 17:48:09,301 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:48:09,302 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69273d59b757af6a8efab060
2025-11-26 17:48:09,302 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 17:48:09,302 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 17:48:09,302 - app.api.routes - INFO -    Comparison ID: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:09,306 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 17:48:09,306 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 17:48:09,307 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:48:09,307 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 17:48:09,307 - app.api.routes - INFO - ======================================================================
2025-11-26 17:48:09,308 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:09,308 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 17:48:09,308 - app.api.routes - INFO - ðŸ“„ Files Processed: 8/8
2025-11-26 17:48:09,308 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 8 PDFs + 1 comparison
2025-11-26 17:48:09,309 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 17:48:09,309 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 17:48:09,309 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 17:48:09,311 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 17:48:09,314 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 17:48:09,314 - app.api.routes - INFO - ======================================================================

2025-11-26 17:48:09,315 - app.services.progress_tracker - INFO - âœ… Job completed: job_115e23b89903 â†’ comparison_id: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:09,319 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 107.47s
2025-11-26 17:48:28,579 - main - INFO - ðŸ“¥ GET /api/comparison/ cmp_1764179181_e8f6c9cd4154/pdf
2025-11-26 17:48:28,581 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison:  cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:28,584 - main - INFO - ðŸ“¤ GET /api/comparison/ cmp_1764179181_e8f6c9cd4154/pdf - 404 - 0.00s
2025-11-26 17:48:44,752 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764179181_e8f6c9cd4154/pdf
2025-11-26 17:48:44,754 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:44,760 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:44,760 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:48:44,761 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:48:44,762 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:48:44,762 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:48:44,765 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:48:44,766 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:48:44,802 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:48:44,802 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:48:44,806 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:48:44,807 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:48:44,809 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:48:44,810 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:48:44,813 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:48:45,072 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:48:45,072 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764179181_e8f6c9cd4154_20251126_174845.pdf (165791 bytes)
2025-11-26 17:48:45,073 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764179181_e8f6c9cd4154/pdf - 200 - 0.32s
2025-11-26 17:53:26,893 - main - INFO - 
2025-11-26 17:53:26,893 - main - INFO - ================================================================================
2025-11-26 17:53:26,894 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:53:26,896 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:53:26,897 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:53:26,898 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:53:26,899 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:53:26,900 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:53:26,901 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:53:26,906 - main - INFO -   âœ… Cleaned up 8 temporary files
2025-11-26 17:53:26,906 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:53:26,907 - main - INFO - ================================================================================
2025-11-26 17:53:26,907 - main - INFO - 
2025-11-26 17:53:31,246 - main - INFO - 
2025-11-26 17:53:31,246 - main - INFO - ================================================================================
2025-11-26 17:53:31,246 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:53:31,247 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:53:31,247 - main - INFO - ================================================================================
2025-11-26 17:53:31,247 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:53:31,247 - main - INFO -   Upload Directory: uploads
2025-11-26 17:53:31,247 - main - INFO -   Max File Size: 20MB
2025-11-26 17:53:31,247 - main - INFO - ================================================================================
2025-11-26 17:53:31,248 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:53:31,248 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:53:31,248 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:53:31,284 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:53:31,295 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:53:31,296 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:53:31,296 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:53:31,296 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:53:31,296 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:53:31,316 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:53:31,317 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:53:31,318 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:53:31,321 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:53:31,321 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:53:31,321 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:53:31,322 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:53:31,322 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:53:31,346 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:53:31,346 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:53:31,346 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:53:31,347 - main - INFO - 
2025-11-26 17:53:31,347 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:53:31,347 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:53:31,347 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:53:31,348 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:53:31,348 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:53:31,348 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:53:31,348 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:53:31,348 - main - INFO - 
2025-11-26 17:53:31,349 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:53:31,349 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:53:31,349 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:53:31,349 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:53:31,349 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:53:31,349 - main - INFO - 
2025-11-26 17:53:31,350 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:53:31,350 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:53:31,350 - main - INFO -        - No manual section generation
2025-11-26 17:53:31,350 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:53:31,350 - main - INFO - 
2025-11-26 17:53:31,350 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:53:31,351 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:53:31,351 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:53:31,351 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:53:31,351 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:53:31,351 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:53:31,351 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:53:31,352 - main - INFO - 
2025-11-26 17:53:31,352 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:53:31,352 - main - INFO -      Main:
2025-11-26 17:53:31,352 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:53:31,352 - main - INFO - 
2025-11-26 17:53:31,352 - main - INFO -      Retrieval:
2025-11-26 17:53:31,353 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:53:31,353 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:53:31,353 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:53:31,353 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:53:31,354 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:53:31,354 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:53:31,354 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:53:31,354 - main - INFO - 
2025-11-26 17:53:31,354 - main - INFO -      Management:
2025-11-26 17:53:31,355 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:53:31,355 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:53:31,355 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:53:31,355 - main - INFO - 
2025-11-26 17:53:31,356 - main - INFO -      Documents (MongoDB):
2025-11-26 17:53:31,356 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:53:31,356 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:53:31,356 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:53:31,356 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:53:31,357 - main - INFO - 
2025-11-26 17:53:31,357 - main - INFO -      Diagnostics & Health:
2025-11-26 17:53:31,357 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:53:31,358 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:53:31,358 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:53:31,358 - main - INFO - 
2025-11-26 17:53:31,358 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:53:31,358 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:53:31,359 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:53:31,359 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:53:31,360 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:53:31,360 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:53:31,360 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:53:31,361 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:53:31,361 - main - INFO - 
2025-11-26 17:53:31,361 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:53:31,362 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:53:31,362 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:53:31,362 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:53:31,362 - main - INFO -      4. No re-upload needed!
2025-11-26 17:53:31,363 - main - INFO - 
2025-11-26 17:53:31,363 - main - INFO - ================================================================================
2025-11-26 17:53:31,363 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:53:31,363 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:53:31,363 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:53:31,364 - main - INFO - ================================================================================
2025-11-26 17:53:31,364 - main - INFO - 
2025-11-26 17:53:31,364 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:54:16,672 - main - INFO - 
2025-11-26 17:54:16,672 - main - INFO - ================================================================================
2025-11-26 17:54:16,673 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 17:54:16,675 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:54:16,675 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 17:54:16,677 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 17:54:16,677 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 17:54:16,679 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 17:54:16,679 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 17:54:16,680 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 17:54:16,681 - main - INFO -   âœ… Application stopped successfully
2025-11-26 17:54:16,681 - main - INFO - ================================================================================
2025-11-26 17:54:16,682 - main - INFO - 
2025-11-26 17:54:19,227 - main - INFO - 
2025-11-26 17:54:19,228 - main - INFO - ================================================================================
2025-11-26 17:54:19,228 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 17:54:19,228 - main - INFO -   Production-Ready Complete Integration
2025-11-26 17:54:19,228 - main - INFO - ================================================================================
2025-11-26 17:54:19,228 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 17:54:19,229 - main - INFO -   Upload Directory: uploads
2025-11-26 17:54:19,229 - main - INFO -   Max File Size: 20MB
2025-11-26 17:54:19,229 - main - INFO - ================================================================================
2025-11-26 17:54:19,229 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 17:54:19,230 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 17:54:19,230 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 17:54:19,281 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 17:54:19,287 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 17:54:19,288 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 17:54:19,288 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 17:54:19,288 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:54:19,289 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 17:54:19,295 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 17:54:19,296 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 17:54:19,297 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 17:54:19,298 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 17:54:19,299 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 17:54:19,299 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 17:54:19,299 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 17:54:19,299 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 17:54:19,306 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 17:54:19,306 - main - INFO -   âœ… User Documents Service connected
2025-11-26 17:54:19,306 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 17:54:19,307 - main - INFO - 
2025-11-26 17:54:19,307 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 17:54:19,307 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 17:54:19,307 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 17:54:19,307 - main - INFO -        - Separates warranties from extensions
2025-11-26 17:54:19,308 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 17:54:19,308 - main - INFO -        - Correct deductible tier detection
2025-11-26 17:54:19,308 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 17:54:19,308 - main - INFO - 
2025-11-26 17:54:19,309 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 17:54:19,309 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 17:54:19,309 - main - INFO -        - Identifies unique items per provider
2025-11-26 17:54:19,309 - main - INFO -        - Transparent scoring methodology
2025-11-26 17:54:19,310 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 17:54:19,310 - main - INFO - 
2025-11-26 17:54:19,310 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 17:54:19,311 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 17:54:19,311 - main - INFO -        - No manual section generation
2025-11-26 17:54:19,311 - main - INFO -        - Complete MongoDB integration
2025-11-26 17:54:19,311 - main - INFO - 
2025-11-26 17:54:19,312 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 17:54:19,312 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 17:54:19,312 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 17:54:19,312 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 17:54:19,312 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 17:54:19,313 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 17:54:19,313 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 17:54:19,313 - main - INFO - 
2025-11-26 17:54:19,313 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 17:54:19,313 - main - INFO -      Main:
2025-11-26 17:54:19,313 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 17:54:19,314 - main - INFO - 
2025-11-26 17:54:19,314 - main - INFO -      Retrieval:
2025-11-26 17:54:19,314 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 17:54:19,314 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 17:54:19,314 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 17:54:19,314 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 17:54:19,315 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 17:54:19,315 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 17:54:19,315 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 17:54:19,315 - main - INFO - 
2025-11-26 17:54:19,315 - main - INFO -      Management:
2025-11-26 17:54:19,315 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 17:54:19,315 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 17:54:19,316 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 17:54:19,316 - main - INFO - 
2025-11-26 17:54:19,316 - main - INFO -      Documents (MongoDB):
2025-11-26 17:54:19,316 - main - INFO -        GET  /api/documents                All documents
2025-11-26 17:54:19,316 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 17:54:19,316 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 17:54:19,316 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 17:54:19,317 - main - INFO - 
2025-11-26 17:54:19,317 - main - INFO -      Diagnostics & Health:
2025-11-26 17:54:19,317 - main - INFO -        GET  /api/health                   System health
2025-11-26 17:54:19,317 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 17:54:19,317 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 17:54:19,317 - main - INFO - 
2025-11-26 17:54:19,318 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 17:54:19,318 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 17:54:19,318 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 17:54:19,318 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 17:54:19,318 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 17:54:19,318 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 17:54:19,318 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 17:54:19,319 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 17:54:19,319 - main - INFO - 
2025-11-26 17:54:19,319 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 17:54:19,319 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 17:54:19,319 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 17:54:19,319 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 17:54:19,320 - main - INFO -      4. No re-upload needed!
2025-11-26 17:54:19,320 - main - INFO - 
2025-11-26 17:54:19,320 - main - INFO - ================================================================================
2025-11-26 17:54:19,321 - main - INFO -   âœ… Application started successfully!
2025-11-26 17:54:19,321 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 17:54:19,321 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 17:54:19,321 - main - INFO - ================================================================================
2025-11-26 17:54:19,321 - main - INFO - 
2025-11-26 17:54:19,322 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 17:54:26,067 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764179181_e8f6c9cd4154/pdf
2025-11-26 17:54:26,068 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:54:26,075 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:54:26,075 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 17:54:26,076 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 17:54:26,076 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 17:54:26,077 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 17:54:26,078 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 17:54:26,078 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 17:54:26,109 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 17:54:26,110 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 17:54:26,115 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 17:54:26,116 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 17:54:26,117 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 17:54:26,118 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 17:54:26,120 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 17:54:26,403 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764179181_e8f6c9cd4154
2025-11-26 17:54:26,404 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764179181_e8f6c9cd4154_20251126_175426.pdf (165778 bytes)
2025-11-26 17:54:26,406 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764179181_e8f6c9cd4154/pdf - 200 - 0.34s
2025-11-26 17:57:43,490 - main - INFO - ðŸ“¥ GET /docs
2025-11-26 17:57:43,492 - main - INFO - ðŸ“¤ GET /docs - 200 - 0.00s
2025-11-26 17:57:43,668 - main - INFO - ðŸ“¥ GET /openapi.json
2025-11-26 17:57:43,683 - main - INFO - ðŸ“¤ GET /openapi.json - 200 - 0.01s
2025-11-26 17:58:12,618 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 17:58:12,625 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 17:58:12,626 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 17:58:12,626 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 17:58:12,626 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 17:58:12,628 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 17:58:12,629 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 17:58:12,629 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 17:58:12,629 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 17:58:12,629 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-26 17:58:12,630 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764179892_50f2fd52023c
2025-11-26 17:58:12,630 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_a1abce950e50 (3 files)
2025-11-26 17:58:12,630 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_a1abce950e50
2025-11-26 17:58:12,631 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:58:12,632 - app.api.routes - INFO - ðŸ“„ Processing: Malath.pdf
2025-11-26 17:58:12,632 - app.api.routes - INFO - ======================================================================
2025-11-26 17:58:12,633 - app.api.routes - INFO - ðŸ’¾ Saved file: Malath.pdf â†’ ce44833de09c4461bb3a5bee75b13e49.pdf (203279 bytes)
2025-11-26 17:58:12,634 - app.api.routes - INFO - ðŸ“– Extracting text from: Malath.pdf
2025-11-26 17:58:12,634 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\ce44833de09c4461bb3a5bee75b13e49.pdf
2025-11-26 17:58:12,635 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:58:12,660 - app.api.routes - INFO - ðŸ“„ Processing: GIG.pdf
2025-11-26 17:58:12,677 - app.api.routes - INFO - ======================================================================
2025-11-26 17:58:12,689 - app.services.pdf_extractor - INFO - Successfully extracted 6578 characters from 3 pages
2025-11-26 17:58:12,690 - app.api.routes - INFO - ðŸ’¾ Saved file: GIG.pdf â†’ 59fef6b674a441a1b008a79d2e27d80d.pdf (478025 bytes)
2025-11-26 17:58:12,690 - app.api.routes - INFO - ðŸ“– Extracting text from: GIG.pdf
2025-11-26 17:58:12,691 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:58:12,691 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\59fef6b674a441a1b008a79d2e27d80d.pdf
2025-11-26 17:58:12,691 - app.api.routes - INFO - ðŸ“„ Processing: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 17:58:12,692 - app.api.routes - INFO - ======================================================================
2025-11-26 17:58:12,822 - app.services.pdf_extractor - INFO - Successfully extracted 6549 characters from 3 pages
2025-11-26 17:58:12,822 - app.api.routes - INFO - ðŸ’¾ Saved file: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 1fc84400a347417c9d8cd3140ce7c9d6.pdf (273210 bytes)
2025-11-26 17:58:12,823 - app.api.routes - INFO - ðŸ“– Extracting text from: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 17:58:12,823 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\1fc84400a347417c9d8cd3140ce7c9d6.pdf
2025-11-26 17:58:12,823 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Malath.pdf
2025-11-26 17:58:12,824 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Malath.pdf
2025-11-26 17:58:12,855 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Malath Insurance (pattern: \bmalath\b)
2025-11-26 17:58:12,857 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Malath Insurance
2025-11-26 17:58:12,856 - app.services.pdf_extractor - INFO - Successfully extracted 3016 characters from 1 pages
2025-11-26 17:58:12,858 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/S. Saudi Amana Contracting Co.
2025-11-26 17:58:12,858 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:58:12,859 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:58:12,896 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 17:58:12,896 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:58:13,288 - app.api.routes - INFO - ðŸ¤– Parsing with AI: GIG.pdf
2025-11-26 17:58:13,288 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for GIG.pdf
2025-11-26 17:58:13,288 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Gulf Insurance Group (GIG) (pattern: \bgig\b)
2025-11-26 17:58:13,289 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Gulf Insurance Group (GIG)
2025-11-26 17:58:13,289 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Saudi Amana Contracting Co. L.L.C
2025-11-26 17:58:13,289 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:58:13,289 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GIG
2025-11-26 17:58:13,332 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 4 sublimits
2025-11-26 17:58:13,333 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:58:13,334 - app.api.routes - INFO - ðŸ¤– Parsing with AI: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 17:58:13,334 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 17:58:13,336 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Arabian Shield Cooperative Insurance Company
2025-11-26 17:58:13,337 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Arabian Shield Cooperative Insurance Company
2025-11-26 17:58:13,337 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 17:58:13,338 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 17:58:13,338 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 17:58:13,352 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 17:58:13,352 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 17:58:22,795 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:22,821 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:58:22,821 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:58:22,823 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:58:22,823 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-26 17:58:22,825 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: As per expiring policy
2025-11-26 17:58:22,825 - app.services.ai_parser - WARNING - âš ï¸ Only 0 warranties, using fallback...
2025-11-26 17:58:22,826 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 0 warranties from patterns
2025-11-26 17:58:22,826 - app.services.ai_parser - WARNING - âš ï¸ Only 0 exclusions, using fallback...
2025-11-26 17:58:22,830 - app.services.ai_parser - INFO - ðŸš« Fallback extracted 0 exclusions from patterns
2025-11-26 17:58:22,831 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:58:22,834 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 0 benefits from patterns
2025-11-26 17:58:22,834 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:58:29,416 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:29,420 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:58:29,421 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:58:29,421 - app.services.ai_parser - INFO - ðŸ”„ Rate: '66,340.70 @ 0.1615 percent on sum insured' â†’ '66â€°'
2025-11-26 17:58:29,421 - app.services.ai_parser - INFO - ðŸ’° Calculated: 2725132100.17 from SI: 41077831.56 Ã— Rate: 66,340.70 @ 0.1615 percent on sum insured
2025-11-26 17:58:29,422 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: As per expiring policy
2025-11-26 17:58:29,422 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:58:29,422 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 0 exclusions, 0 warranties, 0 extensions
2025-11-26 17:58:35,019 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:35,022 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:58:35,023 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:58:35,024 - app.services.ai_parser - INFO - 
2025-11-26 17:58:35,025 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:35,026 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 17:58:35,027 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:35,027 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Arabian Shield Cooperative Insurance Company
2025-11-26 17:58:35,028 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 17:58:35,029 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 66,340.70
2025-11-26 17:58:35,029 - app.services.ai_parser - INFO - ðŸ“Š Rate: 66â€°
2025-11-26 17:58:35,030 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:58:35,031 - app.services.ai_parser - INFO - ðŸ“ Quality: 80.0/100
2025-11-26 17:58:35,032 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: As per expiring policy
2025-11-26 17:58:35,032 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:58:35,033 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:58:35,033 - app.services.ai_parser - INFO - 
2025-11-26 17:58:35,034 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:58:35,035 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-26 17:58:35,035 - app.services.ai_parser - INFO -    âœ“ Exclusions: 0
2025-11-26 17:58:35,036 - app.services.ai_parser - INFO -    âœ“ Warranties: 0
2025-11-26 17:58:35,036 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:58:35,037 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:58:35,037 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:35,040 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 1fc84400a347417c9d8cd3140ce7c9d6.pdf â†’ 69273fcb772ee2aa1a6150fa
2025-11-26 17:58:35,041 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273fcb772ee2aa1a6150fa
2025-11-26 17:58:35,046 - app.services.user_documents_service - INFO - âœ… Saved user document: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 69273fcb772ee2aa1a6150fb (273210 bytes)
2025-11-26 17:58:35,047 - app.api.routes - INFO - âœ… Saved user document: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 69273fcb772ee2aa1a6150fb
2025-11-26 17:58:35,048 - app.api.routes - INFO - âœ… Successfully processed: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 17:58:36,766 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:36,771 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:58:36,772 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:58:36,773 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:58:36,774 - app.services.ai_parser - WARNING - âš ï¸ Only 4 warranties, using fallback...
2025-11-26 17:58:36,779 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 6 warranties from patterns
2025-11-26 17:58:36,779 - app.services.ai_parser - INFO - âœ… Enhanced warranties: 7 total
2025-11-26 17:58:36,780 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 17:58:36,785 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 10 benefits from patterns
2025-11-26 17:58:36,786 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 10 total
2025-11-26 17:58:36,786 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:58:43,103 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:43,105 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:58:43,105 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:58:43,106 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.30% (Per Cent) will applies on the TSI subject to minimum SR 500 per Equipment.' â†’ '0.30%'
2025-11-26 17:58:43,106 - app.services.ai_parser - INFO - ðŸ’° Calculated: 123233.49 from SI: 41077831.25 Ã— Rate: 0.30% (Per Cent) will applies on the TSI subject to minimum SR 500 per Equipment.
2025-11-26 17:58:43,107 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of the claim amount, min SR 10,000
2025-11-26 17:58:43,107 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:58:43,107 - app.services.ai_parser - INFO - ðŸ“Š Counts: 10 benefits, 37 exclusions, 7 warranties, 0 extensions
2025-11-26 17:58:44,144 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:44,147 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 17:58:44,147 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 17:58:44,147 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 17:58:44,148 - app.services.ai_parser - WARNING - âš ï¸ Only 6 benefits, using fallback...
2025-11-26 17:58:44,151 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 28 benefits from patterns
2025-11-26 17:58:44,151 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 28 total
2025-11-26 17:58:44,151 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 17:58:47,467 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:47,492 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 17:58:47,492 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:58:47,493 - app.services.ai_parser - INFO - 
2025-11-26 17:58:47,493 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:47,493 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Malath.pdf
2025-11-26 17:58:47,494 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:47,494 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Malath Insurance
2025-11-26 17:58:47,494 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/S. Saudi Amana Contracting Co.
2025-11-26 17:58:47,495 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 169,122.30
2025-11-26 17:58:47,495 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.30%
2025-11-26 17:58:47,495 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 17:58:47,496 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.0/100
2025-11-26 17:58:47,496 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of the claim amount, min SR 10,000
2025-11-26 17:58:47,496 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:58:47,496 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:58:47,497 - app.services.ai_parser - INFO - 
2025-11-26 17:58:47,497 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:58:47,497 - app.services.ai_parser - INFO -    âœ“ Benefits: 10
2025-11-26 17:58:47,497 - app.services.ai_parser - INFO -    âœ“ Exclusions: 37
2025-11-26 17:58:47,497 - app.services.ai_parser - INFO -    âœ“ Warranties: 7
2025-11-26 17:58:47,498 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 17:58:47,498 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:58:47,498 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:47,499 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: ce44833de09c4461bb3a5bee75b13e49.pdf â†’ 69273fd7772ee2aa1a6150fc
2025-11-26 17:58:47,499 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273fd7772ee2aa1a6150fc
2025-11-26 17:58:47,501 - app.services.user_documents_service - INFO - âœ… Saved user document: Malath.pdf â†’ 69273fd7772ee2aa1a6150fd (203279 bytes)
2025-11-26 17:58:47,501 - app.api.routes - INFO - âœ… Saved user document: Malath.pdf â†’ 69273fd7772ee2aa1a6150fd
2025-11-26 17:58:47,501 - app.api.routes - INFO - âœ… Successfully processed: Malath.pdf
2025-11-26 17:58:50,339 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:50,342 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 17:58:50,343 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 17:58:50,344 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.2% on Total Sum Insured' â†’ '0.2%'
2025-11-26 17:58:50,344 - app.services.ai_parser - INFO - ðŸ’° Calculated: 82155.66 from SI: 41077832.0 Ã— Rate: 0.2% on Total Sum Insured
2025-11-26 17:58:50,345 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of claim amount with a minimum of SR 10,000
2025-11-26 17:58:50,346 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 17:58:50,347 - app.services.ai_parser - INFO - ðŸ“Š Counts: 28 benefits, 23 exclusions, 6 warranties, 2 extensions
2025-11-26 17:58:55,109 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:58:55,111 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 17:58:55,111 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 17:58:55,112 - app.services.ai_parser - INFO - 
2025-11-26 17:58:55,112 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:55,112 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - GIG.pdf
2025-11-26 17:58:55,112 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:55,113 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Gulf Insurance Group (GIG)
2025-11-26 17:58:55,113 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Saudi Amana Contracting Co. L.L.C
2025-11-26 17:58:55,113 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 69,602.00
2025-11-26 17:58:55,113 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.2%
2025-11-26 17:58:55,113 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 17:58:55,114 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.0/100
2025-11-26 17:58:55,114 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of claim amount with a minimum of SR 10,000
2025-11-26 17:58:55,114 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 17:58:55,115 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 17:58:55,115 - app.services.ai_parser - INFO - 
2025-11-26 17:58:55,115 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 17:58:55,115 - app.services.ai_parser - INFO -    âœ“ Benefits: 28
2025-11-26 17:58:55,115 - app.services.ai_parser - INFO -    âœ“ Exclusions: 23
2025-11-26 17:58:55,116 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 17:58:55,116 - app.services.ai_parser - INFO -    âœ“ Extensions: 2
2025-11-26 17:58:55,116 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 17:58:55,116 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 17:58:55,117 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 59fef6b674a441a1b008a79d2e27d80d.pdf â†’ 69273fdf772ee2aa1a6150fe
2025-11-26 17:58:55,118 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 69273fdf772ee2aa1a6150fe
2025-11-26 17:58:55,121 - app.services.user_documents_service - INFO - âœ… Saved user document: GIG.pdf â†’ 69273fdf772ee2aa1a6150ff (478025 bytes)
2025-11-26 17:58:55,121 - app.api.routes - INFO - âœ… Saved user document: GIG.pdf â†’ 69273fdf772ee2aa1a6150ff
2025-11-26 17:58:55,121 - app.api.routes - INFO - âœ… Successfully processed: GIG.pdf
2025-11-26 17:58:55,122 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-26 17:58:55,122 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:58:55,122 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-26 17:58:55,123 - app.api.routes - INFO - ======================================================================
2025-11-26 17:58:55,123 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-26 17:58:55,123 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 17:58:55,124 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 17:58:55,124 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 17:58:55,124 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 17:58:55,125 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 17:58:55,125 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:58:55,125 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Arabian Shield Cooperative Insurance Company
2025-11-26 17:58:55,126 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:58:55,126 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:58:55,127 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:58:55,127 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:58:55,128 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:58:55,128 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:58:55,130 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:58:55,130 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:58:55,130 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:58:55,130 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:58:55,131 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,831.56",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077831.56,
    "total_sum_insured": "SR 41,077,831.56"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: As per expiring policy",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {},
  "exclusions_complete": {
    "all_exclusions_list": []
  },
  "warranties_actual": {
    "warranties_list": []
  },
  "extensions_and_conditions": {
    "extensions_list": [],
    "conditions_list": []
  },
  "coverage_details": {
    "coverage_benefits_explained": []
  },
  "subjectivities": {
    "binding_requirements": [
      "Risk survey within 30 days",
      "Civil Defense certificate r
2025-11-26 17:58:55,134 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:58:55,134 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:58:55,134 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:58:55,135 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:58:55,135 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:58:55,135 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:58:55,135 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:58:55,136 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:58:55,136 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:58:55,136 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:58:55,137 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:58:55,137 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:58:55,137 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:58:55,138 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:58:55,138 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:58:55,138 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:58:55,138 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:58:55,139 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:58:55,139 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Arabian Shield Cooperative Insurance Company
2025-11-26 17:58:55,139 - app.services.ai_ranker - INFO - 
ðŸ“Š Arabian Shield Cooperative Insurance Company:
2025-11-26 17:58:55,140 - app.services.ai_ranker - INFO -    Warranties: 0
2025-11-26 17:58:55,140 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:58:55,140 - app.services.ai_ranker - INFO -    Exclusions: 0
2025-11-26 17:58:55,140 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:58:55,141 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:58:55,141 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Malath Insurance
2025-11-26 17:58:55,141 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:58:55,141 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:58:55,142 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:58:55,142 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:58:55,142 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:58:55,143 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:58:55,143 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:58:55,143 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:58:55,144 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:58:55,144 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:58:55,145 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,831.25",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077831.25,
    "total_sum_insured": "SR 41,077,831.25"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 100,000",
        "deductible": "5% of the claim amount, min SR 10,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100,000 to SR 500,000",
        "deductible": "10% of claim amount, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500,000",
        "deductible": "10% of the claim amount, min SR 75,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
      "range": "up to SR 100,000",
      "deductible": "5% of the clai
2025-11-26 17:58:55,148 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:58:55,148 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:58:55,148 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:58:55,149 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:58:55,149 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:58:55,149 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:58:55,149 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:58:55,149 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:58:55,150 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:58:55,150 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:58:55,150 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:58:55,150 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:58:55,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:58:55,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:58:55,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:58:55,151 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:58:55,152 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:58:55,152 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:58:55,152 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Malath Insurance
2025-11-26 17:58:55,153 - app.services.ai_ranker - INFO - 
ðŸ“Š Malath Insurance:
2025-11-26 17:58:55,154 - app.services.ai_ranker - INFO -    Warranties: 7
2025-11-26 17:58:55,154 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 17:58:55,154 - app.services.ai_ranker - INFO -    Exclusions: 37
2025-11-26 17:58:55,154 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:58:55,155 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 17:58:55,155 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Gulf Insurance Group (GIG)
2025-11-26 17:58:55,155 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 17:58:55,156 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 17:58:55,156 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:58:55,157 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 17:58:55,157 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 17:58:55,157 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 17:58:55,158 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 17:58:55,159 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 17:58:55,159 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 17:58:55,160 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 17:58:55,160 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GIG",
  "sum_insured_breakdown": {
    "material_damage": "SAR 41,077,832",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077832,
    "total_sum_insured": "SAR 41,077,832"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 500,000",
        "deductible": "5% of claim amount with a minimum of SR 10,000",
        "applies_to": "material_damage"
      },
      {
        "range": "up to SR 1,000,000",
        "deductible": "5% of claim amount with a minimum of SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "up to SR 2,000,000",
        "deductible": "5% of claim amount with a minimum of SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 2,000,000",
        "deductible": "5% of claim amount with a minimum of SR 75,000",
        "applies_to": "material_damage"
      }
2025-11-26 17:58:55,164 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:58:55,165 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 17:58:55,165 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 17:58:55,165 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 17:58:55,166 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 17:58:55,166 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 17:58:55,166 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 17:58:55,166 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 17:58:55,166 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 17:58:55,167 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 17:58:55,167 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 17:58:55,167 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 17:58:55,168 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 17:58:55,168 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 17:58:55,168 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 17:58:55,169 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 17:58:55,169 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 17:58:55,169 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 17:58:55,170 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Gulf Insurance Group (GIG)
2025-11-26 17:58:55,170 - app.services.ai_ranker - INFO - 
ðŸ“Š Gulf Insurance Group (GIG):
2025-11-26 17:58:55,170 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 17:58:55,170 - app.services.ai_ranker - INFO -    Extensions: 2
2025-11-26 17:58:55,171 - app.services.ai_ranker - INFO -    Exclusions: 23
2025-11-26 17:58:55,171 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 17:58:55,171 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Arabian Shield Cooperative Insurance Company
2025-11-26 17:58:55,185 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 17:58:55,185 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:58:55,185 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 0
2025-11-26 17:58:55,186 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:58:55,186 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Malath Insurance
2025-11-26 17:58:55,431 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 7
2025-11-26 17:58:55,432 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 17:58:55,432 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:58:55,432 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:58:55,432 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:58:55,433 - app.services.ai_ranker - INFO -       â€¢ Warranted that all plant and equipment is operated and maintained in accordance ...
2025-11-26 17:58:55,433 - app.services.ai_ranker - INFO -       â€¢ Warranted that All operators of the equipment must be licensed to operate such p...
2025-11-26 17:58:55,433 - app.services.ai_ranker - INFO -       â€¢ Warranted that all equipment is fitted with operational overload alarms.
2025-11-26 17:58:55,433 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Gulf Insurance Group (GIG)
2025-11-26 17:58:55,593 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 6
2025-11-26 17:58:55,594 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 2
2025-11-26 17:58:55,594 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 17:58:55,594 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 17:58:55,595 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 17:58:55,595 - app.services.ai_ranker - INFO -       â€¢ Hot works Warranty
2025-11-26 17:58:55,595 - app.services.ai_ranker - INFO -       â€¢ No smoking Warranty
2025-11-26 17:58:55,595 - app.services.ai_ranker - INFO -       â€¢ Housekeeping Warranty
2025-11-26 17:58:55,596 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 17:58:55,596 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 17:58:55,596 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 17:58:55,597 - app.services.ai_ranker - INFO - ðŸ“Š Arabian Shield Cooperative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=73.00
2025-11-26 17:58:55,597 - app.services.ai_ranker - INFO - ðŸ“Š Malath Insurance: Hakim Score=75.0 (Standard), Weighted Score=58.57
2025-11-26 17:58:55,598 - app.services.ai_ranker - INFO - ðŸ“Š Gulf Insurance Group (GIG): Hakim Score=88.0 (Strong), Weighted Score=87.13
2025-11-26 17:58:55,598 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 17:58:55,598 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 17:59:03,784 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:59:03,785 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 17:59:03,785 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 17:59:03,786 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 17:59:07,300 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 17:59:07,302 - app.services.ai_ranker - INFO - âœ… Generated reasoning for Gulf Insurance Group (GIG): Gulf Insurance Group (GIG) stands out as the best insurance provider with a top score of 87.1 out of...
2025-11-26 17:59:07,303 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 17:59:07,304 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 17:59:07,304 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764179892_50f2fd52023c
2025-11-26 17:59:07,304 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-26 17:59:07,305 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 17:59:07,305 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-26 17:59:07,305 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Arabian Shield Cooperative Insurance Company
2025-11-26 17:59:07,306 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 17:59:07,306 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 17:59:07,306 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 17:59:07,306 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 17:59:07,307 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 17:59:07,307 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 17:59:07,307 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Malath Insurance
2025-11-26 17:59:07,308 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 17:59:07,308 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 17:59:07,308 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 17:59:07,308 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 17:59:07,309 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 17:59:07,309 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 17:59:07,312 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 17:59:07,313 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,134 bytes
2025-11-26 17:59:07,313 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 23,635 bytes
2025-11-26 17:59:07,313 - app.services.mongodb_service_enhanced - INFO -    Data table: 10,239 bytes
2025-11-26 17:59:07,313 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,953 bytes
2025-11-26 17:59:07,314 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 30,277 bytes
2025-11-26 17:59:07,314 - app.services.mongodb_service_enhanced - INFO -    Total document: 149,879 bytes
2025-11-26 17:59:07,314 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 17:59:07,315 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-26 17:59:07,315 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-26 17:59:07,315 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-26 17:59:07,315 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-26 17:59:07,316 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-26 17:59:07,316 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-26 17:59:07,316 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-26 17:59:07,316 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-26 17:59:07,316 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-26 17:59:07,317 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-26 17:59:07,317 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-26 17:59:07,317 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-26 17:59:07,317 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-26 17:59:07,318 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-26 17:59:07,318 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 17:59:07,318 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-26 17:59:07,318 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 17:59:07,319 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:59:07,319 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 17:59:07,323 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764179892_50f2fd52023c
2025-11-26 17:59:07,324 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69273febb757af6a8efab061
2025-11-26 17:59:07,327 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 17:59:07,328 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 17:59:07,329 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 17:59:07,329 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 17:59:07,330 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 17:59:07,330 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 17:59:07,331 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 17:59:07,331 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-26 17:59:07,331 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 17:59:07,331 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-26 17:59:07,332 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 17:59:07,332 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-26 17:59:07,332 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 17:59:07,333 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 17:59:07,333 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 17:59:07,333 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 17:59:07,333 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 17:59:07,334 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 17:59:07,334 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 17:59:07,334 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69273febb757af6a8efab061
2025-11-26 17:59:07,334 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 17:59:07,335 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 17:59:07,335 - app.api.routes - INFO -    Comparison ID: cmp_1764179892_50f2fd52023c
2025-11-26 17:59:07,337 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 17:59:07,337 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 17:59:07,337 - app.api.routes - INFO - 
======================================================================
2025-11-26 17:59:07,337 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 17:59:07,338 - app.api.routes - INFO - ======================================================================
2025-11-26 17:59:07,338 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764179892_50f2fd52023c
2025-11-26 17:59:07,338 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 17:59:07,338 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-26 17:59:07,338 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-26 17:59:07,339 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 17:59:07,339 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 17:59:07,339 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 17:59:07,340 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 17:59:07,341 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 17:59:07,342 - app.api.routes - INFO - ======================================================================

2025-11-26 17:59:07,342 - app.services.progress_tracker - INFO - âœ… Job completed: job_a1abce950e50 â†’ comparison_id: cmp_1764179892_50f2fd52023c
2025-11-26 17:59:07,343 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 54.73s
2025-11-26 18:00:15,662 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764179892_50f2fd52023c/pdf
2025-11-26 18:00:15,663 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764179892_50f2fd52023c
2025-11-26 18:00:15,665 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764179892_50f2fd52023c
2025-11-26 18:00:15,666 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 18:00:15,666 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 18:00:15,667 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 18:00:15,667 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 18:00:15,668 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 18:00:15,668 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 18:00:15,676 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 18:00:15,679 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 18:00:15,686 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 18:00:15,687 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 18:00:15,690 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 18:00:15,690 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 18:00:15,694 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 18:00:15,820 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764179892_50f2fd52023c
2025-11-26 18:00:15,821 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764179892_50f2fd52023c_20251126_180015.pdf (138940 bytes)
2025-11-26 18:00:15,822 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764179892_50f2fd52023c/pdf - 200 - 0.16s
2025-11-26 18:04:19,344 - app.services.progress_tracker - INFO - ðŸ§¹ Cleaned up 1 old progress entries
2025-11-26 18:04:19,344 - app.services.progress_tracker - INFO - ðŸ§¹ Cleanup task: Removed 1 old entries
2025-11-26 18:07:28,758 - main - INFO - 
2025-11-26 18:07:28,760 - main - INFO - ================================================================================
2025-11-26 18:07:28,761 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:07:28,762 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:07:28,763 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:07:28,765 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:07:28,767 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:07:28,769 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:07:28,773 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:07:28,782 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-26 18:07:28,783 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:07:28,784 - main - INFO - ================================================================================
2025-11-26 18:07:28,784 - main - INFO - 
2025-11-26 18:07:33,757 - main - INFO - 
2025-11-26 18:07:33,759 - main - INFO - ================================================================================
2025-11-26 18:07:33,760 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:07:33,761 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:07:33,761 - main - INFO - ================================================================================
2025-11-26 18:07:33,761 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:07:33,761 - main - INFO -   Upload Directory: uploads
2025-11-26 18:07:33,762 - main - INFO -   Max File Size: 20MB
2025-11-26 18:07:33,762 - main - INFO - ================================================================================
2025-11-26 18:07:33,762 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:07:33,763 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:07:33,763 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:07:33,784 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:07:33,790 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:07:33,790 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:07:33,791 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:07:33,791 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:07:33,792 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:07:33,800 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:07:33,801 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:07:33,802 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:07:33,804 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:07:33,805 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:07:33,805 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:07:33,805 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:07:33,806 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:07:33,833 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:07:33,834 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:07:33,835 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:07:33,835 - main - INFO - 
2025-11-26 18:07:33,836 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:07:33,836 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:07:33,837 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:07:33,837 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:07:33,838 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:07:33,839 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:07:33,839 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:07:33,840 - main - INFO - 
2025-11-26 18:07:33,841 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:07:33,842 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:07:33,842 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:07:33,843 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:07:33,844 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:07:33,845 - main - INFO - 
2025-11-26 18:07:33,846 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:07:33,847 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:07:33,848 - main - INFO -        - No manual section generation
2025-11-26 18:07:33,849 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:07:33,849 - main - INFO - 
2025-11-26 18:07:33,850 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:07:33,850 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:07:33,851 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:07:33,851 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:07:33,852 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:07:33,852 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:07:33,853 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:07:33,853 - main - INFO - 
2025-11-26 18:07:33,854 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:07:33,854 - main - INFO -      Main:
2025-11-26 18:07:33,855 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:07:33,855 - main - INFO - 
2025-11-26 18:07:33,856 - main - INFO -      Retrieval:
2025-11-26 18:07:33,856 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:07:33,857 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:07:33,857 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:07:33,858 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:07:33,858 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:07:33,859 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:07:33,860 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:07:33,861 - main - INFO - 
2025-11-26 18:07:33,862 - main - INFO -      Management:
2025-11-26 18:07:33,863 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:07:33,864 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:07:33,864 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:07:33,864 - main - INFO - 
2025-11-26 18:07:33,865 - main - INFO -      Documents (MongoDB):
2025-11-26 18:07:33,865 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:07:33,865 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:07:33,866 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:07:33,866 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:07:33,866 - main - INFO - 
2025-11-26 18:07:33,867 - main - INFO -      Diagnostics & Health:
2025-11-26 18:07:33,867 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:07:33,867 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:07:33,867 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:07:33,868 - main - INFO - 
2025-11-26 18:07:33,868 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:07:33,868 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:07:33,869 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:07:33,869 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:07:33,869 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:07:33,869 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:07:33,870 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:07:33,870 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:07:33,870 - main - INFO - 
2025-11-26 18:07:33,871 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:07:33,871 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:07:33,871 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:07:33,872 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:07:33,872 - main - INFO -      4. No re-upload needed!
2025-11-26 18:07:33,872 - main - INFO - 
2025-11-26 18:07:33,873 - main - INFO - ================================================================================
2025-11-26 18:07:33,873 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:07:33,874 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:07:33,874 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:07:33,875 - main - INFO - ================================================================================
2025-11-26 18:07:33,875 - main - INFO - 
2025-11-26 18:07:33,877 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:09:26,483 - main - INFO - 
2025-11-26 18:09:26,493 - main - INFO - ================================================================================
2025-11-26 18:09:26,493 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:09:26,494 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:09:26,495 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:09:26,496 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:09:26,496 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:09:26,497 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:09:26,497 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:09:26,497 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:09:26,498 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:09:26,498 - main - INFO - ================================================================================
2025-11-26 18:09:26,498 - main - INFO - 
2025-11-26 18:09:29,265 - main - INFO - 
2025-11-26 18:09:29,266 - main - INFO - ================================================================================
2025-11-26 18:09:29,266 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:09:29,266 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:09:29,266 - main - INFO - ================================================================================
2025-11-26 18:09:29,267 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:09:29,267 - main - INFO -   Upload Directory: uploads
2025-11-26 18:09:29,267 - main - INFO -   Max File Size: 20MB
2025-11-26 18:09:29,267 - main - INFO - ================================================================================
2025-11-26 18:09:29,267 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:09:29,268 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:09:29,268 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:09:29,305 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:09:29,315 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:09:29,316 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:09:29,316 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:09:29,316 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:09:29,317 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:09:29,327 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:09:29,329 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:09:29,332 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:09:29,334 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:09:29,334 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:09:29,334 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:09:29,335 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:09:29,335 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:09:29,370 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:09:29,371 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:09:29,371 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:09:29,371 - main - INFO - 
2025-11-26 18:09:29,372 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:09:29,372 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:09:29,373 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:09:29,373 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:09:29,373 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:09:29,374 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:09:29,374 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:09:29,374 - main - INFO - 
2025-11-26 18:09:29,375 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:09:29,375 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:09:29,375 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:09:29,375 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:09:29,376 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:09:29,376 - main - INFO - 
2025-11-26 18:09:29,377 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:09:29,377 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:09:29,377 - main - INFO -        - No manual section generation
2025-11-26 18:09:29,378 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:09:29,378 - main - INFO - 
2025-11-26 18:09:29,378 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:09:29,378 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:09:29,379 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:09:29,379 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:09:29,379 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:09:29,380 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:09:29,380 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:09:29,380 - main - INFO - 
2025-11-26 18:09:29,380 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:09:29,381 - main - INFO -      Main:
2025-11-26 18:09:29,381 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:09:29,381 - main - INFO - 
2025-11-26 18:09:29,381 - main - INFO -      Retrieval:
2025-11-26 18:09:29,382 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:09:29,382 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:09:29,382 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:09:29,382 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:09:29,382 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:09:29,382 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:09:29,383 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:09:29,383 - main - INFO - 
2025-11-26 18:09:29,383 - main - INFO -      Management:
2025-11-26 18:09:29,383 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:09:29,383 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:09:29,383 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:09:29,384 - main - INFO - 
2025-11-26 18:09:29,384 - main - INFO -      Documents (MongoDB):
2025-11-26 18:09:29,384 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:09:29,384 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:09:29,384 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:09:29,384 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:09:29,384 - main - INFO - 
2025-11-26 18:09:29,384 - main - INFO -      Diagnostics & Health:
2025-11-26 18:09:29,385 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:09:29,385 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:09:29,385 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:09:29,385 - main - INFO - 
2025-11-26 18:09:29,385 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:09:29,385 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:09:29,385 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:09:29,386 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:09:29,386 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:09:29,386 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:09:29,386 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:09:29,386 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:09:29,386 - main - INFO - 
2025-11-26 18:09:29,387 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:09:29,387 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:09:29,387 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:09:29,387 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:09:29,387 - main - INFO -      4. No re-upload needed!
2025-11-26 18:09:29,387 - main - INFO - 
2025-11-26 18:09:29,388 - main - INFO - ================================================================================
2025-11-26 18:09:29,388 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:09:29,388 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:09:29,389 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:09:29,389 - main - INFO - ================================================================================
2025-11-26 18:09:29,389 - main - INFO - 
2025-11-26 18:09:29,389 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:11:29,305 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 18:11:29,310 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 18:11:29,310 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 18:11:29,310 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 18:11:29,311 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 18:11:29,312 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 18:11:29,313 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 18:11:29,314 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 18:11:29,314 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 18:11:29,314 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-26 18:11:29,315 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764180689_4b8649dbd979
2025-11-26 18:11:29,315 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_8056fd7519ba (3 files)
2025-11-26 18:11:29,315 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_8056fd7519ba
2025-11-26 18:11:29,316 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:11:29,316 - app.api.routes - INFO - ðŸ“„ Processing: Malath.pdf
2025-11-26 18:11:29,316 - app.api.routes - INFO - ======================================================================
2025-11-26 18:11:29,317 - app.api.routes - INFO - ðŸ’¾ Saved file: Malath.pdf â†’ 7a79e5a589d84277ab0e4c9710773686.pdf (203279 bytes)
2025-11-26 18:11:29,318 - app.api.routes - INFO - ðŸ“– Extracting text from: Malath.pdf
2025-11-26 18:11:29,318 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\7a79e5a589d84277ab0e4c9710773686.pdf
2025-11-26 18:11:29,318 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:11:29,339 - app.api.routes - INFO - ðŸ“„ Processing: GIG.pdf
2025-11-26 18:11:29,357 - app.api.routes - INFO - ======================================================================
2025-11-26 18:11:29,369 - app.services.pdf_extractor - INFO - Successfully extracted 6578 characters from 3 pages
2025-11-26 18:11:29,369 - app.api.routes - INFO - ðŸ’¾ Saved file: GIG.pdf â†’ 2d0ead90b923446ab377af3605d4b926.pdf (478025 bytes)
2025-11-26 18:11:29,370 - app.api.routes - INFO - ðŸ“– Extracting text from: GIG.pdf
2025-11-26 18:11:29,370 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:11:29,370 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\2d0ead90b923446ab377af3605d4b926.pdf
2025-11-26 18:11:29,371 - app.api.routes - INFO - ðŸ“„ Processing: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:11:29,371 - app.api.routes - INFO - ======================================================================
2025-11-26 18:11:29,498 - app.services.pdf_extractor - INFO - Successfully extracted 6549 characters from 3 pages
2025-11-26 18:11:29,498 - app.api.routes - INFO - ðŸ’¾ Saved file: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 5c3db7eef9394d07a8f4c6b6c6512f99.pdf (273210 bytes)
2025-11-26 18:11:29,499 - app.api.routes - INFO - ðŸ“– Extracting text from: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:11:29,499 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\5c3db7eef9394d07a8f4c6b6c6512f99.pdf
2025-11-26 18:11:29,499 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Malath.pdf
2025-11-26 18:11:29,500 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Malath.pdf
2025-11-26 18:11:29,534 - app.services.pdf_extractor - INFO - Successfully extracted 3016 characters from 1 pages
2025-11-26 18:11:29,535 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Malath Insurance (pattern: \bmalath\b)
2025-11-26 18:11:29,537 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Malath Insurance
2025-11-26 18:11:29,539 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/S. Saudi Amana Contracting Co.
2025-11-26 18:11:29,539 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 18:11:29,539 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 18:11:29,580 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 18:11:29,580 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 18:11:29,942 - app.api.routes - INFO - ðŸ¤– Parsing with AI: GIG.pdf
2025-11-26 18:11:29,943 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for GIG.pdf
2025-11-26 18:11:29,944 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Gulf Insurance Group (GIG) (pattern: \bgig\b)
2025-11-26 18:11:29,944 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Gulf Insurance Group (GIG)
2025-11-26 18:11:29,945 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Saudi Amana Contracting Co. L.L.C
2025-11-26 18:11:29,945 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 18:11:29,945 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GIG
2025-11-26 18:11:30,006 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 4 sublimits
2025-11-26 18:11:30,006 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 18:11:30,008 - app.api.routes - INFO - ðŸ¤– Parsing with AI: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:11:30,008 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:11:30,010 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Arabian Shield Cooperative Insurance Company
2025-11-26 18:11:30,012 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Arabian Shield Cooperative Insurance Company
2025-11-26 18:11:30,013 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 18:11:30,013 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 18:11:30,013 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 18:11:30,032 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 18:11:30,032 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 18:11:41,341 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:11:41,363 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 18:11:41,365 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 18:11:41,366 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 18:11:41,368 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-26 18:11:41,371 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: As per expiring policy
2025-11-26 18:11:41,372 - app.services.ai_parser - WARNING - âš ï¸ Only 0 warranties, using fallback...
2025-11-26 18:11:41,373 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 0 warranties from patterns
2025-11-26 18:11:41,379 - app.services.ai_parser - WARNING - âš ï¸ Only 0 exclusions, using fallback...
2025-11-26 18:11:41,382 - app.services.ai_parser - INFO - ðŸš« Fallback extracted 0 exclusions from patterns
2025-11-26 18:11:41,388 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 18:11:41,394 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 0 benefits from patterns
2025-11-26 18:11:41,398 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 18:11:47,145 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:11:47,150 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 18:11:47,150 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 18:11:47,150 - app.services.ai_parser - INFO - ðŸ”„ Rate: '66,340.70 @ 0.1615 percent' â†’ '66â€°'
2025-11-26 18:11:47,151 - app.services.ai_parser - INFO - ðŸ’° Calculated: 2725132100.17 from SI: 41077831.56 Ã— Rate: 66,340.70 @ 0.1615 percent
2025-11-26 18:11:47,151 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: As per expiring policy
2025-11-26 18:11:47,151 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 18:11:47,152 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 0 exclusions, 0 warranties, 0 extensions
2025-11-26 18:11:52,422 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:11:52,427 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 18:11:52,427 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 18:11:52,428 - app.services.ai_parser - INFO - 
2025-11-26 18:11:52,428 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:11:52,428 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:11:52,429 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:11:52,429 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Arabian Shield Cooperative Insurance Company
2025-11-26 18:11:52,429 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 18:11:52,430 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 66,340.70
2025-11-26 18:11:52,430 - app.services.ai_parser - INFO - ðŸ“Š Rate: 66â€°
2025-11-26 18:11:52,430 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 18:11:52,430 - app.services.ai_parser - INFO - ðŸ“ Quality: 80.0/100
2025-11-26 18:11:52,431 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: As per expiring policy
2025-11-26 18:11:52,431 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 18:11:52,431 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 18:11:52,431 - app.services.ai_parser - INFO - 
2025-11-26 18:11:52,431 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 18:11:52,431 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-26 18:11:52,432 - app.services.ai_parser - INFO -    âœ“ Exclusions: 0
2025-11-26 18:11:52,432 - app.services.ai_parser - INFO -    âœ“ Warranties: 0
2025-11-26 18:11:52,432 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 18:11:52,432 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 18:11:52,432 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:11:52,433 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 5c3db7eef9394d07a8f4c6b6c6512f99.pdf â†’ 692742e83bf2574f40909e01
2025-11-26 18:11:52,434 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692742e83bf2574f40909e01
2025-11-26 18:11:52,436 - app.services.user_documents_service - INFO - âœ… Saved user document: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 692742e83bf2574f40909e02 (273210 bytes)
2025-11-26 18:11:52,436 - app.api.routes - INFO - âœ… Saved user document: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 692742e83bf2574f40909e02
2025-11-26 18:11:52,436 - app.api.routes - INFO - âœ… Successfully processed: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:11:54,236 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:11:54,241 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 18:11:54,242 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 18:11:54,242 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 18:11:54,243 - app.services.ai_parser - WARNING - âš ï¸ Only 4 warranties, using fallback...
2025-11-26 18:11:54,245 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 6 warranties from patterns
2025-11-26 18:11:54,245 - app.services.ai_parser - INFO - âœ… Enhanced warranties: 7 total
2025-11-26 18:11:54,245 - app.services.ai_parser - WARNING - âš ï¸ Only 2 benefits, using fallback...
2025-11-26 18:11:54,247 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 10 benefits from patterns
2025-11-26 18:11:54,247 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 10 total
2025-11-26 18:11:54,247 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 18:11:57,674 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:11:57,687 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 18:11:57,688 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 18:11:57,689 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 18:11:57,690 - app.services.ai_parser - WARNING - âš ï¸ Only 4 benefits, using fallback...
2025-11-26 18:11:57,693 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 28 benefits from patterns
2025-11-26 18:11:57,693 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 29 total
2025-11-26 18:11:57,694 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 18:12:00,472 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:12:00,479 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 18:12:00,479 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 18:12:00,479 - app.services.ai_parser - INFO - ðŸ”„ Rate: '0.30% (Per Cent)' â†’ '0.30%'
2025-11-26 18:12:00,480 - app.services.ai_parser - INFO - ðŸ’° Calculated: 123233.49 from SI: 41077831.25 Ã— Rate: 0.30% (Per Cent)
2025-11-26 18:12:00,480 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of the claim amount, min. SR 10,000
2025-11-26 18:12:00,480 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 18:12:00,480 - app.services.ai_parser - INFO - ðŸ“Š Counts: 10 benefits, 37 exclusions, 7 warranties, 0 extensions
2025-11-26 18:12:03,721 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:12:03,730 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 18:12:03,730 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 18:12:03,731 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 69,602 @ 0.2%' â†’ '69%'
2025-11-26 18:12:03,731 - app.services.ai_parser - INFO - ðŸ’° Calculated: 28590992628.64 from SI: 41077832.0 Ã— Rate: SR 69,602 @ 0.2%
2025-11-26 18:12:03,731 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 10,000
2025-11-26 18:12:03,731 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 18:12:03,731 - app.services.ai_parser - INFO - ðŸ“Š Counts: 29 benefits, 24 exclusions, 6 warranties, 2 extensions
2025-11-26 18:12:06,102 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:12:06,103 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 18:12:06,103 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 18:12:06,103 - app.services.ai_parser - INFO - 
2025-11-26 18:12:06,104 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:12:06,104 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Malath.pdf
2025-11-26 18:12:06,104 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:12:06,105 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Malath Insurance
2025-11-26 18:12:06,105 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/S. Saudi Amana Contracting Co.
2025-11-26 18:12:06,105 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 169,122.30
2025-11-26 18:12:06,106 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.30%
2025-11-26 18:12:06,106 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 18:12:06,106 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.0/100
2025-11-26 18:12:06,106 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of the claim amount, min. SR 10,000
2025-11-26 18:12:06,107 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 18:12:06,107 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 18:12:06,107 - app.services.ai_parser - INFO - 
2025-11-26 18:12:06,107 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 18:12:06,108 - app.services.ai_parser - INFO -    âœ“ Benefits: 10
2025-11-26 18:12:06,108 - app.services.ai_parser - INFO -    âœ“ Exclusions: 37
2025-11-26 18:12:06,108 - app.services.ai_parser - INFO -    âœ“ Warranties: 7
2025-11-26 18:12:06,108 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 18:12:06,109 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 18:12:06,109 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:12:06,110 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 7a79e5a589d84277ab0e4c9710773686.pdf â†’ 692742f63bf2574f40909e03
2025-11-26 18:12:06,111 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692742f63bf2574f40909e03
2025-11-26 18:12:06,113 - app.services.user_documents_service - INFO - âœ… Saved user document: Malath.pdf â†’ 692742f63bf2574f40909e04 (203279 bytes)
2025-11-26 18:12:06,113 - app.api.routes - INFO - âœ… Saved user document: Malath.pdf â†’ 692742f63bf2574f40909e04
2025-11-26 18:12:06,113 - app.api.routes - INFO - âœ… Successfully processed: Malath.pdf
2025-11-26 18:12:09,644 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:12:09,651 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 18:12:09,652 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 18:12:09,652 - app.services.ai_parser - INFO - 
2025-11-26 18:12:09,652 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:12:09,653 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - GIG.pdf
2025-11-26 18:12:09,653 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:12:09,653 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Gulf Insurance Group (GIG)
2025-11-26 18:12:09,653 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Saudi Amana Contracting Co. L.L.C
2025-11-26 18:12:09,654 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 69,602.00
2025-11-26 18:12:09,654 - app.services.ai_parser - INFO - ðŸ“Š Rate: 69%
2025-11-26 18:12:09,654 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 18:12:09,654 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.7/100
2025-11-26 18:12:09,654 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 10,000
2025-11-26 18:12:09,655 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 18:12:09,655 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 18:12:09,655 - app.services.ai_parser - INFO - 
2025-11-26 18:12:09,655 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 18:12:09,655 - app.services.ai_parser - INFO -    âœ“ Benefits: 29
2025-11-26 18:12:09,656 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-26 18:12:09,656 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 18:12:09,656 - app.services.ai_parser - INFO -    âœ“ Extensions: 2
2025-11-26 18:12:09,656 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 18:12:09,656 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:12:09,658 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 2d0ead90b923446ab377af3605d4b926.pdf â†’ 692742f93bf2574f40909e05
2025-11-26 18:12:09,659 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 692742f93bf2574f40909e05
2025-11-26 18:12:09,662 - app.services.user_documents_service - INFO - âœ… Saved user document: GIG.pdf â†’ 692742f93bf2574f40909e06 (478025 bytes)
2025-11-26 18:12:09,662 - app.api.routes - INFO - âœ… Saved user document: GIG.pdf â†’ 692742f93bf2574f40909e06
2025-11-26 18:12:09,663 - app.api.routes - INFO - âœ… Successfully processed: GIG.pdf
2025-11-26 18:12:09,663 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-26 18:12:09,663 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:12:09,663 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-26 18:12:09,664 - app.api.routes - INFO - ======================================================================
2025-11-26 18:12:09,664 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-26 18:12:09,664 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 18:12:09,664 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 18:12:09,665 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 18:12:09,665 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 18:12:09,665 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 18:12:09,665 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 18:12:09,665 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Arabian Shield Cooperative Insurance Company
2025-11-26 18:12:09,666 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 18:12:09,666 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 18:12:09,666 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:12:09,666 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 18:12:09,667 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 18:12:09,667 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 18:12:09,667 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 18:12:09,667 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 18:12:09,667 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 18:12:09,668 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 18:12:09,668 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,831.56",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077831.56,
    "total_sum_insured": "SR 41,077,831.56"
  },
  "deductibles_complete": {
    "structure_type": "as per expiring policy",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: As per expiring policy",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {},
  "exclusions_complete": {
    "all_exclusions_list": []
  },
  "warranties_actual": {
    "warranties_list": []
  },
  "extensions_and_conditions": {
    "extensions_list": [],
    "conditions_list": []
  },
  "coverage_details": {
    "coverage_benefits_explained": []
  },
  "subjectivities": {
    "binding_requirements": [
      "Risk survey within 30 days",
      "Civil Defense certificate 
2025-11-26 18:12:09,671 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:12:09,671 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 18:12:09,671 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 18:12:09,671 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 18:12:09,672 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 18:12:09,672 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 18:12:09,672 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 18:12:09,672 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 18:12:09,672 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 18:12:09,673 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 18:12:09,673 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 18:12:09,673 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 18:12:09,674 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 18:12:09,674 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 18:12:09,674 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 18:12:09,674 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 18:12:09,675 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 18:12:09,675 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:12:09,675 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Arabian Shield Cooperative Insurance Company
2025-11-26 18:12:09,676 - app.services.ai_ranker - INFO - 
ðŸ“Š Arabian Shield Cooperative Insurance Company:
2025-11-26 18:12:09,676 - app.services.ai_ranker - INFO -    Warranties: 0
2025-11-26 18:12:09,676 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 18:12:09,676 - app.services.ai_ranker - INFO -    Exclusions: 0
2025-11-26 18:12:09,677 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 18:12:09,677 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 18:12:09,677 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Malath Insurance
2025-11-26 18:12:09,677 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 18:12:09,677 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 18:12:09,678 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:12:09,678 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 18:12:09,678 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 18:12:09,678 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 18:12:09,679 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 18:12:09,679 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 18:12:09,679 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 18:12:09,679 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 18:12:09,680 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,831.25",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077831.25,
    "total_sum_insured": "SR 41,077,831.25"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 100,000",
        "deductible": "5% of the claim amount, min. SR 10,000"
      },
      {
        "range": "SR 100,000 to SR 500,000",
        "deductible": "10% of claim amount, min. SR 25,000"
      },
      {
        "range": "above SR 500,000",
        "deductible": "10% of the claim amount, min. SR 75,000"
      }
    ],
    "applicable_md_tier": {
      "range": "up to SR 100,000",
      "deductible": "5% of the claim amount, min. SR 10,000"
    },
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {
    "Claim preparation clause": "SR 50,000",
    "Cover for loss and
2025-11-26 18:12:09,682 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:12:09,682 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 18:12:09,683 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 18:12:09,683 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 18:12:09,684 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 18:12:09,684 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 18:12:09,684 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 18:12:09,685 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 18:12:09,685 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 18:12:09,686 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 18:12:09,688 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 18:12:09,689 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 18:12:09,689 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 18:12:09,690 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 18:12:09,690 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 18:12:09,690 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 18:12:09,690 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 18:12:09,691 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:12:09,691 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Malath Insurance
2025-11-26 18:12:09,691 - app.services.ai_ranker - INFO - 
ðŸ“Š Malath Insurance:
2025-11-26 18:12:09,692 - app.services.ai_ranker - INFO -    Warranties: 7
2025-11-26 18:12:09,692 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 18:12:09,692 - app.services.ai_ranker - INFO -    Exclusions: 37
2025-11-26 18:12:09,692 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 18:12:09,692 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 18:12:09,693 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Gulf Insurance Group (GIG)
2025-11-26 18:12:09,693 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 18:12:09,693 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 18:12:09,693 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:12:09,694 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 18:12:09,694 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 18:12:09,694 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 18:12:09,695 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 18:12:09,695 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 18:12:09,695 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 18:12:09,695 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 18:12:09,696 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GIG",
  "sum_insured_breakdown": {
    "material_damage": "SAR 41,077,832",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077832,
    "total_sum_insured": "SR 41,077,832"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 500,000",
        "deductible": "5%, min SR 10,000",
        "applies_to": "material_damage"
      },
      {
        "range": "up to SR 1,000,000",
        "deductible": "5%, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "up to SR 2,000,000",
        "deductible": "5%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 2,000,000",
        "deductible": "5%, min SR 75,000",
        "applies_to": "material_damage"
      }
    ],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "applicable_md_tier": {
     
2025-11-26 18:12:09,699 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:12:09,699 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 18:12:09,700 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 18:12:09,700 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 18:12:09,700 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 18:12:09,701 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 18:12:09,701 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 18:12:09,701 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 18:12:09,701 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 18:12:09,702 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 18:12:09,702 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 18:12:09,703 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 18:12:09,703 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 18:12:09,704 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 18:12:09,705 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 18:12:09,706 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 18:12:09,707 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 18:12:09,707 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:12:09,708 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Gulf Insurance Group (GIG)
2025-11-26 18:12:09,708 - app.services.ai_ranker - INFO - 
ðŸ“Š Gulf Insurance Group (GIG):
2025-11-26 18:12:09,709 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 18:12:09,709 - app.services.ai_ranker - INFO -    Extensions: 2
2025-11-26 18:12:09,709 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-26 18:12:09,710 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 18:12:09,710 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Arabian Shield Cooperative Insurance Company
2025-11-26 18:12:09,719 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 18:12:09,719 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 18:12:09,720 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 0
2025-11-26 18:12:09,721 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 18:12:09,723 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Malath Insurance
2025-11-26 18:12:09,935 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 7
2025-11-26 18:12:09,936 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 18:12:09,936 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 18:12:09,936 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 18:12:09,937 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 18:12:09,937 - app.services.ai_ranker - INFO -       â€¢ Warranted that all plant and equipment is operated and maintained in accordance ...
2025-11-26 18:12:09,937 - app.services.ai_ranker - INFO -       â€¢ Warranted that All operators of the equipment must be licensed to operate such p...
2025-11-26 18:12:09,938 - app.services.ai_ranker - INFO -       â€¢ Warranted that all equipment is fitted with operational overload alarms.
2025-11-26 18:12:09,938 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Gulf Insurance Group (GIG)
2025-11-26 18:12:10,149 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 6
2025-11-26 18:12:10,149 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 2
2025-11-26 18:12:10,149 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 18:12:10,150 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 18:12:10,150 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 18:12:10,150 - app.services.ai_ranker - INFO -       â€¢ Hot works Warranty
2025-11-26 18:12:10,150 - app.services.ai_ranker - INFO -       â€¢ No smoking Warranty
2025-11-26 18:12:10,151 - app.services.ai_ranker - INFO -       â€¢ Housekeeping Warranty
2025-11-26 18:12:10,151 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 18:12:10,151 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 18:12:10,152 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 18:12:10,152 - app.services.ai_ranker - INFO - ðŸ“Š Arabian Shield Cooperative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=73.00
2025-11-26 18:12:10,152 - app.services.ai_ranker - INFO - ðŸ“Š Malath Insurance: Hakim Score=75.0 (Standard), Weighted Score=63.45
2025-11-26 18:12:10,153 - app.services.ai_ranker - INFO - ðŸ“Š Gulf Insurance Group (GIG): Hakim Score=88.0 (Strong), Weighted Score=81.99
2025-11-26 18:12:10,153 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 18:12:10,153 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 18:12:19,932 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:12:19,939 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 18:12:19,939 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 18:12:19,939 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 18:12:23,606 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:12:23,614 - app.services.ai_ranker - INFO - âœ… Generated reasoning for Gulf Insurance Group (GIG): Gulf Insurance Group (GIG) stands out as the best insurance provider due to its top rank of #1 with ...
2025-11-26 18:12:23,614 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 18:12:23,615 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 18:12:23,615 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:23,615 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-26 18:12:23,615 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 18:12:23,616 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-26 18:12:23,616 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Arabian Shield Cooperative Insurance Company
2025-11-26 18:12:23,616 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 18:12:23,616 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 18:12:23,617 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 18:12:23,617 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 18:12:23,617 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 18:12:23,617 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Malath Insurance
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 18:12:23,618 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 18:12:23,620 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 18:12:23,621 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,331 bytes
2025-11-26 18:12:23,621 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 24,419 bytes
2025-11-26 18:12:23,621 - app.services.mongodb_service_enhanced - INFO -    Data table: 10,535 bytes
2025-11-26 18:12:23,621 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,953 bytes
2025-11-26 18:12:23,621 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 30,373 bytes
2025-11-26 18:12:23,622 - app.services.mongodb_service_enhanced - INFO -    Total document: 152,835 bytes
2025-11-26 18:12:23,622 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 18:12:23,622 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-26 18:12:23,622 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-26 18:12:23,622 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-26 18:12:23,622 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-26 18:12:23,623 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-26 18:12:23,623 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-26 18:12:23,623 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-26 18:12:23,623 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-26 18:12:23,623 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-26 18:12:23,624 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-26 18:12:23,624 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-26 18:12:23,624 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-26 18:12:23,624 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-26 18:12:23,624 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-26 18:12:23,624 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 18:12:23,625 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-26 18:12:23,625 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 18:12:23,625 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:12:23,625 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 18:12:23,628 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:23,628 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 69274307b757af6a8efab062
2025-11-26 18:12:23,630 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 18:12:23,630 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 18:12:23,631 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 18:12:23,631 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 18:12:23,631 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 18:12:23,632 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 18:12:23,632 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 18:12:23,632 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-26 18:12:23,632 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 18:12:23,633 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-26 18:12:23,633 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 18:12:23,633 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-26 18:12:23,634 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 18:12:23,634 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 18:12:23,635 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 18:12:23,635 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 18:12:23,636 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 18:12:23,636 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 18:12:23,637 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:12:23,638 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 69274307b757af6a8efab062
2025-11-26 18:12:23,638 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 18:12:23,638 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 18:12:23,639 - app.api.routes - INFO -    Comparison ID: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:23,640 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 18:12:23,640 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 18:12:23,641 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:12:23,641 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 18:12:23,641 - app.api.routes - INFO - ======================================================================
2025-11-26 18:12:23,641 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:23,642 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 18:12:23,642 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-26 18:12:23,642 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-26 18:12:23,642 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 18:12:23,642 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 18:12:23,643 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 18:12:23,643 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 18:12:23,644 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 18:12:23,645 - app.api.routes - INFO - ======================================================================

2025-11-26 18:12:23,645 - app.services.progress_tracker - INFO - âœ… Job completed: job_8056fd7519ba â†’ comparison_id: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:23,646 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 54.34s
2025-11-26 18:12:45,362 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764180689_4b8649dbd979/pdf
2025-11-26 18:12:45,365 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:45,370 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:45,371 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 18:12:45,373 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 18:12:45,374 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 18:12:45,375 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 18:12:45,377 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 18:12:45,377 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 18:12:45,386 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 18:12:45,387 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 18:12:45,389 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 18:12:45,389 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 18:12:45,390 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 18:12:45,390 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 18:12:45,392 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 18:12:45,549 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764180689_4b8649dbd979
2025-11-26 18:12:45,550 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764180689_4b8649dbd979_20251126_181245.pdf (139702 bytes)
2025-11-26 18:12:45,550 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764180689_4b8649dbd979/pdf - 200 - 0.19s
2025-11-26 18:19:14,269 - main - INFO - 
2025-11-26 18:19:14,269 - main - INFO - ================================================================================
2025-11-26 18:19:14,270 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:19:14,275 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:19:14,277 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:19:14,281 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:19:14,282 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:19:14,283 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:19:14,283 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:19:14,285 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-26 18:19:14,288 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:19:14,288 - main - INFO - ================================================================================
2025-11-26 18:19:14,289 - main - INFO - 
2025-11-26 18:19:19,133 - main - INFO - 
2025-11-26 18:19:19,133 - main - INFO - ================================================================================
2025-11-26 18:19:19,133 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:19:19,133 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:19:19,133 - main - INFO - ================================================================================
2025-11-26 18:19:19,134 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:19:19,134 - main - INFO -   Upload Directory: uploads
2025-11-26 18:19:19,134 - main - INFO -   Max File Size: 20MB
2025-11-26 18:19:19,134 - main - INFO - ================================================================================
2025-11-26 18:19:19,134 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:19:19,135 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:19:19,135 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:19:19,164 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:19:19,169 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:19:19,169 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:19:19,169 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:19:19,169 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:19:19,170 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:19:19,182 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:19:19,183 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:19:19,184 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:19:19,185 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:19:19,186 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:19:19,186 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:19:19,186 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:19:19,186 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:19:19,198 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:19:19,199 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:19:19,199 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:19:19,199 - main - INFO - 
2025-11-26 18:19:19,199 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:19:19,200 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:19:19,200 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:19:19,200 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:19:19,200 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:19:19,200 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:19:19,200 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:19:19,201 - main - INFO - 
2025-11-26 18:19:19,201 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:19:19,201 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:19:19,201 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:19:19,201 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:19:19,201 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:19:19,202 - main - INFO - 
2025-11-26 18:19:19,202 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:19:19,202 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:19:19,202 - main - INFO -        - No manual section generation
2025-11-26 18:19:19,202 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:19:19,203 - main - INFO - 
2025-11-26 18:19:19,203 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:19:19,203 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:19:19,203 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:19:19,204 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:19:19,204 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:19:19,205 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:19:19,206 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:19:19,207 - main - INFO - 
2025-11-26 18:19:19,207 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:19:19,208 - main - INFO -      Main:
2025-11-26 18:19:19,208 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:19:19,209 - main - INFO - 
2025-11-26 18:19:19,209 - main - INFO -      Retrieval:
2025-11-26 18:19:19,209 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:19:19,209 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:19:19,210 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:19:19,210 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:19:19,210 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:19:19,211 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:19:19,211 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:19:19,212 - main - INFO - 
2025-11-26 18:19:19,212 - main - INFO -      Management:
2025-11-26 18:19:19,212 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:19:19,212 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:19:19,213 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:19:19,213 - main - INFO - 
2025-11-26 18:19:19,213 - main - INFO -      Documents (MongoDB):
2025-11-26 18:19:19,213 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:19:19,213 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:19:19,213 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:19:19,214 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:19:19,214 - main - INFO - 
2025-11-26 18:19:19,214 - main - INFO -      Diagnostics & Health:
2025-11-26 18:19:19,214 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:19:19,215 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:19:19,215 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:19:19,215 - main - INFO - 
2025-11-26 18:19:19,215 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:19:19,215 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:19:19,215 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:19:19,216 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:19:19,216 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:19:19,216 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:19:19,216 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:19:19,216 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:19:19,216 - main - INFO - 
2025-11-26 18:19:19,217 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:19:19,217 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:19:19,217 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:19:19,217 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:19:19,217 - main - INFO -      4. No re-upload needed!
2025-11-26 18:19:19,218 - main - INFO - 
2025-11-26 18:19:19,218 - main - INFO - ================================================================================
2025-11-26 18:19:19,218 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:19:19,218 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:19:19,218 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:19:19,218 - main - INFO - ================================================================================
2025-11-26 18:19:19,219 - main - INFO - 
2025-11-26 18:19:19,219 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:20:41,025 - main - INFO - 
2025-11-26 18:20:41,026 - main - INFO - ================================================================================
2025-11-26 18:20:41,026 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:20:41,027 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:20:41,028 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:20:41,029 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:20:41,030 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:20:41,030 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:20:41,031 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:20:41,032 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:20:41,032 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:20:41,032 - main - INFO - ================================================================================
2025-11-26 18:20:41,032 - main - INFO - 
2025-11-26 18:20:44,233 - main - INFO - 
2025-11-26 18:20:44,233 - main - INFO - ================================================================================
2025-11-26 18:20:44,234 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:20:44,234 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:20:44,234 - main - INFO - ================================================================================
2025-11-26 18:20:44,234 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:20:44,234 - main - INFO -   Upload Directory: uploads
2025-11-26 18:20:44,234 - main - INFO -   Max File Size: 20MB
2025-11-26 18:20:44,235 - main - INFO - ================================================================================
2025-11-26 18:20:44,235 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:20:44,235 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:20:44,235 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:20:44,250 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:20:44,255 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:20:44,255 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:20:44,255 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:20:44,256 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:20:44,256 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:20:44,268 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:20:44,271 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:20:44,280 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:20:44,284 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:20:44,287 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:20:44,288 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:20:44,289 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:20:44,304 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:20:44,389 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:20:44,414 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:20:44,417 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:20:44,425 - main - INFO - 
2025-11-26 18:20:44,425 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:20:44,426 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:20:44,426 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:20:44,426 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:20:44,426 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:20:44,427 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:20:44,427 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:20:44,427 - main - INFO - 
2025-11-26 18:20:44,427 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:20:44,428 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:20:44,428 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:20:44,429 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:20:44,429 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:20:44,430 - main - INFO - 
2025-11-26 18:20:44,430 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:20:44,430 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:20:44,431 - main - INFO -        - No manual section generation
2025-11-26 18:20:44,431 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:20:44,431 - main - INFO - 
2025-11-26 18:20:44,432 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:20:44,432 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:20:44,433 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:20:44,433 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:20:44,434 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:20:44,434 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:20:44,434 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:20:44,435 - main - INFO - 
2025-11-26 18:20:44,435 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:20:44,435 - main - INFO -      Main:
2025-11-26 18:20:44,436 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:20:44,436 - main - INFO - 
2025-11-26 18:20:44,436 - main - INFO -      Retrieval:
2025-11-26 18:20:44,437 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:20:44,437 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:20:44,438 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:20:44,439 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:20:44,439 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:20:44,440 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:20:44,440 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:20:44,441 - main - INFO - 
2025-11-26 18:20:44,441 - main - INFO -      Management:
2025-11-26 18:20:44,442 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:20:44,446 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:20:44,449 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:20:44,450 - main - INFO - 
2025-11-26 18:20:44,450 - main - INFO -      Documents (MongoDB):
2025-11-26 18:20:44,450 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:20:44,451 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:20:44,451 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:20:44,451 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:20:44,452 - main - INFO - 
2025-11-26 18:20:44,452 - main - INFO -      Diagnostics & Health:
2025-11-26 18:20:44,453 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:20:44,453 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:20:44,453 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:20:44,454 - main - INFO - 
2025-11-26 18:20:44,454 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:20:44,454 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:20:44,454 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:20:44,454 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:20:44,455 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:20:44,455 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:20:44,455 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:20:44,455 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:20:44,456 - main - INFO - 
2025-11-26 18:20:44,456 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:20:44,456 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:20:44,456 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:20:44,457 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:20:44,457 - main - INFO -      4. No re-upload needed!
2025-11-26 18:20:44,457 - main - INFO - 
2025-11-26 18:20:44,457 - main - INFO - ================================================================================
2025-11-26 18:20:44,457 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:20:44,458 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:20:44,458 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:20:44,458 - main - INFO - ================================================================================
2025-11-26 18:20:44,458 - main - INFO - 
2025-11-26 18:20:44,459 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:20:52,330 - main - INFO - ðŸ“¥ POST /api/compare-quotes
2025-11-26 18:20:52,345 - app.api.routes - INFO - ðŸ” Checking user subscription for user: 691f66b40c6cd02283165a7c
2025-11-26 18:20:52,352 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 18:20:52,352 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 18:20:52,352 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 18:20:52,359 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 18:20:52,375 - app.api.routes - INFO - âœ… User 691f66b40c6cd02283165a7c can perform comparison
2025-11-26 18:20:52,391 - app.api.routes - INFO -    - Remaining comparisons: -1
2025-11-26 18:20:52,396 - app.api.routes - INFO -    - Quotes per case: 8
2025-11-26 18:20:52,397 - app.api.routes - INFO -    - Files uploaded: 3
2025-11-26 18:20:52,401 - app.api.routes - INFO - ðŸ†” Generated comparison ID: cmp_1764181252_b7fdb478ed00
2025-11-26 18:20:52,402 - app.services.progress_tracker - INFO - ðŸ“Š Progress initialized for job: job_1a6730ba88b7 (3 files)
2025-11-26 18:20:52,403 - app.api.routes - INFO - ðŸ“Š Initialized progress tracking: job_1a6730ba88b7
2025-11-26 18:20:52,404 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:20:52,406 - app.api.routes - INFO - ðŸ“„ Processing: Malath.pdf
2025-11-26 18:20:52,406 - app.api.routes - INFO - ======================================================================
2025-11-26 18:20:52,408 - app.api.routes - INFO - ðŸ’¾ Saved file: Malath.pdf â†’ fd91a30ca71848fbaf070d0ac5561f72.pdf (203279 bytes)
2025-11-26 18:20:52,409 - app.api.routes - INFO - ðŸ“– Extracting text from: Malath.pdf
2025-11-26 18:20:52,411 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\fd91a30ca71848fbaf070d0ac5561f72.pdf
2025-11-26 18:20:52,411 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:20:52,474 - app.api.routes - INFO - ðŸ“„ Processing: GIG.pdf
2025-11-26 18:20:52,474 - app.api.routes - INFO - ======================================================================
2025-11-26 18:20:52,485 - app.services.pdf_extractor - INFO - Successfully extracted 6578 characters from 3 pages
2025-11-26 18:20:52,485 - app.api.routes - INFO - ðŸ’¾ Saved file: GIG.pdf â†’ 61fc0433b66d40eda3e4b505685c7e9c.pdf (478025 bytes)
2025-11-26 18:20:52,486 - app.api.routes - INFO - ðŸ“– Extracting text from: GIG.pdf
2025-11-26 18:20:52,486 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:20:52,486 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\61fc0433b66d40eda3e4b505685c7e9c.pdf
2025-11-26 18:20:52,486 - app.api.routes - INFO - ðŸ“„ Processing: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:20:52,487 - app.api.routes - INFO - ======================================================================
2025-11-26 18:20:52,626 - app.services.pdf_extractor - INFO - Successfully extracted 6549 characters from 3 pages
2025-11-26 18:20:52,628 - app.api.routes - INFO - ðŸ’¾ Saved file: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 9360b93529d74fdf83ff256fbae64a62.pdf (273210 bytes)
2025-11-26 18:20:52,630 - app.api.routes - INFO - ðŸ“– Extracting text from: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:20:52,632 - app.services.pdf_extractor - INFO - Extracting text from PDF: uploads\9360b93529d74fdf83ff256fbae64a62.pdf
2025-11-26 18:20:52,633 - app.api.routes - INFO - ðŸ¤– Parsing with AI: Malath.pdf
2025-11-26 18:20:52,676 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for Malath.pdf
2025-11-26 18:20:52,676 - app.services.pdf_extractor - INFO - Successfully extracted 3016 characters from 1 pages
2025-11-26 18:20:52,678 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Malath Insurance (pattern: \bmalath\b)
2025-11-26 18:20:52,680 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Malath Insurance
2025-11-26 18:20:52,681 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): M/S. Saudi Amana Contracting Co.
2025-11-26 18:20:52,682 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 18:20:52,683 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 18:20:52,723 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 2 sublimits
2025-11-26 18:20:52,724 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 18:20:53,075 - app.api.routes - INFO - ðŸ¤– Parsing with AI: GIG.pdf
2025-11-26 18:20:53,076 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for GIG.pdf
2025-11-26 18:20:53,076 - app.services.ai_parser - INFO - âœ… Detected insurer from filename: Gulf Insurance Group (GIG) (pattern: \bgig\b)
2025-11-26 18:20:53,077 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Gulf Insurance Group (GIG)
2025-11-26 18:20:53,077 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Saudi Amana Contracting Co. L.L.C
2025-11-26 18:20:53,077 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 18:20:53,078 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GIG
2025-11-26 18:20:53,123 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 4 sublimits
2025-11-26 18:20:53,123 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 18:20:53,124 - app.api.routes - INFO - ðŸ¤– Parsing with AI: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:20:53,125 - app.services.ai_parser - INFO - ðŸ” Stage 1: Entity identification for 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:20:53,126 - app.services.ai_parser - INFO - âœ… Detected insurer from text: Arabian Shield Cooperative Insurance Company
2025-11-26 18:20:53,128 - app.services.ai_parser - INFO - ðŸ¢ Insurer (Insurance Company): Arabian Shield Cooperative Insurance Company
2025-11-26 18:20:53,128 - app.services.ai_parser - INFO - ðŸ‘¤ Insured (Customer): Unknown Insured
2025-11-26 18:20:53,128 - app.services.ai_parser - INFO - ðŸ” Stage 2: Document format detection
2025-11-26 18:20:53,129 - app.services.ai_parser - INFO - ðŸ“‹ Detected format: GENERIC
2025-11-26 18:20:53,143 - app.services.ai_parser - INFO - ðŸŽ¯ Pre-extracted 0 sublimits
2025-11-26 18:20:53,143 - app.services.ai_parser - INFO - ðŸ” Stage 3: Comprehensive extraction
2025-11-26 18:21:05,037 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:05,046 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 18:21:05,047 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 18:21:05,047 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 18:21:05,048 - app.services.ai_parser - WARNING - âš ï¸ Deductible missing/invalid, using fallback...
2025-11-26 18:21:05,049 - app.services.ai_parser - INFO - âœ… Extracted deductible: MD: As per expiring policy
2025-11-26 18:21:05,049 - app.services.ai_parser - WARNING - âš ï¸ Only 0 warranties, using fallback...
2025-11-26 18:21:05,051 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 0 warranties from patterns
2025-11-26 18:21:05,051 - app.services.ai_parser - WARNING - âš ï¸ Only 0 exclusions, using fallback...
2025-11-26 18:21:05,053 - app.services.ai_parser - INFO - ðŸš« Fallback extracted 0 exclusions from patterns
2025-11-26 18:21:05,053 - app.services.ai_parser - WARNING - âš ï¸ Only 0 benefits, using fallback...
2025-11-26 18:21:05,059 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 0 benefits from patterns
2025-11-26 18:21:05,059 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 18:21:10,605 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:10,609 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 18:21:10,609 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 18:21:10,609 - app.services.ai_parser - INFO - ðŸ”„ Rate: '66,340.70 @ 0.1615 percent' â†’ '0.1615%'
2025-11-26 18:21:10,610 - app.services.ai_parser - INFO - ðŸ’° Calculated: 2725132100.17 from SI: 41077831.56 Ã— Rate: 66,340.70 @ 0.1615 percent
2025-11-26 18:21:10,610 - app.services.ai_parser - INFO - âœ… Applicable deductibles (fallback): MD: As per expiring policy
2025-11-26 18:21:10,610 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 18:21:10,611 - app.services.ai_parser - INFO - ðŸ“Š Counts: 0 benefits, 0 exclusions, 0 warranties, 0 extensions
2025-11-26 18:21:17,079 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:17,090 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 85.0
2025-11-26 18:21:17,091 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 18:21:17,092 - app.services.ai_parser - INFO - 
2025-11-26 18:21:17,092 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:17,093 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:21:17,093 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:17,094 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Arabian Shield Cooperative Insurance Company
2025-11-26 18:21:17,094 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Unknown Insured
2025-11-26 18:21:17,094 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 66,340.70
2025-11-26 18:21:17,095 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.1615%
2025-11-26 18:21:17,095 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 85.0/100
2025-11-26 18:21:17,096 - app.services.ai_parser - INFO - ðŸ“ Quality: 80.0/100
2025-11-26 18:21:17,096 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: As per expiring policy
2025-11-26 18:21:17,097 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 18:21:17,097 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 18:21:17,097 - app.services.ai_parser - INFO - 
2025-11-26 18:21:17,098 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 18:21:17,098 - app.services.ai_parser - INFO -    âœ“ Benefits: 0
2025-11-26 18:21:17,098 - app.services.ai_parser - INFO -    âœ“ Exclusions: 0
2025-11-26 18:21:17,099 - app.services.ai_parser - INFO -    âœ“ Warranties: 0
2025-11-26 18:21:17,099 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 18:21:17,099 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 18:21:17,100 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:17,101 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 9360b93529d74fdf83ff256fbae64a62.pdf â†’ 6927451d66b3b08604cbb803
2025-11-26 18:21:17,101 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6927451d66b3b08604cbb803
2025-11-26 18:21:17,103 - app.services.user_documents_service - INFO - âœ… Saved user document: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 6927451d66b3b08604cbb804 (273210 bytes)
2025-11-26 18:21:17,104 - app.api.routes - INFO - âœ… Saved user document: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf â†’ 6927451d66b3b08604cbb804
2025-11-26 18:21:17,104 - app.api.routes - INFO - âœ… Successfully processed: 00002P - V2 - Saudi Amana Contracting Co. - PE - Renewal Notice.pdf
2025-11-26 18:21:17,477 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:17,479 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 18:21:17,479 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 18:21:17,479 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 18:21:17,480 - app.services.ai_parser - WARNING - âš ï¸ Only 4 benefits, using fallback...
2025-11-26 18:21:17,482 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 28 benefits from patterns
2025-11-26 18:21:17,482 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 29 total
2025-11-26 18:21:17,483 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 18:21:23,021 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:23,025 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 18:21:23,025 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 18:21:23,026 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 69,602 @ 0.2%' â†’ '0.2%'
2025-11-26 18:21:23,026 - app.services.ai_parser - INFO - ðŸ’° Calculated: 28590992628.64 from SI: 41077832.0 Ã— Rate: SR 69,602 @ 0.2%
2025-11-26 18:21:23,026 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5%, min SR 10,000
2025-11-26 18:21:23,026 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 18:21:23,027 - app.services.ai_parser - INFO - ðŸ“Š Counts: 29 benefits, 24 exclusions, 6 warranties, 2 extensions
2025-11-26 18:21:27,684 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:27,686 - app.services.ai_parser - INFO - âœ… Stage 3: JSON parsed successfully
2025-11-26 18:21:27,687 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validation and Fallback
2025-11-26 18:21:27,687 - app.services.ai_parser - INFO - ðŸ” Stage 3.5: Validating and enhancing extraction...
2025-11-26 18:21:27,687 - app.services.ai_parser - WARNING - âš ï¸ Only 4 warranties, using fallback...
2025-11-26 18:21:27,689 - app.services.ai_parser - INFO - âš ï¸ Fallback extracted 6 warranties from patterns
2025-11-26 18:21:27,690 - app.services.ai_parser - INFO - âœ… Enhanced warranties: 7 total
2025-11-26 18:21:27,690 - app.services.ai_parser - WARNING - âš ï¸ Only 3 benefits, using fallback...
2025-11-26 18:21:27,691 - app.services.ai_parser - INFO - ðŸ“‹ Fallback extracted 10 benefits from patterns
2025-11-26 18:21:27,691 - app.services.ai_parser - INFO - âœ… Enhanced benefits: 12 total
2025-11-26 18:21:27,692 - app.services.ai_parser - INFO - ðŸ” Stage 4: Extracting subjectivities and binding requirements
2025-11-26 18:21:28,296 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:28,301 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 80.0
2025-11-26 18:21:28,302 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 18:21:28,303 - app.services.ai_parser - INFO - 
2025-11-26 18:21:28,303 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:28,305 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - GIG.pdf
2025-11-26 18:21:28,306 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:28,306 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Gulf Insurance Group (GIG)
2025-11-26 18:21:28,307 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: Saudi Amana Contracting Co. L.L.C
2025-11-26 18:21:28,308 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 69,602.00
2025-11-26 18:21:28,309 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.2%
2025-11-26 18:21:28,309 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 80.0/100
2025-11-26 18:21:28,309 - app.services.ai_parser - INFO - ðŸ“ Quality: 99.7/100
2025-11-26 18:21:28,310 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5%, min SR 10,000
2025-11-26 18:21:28,310 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 18:21:28,310 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 18:21:28,311 - app.services.ai_parser - INFO - 
2025-11-26 18:21:28,311 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 18:21:28,311 - app.services.ai_parser - INFO -    âœ“ Benefits: 29
2025-11-26 18:21:28,311 - app.services.ai_parser - INFO -    âœ“ Exclusions: 24
2025-11-26 18:21:28,312 - app.services.ai_parser - INFO -    âœ“ Warranties: 6
2025-11-26 18:21:28,312 - app.services.ai_parser - INFO -    âœ“ Extensions: 2
2025-11-26 18:21:28,312 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 18:21:28,312 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:28,316 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: 61fc0433b66d40eda3e4b505685c7e9c.pdf â†’ 6927452866b3b08604cbb805
2025-11-26 18:21:28,316 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6927452866b3b08604cbb805
2025-11-26 18:21:28,320 - app.services.user_documents_service - INFO - âœ… Saved user document: GIG.pdf â†’ 6927452866b3b08604cbb806 (478025 bytes)
2025-11-26 18:21:28,320 - app.api.routes - INFO - âœ… Saved user document: GIG.pdf â†’ 6927452866b3b08604cbb806
2025-11-26 18:21:28,321 - app.api.routes - INFO - âœ… Successfully processed: GIG.pdf
2025-11-26 18:21:33,549 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:33,557 - app.services.ai_parser - INFO - âœ… Stage 4: Subjectivities extracted
2025-11-26 18:21:33,557 - app.services.ai_parser - INFO - ðŸ§® Stage 5: Calculations and tier detection
2025-11-26 18:21:33,557 - app.services.ai_parser - INFO - ðŸ”„ Rate: 'SR 169,122.3 @ 0.30%' â†’ '0.30%'
2025-11-26 18:21:33,557 - app.services.ai_parser - INFO - ðŸ’° Calculated: 69471773000.12 from SI: 41077831.25 Ã— Rate: SR 169,122.3 @ 0.30%
2025-11-26 18:21:33,558 - app.services.ai_parser - INFO - âœ… Applicable deductibles: MD: 5% of the claim amount, min SR 10,000
2025-11-26 18:21:33,558 - app.services.ai_parser - INFO - ðŸŽ¯ Stage 6: Analysis and scoring
2025-11-26 18:21:33,558 - app.services.ai_parser - INFO - ðŸ“Š Counts: 12 benefits, 37 exclusions, 7 warranties, 0 extensions
2025-11-26 18:21:38,781 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:38,794 - app.services.ai_parser - INFO - âœ… Stage 6 complete - Score: 78.0
2025-11-26 18:21:38,795 - app.services.ai_parser - INFO - ðŸ“¦ Assembling final data structure
2025-11-26 18:21:38,796 - app.services.ai_parser - INFO - 
2025-11-26 18:21:38,797 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:38,797 - app.services.ai_parser - INFO - âœ… EXTRACTION COMPLETE - Malath.pdf
2025-11-26 18:21:38,798 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:38,799 - app.services.ai_parser - INFO - ðŸ¢ Insurer: Malath Insurance
2025-11-26 18:21:38,800 - app.services.ai_parser - INFO - ðŸ‘¤ Insured: M/S. Saudi Amana Contracting Co.
2025-11-26 18:21:38,800 - app.services.ai_parser - INFO - ðŸ’° Premium: SAR 169,122.30
2025-11-26 18:21:38,801 - app.services.ai_parser - INFO - ðŸ“Š Rate: 0.30%
2025-11-26 18:21:38,802 - app.services.ai_parser - INFO - ðŸŽ¯ Score: 78.0/100
2025-11-26 18:21:38,803 - app.services.ai_parser - INFO - ðŸ“ Quality: 98.7/100
2025-11-26 18:21:38,803 - app.services.ai_parser - INFO - ðŸ”§ Deductible: MD: 5% of the claim amount, min SR 10,000
2025-11-26 18:21:38,804 - app.services.ai_parser - INFO - â° Validity: 15 days from date shown
2025-11-26 18:21:38,805 - app.services.ai_parser - INFO - ðŸ’¼ Brokerage: 15%
2025-11-26 18:21:38,806 - app.services.ai_parser - INFO - 
2025-11-26 18:21:38,806 - app.services.ai_parser - INFO - ðŸ“¦ Extracted:
2025-11-26 18:21:38,807 - app.services.ai_parser - INFO -    âœ“ Benefits: 12
2025-11-26 18:21:38,808 - app.services.ai_parser - INFO -    âœ“ Exclusions: 37
2025-11-26 18:21:38,808 - app.services.ai_parser - INFO -    âœ“ Warranties: 7
2025-11-26 18:21:38,809 - app.services.ai_parser - INFO -    âœ“ Extensions: 0
2025-11-26 18:21:38,810 - app.services.ai_parser - INFO -    âœ“ Subjectivities: 4
2025-11-26 18:21:38,810 - app.services.ai_parser - INFO - ======================================================================
2025-11-26 18:21:38,814 - app.services.mongodb_service_enhanced - INFO - âœ… Saved individual PDF: fd91a30ca71848fbaf070d0ac5561f72.pdf â†’ 6927453266b3b08604cbb807
2025-11-26 18:21:38,815 - app.api.routes - INFO - âœ… Saved individual PDF to MongoDB: 6927453266b3b08604cbb807
2025-11-26 18:21:38,821 - app.services.user_documents_service - INFO - âœ… Saved user document: Malath.pdf â†’ 6927453266b3b08604cbb808 (203279 bytes)
2025-11-26 18:21:38,821 - app.api.routes - INFO - âœ… Saved user document: Malath.pdf â†’ 6927453266b3b08604cbb808
2025-11-26 18:21:38,822 - app.api.routes - INFO - âœ… Successfully processed: Malath.pdf
2025-11-26 18:21:38,822 - app.api.routes - INFO - 
âœ… Successfully extracted 3 quotes
2025-11-26 18:21:38,823 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:21:38,823 - app.api.routes - INFO - ðŸ”€ Generating comparison for 3 quotes
2025-11-26 18:21:38,823 - app.api.routes - INFO - ======================================================================
2025-11-26 18:21:38,824 - app.services.ai_ranker - INFO - ðŸ” Starting comprehensive comparison of 3 quotes
2025-11-26 18:21:38,824 - app.services.ai_ranker - INFO - âš–ï¸ Using weights: {'premium': 0.25, 'rate': 0.2, 'benefits': 0.1, 'exclusions': 0.05, 'warranties': 0.04, 'extensions': 0.04, 'subjectivities': 0.02, 'provider_reputation': 0.3}
2025-11-26 18:21:38,825 - app.services.ai_ranker - INFO - ðŸ† Hakim Score integration enabled
2025-11-26 18:21:38,825 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 18:21:38,825 - app.services.ai_ranker - INFO - ðŸ” IDENTIFYING UNIQUE ITEMS using SEMANTIC MATCHING v7.1
2025-11-26 18:21:38,826 - app.services.ai_ranker - INFO - ================================================================================
2025-11-26 18:21:38,826 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 18:21:38,827 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Arabian Shield Cooperative Insurance Company
2025-11-26 18:21:38,827 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 18:21:38,827 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 18:21:38,827 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:21:38,828 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 18:21:38,828 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 18:21:38,829 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 18:21:38,829 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 18:21:38,830 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 18:21:38,830 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 18:21:38,830 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 18:21:38,831 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,831.56",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077831.56,
    "total_sum_insured": "SR 41,077,831.56"
  },
  "deductibles_complete": {
    "structure_type": "as per expiring policy",
    "material_damage_tiers": [],
    "business_interruption_tiers": [],
    "natural_catastrophe_tiers": [],
    "fallback_summary": "MD: As per expiring policy",
    "applicable_md_tier": {},
    "applicable_bi_tier": {},
    "applicable_nc_tier": {}
  },
  "sublimits_comprehensive": {},
  "exclusions_complete": {
    "all_exclusions_list": []
  },
  "warranties_actual": {
    "warranties_list": []
  },
  "extensions_and_conditions": {
    "extensions_list": [],
    "conditions_list": []
  },
  "coverage_details": {
    "coverage_benefits_explained": []
  },
  "subjectivities": {
    "binding_requirements": [
      "Risk survey within 30 days",
      "Civil Defense certificate 
2025-11-26 18:21:38,834 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:21:38,835 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 18:21:38,835 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 18:21:38,836 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 18:21:38,837 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 18:21:38,837 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 18:21:38,838 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 18:21:38,838 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 18:21:38,838 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 18:21:38,838 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 18:21:38,839 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 18:21:38,839 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 18:21:38,839 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 18:21:38,840 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 18:21:38,840 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 18:21:38,840 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 18:21:38,841 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 18:21:38,841 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:21:38,841 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Arabian Shield Cooperative Insurance Company
2025-11-26 18:21:38,842 - app.services.ai_ranker - INFO - 
ðŸ“Š Arabian Shield Cooperative Insurance Company:
2025-11-26 18:21:38,842 - app.services.ai_ranker - INFO -    Warranties: 0
2025-11-26 18:21:38,842 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 18:21:38,843 - app.services.ai_ranker - INFO -    Exclusions: 0
2025-11-26 18:21:38,843 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 18:21:38,843 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 18:21:38,843 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Gulf Insurance Group (GIG)
2025-11-26 18:21:38,844 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 18:21:38,844 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 18:21:38,844 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:21:38,845 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 18:21:38,846 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 18:21:38,847 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 18:21:38,848 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 18:21:38,848 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 18:21:38,848 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 18:21:38,849 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 18:21:38,849 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GIG",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,832",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077832,
    "total_sum_insured": "SR 41,077,832"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 500,000",
        "deductible": "5%, min SR 10,000",
        "applies_to": "material_damage"
      },
      {
        "range": "up to SR 1,000,000",
        "deductible": "5%, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "up to SR 2,000,000",
        "deductible": "5%, min SR 50,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 2,000,000",
        "deductible": "5%, min SR 75,000",
        "applies_to": "material_damage"
      },
      {
        "range": "Gantry Crane",
        "deductible": "10%, min SR 50,000",
        "applies_to": "material
2025-11-26 18:21:38,851 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:21:38,851 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 18:21:38,851 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 18:21:38,852 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 18:21:38,852 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 18:21:38,852 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 18:21:38,852 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 18:21:38,852 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 18:21:38,853 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 18:21:38,853 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 18:21:38,853 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 18:21:38,853 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 18:21:38,853 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 18:21:38,854 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 18:21:38,854 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 18:21:38,854 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 18:21:38,855 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 18:21:38,855 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:21:38,855 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Gulf Insurance Group (GIG)
2025-11-26 18:21:38,855 - app.services.ai_ranker - INFO - 
ðŸ“Š Gulf Insurance Group (GIG):
2025-11-26 18:21:38,856 - app.services.ai_ranker - INFO -    Warranties: 6
2025-11-26 18:21:38,856 - app.services.ai_ranker - INFO -    Extensions: 2
2025-11-26 18:21:38,856 - app.services.ai_ranker - INFO -    Exclusions: 24
2025-11-26 18:21:38,856 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 18:21:38,856 - app.services.ai_ranker - INFO - 
============================================================
2025-11-26 18:21:38,856 - app.services.ai_ranker - INFO - ðŸ” EXTRACTING SUBJECTIVITIES for: Malath Insurance
2025-11-26 18:21:38,857 - app.services.ai_ranker - INFO - ============================================================
2025-11-26 18:21:38,857 - app.services.ai_ranker - INFO -    Extended data exists: True
2025-11-26 18:21:38,857 - app.services.ai_ranker - INFO -    Extended data keys: ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:21:38,858 - app.services.ai_ranker - INFO -    Subjectivities data exists: True
2025-11-26 18:21:38,858 - app.services.ai_ranker - INFO -    Subjectivities data type: <class 'dict'>
2025-11-26 18:21:38,858 - app.services.ai_ranker - INFO -    Subjectivities data: {'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance', '... all requirements'], 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions'], 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property', 'Civil Defense License', '... all documents']}
2025-11-26 18:21:38,859 - app.services.ai_ranker - INFO -    Quote has _extended_data attr: True
2025-11-26 18:21:38,859 - app.services.ai_ranker - INFO -    Quote has subscriptions: True
2025-11-26 18:21:38,859 - app.services.ai_ranker - INFO -    Quote has subjectivities: False
2025-11-26 18:21:38,859 - app.services.ai_ranker - INFO -    Quote has additional_info: True
2025-11-26 18:21:38,859 - app.services.ai_ranker - INFO -    Extended data preview (first 1000 chars):
{
  "document_format": "GENERIC",
  "sum_insured_breakdown": {
    "material_damage": "SR 41,077,831.25",
    "business_interruption": "N/A",
    "total_sum_insured_numeric": 41077831.25,
    "total_sum_insured": "SR 41,077,831.25"
  },
  "deductibles_complete": {
    "structure_type": "tiered_by_sum_insured",
    "material_damage_tiers": [
      {
        "range": "up to SR 100,000",
        "deductible": "5% of the claim amount, min SR 10,000",
        "applies_to": "material_damage"
      },
      {
        "range": "SR 100,000 to SR 500,000",
        "deductible": "10% of claim amount, min SR 25,000",
        "applies_to": "material_damage"
      },
      {
        "range": "above SR 500,000",
        "deductible": "10% of the claim amount, min SR 75,000",
        "applies_to": "material_damage"
      }
    ],
    "applicable_md_tier": {
      "range": "up to SR 100,000",
      "deductible": "5% of the claim amount, min SR 10,000",
      "applies_to": "material_damage"
    },
    "
2025-11-26 18:21:38,861 - app.services.ai_ranker - INFO -    âœ… Found 4 items in key 'binding_requirements': ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:21:38,862 - app.services.ai_ranker - INFO -    âœ… Found 3 items in key 'conditions_precedent': ['No deterioration of loss record', 'Survey and fulfillment of recommendations', '... all conditions']
2025-11-26 18:21:38,862 - app.services.ai_ranker - INFO -    âœ… Found 5 items in key 'documentation_required': ['Signed proposal form', 'GPS coordinates', 'Photographs of property']
2025-11-26 18:21:38,863 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities_list': []
2025-11-26 18:21:38,863 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'requirements': []
2025-11-26 18:21:38,864 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'all_subjectivities': []
2025-11-26 18:21:38,864 - app.services.ai_ranker - INFO -    âœ… Found 0 items in key 'subjectivities': []
2025-11-26 18:21:38,864 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['binding_requirements']: []
2025-11-26 18:21:38,865 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['conditions_precedent']: []
2025-11-26 18:21:38,865 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['subjectivities_and_requirements']['documentation_required']: []
2025-11-26 18:21:38,865 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['binding_requirements']: []
2025-11-26 18:21:38,865 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['conditions_precedent']: []
2025-11-26 18:21:38,866 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['binding_requirements']['documentation_required']: []
2025-11-26 18:21:38,866 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['binding_requirements']: []
2025-11-26 18:21:38,866 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['conditions_precedent']: []
2025-11-26 18:21:38,866 - app.services.ai_ranker - INFO -    âœ… Found 0 items in extended_data['conditions_precedent']['documentation_required']: []
2025-11-26 18:21:38,867 - app.services.ai_ranker - INFO -    ðŸ“Š Total unique subjectivities extracted: 12
2025-11-26 18:21:38,867 - app.services.ai_ranker - INFO -    ðŸ“ Sample subjectivities: ['Risk survey within 30 days', 'Civil Defense certificate required', 'KYC/AML clearance']
2025-11-26 18:21:38,867 - app.services.ai_ranker - INFO -    âœ… Extracted 12 subjectivities for Malath Insurance
2025-11-26 18:21:38,867 - app.services.ai_ranker - INFO - 
ðŸ“Š Malath Insurance:
2025-11-26 18:21:38,868 - app.services.ai_ranker - INFO -    Warranties: 7
2025-11-26 18:21:38,868 - app.services.ai_ranker - INFO -    Extensions: 0
2025-11-26 18:21:38,868 - app.services.ai_ranker - INFO -    Exclusions: 37
2025-11-26 18:21:38,868 - app.services.ai_ranker - INFO -    Subjectivities: 12
2025-11-26 18:21:38,868 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Arabian Shield Cooperative Insurance Company
2025-11-26 18:21:38,878 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 0
2025-11-26 18:21:38,879 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 18:21:38,879 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 0
2025-11-26 18:21:38,880 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 18:21:38,880 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Gulf Insurance Group (GIG)
2025-11-26 18:21:39,085 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 6
2025-11-26 18:21:39,087 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 2
2025-11-26 18:21:39,087 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 18:21:39,087 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 18:21:39,088 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 18:21:39,088 - app.services.ai_ranker - INFO -       â€¢ Hot works Warranty
2025-11-26 18:21:39,088 - app.services.ai_ranker - INFO -       â€¢ No smoking Warranty
2025-11-26 18:21:39,088 - app.services.ai_ranker - INFO -       â€¢ Housekeeping Warranty
2025-11-26 18:21:39,089 - app.services.ai_ranker - INFO - 
ðŸ”Ž Analyzing unique items for: Malath Insurance
2025-11-26 18:21:39,307 - app.services.ai_ranker - INFO -    âœ“ Unique Warranties: 7
2025-11-26 18:21:39,307 - app.services.ai_ranker - INFO -    âœ“ Unique Extensions: 0
2025-11-26 18:21:39,307 - app.services.ai_ranker - INFO -    âœ“ Unique Exclusions: 10
2025-11-26 18:21:39,308 - app.services.ai_ranker - INFO -    âœ“ Unique Subjectivities: 0
2025-11-26 18:21:39,308 - app.services.ai_ranker - INFO -    ðŸ“ Sample unique warranties:
2025-11-26 18:21:39,308 - app.services.ai_ranker - INFO -       â€¢ Warranted that all plant and equipment is operated and maintained in accordance ...
2025-11-26 18:21:39,309 - app.services.ai_ranker - INFO -       â€¢ Warranted that All operators of the equipment must be licensed to operate such p...
2025-11-26 18:21:39,309 - app.services.ai_ranker - INFO -       â€¢ Warranted that all equipment is fitted with operational overload alarms.
2025-11-26 18:21:39,309 - app.services.ai_ranker - INFO - 
================================================================================
2025-11-26 18:21:39,310 - app.services.ai_ranker - INFO - âœ… UNIQUE ITEMS IDENTIFICATION COMPLETE
2025-11-26 18:21:39,310 - app.services.ai_ranker - INFO - ================================================================================

2025-11-26 18:21:39,310 - app.services.ai_ranker - INFO - ðŸ“Š Arabian Shield Cooperative Insurance Company: Hakim Score=80.0 (Baseline), Weighted Score=78.00
2025-11-26 18:21:39,311 - app.services.ai_ranker - INFO - ðŸ“Š Gulf Insurance Group (GIG): Hakim Score=88.0 (Strong), Weighted Score=84.61
2025-11-26 18:21:39,311 - app.services.ai_ranker - INFO - ðŸ“Š Malath Insurance: Hakim Score=75.0 (Standard), Weighted Score=59.14
2025-11-26 18:21:39,311 - app.services.ai_ranker - INFO - ðŸ¤– Performing weighted ranking with Hakim Score...
2025-11-26 18:21:39,312 - app.services.ai_ranker - INFO - ðŸ¤– Performing AI-powered ranking analysis...
2025-11-26 18:21:46,584 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:46,592 - app.services.ai_ranker - INFO - âœ… AI ranking analysis completed
2025-11-26 18:21:46,593 - app.services.ai_ranker - INFO - âœ… Weighted ranking with Hakim Score completed
2025-11-26 18:21:46,593 - app.services.ai_ranker - INFO - ðŸ”¨ Building comprehensive comparison structure...
2025-11-26 18:21:49,859 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-26 18:21:49,863 - app.services.ai_ranker - INFO - âœ… Generated reasoning for Gulf Insurance Group (GIG): Gulf Insurance Group (GIG) stands out as the best insurance provider due to its leading score of 84....
2025-11-26 18:21:49,866 - app.services.ai_ranker - INFO - âœ… Comprehensive comparison complete
2025-11-26 18:21:49,867 - app.services.mongodb_service_enhanced - INFO - ðŸ’¾ Saving COMPLETE comparison data to MongoDB
2025-11-26 18:21:49,868 - app.services.mongodb_service_enhanced - INFO -    Comparison ID: cmp_1764181252_b7fdb478ed00
2025-11-26 18:21:49,869 - app.services.mongodb_service_enhanced - INFO -    Total PDFs: 3
2025-11-26 18:21:49,869 - app.services.mongodb_service_enhanced - INFO -    Data keys: ['comparison_id', 'status', 'total_quotes', 'hakim_score_enabled', 'summary', 'key_differences', 'side_by_side', 'data_table', 'analytics', 'provider_cards', 'extracted_quotes', 'files_processed', 'processing_timestamp', 'processing_summary']
2025-11-26 18:21:49,871 - app.services.mongodb_service_enhanced - INFO - ðŸ“‹ Extracted quotes count: 3
2025-11-26 18:21:49,872 - app.services.mongodb_service_enhanced - INFO -    Quote 1: Arabian Shield Cooperative Insurance Company
2025-11-26 18:21:49,873 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 18:21:49,873 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 18:21:49,874 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 18:21:49,875 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 18:21:49,875 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 18:21:49,876 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 18:21:49,877 - app.services.mongodb_service_enhanced - INFO -    Quote 2: Gulf Insurance Group (GIG)
2025-11-26 18:21:49,877 - app.services.mongodb_service_enhanced - INFO -       - Has _extended_data: True
2025-11-26 18:21:49,878 - app.services.mongodb_service_enhanced - INFO -       - Has _analysis_details: True
2025-11-26 18:21:49,878 - app.services.mongodb_service_enhanced - INFO -       - Has _calculation_log: True
2025-11-26 18:21:49,879 - app.services.mongodb_service_enhanced - INFO -       - Has _quote_fingerprint: True
2025-11-26 18:21:49,879 - app.services.mongodb_service_enhanced - INFO -       - Has _quality_metrics: True
2025-11-26 18:21:49,880 - app.services.mongodb_service_enhanced - INFO -       - All keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible']...
2025-11-26 18:21:49,885 - app.services.mongodb_service_enhanced - INFO - ðŸ“Š Data sizes:
2025-11-26 18:21:49,886 - app.services.mongodb_service_enhanced - INFO -    Summary: 4,302 bytes
2025-11-26 18:21:49,887 - app.services.mongodb_service_enhanced - INFO -    Side-by-side: 24,656 bytes
2025-11-26 18:21:49,888 - app.services.mongodb_service_enhanced - INFO -    Data table: 10,585 bytes
2025-11-26 18:21:49,888 - app.services.mongodb_service_enhanced - INFO -    Analytics: 1,940 bytes
2025-11-26 18:21:49,889 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes: 31,055 bytes
2025-11-26 18:21:49,889 - app.services.mongodb_service_enhanced - INFO -    Total document: 154,373 bytes
2025-11-26 18:21:49,890 - app.services.mongodb_service_enhanced - INFO -    Comparison matrix keys: ['premium', 'rate', 'score', 'hakim_score', 'deductible', 'coverage', 'benefits', 'exclusions', 'warranties', 'subjectivities', 'conditions', 'benefits_count', 'exclusions_count', 'warranties_count']
2025-11-26 18:21:49,890 - app.services.mongodb_service_enhanced - INFO -       premium: 3 items
2025-11-26 18:21:49,890 - app.services.mongodb_service_enhanced - INFO -       rate: 3 items
2025-11-26 18:21:49,891 - app.services.mongodb_service_enhanced - INFO -       score: 3 items
2025-11-26 18:21:49,891 - app.services.mongodb_service_enhanced - INFO -       hakim_score: 3 items
2025-11-26 18:21:49,891 - app.services.mongodb_service_enhanced - INFO -       deductible: 3 items
2025-11-26 18:21:49,892 - app.services.mongodb_service_enhanced - INFO -       coverage: 3 items
2025-11-26 18:21:49,892 - app.services.mongodb_service_enhanced - INFO -       benefits: 3 items
2025-11-26 18:21:49,892 - app.services.mongodb_service_enhanced - INFO -       exclusions: 3 items
2025-11-26 18:21:49,893 - app.services.mongodb_service_enhanced - INFO -       warranties: 3 items
2025-11-26 18:21:49,893 - app.services.mongodb_service_enhanced - INFO -       subjectivities: 3 items
2025-11-26 18:21:49,893 - app.services.mongodb_service_enhanced - INFO -       conditions: 3 items
2025-11-26 18:21:49,894 - app.services.mongodb_service_enhanced - INFO -       benefits_count: 3 items
2025-11-26 18:21:49,894 - app.services.mongodb_service_enhanced - INFO -       exclusions_count: 3 items
2025-11-26 18:21:49,894 - app.services.mongodb_service_enhanced - INFO -       warranties_count: 3 items
2025-11-26 18:21:49,894 - app.services.mongodb_service_enhanced - INFO -    Extracted quotes structure:
2025-11-26 18:21:49,895 - app.services.mongodb_service_enhanced - INFO -       - Count: 3
2025-11-26 18:21:49,895 - app.services.mongodb_service_enhanced - INFO -       - First quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 18:21:49,896 - app.services.mongodb_service_enhanced - INFO -       - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:21:49,898 - app.services.mongodb_service_enhanced - INFO -       - _analysis_details keys (7): ['overall_score', 'score_breakdown', 'strengths', 'weaknesses', 'value_assessment', 'recommendation', 'score_methodology']
2025-11-26 18:21:49,902 - app.services.mongodb_service_enhanced - INFO - âœ… Saved new comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:21:49,903 - app.services.mongodb_service_enhanced - INFO -    MongoDB ID: 6927453db757af6a8efab063
2025-11-26 18:21:49,905 - app.services.mongodb_service_enhanced - INFO - âœ… Verification - Saved document has:
2025-11-26 18:21:49,906 - app.services.mongodb_service_enhanced - INFO -    - comparison_data: True
2025-11-26 18:21:49,906 - app.services.mongodb_service_enhanced - INFO -    - summary: True
2025-11-26 18:21:49,906 - app.services.mongodb_service_enhanced - INFO -    - side_by_side: True
2025-11-26 18:21:49,906 - app.services.mongodb_service_enhanced - INFO -    - data_table: True
2025-11-26 18:21:49,906 - app.services.mongodb_service_enhanced - INFO -    - analytics: True
2025-11-26 18:21:49,907 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes: True
2025-11-26 18:21:49,907 - app.services.mongodb_service_enhanced - INFO -    - data_table rows: 3
2025-11-26 18:21:49,907 - app.services.mongodb_service_enhanced - INFO -    - First row keys (27): ['provider', 'provider_name', 'company', 'score', 'weighted_score', 'premium', 'premium_amount', 'rate', 'coverage', 'coverage_limit', 'benefits', 'benefits_count', 'key_benefits', 'exclusions', 'exclusions_count']...
2025-11-26 18:21:49,908 - app.services.mongodb_service_enhanced - INFO -    - side_by_side providers: 3
2025-11-26 18:21:49,908 - app.services.mongodb_service_enhanced - INFO -    - First provider keys (28): ['name', 'client_name', 'ia_compliant', 'hakim_score', 'hakim_tier', 'hakim_rank', 'rank', 'score', 'premium', 'rate', 'coverage_limit', 'deductible', 'warranties', 'warranties_count', 'unique_warranties']...
2025-11-26 18:21:49,908 - app.services.mongodb_service_enhanced - INFO -    - extracted_quotes count: 3
2025-11-26 18:21:49,909 - app.services.mongodb_service_enhanced - INFO -    - First saved quote keys (25): ['company_name', 'insured_name', 'policy_type', 'policy_number', 'premium_amount', 'premium_frequency', 'rate', 'total_annual_cost', 'score', 'deductible', 'coverage_limit', 'sum_insured_total', 'key_benefits', 'exclusions', 'warranties', 'strengths', 'weaknesses', 'file_name', 'extraction_confidence', 'additional_info', '_extended_data', '_analysis_details', '_calculation_log', '_quote_fingerprint', '_quality_metrics']
2025-11-26 18:21:49,909 - app.services.mongodb_service_enhanced - INFO -    - Has _extended_data: True
2025-11-26 18:21:49,910 - app.services.mongodb_service_enhanced - INFO -    - Has _analysis_details: True
2025-11-26 18:21:49,910 - app.services.mongodb_service_enhanced - INFO -    - Has _calculation_log: True
2025-11-26 18:21:49,910 - app.services.mongodb_service_enhanced - INFO -    - Has _quote_fingerprint: True
2025-11-26 18:21:49,911 - app.services.mongodb_service_enhanced - INFO -    - Has _quality_metrics: True
2025-11-26 18:21:49,911 - app.services.mongodb_service_enhanced - INFO -    - _extended_data keys (15): ['document_format', 'sum_insured_breakdown', 'deductibles_complete', 'sublimits_comprehensive', 'exclusions_complete', 'warranties_actual', 'extensions_and_conditions', 'coverage_details', 'subjectivities', 'operational_details', 'brokerage_info', 'special_conditions', 'validity_period', 'geographical_limits', 'jurisdiction']
2025-11-26 18:21:49,912 - app.api.routes - INFO - âœ… Saved comparison result to MongoDB: 6927453db757af6a8efab063
2025-11-26 18:21:49,912 - app.api.routes - INFO -    Database: hakemAI
2025-11-26 18:21:49,913 - app.api.routes - INFO -    Collection: comparisons
2025-11-26 18:21:49,913 - app.api.routes - INFO -    Comparison ID: cmp_1764181252_b7fdb478ed00
2025-11-26 18:21:49,915 - app.services.user_subscription_service - INFO - âœ… Unlimited plan - no usage tracking needed for user 691f66b40c6cd02283165a7c
2025-11-26 18:21:49,915 - app.api.routes - INFO - âœ… Recorded comparison usage for user 691f66b40c6cd02283165a7c
2025-11-26 18:21:49,915 - app.api.routes - INFO - 
======================================================================
2025-11-26 18:21:49,916 - app.api.routes - INFO - âœ… COMPARISON COMPLETE
2025-11-26 18:21:49,916 - app.api.routes - INFO - ======================================================================
2025-11-26 18:21:49,916 - app.api.routes - INFO - ðŸ“Š Comparison ID: cmp_1764181252_b7fdb478ed00
2025-11-26 18:21:49,916 - app.api.routes - INFO - ðŸ‘¤ User ID: 691f66b40c6cd02283165a7c
2025-11-26 18:21:49,917 - app.api.routes - INFO - ðŸ“„ Files Processed: 3/3
2025-11-26 18:21:49,917 - app.api.routes - INFO - ðŸ’¾ Saved to MongoDB: 3 PDFs + 1 comparison
2025-11-26 18:21:49,917 - app.services.user_subscription_service - INFO - ðŸ” Searching for user with ID: 691f66b40c6cd02283165a7c
2025-11-26 18:21:49,917 - app.services.user_subscription_service - INFO - ðŸ“Š Database: hakemAI
2025-11-26 18:21:49,918 - app.services.user_subscription_service - INFO - ðŸ“Š Collection: users
2025-11-26 18:21:49,919 - app.services.user_subscription_service - INFO - âœ… Found user: john_doe (john.doe@example.com)
2025-11-26 18:21:49,919 - app.api.routes - INFO - ðŸ“Š Remaining comparisons: -1
2025-11-26 18:21:49,920 - app.api.routes - INFO - ======================================================================

2025-11-26 18:21:49,920 - app.services.progress_tracker - INFO - âœ… Job completed: job_1a6730ba88b7 â†’ comparison_id: cmp_1764181252_b7fdb478ed00
2025-11-26 18:21:49,922 - main - INFO - ðŸ“¤ POST /api/compare-quotes - 200 - 57.59s
2025-11-26 18:24:02,071 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf
2025-11-26 18:24:02,072 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:24:02,075 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764181252_b7fdb478ed00
2025-11-26 18:24:02,075 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 18:24:02,076 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 18:24:02,077 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 18:24:02,077 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 18:24:02,078 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 18:24:02,078 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 18:24:02,085 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 18:24:02,085 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 18:24:02,086 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 18:24:02,087 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 18:24:02,088 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 18:24:02,088 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 18:24:02,091 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 18:24:02,272 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:24:02,272 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764181252_b7fdb478ed00_20251126_182402.pdf (139596 bytes)
2025-11-26 18:24:02,273 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf - 200 - 0.20s
2025-11-26 18:30:41,749 - main - INFO - 
2025-11-26 18:30:41,749 - main - INFO - ================================================================================
2025-11-26 18:30:41,749 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:30:41,750 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:30:41,751 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:30:41,752 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:30:41,752 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:30:41,753 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:30:41,754 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:30:41,756 - main - INFO -   âœ… Cleaned up 3 temporary files
2025-11-26 18:30:41,756 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:30:41,756 - main - INFO - ================================================================================
2025-11-26 18:30:41,757 - main - INFO - 
2025-11-26 18:30:46,058 - main - INFO - 
2025-11-26 18:30:46,059 - main - INFO - ================================================================================
2025-11-26 18:30:46,059 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:30:46,059 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:30:46,059 - main - INFO - ================================================================================
2025-11-26 18:30:46,059 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:30:46,060 - main - INFO -   Upload Directory: uploads
2025-11-26 18:30:46,060 - main - INFO -   Max File Size: 20MB
2025-11-26 18:30:46,060 - main - INFO - ================================================================================
2025-11-26 18:30:46,060 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:30:46,061 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:30:46,061 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:30:46,092 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:30:46,099 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:30:46,099 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:30:46,099 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:30:46,100 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:30:46,100 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:30:46,109 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:30:46,110 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:30:46,111 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:30:46,114 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:30:46,115 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:30:46,116 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:30:46,116 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:30:46,117 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:30:46,127 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:30:46,128 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:30:46,128 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:30:46,128 - main - INFO - 
2025-11-26 18:30:46,128 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:30:46,129 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:30:46,129 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:30:46,129 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:30:46,129 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:30:46,130 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:30:46,130 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:30:46,130 - main - INFO - 
2025-11-26 18:30:46,130 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:30:46,131 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:30:46,131 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:30:46,131 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:30:46,131 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:30:46,131 - main - INFO - 
2025-11-26 18:30:46,132 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:30:46,132 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:30:46,132 - main - INFO -        - No manual section generation
2025-11-26 18:30:46,132 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:30:46,132 - main - INFO - 
2025-11-26 18:30:46,133 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:30:46,133 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:30:46,133 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:30:46,134 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:30:46,134 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:30:46,135 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:30:46,135 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:30:46,135 - main - INFO - 
2025-11-26 18:30:46,135 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:30:46,136 - main - INFO -      Main:
2025-11-26 18:30:46,136 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:30:46,136 - main - INFO - 
2025-11-26 18:30:46,136 - main - INFO -      Retrieval:
2025-11-26 18:30:46,136 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:30:46,137 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:30:46,137 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:30:46,137 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:30:46,137 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:30:46,137 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:30:46,138 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:30:46,138 - main - INFO - 
2025-11-26 18:30:46,138 - main - INFO -      Management:
2025-11-26 18:30:46,138 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:30:46,139 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:30:46,139 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:30:46,139 - main - INFO - 
2025-11-26 18:30:46,140 - main - INFO -      Documents (MongoDB):
2025-11-26 18:30:46,140 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:30:46,140 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:30:46,141 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:30:46,141 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:30:46,141 - main - INFO - 
2025-11-26 18:30:46,141 - main - INFO -      Diagnostics & Health:
2025-11-26 18:30:46,141 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:30:46,141 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:30:46,142 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:30:46,142 - main - INFO - 
2025-11-26 18:30:46,142 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:30:46,142 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:30:46,142 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:30:46,142 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:30:46,142 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:30:46,143 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:30:46,143 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:30:46,143 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:30:46,143 - main - INFO - 
2025-11-26 18:30:46,143 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:30:46,144 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:30:46,144 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:30:46,144 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:30:46,144 - main - INFO -      4. No re-upload needed!
2025-11-26 18:30:46,144 - main - INFO - 
2025-11-26 18:30:46,145 - main - INFO - ================================================================================
2025-11-26 18:30:46,145 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:30:46,145 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:30:46,146 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:30:46,146 - main - INFO - ================================================================================
2025-11-26 18:30:46,146 - main - INFO - 
2025-11-26 18:30:46,146 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:30:56,041 - main - INFO - 
2025-11-26 18:30:56,054 - main - INFO - ================================================================================
2025-11-26 18:30:56,076 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:30:56,077 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:30:56,081 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:30:56,091 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:30:56,127 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:30:56,179 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:30:56,182 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:30:56,187 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:30:56,204 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:30:56,215 - main - INFO - ================================================================================
2025-11-26 18:30:56,222 - main - INFO - 
2025-11-26 18:30:58,911 - main - INFO - 
2025-11-26 18:30:58,911 - main - INFO - ================================================================================
2025-11-26 18:30:58,911 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:30:58,911 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:30:58,912 - main - INFO - ================================================================================
2025-11-26 18:30:58,912 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:30:58,912 - main - INFO -   Upload Directory: uploads
2025-11-26 18:30:58,912 - main - INFO -   Max File Size: 20MB
2025-11-26 18:30:58,913 - main - INFO - ================================================================================
2025-11-26 18:30:58,913 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:30:58,913 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:30:58,914 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:30:58,954 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:30:58,961 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:30:58,961 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:30:58,962 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:30:58,962 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:30:58,962 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:30:58,970 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:30:58,971 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:30:58,973 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:30:58,977 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:30:58,978 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:30:58,979 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:30:58,980 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:30:58,981 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:30:58,992 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:30:58,992 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:30:58,993 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:30:58,993 - main - INFO - 
2025-11-26 18:30:58,993 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:30:58,993 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:30:58,994 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:30:58,994 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:30:58,994 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:30:58,994 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:30:58,995 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:30:58,995 - main - INFO - 
2025-11-26 18:30:58,995 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:30:58,995 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:30:58,996 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:30:58,996 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:30:58,996 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:30:58,997 - main - INFO - 
2025-11-26 18:30:58,997 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:30:58,998 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:30:58,998 - main - INFO -        - No manual section generation
2025-11-26 18:30:58,999 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:30:58,999 - main - INFO - 
2025-11-26 18:30:59,000 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:30:59,000 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:30:59,000 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:30:59,000 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:30:59,001 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:30:59,001 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:30:59,001 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:30:59,001 - main - INFO - 
2025-11-26 18:30:59,002 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:30:59,002 - main - INFO -      Main:
2025-11-26 18:30:59,002 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:30:59,002 - main - INFO - 
2025-11-26 18:30:59,002 - main - INFO -      Retrieval:
2025-11-26 18:30:59,003 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:30:59,003 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:30:59,003 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:30:59,003 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:30:59,004 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:30:59,004 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:30:59,004 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:30:59,004 - main - INFO - 
2025-11-26 18:30:59,004 - main - INFO -      Management:
2025-11-26 18:30:59,005 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:30:59,005 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:30:59,005 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:30:59,005 - main - INFO - 
2025-11-26 18:30:59,006 - main - INFO -      Documents (MongoDB):
2025-11-26 18:30:59,006 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:30:59,006 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:30:59,007 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:30:59,007 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:30:59,008 - main - INFO - 
2025-11-26 18:30:59,008 - main - INFO -      Diagnostics & Health:
2025-11-26 18:30:59,008 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:30:59,008 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:30:59,009 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:30:59,009 - main - INFO - 
2025-11-26 18:30:59,009 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:30:59,010 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:30:59,010 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:30:59,010 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:30:59,010 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:30:59,011 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:30:59,011 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:30:59,011 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:30:59,011 - main - INFO - 
2025-11-26 18:30:59,012 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:30:59,012 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:30:59,012 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:30:59,012 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:30:59,012 - main - INFO -      4. No re-upload needed!
2025-11-26 18:30:59,013 - main - INFO - 
2025-11-26 18:30:59,013 - main - INFO - ================================================================================
2025-11-26 18:30:59,013 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:30:59,014 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:30:59,014 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:30:59,015 - main - INFO - ================================================================================
2025-11-26 18:30:59,016 - main - INFO - 
2025-11-26 18:30:59,017 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:31:03,829 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf
2025-11-26 18:31:03,830 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:31:03,832 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764181252_b7fdb478ed00
2025-11-26 18:31:03,832 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 18:31:03,833 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 18:31:03,833 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 18:31:03,833 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 18:31:03,834 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 18:31:03,834 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 18:31:03,842 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 18:31:03,843 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 18:31:03,844 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 18:31:03,845 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 18:31:03,848 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 18:31:03,849 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 18:31:03,852 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 18:31:04,015 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:31:04,015 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764181252_b7fdb478ed00_20251126_183104.pdf (139590 bytes)
2025-11-26 18:31:04,016 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf - 200 - 0.19s
2025-11-26 18:36:58,137 - main - INFO - 
2025-11-26 18:36:58,138 - main - INFO - ================================================================================
2025-11-26 18:36:58,140 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:36:58,141 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:36:58,142 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:36:58,143 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:36:58,143 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:36:58,144 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:36:58,145 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:36:58,145 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:36:58,146 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:36:58,146 - main - INFO - ================================================================================
2025-11-26 18:36:58,146 - main - INFO - 
2025-11-26 18:37:02,437 - main - INFO - 
2025-11-26 18:37:02,437 - main - INFO - ================================================================================
2025-11-26 18:37:02,437 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:37:02,437 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:37:02,438 - main - INFO - ================================================================================
2025-11-26 18:37:02,438 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:37:02,438 - main - INFO -   Upload Directory: uploads
2025-11-26 18:37:02,438 - main - INFO -   Max File Size: 20MB
2025-11-26 18:37:02,438 - main - INFO - ================================================================================
2025-11-26 18:37:02,440 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:37:02,442 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:37:02,443 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:37:02,470 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:37:02,483 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:37:02,483 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:37:02,483 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:37:02,484 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:37:02,484 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:37:02,498 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:37:02,499 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:37:02,500 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:37:02,502 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:37:02,503 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:37:02,503 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:37:02,504 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:37:02,504 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:37:02,516 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:37:02,516 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:37:02,517 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:37:02,517 - main - INFO - 
2025-11-26 18:37:02,517 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:37:02,517 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:37:02,517 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:37:02,518 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:37:02,518 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:37:02,518 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:37:02,518 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:37:02,518 - main - INFO - 
2025-11-26 18:37:02,519 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:37:02,519 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:37:02,519 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:37:02,519 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:37:02,519 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:37:02,519 - main - INFO - 
2025-11-26 18:37:02,520 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:37:02,520 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:37:02,520 - main - INFO -        - No manual section generation
2025-11-26 18:37:02,520 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:37:02,520 - main - INFO - 
2025-11-26 18:37:02,520 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:37:02,520 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:37:02,521 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:37:02,521 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:37:02,521 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:37:02,521 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:37:02,521 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:37:02,521 - main - INFO - 
2025-11-26 18:37:02,522 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:37:02,522 - main - INFO -      Main:
2025-11-26 18:37:02,523 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:37:02,524 - main - INFO - 
2025-11-26 18:37:02,525 - main - INFO -      Retrieval:
2025-11-26 18:37:02,525 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:37:02,525 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:37:02,525 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:37:02,526 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:37:02,526 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:37:02,527 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:37:02,528 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:37:02,528 - main - INFO - 
2025-11-26 18:37:02,529 - main - INFO -      Management:
2025-11-26 18:37:02,529 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:37:02,529 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:37:02,529 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:37:02,530 - main - INFO - 
2025-11-26 18:37:02,530 - main - INFO -      Documents (MongoDB):
2025-11-26 18:37:02,530 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:37:02,530 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:37:02,530 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:37:02,530 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:37:02,531 - main - INFO - 
2025-11-26 18:37:02,531 - main - INFO -      Diagnostics & Health:
2025-11-26 18:37:02,531 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:37:02,531 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:37:02,531 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:37:02,532 - main - INFO - 
2025-11-26 18:37:02,532 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:37:02,532 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:37:02,532 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:37:02,532 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:37:02,532 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:37:02,533 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:37:02,533 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:37:02,533 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:37:02,533 - main - INFO - 
2025-11-26 18:37:02,533 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:37:02,533 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:37:02,533 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:37:02,534 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:37:02,534 - main - INFO -      4. No re-upload needed!
2025-11-26 18:37:02,534 - main - INFO - 
2025-11-26 18:37:02,534 - main - INFO - ================================================================================
2025-11-26 18:37:02,534 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:37:02,535 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:37:02,535 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:37:02,535 - main - INFO - ================================================================================
2025-11-26 18:37:02,535 - main - INFO - 
2025-11-26 18:37:02,535 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:37:10,719 - main - INFO - 
2025-11-26 18:37:10,720 - main - INFO - ================================================================================
2025-11-26 18:37:10,720 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:37:10,721 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:37:10,722 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:37:10,723 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:37:10,723 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:37:10,724 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:37:10,725 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:37:10,725 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:37:10,725 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:37:10,726 - main - INFO - ================================================================================
2025-11-26 18:37:10,726 - main - INFO - 
2025-11-26 18:37:15,208 - main - INFO - 
2025-11-26 18:37:15,208 - main - INFO - ================================================================================
2025-11-26 18:37:15,208 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:37:15,209 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:37:15,209 - main - INFO - ================================================================================
2025-11-26 18:37:15,209 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:37:15,210 - main - INFO -   Upload Directory: uploads
2025-11-26 18:37:15,210 - main - INFO -   Max File Size: 20MB
2025-11-26 18:37:15,210 - main - INFO - ================================================================================
2025-11-26 18:37:15,211 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:37:15,211 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:37:15,211 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:37:15,236 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:37:15,248 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:37:15,249 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:37:15,249 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:37:15,249 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:37:15,249 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:37:15,261 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:37:15,264 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:37:15,265 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:37:15,267 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:37:15,267 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:37:15,267 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:37:15,268 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:37:15,268 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:37:15,280 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:37:15,281 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:37:15,281 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:37:15,281 - main - INFO - 
2025-11-26 18:37:15,281 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:37:15,282 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:37:15,282 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:37:15,282 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:37:15,282 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:37:15,282 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:37:15,283 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:37:15,283 - main - INFO - 
2025-11-26 18:37:15,283 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:37:15,283 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:37:15,283 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:37:15,283 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:37:15,284 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:37:15,284 - main - INFO - 
2025-11-26 18:37:15,284 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:37:15,284 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:37:15,284 - main - INFO -        - No manual section generation
2025-11-26 18:37:15,284 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:37:15,285 - main - INFO - 
2025-11-26 18:37:15,285 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:37:15,285 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:37:15,285 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:37:15,285 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:37:15,285 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:37:15,285 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:37:15,286 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:37:15,286 - main - INFO - 
2025-11-26 18:37:15,286 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:37:15,286 - main - INFO -      Main:
2025-11-26 18:37:15,286 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:37:15,286 - main - INFO - 
2025-11-26 18:37:15,286 - main - INFO -      Retrieval:
2025-11-26 18:37:15,287 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:37:15,287 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:37:15,287 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:37:15,287 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:37:15,287 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:37:15,287 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:37:15,288 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:37:15,288 - main - INFO - 
2025-11-26 18:37:15,288 - main - INFO -      Management:
2025-11-26 18:37:15,288 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:37:15,289 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:37:15,290 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:37:15,290 - main - INFO - 
2025-11-26 18:37:15,291 - main - INFO -      Documents (MongoDB):
2025-11-26 18:37:15,291 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:37:15,292 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:37:15,292 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:37:15,292 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:37:15,292 - main - INFO - 
2025-11-26 18:37:15,293 - main - INFO -      Diagnostics & Health:
2025-11-26 18:37:15,293 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:37:15,293 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:37:15,293 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:37:15,294 - main - INFO - 
2025-11-26 18:37:15,294 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:37:15,294 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:37:15,295 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:37:15,295 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:37:15,295 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:37:15,295 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:37:15,295 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:37:15,296 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:37:15,296 - main - INFO - 
2025-11-26 18:37:15,296 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:37:15,296 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:37:15,297 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:37:15,297 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:37:15,298 - main - INFO -      4. No re-upload needed!
2025-11-26 18:37:15,298 - main - INFO - 
2025-11-26 18:37:15,298 - main - INFO - ================================================================================
2025-11-26 18:37:15,299 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:37:15,299 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:37:15,299 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:37:15,299 - main - INFO - ================================================================================
2025-11-26 18:37:15,299 - main - INFO - 
2025-11-26 18:37:15,300 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:38:11,782 - main - INFO - 
2025-11-26 18:38:11,787 - main - INFO - ================================================================================
2025-11-26 18:38:11,788 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:38:11,790 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:38:11,790 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:38:11,792 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:38:11,792 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:38:11,795 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:38:11,796 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:38:11,797 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:38:11,797 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:38:11,797 - main - INFO - ================================================================================
2025-11-26 18:38:11,798 - main - INFO - 
2025-11-26 18:38:14,316 - main - INFO - 
2025-11-26 18:38:14,317 - main - INFO - ================================================================================
2025-11-26 18:38:14,317 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:38:14,317 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:38:14,317 - main - INFO - ================================================================================
2025-11-26 18:38:14,318 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:38:14,318 - main - INFO -   Upload Directory: uploads
2025-11-26 18:38:14,318 - main - INFO -   Max File Size: 20MB
2025-11-26 18:38:14,318 - main - INFO - ================================================================================
2025-11-26 18:38:14,319 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:38:14,319 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:38:14,319 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:38:14,335 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:38:14,339 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:38:14,340 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:38:14,340 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:38:14,340 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:38:14,340 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:38:14,361 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:38:14,362 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:38:14,364 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:38:14,366 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:38:14,367 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:38:14,367 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:38:14,368 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:38:14,368 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:38:14,376 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:38:14,376 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:38:14,376 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:38:14,377 - main - INFO - 
2025-11-26 18:38:14,377 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:38:14,377 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:38:14,377 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:38:14,378 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:38:14,378 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:38:14,378 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:38:14,378 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:38:14,378 - main - INFO - 
2025-11-26 18:38:14,379 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:38:14,379 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:38:14,379 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:38:14,379 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:38:14,380 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:38:14,380 - main - INFO - 
2025-11-26 18:38:14,380 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:38:14,380 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:38:14,380 - main - INFO -        - No manual section generation
2025-11-26 18:38:14,380 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:38:14,381 - main - INFO - 
2025-11-26 18:38:14,381 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:38:14,381 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:38:14,381 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:38:14,381 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:38:14,381 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:38:14,382 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:38:14,382 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:38:14,382 - main - INFO - 
2025-11-26 18:38:14,382 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:38:14,382 - main - INFO -      Main:
2025-11-26 18:38:14,382 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:38:14,383 - main - INFO - 
2025-11-26 18:38:14,383 - main - INFO -      Retrieval:
2025-11-26 18:38:14,383 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:38:14,383 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:38:14,383 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:38:14,383 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:38:14,383 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:38:14,383 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:38:14,384 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:38:14,384 - main - INFO - 
2025-11-26 18:38:14,384 - main - INFO -      Management:
2025-11-26 18:38:14,384 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:38:14,384 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:38:14,384 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:38:14,384 - main - INFO - 
2025-11-26 18:38:14,385 - main - INFO -      Documents (MongoDB):
2025-11-26 18:38:14,385 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:38:14,385 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:38:14,385 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:38:14,385 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:38:14,385 - main - INFO - 
2025-11-26 18:38:14,385 - main - INFO -      Diagnostics & Health:
2025-11-26 18:38:14,386 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:38:14,386 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:38:14,386 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:38:14,386 - main - INFO - 
2025-11-26 18:38:14,386 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:38:14,386 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:38:14,386 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:38:14,387 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:38:14,387 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:38:14,387 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:38:14,387 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:38:14,387 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:38:14,387 - main - INFO - 
2025-11-26 18:38:14,387 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:38:14,388 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:38:14,388 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:38:14,388 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:38:14,388 - main - INFO -      4. No re-upload needed!
2025-11-26 18:38:14,388 - main - INFO - 
2025-11-26 18:38:14,388 - main - INFO - ================================================================================
2025-11-26 18:38:14,389 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:38:14,389 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:38:14,389 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:38:14,390 - main - INFO - ================================================================================
2025-11-26 18:38:14,390 - main - INFO - 
2025-11-26 18:38:14,390 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:40:48,024 - main - INFO - 
2025-11-26 18:40:48,024 - main - INFO - ================================================================================
2025-11-26 18:40:48,025 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:40:48,026 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:40:48,026 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:40:48,027 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:40:48,027 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:40:48,028 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:40:48,028 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:40:48,029 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:40:48,029 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:40:48,029 - main - INFO - ================================================================================
2025-11-26 18:40:48,030 - main - INFO - 
2025-11-26 18:40:51,798 - main - INFO - 
2025-11-26 18:40:51,798 - main - INFO - ================================================================================
2025-11-26 18:40:51,798 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:40:51,798 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:40:51,799 - main - INFO - ================================================================================
2025-11-26 18:40:51,799 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:40:51,799 - main - INFO -   Upload Directory: uploads
2025-11-26 18:40:51,799 - main - INFO -   Max File Size: 20MB
2025-11-26 18:40:51,799 - main - INFO - ================================================================================
2025-11-26 18:40:51,800 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:40:51,801 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:40:51,801 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:40:51,827 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:40:51,833 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:40:51,833 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:40:51,834 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:40:51,834 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:40:51,834 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:40:51,846 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:40:51,847 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:40:51,848 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:40:51,850 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:40:51,850 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:40:51,850 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:40:51,851 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:40:51,851 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:40:51,867 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:40:51,867 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:40:51,867 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:40:51,868 - main - INFO - 
2025-11-26 18:40:51,868 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:40:51,868 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:40:51,868 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:40:51,868 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:40:51,869 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:40:51,869 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:40:51,869 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:40:51,869 - main - INFO - 
2025-11-26 18:40:51,869 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:40:51,869 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:40:51,869 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:40:51,870 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:40:51,870 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:40:51,870 - main - INFO - 
2025-11-26 18:40:51,870 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:40:51,870 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:40:51,870 - main - INFO -        - No manual section generation
2025-11-26 18:40:51,871 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:40:51,871 - main - INFO - 
2025-11-26 18:40:51,871 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:40:51,871 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:40:51,871 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:40:51,871 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:40:51,872 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:40:51,872 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:40:51,872 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:40:51,872 - main - INFO - 
2025-11-26 18:40:51,873 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:40:51,874 - main - INFO -      Main:
2025-11-26 18:40:51,874 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:40:51,875 - main - INFO - 
2025-11-26 18:40:51,875 - main - INFO -      Retrieval:
2025-11-26 18:40:51,876 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:40:51,876 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:40:51,876 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:40:51,876 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:40:51,877 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:40:51,877 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:40:51,877 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:40:51,877 - main - INFO - 
2025-11-26 18:40:51,878 - main - INFO -      Management:
2025-11-26 18:40:51,878 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:40:51,878 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:40:51,878 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:40:51,879 - main - INFO - 
2025-11-26 18:40:51,880 - main - INFO -      Documents (MongoDB):
2025-11-26 18:40:51,880 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:40:51,880 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:40:51,880 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:40:51,881 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:40:51,881 - main - INFO - 
2025-11-26 18:40:51,881 - main - INFO -      Diagnostics & Health:
2025-11-26 18:40:51,881 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:40:51,881 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:40:51,881 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:40:51,882 - main - INFO - 
2025-11-26 18:40:51,882 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:40:51,882 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:40:51,882 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:40:51,882 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:40:51,882 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:40:51,883 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:40:51,883 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:40:51,883 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:40:51,883 - main - INFO - 
2025-11-26 18:40:51,884 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:40:51,884 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:40:51,884 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:40:51,884 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:40:51,884 - main - INFO -      4. No re-upload needed!
2025-11-26 18:40:51,884 - main - INFO - 
2025-11-26 18:40:51,885 - main - INFO - ================================================================================
2025-11-26 18:40:51,885 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:40:51,885 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:40:51,885 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:40:51,885 - main - INFO - ================================================================================
2025-11-26 18:40:51,886 - main - INFO - 
2025-11-26 18:40:51,886 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:41:03,892 - main - INFO - 
2025-11-26 18:41:03,893 - main - INFO - ================================================================================
2025-11-26 18:41:03,893 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:41:03,894 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:41:03,894 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:41:03,895 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:41:03,896 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:41:03,897 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:41:03,897 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:41:03,898 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:41:03,898 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:41:03,898 - main - INFO - ================================================================================
2025-11-26 18:41:03,899 - main - INFO - 
2025-11-26 18:41:06,810 - main - INFO - 
2025-11-26 18:41:06,811 - main - INFO - ================================================================================
2025-11-26 18:41:06,811 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:41:06,811 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:41:06,811 - main - INFO - ================================================================================
2025-11-26 18:41:06,812 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:41:06,812 - main - INFO -   Upload Directory: uploads
2025-11-26 18:41:06,812 - main - INFO -   Max File Size: 20MB
2025-11-26 18:41:06,812 - main - INFO - ================================================================================
2025-11-26 18:41:06,813 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:41:06,813 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:41:06,813 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:41:06,841 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:41:06,851 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:41:06,852 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:41:06,852 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:41:06,852 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:41:06,852 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:41:06,862 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:41:06,863 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:41:06,866 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:41:06,868 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:41:06,868 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:41:06,868 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:41:06,868 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:41:06,869 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:41:06,903 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:41:06,904 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:41:06,904 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:41:06,904 - main - INFO - 
2025-11-26 18:41:06,905 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:41:06,905 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:41:06,905 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:41:06,906 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:41:06,906 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:41:06,906 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:41:06,907 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:41:06,907 - main - INFO - 
2025-11-26 18:41:06,908 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:41:06,908 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:41:06,909 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:41:06,909 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:41:06,909 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:41:06,910 - main - INFO - 
2025-11-26 18:41:06,910 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:41:06,911 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:41:06,911 - main - INFO -        - No manual section generation
2025-11-26 18:41:06,911 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:41:06,912 - main - INFO - 
2025-11-26 18:41:06,912 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:41:06,912 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:41:06,912 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:41:06,913 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:41:06,913 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:41:06,913 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:41:06,914 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:41:06,914 - main - INFO - 
2025-11-26 18:41:06,914 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:41:06,915 - main - INFO -      Main:
2025-11-26 18:41:06,915 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:41:06,915 - main - INFO - 
2025-11-26 18:41:06,915 - main - INFO -      Retrieval:
2025-11-26 18:41:06,916 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:41:06,916 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:41:06,916 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:41:06,916 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:41:06,917 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:41:06,917 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:41:06,917 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:41:06,917 - main - INFO - 
2025-11-26 18:41:06,917 - main - INFO -      Management:
2025-11-26 18:41:06,918 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:41:06,918 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:41:06,918 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:41:06,919 - main - INFO - 
2025-11-26 18:41:06,919 - main - INFO -      Documents (MongoDB):
2025-11-26 18:41:06,919 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:41:06,919 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:41:06,920 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:41:06,920 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:41:06,920 - main - INFO - 
2025-11-26 18:41:06,920 - main - INFO -      Diagnostics & Health:
2025-11-26 18:41:06,920 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:41:06,921 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:41:06,921 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:41:06,921 - main - INFO - 
2025-11-26 18:41:06,921 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:41:06,921 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:41:06,922 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:41:06,922 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:41:06,923 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:41:06,923 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:41:06,924 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:41:06,925 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:41:06,925 - main - INFO - 
2025-11-26 18:41:06,925 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:41:06,925 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:41:06,926 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:41:06,926 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:41:06,926 - main - INFO -      4. No re-upload needed!
2025-11-26 18:41:06,926 - main - INFO - 
2025-11-26 18:41:06,926 - main - INFO - ================================================================================
2025-11-26 18:41:06,926 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:41:06,927 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:41:06,927 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:41:06,927 - main - INFO - ================================================================================
2025-11-26 18:41:06,927 - main - INFO - 
2025-11-26 18:41:06,928 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:41:17,096 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf
2025-11-26 18:41:17,098 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:41:17,101 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764181252_b7fdb478ed00
2025-11-26 18:41:17,102 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 18:41:17,102 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 18:41:17,103 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 18:41:17,104 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 18:41:17,105 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 18:41:17,106 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 18:41:17,115 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 18:41:17,116 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 18:41:17,118 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 18:41:17,119 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 18:41:17,120 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 18:41:17,120 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 18:41:17,121 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 18:41:17,278 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:41:17,278 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764181252_b7fdb478ed00_20251126_184117.pdf (139632 bytes)
2025-11-26 18:41:17,279 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf - 200 - 0.18s
2025-11-26 18:42:22,120 - main - INFO - 
2025-11-26 18:42:22,121 - main - INFO - ================================================================================
2025-11-26 18:42:22,121 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:42:22,123 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:42:22,124 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:42:22,125 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:42:22,126 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:42:22,127 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:42:22,128 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:42:22,128 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:42:22,128 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:42:22,128 - main - INFO - ================================================================================
2025-11-26 18:42:22,129 - main - INFO - 
2025-11-26 18:42:25,690 - main - INFO - 
2025-11-26 18:42:25,691 - main - INFO - ================================================================================
2025-11-26 18:42:25,691 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:42:25,692 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:42:25,692 - main - INFO - ================================================================================
2025-11-26 18:42:25,692 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:42:25,692 - main - INFO -   Upload Directory: uploads
2025-11-26 18:42:25,692 - main - INFO -   Max File Size: 20MB
2025-11-26 18:42:25,693 - main - INFO - ================================================================================
2025-11-26 18:42:25,693 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:42:25,693 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:42:25,693 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:42:25,717 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:42:25,722 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:42:25,722 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:42:25,723 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:42:25,724 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:42:25,724 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:42:25,759 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:42:25,762 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:42:25,764 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:42:25,768 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:42:25,769 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:42:25,769 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:42:25,770 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:42:25,770 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:42:25,790 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:42:25,791 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:42:25,791 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:42:25,792 - main - INFO - 
2025-11-26 18:42:25,792 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:42:25,792 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:42:25,793 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:42:25,793 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:42:25,793 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:42:25,794 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:42:25,794 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:42:25,794 - main - INFO - 
2025-11-26 18:42:25,794 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:42:25,795 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:42:25,795 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:42:25,795 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:42:25,795 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:42:25,796 - main - INFO - 
2025-11-26 18:42:25,796 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:42:25,796 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:42:25,796 - main - INFO -        - No manual section generation
2025-11-26 18:42:25,797 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:42:25,797 - main - INFO - 
2025-11-26 18:42:25,797 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:42:25,797 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:42:25,797 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:42:25,797 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:42:25,798 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:42:25,798 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:42:25,798 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:42:25,798 - main - INFO - 
2025-11-26 18:42:25,798 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:42:25,799 - main - INFO -      Main:
2025-11-26 18:42:25,799 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:42:25,799 - main - INFO - 
2025-11-26 18:42:25,799 - main - INFO -      Retrieval:
2025-11-26 18:42:25,799 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:42:25,800 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:42:25,800 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:42:25,800 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:42:25,800 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:42:25,800 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:42:25,800 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:42:25,800 - main - INFO - 
2025-11-26 18:42:25,801 - main - INFO -      Management:
2025-11-26 18:42:25,801 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:42:25,801 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:42:25,801 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:42:25,801 - main - INFO - 
2025-11-26 18:42:25,802 - main - INFO -      Documents (MongoDB):
2025-11-26 18:42:25,802 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:42:25,802 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:42:25,802 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:42:25,802 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:42:25,803 - main - INFO - 
2025-11-26 18:42:25,803 - main - INFO -      Diagnostics & Health:
2025-11-26 18:42:25,803 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:42:25,804 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:42:25,804 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:42:25,804 - main - INFO - 
2025-11-26 18:42:25,804 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:42:25,805 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:42:25,805 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:42:25,805 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:42:25,805 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:42:25,806 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:42:25,806 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:42:25,806 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:42:25,807 - main - INFO - 
2025-11-26 18:42:25,808 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:42:25,809 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:42:25,809 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:42:25,810 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:42:25,811 - main - INFO -      4. No re-upload needed!
2025-11-26 18:42:25,811 - main - INFO - 
2025-11-26 18:42:25,811 - main - INFO - ================================================================================
2025-11-26 18:42:25,812 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:42:25,812 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:42:25,812 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:42:25,813 - main - INFO - ================================================================================
2025-11-26 18:42:25,813 - main - INFO - 
2025-11-26 18:42:25,814 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:42:37,278 - main - INFO - 
2025-11-26 18:42:37,278 - main - INFO - ================================================================================
2025-11-26 18:42:37,279 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 18:42:37,281 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:42:37,281 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 18:42:37,283 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 18:42:37,284 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 18:42:37,285 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 18:42:37,286 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 18:42:37,286 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 18:42:37,287 - main - INFO -   âœ… Application stopped successfully
2025-11-26 18:42:37,287 - main - INFO - ================================================================================
2025-11-26 18:42:37,287 - main - INFO - 
2025-11-26 18:42:40,897 - main - INFO - 
2025-11-26 18:42:40,897 - main - INFO - ================================================================================
2025-11-26 18:42:40,897 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 18:42:40,897 - main - INFO -   Production-Ready Complete Integration
2025-11-26 18:42:40,897 - main - INFO - ================================================================================
2025-11-26 18:42:40,898 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 18:42:40,898 - main - INFO -   Upload Directory: uploads
2025-11-26 18:42:40,898 - main - INFO -   Max File Size: 20MB
2025-11-26 18:42:40,898 - main - INFO - ================================================================================
2025-11-26 18:42:40,898 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 18:42:40,899 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 18:42:40,899 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 18:42:40,933 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 18:42:40,937 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 18:42:40,937 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 18:42:40,938 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 18:42:40,938 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:42:40,938 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 18:42:40,971 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 18:42:40,973 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 18:42:40,974 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 18:42:40,977 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 18:42:40,978 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 18:42:40,978 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 18:42:40,978 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 18:42:40,979 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 18:42:41,015 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 18:42:41,016 - main - INFO -   âœ… User Documents Service connected
2025-11-26 18:42:41,016 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 18:42:41,016 - main - INFO - 
2025-11-26 18:42:41,017 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 18:42:41,017 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 18:42:41,017 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 18:42:41,017 - main - INFO -        - Separates warranties from extensions
2025-11-26 18:42:41,017 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 18:42:41,018 - main - INFO -        - Correct deductible tier detection
2025-11-26 18:42:41,018 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 18:42:41,018 - main - INFO - 
2025-11-26 18:42:41,018 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 18:42:41,018 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 18:42:41,019 - main - INFO -        - Identifies unique items per provider
2025-11-26 18:42:41,019 - main - INFO -        - Transparent scoring methodology
2025-11-26 18:42:41,019 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 18:42:41,019 - main - INFO - 
2025-11-26 18:42:41,019 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 18:42:41,020 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 18:42:41,020 - main - INFO -        - No manual section generation
2025-11-26 18:42:41,020 - main - INFO -        - Complete MongoDB integration
2025-11-26 18:42:41,020 - main - INFO - 
2025-11-26 18:42:41,020 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 18:42:41,020 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 18:42:41,021 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 18:42:41,021 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 18:42:41,021 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 18:42:41,021 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 18:42:41,021 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 18:42:41,021 - main - INFO - 
2025-11-26 18:42:41,022 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 18:42:41,022 - main - INFO -      Main:
2025-11-26 18:42:41,022 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 18:42:41,023 - main - INFO - 
2025-11-26 18:42:41,023 - main - INFO -      Retrieval:
2025-11-26 18:42:41,023 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 18:42:41,023 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 18:42:41,023 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 18:42:41,024 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 18:42:41,024 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 18:42:41,024 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 18:42:41,024 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 18:42:41,024 - main - INFO - 
2025-11-26 18:42:41,025 - main - INFO -      Management:
2025-11-26 18:42:41,025 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 18:42:41,025 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 18:42:41,025 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 18:42:41,026 - main - INFO - 
2025-11-26 18:42:41,026 - main - INFO -      Documents (MongoDB):
2025-11-26 18:42:41,026 - main - INFO -        GET  /api/documents                All documents
2025-11-26 18:42:41,027 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 18:42:41,027 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 18:42:41,028 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 18:42:41,028 - main - INFO - 
2025-11-26 18:42:41,028 - main - INFO -      Diagnostics & Health:
2025-11-26 18:42:41,028 - main - INFO -        GET  /api/health                   System health
2025-11-26 18:42:41,029 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 18:42:41,029 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 18:42:41,029 - main - INFO - 
2025-11-26 18:42:41,029 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 18:42:41,030 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 18:42:41,031 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 18:42:41,032 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 18:42:41,033 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 18:42:41,034 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 18:42:41,034 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 18:42:41,034 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 18:42:41,034 - main - INFO - 
2025-11-26 18:42:41,035 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 18:42:41,035 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 18:42:41,035 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 18:42:41,035 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 18:42:41,036 - main - INFO -      4. No re-upload needed!
2025-11-26 18:42:41,036 - main - INFO - 
2025-11-26 18:42:41,036 - main - INFO - ================================================================================
2025-11-26 18:42:41,036 - main - INFO -   âœ… Application started successfully!
2025-11-26 18:42:41,036 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 18:42:41,037 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 18:42:41,037 - main - INFO - ================================================================================
2025-11-26 18:42:41,037 - main - INFO - 
2025-11-26 18:42:41,037 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 18:42:42,800 - main - INFO - ðŸ“¥ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf
2025-11-26 18:42:42,801 - app.api.routes - INFO - ðŸ“„ Generating PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:42:42,803 - app.services.pdf_generator_service - INFO - ðŸ” Validating comparison data for: cmp_1764181252_b7fdb478ed00
2025-11-26 18:42:42,803 - app.services.pdf_generator_service - INFO - âœ… Comparison data validated: summary=True, data_table=True, side_by_side=True
2025-11-26 18:42:42,804 - app.services.pdf_generator_service - INFO - ðŸ“„ Building cover page...
2025-11-26 18:42:42,804 - app.services.pdf_generator_service - INFO - âœ… Cover page built successfully
2025-11-26 18:42:42,804 - app.services.pdf_generator_service - INFO - ðŸ“„ Building summary section...
2025-11-26 18:42:42,806 - app.services.pdf_generator_service - INFO - âœ… Summary section built successfully
2025-11-26 18:42:42,806 - app.services.pdf_generator_service - INFO - ðŸ“„ Building key differences section...
2025-11-26 18:42:42,817 - app.services.pdf_generator_service - INFO - âœ… Key differences section built successfully
2025-11-26 18:42:42,817 - app.services.pdf_generator_service - INFO - ðŸ“„ Building data table section...
2025-11-26 18:42:42,819 - app.services.pdf_generator_service - INFO - âœ… Data table section built successfully
2025-11-26 18:42:42,820 - app.services.pdf_generator_service - INFO - ðŸ“„ Building side-by-side section...
2025-11-26 18:42:42,821 - app.services.pdf_generator_service - INFO - âœ… Side-by-side section built successfully
2025-11-26 18:42:42,822 - app.services.pdf_generator_service - INFO - ðŸ“„ Building analytics section...
2025-11-26 18:42:42,824 - app.services.pdf_generator_service - INFO - âœ… Analytics section built successfully
2025-11-26 18:42:43,004 - app.services.pdf_generator_service - INFO - âœ… Generated PDF for comparison: cmp_1764181252_b7fdb478ed00
2025-11-26 18:42:43,004 - app.api.routes - INFO - âœ… PDF generated successfully: HAKEM_AI_Comparison_cmp_1764181252_b7fdb478ed00_20251126_184243.pdf (139590 bytes)
2025-11-26 18:42:43,007 - main - INFO - ðŸ“¤ GET /api/comparison/cmp_1764181252_b7fdb478ed00/pdf - 200 - 0.21s
2025-11-26 19:02:53,813 - main - INFO - 
2025-11-26 19:02:53,813 - main - INFO - ================================================================================
2025-11-26 19:02:53,813 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 19:02:53,814 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:02:53,814 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 19:02:53,815 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:02:53,816 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 19:02:53,816 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 19:02:53,817 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 19:02:53,817 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 19:02:53,818 - main - INFO -   âœ… Application stopped successfully
2025-11-26 19:02:53,818 - main - INFO - ================================================================================
2025-11-26 19:02:53,818 - main - INFO - 
2025-11-26 19:02:57,103 - main - INFO - 
2025-11-26 19:02:57,103 - main - INFO - ================================================================================
2025-11-26 19:02:57,104 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 19:02:57,104 - main - INFO -   Production-Ready Complete Integration
2025-11-26 19:02:57,104 - main - INFO - ================================================================================
2025-11-26 19:02:57,104 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 19:02:57,104 - main - INFO -   Upload Directory: uploads
2025-11-26 19:02:57,105 - main - INFO -   Max File Size: 20MB
2025-11-26 19:02:57,105 - main - INFO - ================================================================================
2025-11-26 19:02:57,105 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 19:02:57,105 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 19:02:57,106 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 19:02:57,129 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 19:02:57,136 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 19:02:57,137 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 19:02:57,137 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 19:02:57,137 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:02:57,137 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 19:02:57,147 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 19:02:57,148 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 19:02:57,149 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 19:02:57,152 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 19:02:57,152 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 19:02:57,153 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 19:02:57,153 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:02:57,153 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 19:02:57,164 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 19:02:57,164 - main - INFO -   âœ… User Documents Service connected
2025-11-26 19:02:57,164 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 19:02:57,164 - main - INFO - 
2025-11-26 19:02:57,165 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 19:02:57,165 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 19:02:57,165 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 19:02:57,165 - main - INFO -        - Separates warranties from extensions
2025-11-26 19:02:57,165 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 19:02:57,166 - main - INFO -        - Correct deductible tier detection
2025-11-26 19:02:57,166 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 19:02:57,166 - main - INFO - 
2025-11-26 19:02:57,166 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 19:02:57,166 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 19:02:57,166 - main - INFO -        - Identifies unique items per provider
2025-11-26 19:02:57,167 - main - INFO -        - Transparent scoring methodology
2025-11-26 19:02:57,167 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 19:02:57,167 - main - INFO - 
2025-11-26 19:02:57,167 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 19:02:57,167 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 19:02:57,167 - main - INFO -        - No manual section generation
2025-11-26 19:02:57,168 - main - INFO -        - Complete MongoDB integration
2025-11-26 19:02:57,168 - main - INFO - 
2025-11-26 19:02:57,168 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 19:02:57,168 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 19:02:57,168 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 19:02:57,169 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 19:02:57,169 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 19:02:57,169 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 19:02:57,169 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 19:02:57,169 - main - INFO - 
2025-11-26 19:02:57,169 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 19:02:57,170 - main - INFO -      Main:
2025-11-26 19:02:57,170 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 19:02:57,170 - main - INFO - 
2025-11-26 19:02:57,170 - main - INFO -      Retrieval:
2025-11-26 19:02:57,170 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 19:02:57,170 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 19:02:57,171 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 19:02:57,171 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 19:02:57,171 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 19:02:57,171 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 19:02:57,171 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 19:02:57,171 - main - INFO - 
2025-11-26 19:02:57,171 - main - INFO -      Management:
2025-11-26 19:02:57,172 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 19:02:57,172 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 19:02:57,172 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 19:02:57,172 - main - INFO - 
2025-11-26 19:02:57,172 - main - INFO -      Documents (MongoDB):
2025-11-26 19:02:57,172 - main - INFO -        GET  /api/documents                All documents
2025-11-26 19:02:57,173 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 19:02:57,173 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 19:02:57,173 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 19:02:57,173 - main - INFO - 
2025-11-26 19:02:57,174 - main - INFO -      Diagnostics & Health:
2025-11-26 19:02:57,174 - main - INFO -        GET  /api/health                   System health
2025-11-26 19:02:57,175 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 19:02:57,176 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 19:02:57,176 - main - INFO - 
2025-11-26 19:02:57,177 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 19:02:57,177 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 19:02:57,177 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 19:02:57,178 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 19:02:57,179 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 19:02:57,179 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 19:02:57,179 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 19:02:57,179 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 19:02:57,180 - main - INFO - 
2025-11-26 19:02:57,180 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 19:02:57,180 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 19:02:57,181 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 19:02:57,183 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 19:02:57,183 - main - INFO -      4. No re-upload needed!
2025-11-26 19:02:57,183 - main - INFO - 
2025-11-26 19:02:57,184 - main - INFO - ================================================================================
2025-11-26 19:02:57,184 - main - INFO -   âœ… Application started successfully!
2025-11-26 19:02:57,184 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 19:02:57,184 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 19:02:57,185 - main - INFO - ================================================================================
2025-11-26 19:02:57,185 - main - INFO - 
2025-11-26 19:02:57,185 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 19:04:35,416 - main - INFO - 
2025-11-26 19:04:35,416 - main - INFO - ================================================================================
2025-11-26 19:04:35,416 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 19:04:35,417 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:04:35,418 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 19:04:35,421 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:04:35,423 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 19:04:35,424 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 19:04:35,425 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 19:04:35,426 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 19:04:35,427 - main - INFO -   âœ… Application stopped successfully
2025-11-26 19:04:35,427 - main - INFO - ================================================================================
2025-11-26 19:04:35,427 - main - INFO - 
2025-11-26 19:04:38,172 - main - INFO - 
2025-11-26 19:04:38,172 - main - INFO - ================================================================================
2025-11-26 19:04:38,173 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 19:04:38,173 - main - INFO -   Production-Ready Complete Integration
2025-11-26 19:04:38,173 - main - INFO - ================================================================================
2025-11-26 19:04:38,174 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 19:04:38,174 - main - INFO -   Upload Directory: uploads
2025-11-26 19:04:38,174 - main - INFO -   Max File Size: 20MB
2025-11-26 19:04:38,174 - main - INFO - ================================================================================
2025-11-26 19:04:38,175 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 19:04:38,175 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 19:04:38,175 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 19:04:38,226 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 19:04:38,233 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 19:04:38,234 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 19:04:38,234 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 19:04:38,234 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:04:38,234 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 19:04:38,273 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 19:04:38,274 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 19:04:38,276 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 19:04:38,278 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 19:04:38,279 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 19:04:38,279 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 19:04:38,279 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:04:38,280 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 19:04:38,306 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 19:04:38,306 - main - INFO -   âœ… User Documents Service connected
2025-11-26 19:04:38,306 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 19:04:38,306 - main - INFO - 
2025-11-26 19:04:38,307 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 19:04:38,307 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 19:04:38,308 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 19:04:38,308 - main - INFO -        - Separates warranties from extensions
2025-11-26 19:04:38,309 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 19:04:38,309 - main - INFO -        - Correct deductible tier detection
2025-11-26 19:04:38,309 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 19:04:38,309 - main - INFO - 
2025-11-26 19:04:38,310 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 19:04:38,310 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 19:04:38,310 - main - INFO -        - Identifies unique items per provider
2025-11-26 19:04:38,310 - main - INFO -        - Transparent scoring methodology
2025-11-26 19:04:38,310 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 19:04:38,310 - main - INFO - 
2025-11-26 19:04:38,311 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 19:04:38,311 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 19:04:38,311 - main - INFO -        - No manual section generation
2025-11-26 19:04:38,311 - main - INFO -        - Complete MongoDB integration
2025-11-26 19:04:38,311 - main - INFO - 
2025-11-26 19:04:38,312 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 19:04:38,312 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 19:04:38,312 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 19:04:38,312 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 19:04:38,312 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 19:04:38,313 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 19:04:38,313 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 19:04:38,313 - main - INFO - 
2025-11-26 19:04:38,313 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 19:04:38,313 - main - INFO -      Main:
2025-11-26 19:04:38,313 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 19:04:38,314 - main - INFO - 
2025-11-26 19:04:38,314 - main - INFO -      Retrieval:
2025-11-26 19:04:38,314 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 19:04:38,314 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 19:04:38,314 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 19:04:38,314 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 19:04:38,315 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 19:04:38,315 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 19:04:38,315 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 19:04:38,315 - main - INFO - 
2025-11-26 19:04:38,315 - main - INFO -      Management:
2025-11-26 19:04:38,316 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 19:04:38,316 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 19:04:38,316 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 19:04:38,316 - main - INFO - 
2025-11-26 19:04:38,316 - main - INFO -      Documents (MongoDB):
2025-11-26 19:04:38,316 - main - INFO -        GET  /api/documents                All documents
2025-11-26 19:04:38,317 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 19:04:38,317 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 19:04:38,317 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 19:04:38,317 - main - INFO - 
2025-11-26 19:04:38,317 - main - INFO -      Diagnostics & Health:
2025-11-26 19:04:38,317 - main - INFO -        GET  /api/health                   System health
2025-11-26 19:04:38,317 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 19:04:38,317 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 19:04:38,318 - main - INFO - 
2025-11-26 19:04:38,318 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 19:04:38,318 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 19:04:38,318 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 19:04:38,318 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 19:04:38,318 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 19:04:38,319 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 19:04:38,319 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 19:04:38,319 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 19:04:38,319 - main - INFO - 
2025-11-26 19:04:38,319 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 19:04:38,319 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 19:04:38,319 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 19:04:38,320 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 19:04:38,320 - main - INFO -      4. No re-upload needed!
2025-11-26 19:04:38,320 - main - INFO - 
2025-11-26 19:04:38,320 - main - INFO - ================================================================================
2025-11-26 19:04:38,320 - main - INFO -   âœ… Application started successfully!
2025-11-26 19:04:38,320 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 19:04:38,320 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 19:04:38,321 - main - INFO - ================================================================================
2025-11-26 19:04:38,321 - main - INFO - 
2025-11-26 19:04:38,321 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 19:07:17,219 - main - INFO - 
2025-11-26 19:07:17,219 - main - INFO - ================================================================================
2025-11-26 19:07:17,219 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 19:07:17,220 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:07:17,221 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 19:07:17,221 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:07:17,221 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 19:07:17,222 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 19:07:17,222 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 19:07:17,222 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 19:07:17,223 - main - INFO -   âœ… Application stopped successfully
2025-11-26 19:07:17,223 - main - INFO - ================================================================================
2025-11-26 19:07:17,223 - main - INFO - 
2025-11-26 19:07:19,843 - main - INFO - 
2025-11-26 19:07:19,843 - main - INFO - ================================================================================
2025-11-26 19:07:19,844 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 19:07:19,844 - main - INFO -   Production-Ready Complete Integration
2025-11-26 19:07:19,844 - main - INFO - ================================================================================
2025-11-26 19:07:19,845 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 19:07:19,845 - main - INFO -   Upload Directory: uploads
2025-11-26 19:07:19,845 - main - INFO -   Max File Size: 20MB
2025-11-26 19:07:19,845 - main - INFO - ================================================================================
2025-11-26 19:07:19,846 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 19:07:19,846 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 19:07:19,846 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 19:07:19,870 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 19:07:19,881 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 19:07:19,881 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 19:07:19,881 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 19:07:19,882 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:07:19,882 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 19:07:19,903 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 19:07:19,904 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 19:07:19,905 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 19:07:19,910 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 19:07:19,910 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 19:07:19,911 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 19:07:19,911 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:07:19,911 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 19:07:19,921 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 19:07:19,921 - main - INFO -   âœ… User Documents Service connected
2025-11-26 19:07:19,921 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 19:07:19,921 - main - INFO - 
2025-11-26 19:07:19,922 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 19:07:19,922 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 19:07:19,922 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 19:07:19,923 - main - INFO -        - Separates warranties from extensions
2025-11-26 19:07:19,923 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 19:07:19,925 - main - INFO -        - Correct deductible tier detection
2025-11-26 19:07:19,926 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 19:07:19,928 - main - INFO - 
2025-11-26 19:07:19,929 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 19:07:19,930 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 19:07:19,932 - main - INFO -        - Identifies unique items per provider
2025-11-26 19:07:19,932 - main - INFO -        - Transparent scoring methodology
2025-11-26 19:07:19,933 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 19:07:19,933 - main - INFO - 
2025-11-26 19:07:19,933 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 19:07:19,933 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 19:07:19,934 - main - INFO -        - No manual section generation
2025-11-26 19:07:19,934 - main - INFO -        - Complete MongoDB integration
2025-11-26 19:07:19,934 - main - INFO - 
2025-11-26 19:07:19,934 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 19:07:19,935 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 19:07:19,935 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 19:07:19,935 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 19:07:19,936 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 19:07:19,936 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 19:07:19,936 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 19:07:19,936 - main - INFO - 
2025-11-26 19:07:19,937 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 19:07:19,937 - main - INFO -      Main:
2025-11-26 19:07:19,937 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 19:07:19,938 - main - INFO - 
2025-11-26 19:07:19,938 - main - INFO -      Retrieval:
2025-11-26 19:07:19,938 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 19:07:19,938 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 19:07:19,939 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 19:07:19,939 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 19:07:19,939 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 19:07:19,939 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 19:07:19,940 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 19:07:19,940 - main - INFO - 
2025-11-26 19:07:19,942 - main - INFO -      Management:
2025-11-26 19:07:19,946 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 19:07:19,949 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 19:07:19,950 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 19:07:19,950 - main - INFO - 
2025-11-26 19:07:19,950 - main - INFO -      Documents (MongoDB):
2025-11-26 19:07:19,951 - main - INFO -        GET  /api/documents                All documents
2025-11-26 19:07:19,951 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 19:07:19,951 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 19:07:19,951 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 19:07:19,952 - main - INFO - 
2025-11-26 19:07:19,952 - main - INFO -      Diagnostics & Health:
2025-11-26 19:07:19,952 - main - INFO -        GET  /api/health                   System health
2025-11-26 19:07:19,952 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 19:07:19,952 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 19:07:19,953 - main - INFO - 
2025-11-26 19:07:19,953 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 19:07:19,953 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 19:07:19,953 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 19:07:19,954 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 19:07:19,954 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 19:07:19,954 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 19:07:19,954 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 19:07:19,955 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 19:07:19,955 - main - INFO - 
2025-11-26 19:07:19,955 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 19:07:19,955 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 19:07:19,955 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 19:07:19,956 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 19:07:19,956 - main - INFO -      4. No re-upload needed!
2025-11-26 19:07:19,956 - main - INFO - 
2025-11-26 19:07:19,956 - main - INFO - ================================================================================
2025-11-26 19:07:19,957 - main - INFO -   âœ… Application started successfully!
2025-11-26 19:07:19,957 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 19:07:19,958 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 19:07:19,959 - main - INFO - ================================================================================
2025-11-26 19:07:19,959 - main - INFO - 
2025-11-26 19:07:19,960 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
2025-11-26 19:07:45,706 - main - INFO - 
2025-11-26 19:07:45,706 - main - INFO - ================================================================================
2025-11-26 19:07:45,706 - main - INFO -   ðŸ›‘ Shutting down application...
2025-11-26 19:07:45,707 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:07:45,707 - main - INFO -   âœ… Enhanced MongoDB connection closed
2025-11-26 19:07:45,708 - app.services.user_subscription_service - INFO - ðŸ”Œ Disconnected from MongoDB
2025-11-26 19:07:45,708 - main - INFO -   âœ… User Subscription Service connection closed
2025-11-26 19:07:45,710 - app.services.user_documents_service - INFO - ðŸ”Œ User Documents Service disconnected from MongoDB
2025-11-26 19:07:45,710 - main - INFO -   âœ… User Documents Service connection closed
2025-11-26 19:07:45,710 - main - INFO -   âœ… Cleaned up 0 temporary files
2025-11-26 19:07:45,711 - main - INFO -   âœ… Application stopped successfully
2025-11-26 19:07:45,711 - main - INFO - ================================================================================
2025-11-26 19:07:45,711 - main - INFO - 
2025-11-26 19:07:48,400 - main - INFO - 
2025-11-26 19:07:48,400 - main - INFO - ================================================================================
2025-11-26 19:07:48,400 - main - INFO -   INSURANCE QUOTE COMPARISON API v3.1
2025-11-26 19:07:48,401 - main - INFO -   Production-Ready Complete Integration
2025-11-26 19:07:48,401 - main - INFO - ================================================================================
2025-11-26 19:07:48,401 - main - INFO -   AI Model: gpt-4o-mini
2025-11-26 19:07:48,402 - main - INFO -   Upload Directory: uploads
2025-11-26 19:07:48,402 - main - INFO -   Max File Size: 20MB
2025-11-26 19:07:48,402 - main - INFO - ================================================================================
2025-11-26 19:07:48,403 - main - INFO -   âœ… Upload directory ready: uploads
2025-11-26 19:07:48,403 - main - INFO -   âœ… Logs directory ready: logs/
2025-11-26 19:07:48,403 - app.services.mongodb_service_enhanced - INFO - ðŸ”Œ Connecting to MongoDB: mongodb://localhost:27017
2025-11-26 19:07:48,438 - app.services.mongodb_service_enhanced - INFO - âœ… Successfully connected to MongoDB
2025-11-26 19:07:48,444 - app.services.mongodb_service_enhanced - INFO - âœ… Database indexes created successfully
2025-11-26 19:07:48,445 - main - INFO -   âœ… Enhanced MongoDB connected: mongodb://localhost:27017
2025-11-26 19:07:48,445 - app.services.user_subscription_service - INFO - ðŸ”Œ Connecting to MongoDB for user subscription checks
2025-11-26 19:07:48,445 - app.services.user_subscription_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:07:48,446 - app.services.user_subscription_service - INFO -    Database: hakemAI
2025-11-26 19:07:48,469 - app.services.user_subscription_service - INFO - âœ… Successfully connected to MongoDB for user subscription checks
2025-11-26 19:07:48,470 - app.services.user_subscription_service - INFO - ðŸ“‹ Available databases: ['admin', 'config', 'hakemAI', 'insurance_comparison', 'local']
2025-11-26 19:07:48,471 - app.services.user_subscription_service - INFO - ðŸ“‹ Collections in 'hakemAI': ['user_documents', 'admins', 'individual_pdf_extractions', 'comparisons', 'users']
2025-11-26 19:07:48,473 - app.services.user_subscription_service - INFO - ðŸ“Š Users collection has 6 documents
2025-11-26 19:07:48,473 - main - INFO -   âœ… User Subscription Service connected
2025-11-26 19:07:48,473 - app.services.user_documents_service - INFO - ðŸ”Œ Connecting User Documents Service to MongoDB
2025-11-26 19:07:48,473 - app.services.user_documents_service - INFO -    URL: mongodb://localhost:27017/hakemAI
2025-11-26 19:07:48,474 - app.services.user_documents_service - INFO -    Database: hakemAI
2025-11-26 19:07:48,484 - app.services.user_documents_service - INFO - âœ… User Documents Service connected to MongoDB
2025-11-26 19:07:48,485 - main - INFO -   âœ… User Documents Service connected
2025-11-26 19:07:48,485 - main - INFO -   âœ… Progress tracker cleanup task started
2025-11-26 19:07:48,485 - main - INFO - 
2025-11-26 19:07:48,485 - main - INFO -   ðŸŽ¯ INTEGRATED COMPONENTS:
2025-11-26 19:07:48,486 - main - INFO -      â€¢ AI Parser v6.0: 6-stage comprehensive extraction
2025-11-26 19:07:48,486 - main - INFO -        - Proper entity identification (insurer vs insured)
2025-11-26 19:07:48,486 - main - INFO -        - Separates warranties from extensions
2025-11-26 19:07:48,486 - main - INFO -        - Extracts subjectivities & operational details
2025-11-26 19:07:48,486 - main - INFO -        - Correct deductible tier detection
2025-11-26 19:07:48,487 - main - INFO -        - Full benefits extraction (30+, not 4)
2025-11-26 19:07:48,487 - main - INFO - 
2025-11-26 19:07:48,487 - main - INFO -      â€¢ AI Ranker v2.0: Complete comparison engine
2025-11-26 19:07:48,487 - main - INFO -        - Generates ALL sections comprehensively
2025-11-26 19:07:48,487 - main - INFO -        - Identifies unique items per provider
2025-11-26 19:07:48,487 - main - INFO -        - Transparent scoring methodology
2025-11-26 19:07:48,488 - main - INFO -        - Uses full _extended_data from parser
2025-11-26 19:07:48,488 - main - INFO - 
2025-11-26 19:07:48,488 - main - INFO -      â€¢ Routes v3.1: Simplified orchestration
2025-11-26 19:07:48,488 - main - INFO -        - Single endpoint auto-populates everything
2025-11-26 19:07:48,488 - main - INFO -        - No manual section generation
2025-11-26 19:07:48,489 - main - INFO -        - Complete MongoDB integration
2025-11-26 19:07:48,489 - main - INFO - 
2025-11-26 19:07:48,489 - main - INFO -   ðŸ”§ CRITICAL FIXES IN v3.1:
2025-11-26 19:07:48,489 - main - INFO -      âœ… Benefits count: 30+ (was 4)
2025-11-26 19:07:48,489 - main - INFO -      âœ… Warranty categorization: Proper separation
2025-11-26 19:07:48,490 - main - INFO -      âœ… Subjectivities: Now included
2025-11-26 19:07:48,490 - main - INFO -      âœ… Deductibles: Correct tier (SR 1M, not SR 50K)
2025-11-26 19:07:48,490 - main - INFO -      âœ… Operational details: Validity, payment, brokerage
2025-11-26 19:07:48,490 - main - INFO -      âœ… Scoring: Transparent methodology with breakdown
2025-11-26 19:07:48,490 - main - INFO - 
2025-11-26 19:07:48,491 - main - INFO -   ðŸ“¡ AVAILABLE ENDPOINTS:
2025-11-26 19:07:48,491 - main - INFO -      Main:
2025-11-26 19:07:48,491 - main - INFO -        POST /api/compare-quotes           Upload PDFs, get everything
2025-11-26 19:07:48,491 - main - INFO - 
2025-11-26 19:07:48,491 - main - INFO -      Retrieval:
2025-11-26 19:07:48,492 - main - INFO -        GET  /api/comparisons/{id}         Complete comparison
2025-11-26 19:07:48,492 - main - INFO -        POST /api/summary                  Rankings & analysis
2025-11-26 19:07:48,493 - main - INFO -        POST /api/key-differences          Unique items per provider
2025-11-26 19:07:48,493 - main - INFO -        POST /api/side-by-side             Top providers comparison
2025-11-26 19:07:48,493 - main - INFO -        POST /api/data-table               Sortable data grid
2025-11-26 19:07:48,493 - main - INFO -        POST /api/analytics                Charts & statistics
2025-11-26 19:07:48,493 - main - INFO -        POST /api/provider-cards           UI-ready summaries
2025-11-26 19:07:48,494 - main - INFO - 
2025-11-26 19:07:48,494 - main - INFO -      Management:
2025-11-26 19:07:48,494 - main - INFO -        GET  /api/comparisons/recent       Recent comparisons
2025-11-26 19:07:48,494 - main - INFO -        GET  /api/comparisons/search       Search by provider
2025-11-26 19:07:48,494 - main - INFO -        DELETE /api/comparisons/{id}       Delete comparison
2025-11-26 19:07:48,495 - main - INFO - 
2025-11-26 19:07:48,495 - main - INFO -      Documents (MongoDB):
2025-11-26 19:07:48,495 - main - INFO -        GET  /api/documents                All documents
2025-11-26 19:07:48,495 - main - INFO -        GET  /api/documents/{id}           Specific document
2025-11-26 19:07:48,495 - main - INFO -        GET  /api/documents/search/{q}     Search documents
2025-11-26 19:07:48,496 - main - INFO -        DELETE /api/documents/{id}         Delete document
2025-11-26 19:07:48,496 - main - INFO - 
2025-11-26 19:07:48,496 - main - INFO -      Diagnostics & Health:
2025-11-26 19:07:48,496 - main - INFO -        GET  /api/health                   System health
2025-11-26 19:07:48,496 - main - INFO -        GET  /api/status                   Detailed status
2025-11-26 19:07:48,496 - main - INFO -        GET  /api/diagnostics/comparison/{id}  Comparison diagnostics
2025-11-26 19:07:48,497 - main - INFO - 
2025-11-26 19:07:48,497 - main - INFO -   ðŸ“Š AUTO-GENERATED SECTIONS:
2025-11-26 19:07:48,497 - main - INFO -      âœ“ Summary with rankings & detailed analysis
2025-11-26 19:07:48,497 - main - INFO -      âœ“ Key Differences (unique warranties, exclusions)
2025-11-26 19:07:48,497 - main - INFO -      âœ“ Side-by-Side (top providers comparison matrix)
2025-11-26 19:07:48,498 - main - INFO -      âœ“ Data Table (sortable, filterable)
2025-11-26 19:07:48,498 - main - INFO -      âœ“ Analytics (premium charts, score charts, features)
2025-11-26 19:07:48,498 - main - INFO -      âœ“ Provider Cards (UI-ready summaries)
2025-11-26 19:07:48,499 - main - INFO -      âœ“ Extracted Quotes (full data with all benefits)
2025-11-26 19:07:48,500 - main - INFO - 
2025-11-26 19:07:48,500 - main - INFO -   ðŸŽ¯ WORKFLOW:
2025-11-26 19:07:48,501 - main - INFO -      1. Upload 1-10 PDFs â†’ POST /api/compare-quotes
2025-11-26 19:07:48,501 - main - INFO -      2. Receive comparison_id + complete data
2025-11-26 19:07:48,501 - main - INFO -      3. Retrieve sections using comparison_id
2025-11-26 19:07:48,501 - main - INFO -      4. No re-upload needed!
2025-11-26 19:07:48,501 - main - INFO - 
2025-11-26 19:07:48,502 - main - INFO - ================================================================================
2025-11-26 19:07:48,502 - main - INFO -   âœ… Application started successfully!
2025-11-26 19:07:48,502 - main - INFO -   ðŸ“š API Docs: http://localhost:8000/docs
2025-11-26 19:07:48,502 - main - INFO -   ðŸ“– ReDoc: http://localhost:8000/redoc
2025-11-26 19:07:48,502 - main - INFO - ================================================================================
2025-11-26 19:07:48,503 - main - INFO - 
2025-11-26 19:07:48,503 - app.services.progress_tracker - INFO - ðŸ”„ Starting progress cleanup task (interval: 300s)
